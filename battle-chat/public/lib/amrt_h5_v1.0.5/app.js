var AMRT=function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=h()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&c(r,n.prototype),r}).apply(null,arguments)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function p(e){var t=h();return function(){var n,i=l(e);if(t){var r=l(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return f(this,n)}}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}(e,t)||x(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||x(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=x(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}Array.prototype.insert=function(e,t){this.splice(t,0,e)},Array.prototype.removeAt=function(e){return!(isNaN(e)||e>=this.length)&&this.splice(e,1)[0]},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t});var M="111",B={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},I=100,E=200,S=201,T=202,L=204,F=205,_=206,U=208,P=300,k=301,D=302,R=304,O=306,N=307,G=1e3,Q=1001,H=1002,z=1003,V=1004,j=1005,W=1006,X=1007,Z=1008,Y=1009,K=1012,J=1014,q=1015,$=1016,ee=1017,te=1018,ne=1019,ie=1020,re=1021,ae=1022,oe=1023,se=1024,Ae=1025,le=oe,ce=1026,he=1027,ue=1028,de=33776,fe=33777,pe=33778,me=33779,ge=35840,ve=35841,ye=35842,we=35843,xe=36196,be=37808,Ce=36492,Me=37492,Be=37496,Ie=2200,Ee=2201,Se=2300,Te=2301,Le=2302,Fe=2400,_e=2401,Ue=2402,Pe=3e3,ke=3001,De=3007,Re=3002,Oe=3004,Ne=3005,Ge=3006,Qe=3201,He=7680,ze=35044,Ve=35048,je=5e3,We=2e3;function Xe(){}Object.assign(Xe.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e)}}}});for(var Ze=[],Ye=0;Ye<256;Ye++)Ze[Ye]=(Ye<16?"0":"")+Ye.toString(16);var Ke={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ze[255&e]+Ze[e>>8&255]+Ze[e>>16&255]+Ze[e>>24&255]+"-"+Ze[255&t]+Ze[t>>8&255]+"-"+Ze[t>>16&15|64]+Ze[t>>24&255]+"-"+Ze[63&n|128]+Ze[n>>8&255]+"-"+Ze[n>>16&255]+Ze[n>>24&255]+Ze[255&i]+Ze[i>>8&255]+Ze[i>>16&255]+Ze[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ke.DEG2RAD},radToDeg:function(e){return e*Ke.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){var t=Math.log(e)/Math.LN2;return t=t-Math.floor(t)<=.5?Math.floor(t):Math.ceil(t),Math.pow(2,t)}};function Je(e,t){this.x=e||0,this.y=t||0}function qe(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1}Object.defineProperties(Je.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Je.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}}),Object.assign(qe,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,a,o){var s=n[i+0],A=n[i+1],l=n[i+2],c=n[i+3],h=r[a+0],u=r[a+1],d=r[a+2],f=r[a+3];if(c!==f||s!==h||A!==u||l!==d){var p=1-o,m=s*h+A*u+l*d+c*f,g=m>=0?1:-1,v=1-m*m;if(v>Number.EPSILON){var y=Math.sqrt(v),w=Math.atan2(y,m*g);p=Math.sin(p*w)/y,o=Math.sin(o*w)/y}var x=o*g;if(s=s*p+h*x,A=A*p+u*x,l=l*p+d*x,c=c*p+f*x,p===1-o){var b=1/Math.sqrt(s*s+A*A+l*l+c*c);s*=b,A*=b,l*=b,c*=b}}e[t]=s,e[t+1]=A,e[t+2]=l,e[t+3]=c}}),Object.defineProperties(qe.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(qe.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e.order,o=Math.cos,s=Math.sin,A=o(n/2),l=o(i/2),c=o(r/2),h=s(n/2),u=s(i/2),d=s(r/2);return"XYZ"===a?(this._x=h*l*c+A*u*d,this._y=A*u*c-h*l*d,this._z=A*l*d+h*u*c,this._w=A*l*c-h*u*d):"YXZ"===a?(this._x=h*l*c+A*u*d,this._y=A*u*c-h*l*d,this._z=A*l*d-h*u*c,this._w=A*l*c+h*u*d):"ZXY"===a?(this._x=h*l*c-A*u*d,this._y=A*u*c+h*l*d,this._z=A*l*d+h*u*c,this._w=A*l*c-h*u*d):"ZYX"===a?(this._x=h*l*c-A*u*d,this._y=A*u*c+h*l*d,this._z=A*l*d-h*u*c,this._w=A*l*c+h*u*d):"YZX"===a?(this._x=h*l*c+A*u*d,this._y=A*u*c+h*l*d,this._z=A*l*d-h*u*c,this._w=A*l*c-h*u*d):"XZY"===a&&(this._x=h*l*c-A*u*d,this._y=A*u*c-h*l*d,this._z=A*l*d+h*u*c,this._w=A*l*c+h*u*d),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],a=n[8],o=n[1],s=n[5],A=n[9],l=n[2],c=n[6],h=n[10],u=i+s+h;return u>0?(t=.5/Math.sqrt(u+1),this._w=.25/t,this._x=(c-A)*t,this._y=(a-l)*t,this._z=(o-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(c-A)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(a+l)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(a-l)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(A+c)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(o-r)/t,this._x=(a+l)/t,this._y=(A+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Ke.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},invert:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,A=t._z,l=t._w;return this._x=n*l+a*o+i*A-r*s,this._y=i*l+a*s+r*o-n*A,this._z=r*l+a*A+n*s-i*o,this._w=a*l-n*o-i*s-r*A,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var A=1-t;return this._w=A*a+t*this._w,this._x=A*n+t*this._x,this._y=A*i+t*this._y,this._z=A*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=a*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},slerpQuaternions:function(e,t,n){return this.copy(e).slerp(t,n)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var $e=new tt,et=new qe;function tt(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(tt.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(et.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(et.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,A=s*t+a*i-o*n,l=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=A*s+h*-r+l*-o-c*-a,this.y=l*s+h*-a+c*-r-A*-o,this.z=c*s+h*-o+A*-a-l*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return $e.copy(this).projectOnVector(e),this.sub($e)},reflect:function(e){return this.sub($e.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("Vector3: angleTo() can't handle zero length vectors.");var n=this.dot(e)/t;return Math.acos(Ke.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var nt,it=new tt;function rt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(rt.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,a,o,s,A){var l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=r,l[5]=s,l[6]=n,l[7]=a,l[8]=A,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)it.x=e.getX(t),it.y=e.getY(t),it.z=e.getZ(t),it.applyMatrix3(this),e.setXYZ(t,it.x,it.y,it.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],A=n[1],l=n[4],c=n[7],h=n[2],u=n[5],d=n[8],f=i[0],p=i[3],m=i[6],g=i[1],v=i[4],y=i[7],w=i[2],x=i[5],b=i[8];return r[0]=a*f+o*g+s*w,r[3]=a*p+o*v+s*x,r[6]=a*m+o*y+s*b,r[1]=A*f+l*g+c*w,r[4]=A*p+l*v+c*x,r[7]=A*m+l*y+c*b,r[2]=h*f+u*g+d*w,r[5]=h*p+u*v+d*x,r[8]=h*m+u*y+d*b,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],A=e[7],l=e[8];return t*a*l-t*o*A-n*r*l+n*o*s+i*r*A-i*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,r=n[0],a=n[1],o=n[2],s=n[3],A=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=u*A-l*h,f=l*c-u*s,p=h*s-A*c,m=r*d+a*f+o*p;if(0===m){var g="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var v=1/m;return i[0]=d*v,i[1]=(o*h-u*a)*v,i[2]=(l*a-o*A)*v,i[3]=f*v,i[4]=(u*r-o*c)*v,i[5]=(o*s-l*r)*v,i[6]=p*v,i[7]=(a*c-h*r)*v,i[8]=(A*r-a*s)*v,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,r,a,o){var s=Math.cos(r),A=Math.sin(r);this.set(n*s,n*A,-n*(s*a+A*o)+a+e,-i*A,i*s,-i*(-A*a+s*o)+o+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],A=i[4],l=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*A,i[6]=t*o+n*l,i[1]=-n*r+t*s,i[4]=-n*a+t*A,i[7]=-n*o+t*l,this},rotateY:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements;return i[0]=t,i[6]=-n,i[2]=n,i[8]=t,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var at={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===nt&&(nt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),nt.width=e.width,nt.height=e.height;var n=nt.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=nt}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},ot=0;function st(e,t,n,i,r,a,o,s,A,l){Object.defineProperty(this,"id",{value:ot++}),this.uuid=Ke.generateUUID(),this.name="",this.image=void 0!==e?e:st.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:st.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Q,this.wrapT=void 0!==i?i:Q,this.magFilter=void 0!==r?r:W,this.minFilter=void 0!==a?a:Z,this.anisotropy=void 0!==A?A:1,this.format=void 0!==o?o:oe,this.type=void 0!==s?s:Y,this.offset=new Je(0,0),this.repeat=new Je(1,1),this.center=new Je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:Pe,this.version=0,this.onUpdate=null}function At(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1}function lt(e,t,n){this.width=e,this.height=t,this.scissor=new At(0,0,e,t),this.scissorTest=!1,this.viewport=new At(0,0,e,t),n=n||{},this.texture=new st(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:W,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function ct(e,t,n){lt.call(this,e,t,n),this.samples=4}st.DEFAULT_IMAGE=void 0,st.DEFAULT_MAPPING=P,st.prototype=Object.assign(Object.create(Xe.prototype),{constructor:st,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=Ke.generateUUID()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)r.push(at.getDataURL(i[a]))}else r=at.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==P)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case G:e.x=e.x-Math.floor(e.x);break;case Q:e.x=e.x<0?0:1;break;case H:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case G:e.y=e.y-Math.floor(e.y);break;case Q:e.y=e.y<0?0:1;break;case H:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(st.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(At.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(At.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,A=s[0],l=s[4],c=s[8],h=s[1],u=s[5],d=s[9],f=s[2],p=s[6],m=s[10];if(Math.abs(l-h)<a&&Math.abs(c-f)<a&&Math.abs(d-p)<a){if(Math.abs(l+h)<o&&Math.abs(c+f)<o&&Math.abs(d+p)<o&&Math.abs(A+u+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(A+1)/2,v=(u+1)/2,y=(m+1)/2,w=(l+h)/4,x=(c+f)/4,b=(d+p)/4;return g>v&&g>y?g<a?(n=0,i=.707106781,r=.707106781):(i=w/(n=Math.sqrt(g)),r=x/n):v>y?v<a?(n=.707106781,i=0,r=.707106781):(n=w/(i=Math.sqrt(v)),r=b/i):y<a?(n=.707106781,i=.707106781,r=0):(n=x/(r=Math.sqrt(y)),i=b/r),this.set(n,i,r,t),this}var C=Math.sqrt((p-d)*(p-d)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(C)<.001&&(C=1),this.x=(p-d)/C,this.y=(c-f)/C,this.z=(h-l)/C,this.w=Math.acos((A+u+m-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),lt.prototype=Object.assign(Object.create(Xe.prototype),{constructor:lt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ct.prototype=Object.assign(Object.create(lt.prototype),{constructor:ct,isWebGLMultisampleRenderTarget:!0,copy:function(e){return lt.prototype.copy.call(this,e),this.samples=e.samples,this}});var ht=new tt,ut=new vt,dt=new tt(0,0,0),ft=new tt(1,1,1),pt=new tt,mt=new tt,gt=new tt;function vt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(vt.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,a,o,s,A,l,c,h,u,d,f,p){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=A,m[6]=l,m[10]=c,m[14]=h,m[3]=u,m[7]=d,m[11]=f,m[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new vt).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,i=1/ht.setFromMatrixColumn(e,0).length(),r=1/ht.setFromMatrixColumn(e,1).length(),a=1/ht.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),A=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*l,u=a*c,d=o*l,f=o*c;t[0]=s*l,t[4]=-s*c,t[8]=A,t[1]=u+d*A,t[5]=h-f*A,t[9]=-o*s,t[2]=f-h*A,t[6]=d+u*A,t[10]=a*s}else if("YXZ"===e.order){var p=s*l,m=s*c,g=A*l,v=A*c;t[0]=p+v*o,t[4]=g*o-m,t[8]=a*A,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=m*o-g,t[6]=v+p*o,t[10]=a*s}else if("ZXY"===e.order){p=s*l,m=s*c,g=A*l,v=A*c;t[0]=p-v*o,t[4]=-a*c,t[8]=g+m*o,t[1]=m+g*o,t[5]=a*l,t[9]=v-p*o,t[2]=-a*A,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){h=a*l,u=a*c,d=o*l,f=o*c;t[0]=s*l,t[4]=d*A-u,t[8]=h*A+f,t[1]=s*c,t[5]=f*A+h,t[9]=u*A-d,t[2]=-A,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var y=a*s,w=a*A,x=o*s,b=o*A;t[0]=s*l,t[4]=b-y*c,t[8]=x*c+w,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-A*l,t[6]=w*c+x,t[10]=y-b*c}else if("XZY"===e.order){y=a*s,w=a*A,x=o*s,b=o*A;t[0]=s*l,t[4]=-c,t[8]=A*l,t[1]=y*c+b,t[5]=a*l,t[9]=w*c-x,t[2]=x*c-w,t[6]=o*l,t[10]=b*c+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(dt,e,ft)},lookAt:function(e,t,n){var i=this.elements;return gt.subVectors(e,t),0===gt.lengthSq()&&(gt.z=1),gt.normalize(),pt.crossVectors(n,gt),0===pt.lengthSq()&&(1===Math.abs(n.z)?gt.x+=1e-4:gt.z+=1e-4,gt.normalize(),pt.crossVectors(n,gt)),pt.normalize(),mt.crossVectors(gt,pt),i[0]=pt.x,i[4]=mt.x,i[8]=gt.x,i[1]=pt.y,i[5]=mt.y,i[9]=gt.y,i[2]=pt.z,i[6]=mt.z,i[10]=gt.z,this},multiply:function(e,t){return void 0!==t?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],A=n[12],l=n[1],c=n[5],h=n[9],u=n[13],d=n[2],f=n[6],p=n[10],m=n[14],g=n[3],v=n[7],y=n[11],w=n[15],x=i[0],b=i[4],C=i[8],M=i[12],B=i[1],I=i[5],E=i[9],S=i[13],T=i[2],L=i[6],F=i[10],_=i[14],U=i[3],P=i[7],k=i[11],D=i[15];return r[0]=a*x+o*B+s*T+A*U,r[4]=a*b+o*I+s*L+A*P,r[8]=a*C+o*E+s*F+A*k,r[12]=a*M+o*S+s*_+A*D,r[1]=l*x+c*B+h*T+u*U,r[5]=l*b+c*I+h*L+u*P,r[9]=l*C+c*E+h*F+u*k,r[13]=l*M+c*S+h*_+u*D,r[2]=d*x+f*B+p*T+m*U,r[6]=d*b+f*I+p*L+m*P,r[10]=d*C+f*E+p*F+m*k,r[14]=d*M+f*S+p*_+m*D,r[3]=g*x+v*B+y*T+w*U,r[7]=g*b+v*I+y*L+w*P,r[11]=g*C+v*E+y*F+w*k,r[15]=g*M+v*S+y*_+w*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)ht.x=e.getX(t),ht.y=e.getY(t),ht.z=e.getZ(t),ht.applyMatrix4(this),e.setXYZ(t,ht.x,ht.y,ht.z);return e},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],A=e[13],l=e[2],c=e[6],h=e[10],u=e[14];return e[3]*(+r*s*c-i*A*c-r*o*h+n*A*h+i*o*u-n*s*u)+e[7]*(+t*s*u-t*A*h+r*a*h-i*a*u+i*A*l-r*s*l)+e[11]*(+t*A*c-t*o*u-r*a*c+n*a*u+r*o*l-n*A*l)+e[15]*(-i*o*l-t*s*c+t*o*h+i*a*c-n*a*h+n*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],A=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],f=i[10],p=i[11],m=i[12],g=i[13],v=i[14],y=i[15],w=d*v*h-g*f*h+g*c*p-l*v*p-d*c*y+l*f*y,x=m*f*h-u*v*h-m*c*p+A*v*p+u*c*y-A*f*y,b=u*g*h-m*d*h+m*l*p-A*g*p-u*l*y+A*d*y,C=m*d*c-u*g*c-m*l*f+A*g*f+u*l*v-A*d*v,M=r*w+a*x+o*b+s*C;if(0===M){var B="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(B);return console.warn(B),this.identity()}var I=1/M;return n[0]=w*I,n[1]=(g*f*s-d*v*s-g*o*p+a*v*p+d*o*y-a*f*y)*I,n[2]=(l*v*s-g*c*s+g*o*h-a*v*h-l*o*y+a*c*y)*I,n[3]=(d*c*s-l*f*s-d*o*h+a*f*h+l*o*p-a*c*p)*I,n[4]=x*I,n[5]=(u*v*s-m*f*s+m*o*p-r*v*p-u*o*y+r*f*y)*I,n[6]=(m*c*s-A*v*s-m*o*h+r*v*h+A*o*y-r*c*y)*I,n[7]=(A*f*s-u*c*s+u*o*h-r*f*h-A*o*p+r*c*p)*I,n[8]=b*I,n[9]=(m*d*s-u*g*s-m*a*p+r*g*p+u*a*y-r*d*y)*I,n[10]=(A*g*s-m*l*s+m*a*h-r*g*h-A*a*y+r*l*y)*I,n[11]=(u*l*s-A*d*s-u*a*h+r*d*h+A*a*p-r*l*p)*I,n[12]=C*I,n[13]=(u*g*o-m*d*o+m*a*f-r*g*f-u*a*v+r*d*v)*I,n[14]=(m*l*o-A*g*o-m*a*c+r*g*c+A*a*v-r*l*v)*I,n[15]=(A*d*o-u*l*o+u*a*c-r*d*c-A*a*f+r*l*f)*I,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,A=r*a,l=r*o;return this.set(A*a+n,A*o-i*s,A*s+i*o,0,A*o+i*s,l*o+n,l*s-i*a,0,A*s-i*o,l*s+i*a,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,A=r+r,l=a+a,c=o+o,h=r*A,u=r*l,d=r*c,f=a*l,p=a*c,m=o*c,g=s*A,v=s*l,y=s*c,w=n.x,x=n.y,b=n.z;return i[0]=(1-(f+m))*w,i[1]=(u+y)*w,i[2]=(d-v)*w,i[3]=0,i[4]=(u-y)*x,i[5]=(1-(h+m))*x,i[6]=(p+g)*x,i[7]=0,i[8]=(d+v)*b,i[9]=(p-g)*b,i[10]=(1-(h+f))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,n){var i=this.elements,r=ht.set(i[0],i[1],i[2]).length(),a=ht.set(i[4],i[5],i[6]).length(),o=ht.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],ut.copy(this);var s=1/r,A=1/a,l=1/o;return ut.elements[0]*=s,ut.elements[1]*=s,ut.elements[2]*=s,ut.elements[4]*=A,ut.elements[5]*=A,ut.elements[6]*=A,ut.elements[8]*=l,ut.elements[9]*=l,ut.elements[10]*=l,t.setFromRotationMatrix(ut),n.x=r,n.y=a,n.z=o,this},makePerspective:function(e,t,n,i,r,a){void 0===a&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),A=2*r/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),u=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=A,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=u,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),A=1/(n-i),l=1/(a-r),c=(t+e)*s,h=(n+i)*A,u=(a+r)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*A,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-u,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},invert:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],A=e[7],l=e[8],c=e[9],h=e[10],u=e[11],d=e[12],f=e[13],p=e[14],m=e[15],g=c*p*A-f*h*A+f*s*u-o*p*u-c*s*m+o*h*m,v=d*h*A-l*p*A-d*s*u+a*p*u+l*s*m-a*h*m,y=l*f*A-d*c*A+d*o*u-a*f*u-l*o*m+a*c*m,w=d*c*s-l*f*s-d*o*h+a*f*h+l*o*p-a*c*p,x=t*g+n*v+i*y+r*w;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var b=1/x;return e[0]=g*b,e[1]=(f*h*r-c*p*r-f*i*u+n*p*u+c*i*m-n*h*m)*b,e[2]=(o*p*r-f*s*r+f*i*A-n*p*A-o*i*m+n*s*m)*b,e[3]=(c*s*r-o*h*r-c*i*A+n*h*A+o*i*u-n*s*u)*b,e[4]=v*b,e[5]=(l*p*r-d*h*r+d*i*u-t*p*u-l*i*m+t*h*m)*b,e[6]=(d*s*r-a*p*r-d*i*A+t*p*A+a*i*m-t*s*m)*b,e[7]=(a*h*r-l*s*r+l*i*A-t*h*A-a*i*u+t*s*u)*b,e[8]=y*b,e[9]=(d*c*r-l*f*r-d*n*u+t*f*u+l*n*m-t*c*m)*b,e[10]=(a*f*r-d*o*r+d*n*A-t*f*A-a*n*m+t*o*m)*b,e[11]=(l*o*r-a*c*r-l*n*A+t*c*A+a*n*u-t*o*u)*b,e[12]=w*b,e[13]=(l*f*i-d*c*i+d*n*h-t*f*h-l*n*p+t*c*p)*b,e[14]=(d*o*i-a*f*i-d*n*s+t*f*s+a*n*p-t*o*p)*b,e[15]=(a*c*i-l*o*i+l*n*s-t*c*s-a*n*h+t*o*h)*b,this}});var yt=new vt,wt=new qe;function xt(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||xt.DefaultOrder}function bt(){this._mask=1}xt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],xt.DefaultOrder="XYZ",Object.defineProperties(xt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(xt.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=Ke.clamp,r=e.elements,a=r[0],o=r[4],s=r[8],A=r[1],l=r[5],c=r[9],h=r[2],u=r[6],d=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(A,l)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(A,a))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(A,a)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(i(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,d),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return yt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(yt,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return wt.setFromEuler(this),this.setFromQuaternion(wt,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new tt(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.defineProperties(bt.prototype,{mask:{get:function(){return this._mask},set:function(e){this._mask=e,this._onChangeCallback()}}}),Object.assign(bt.prototype,{set:function(e){this.mask=1<<e|0,this._onChangeCallback()},enable:function(e){this.mask|=1<<e|0,this._onChangeCallback()},enableAll:function(){this.mask=-1,this._onChangeCallback()},toggle:function(e){this.mask^=1<<e|0,this._onChangeCallback()},disable:function(e){this.mask&=~(1<<e|0),this._onChangeCallback()},disableAll:function(){this.mask=0,this._onChangeCallback()},test:function(e){return 0!=(this.mask&e.mask)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Ct=0,Mt=new tt,Bt=new qe,It=new vt,Et=new tt,St=new tt,Tt=new tt,Lt=new qe,Ft=new tt(1,0,0),_t=new tt(0,1,0),Ut=new tt(0,0,1),Pt={type:"added"},kt={type:"removed"};function Dt(){Object.defineProperty(this,"id",{value:Ct++}),this.viewer=null,this.uuid=Ke.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dt.DefaultUp.clone();var e=new tt,t=new xt,n=new qe,i=new tt(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new vt},normalMatrix:{value:new rt}}),this.matrix=new vt,this.matrixWorld=new vt,this.matrixAutoUpdate=Dt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new bt;var r=this;this.layers._onChange((function(){r.viewer&&r.viewer.renderManager.render()})),this._visible=!0,this._castShadow=!1,this._receiveShadow=!1,this._frustumCulled=!0,this._renderOrder=0,this.userData={},this.isDirty=!1}function Rt(){Dt.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Dt.DefaultUp=new tt(0,1,0),Dt.DefaultMatrixAutoUpdate=!0,Object.defineProperties(Dt.prototype,{visible:{get:function(){return this._visible},set:function(e){this._visible!==e&&(this.viewer&&this.viewer.renderManager.render(),this.activeCallback(this._visible)),this._visible=e}},castShadow:{get:function(){return this._castShadow},set:function(e){this._castShadow!==e&&this.viewer&&this.viewer.renderManager.render(),this._castShadow=e}},receiveShadow:{get:function(){return this._receiveShadow},set:function(e){this._receiveShadow!==e&&this.viewer&&this.viewer.renderManager.render(),this._receiveShadow=e}},frustumCulled:{get:function(){return this._frustumCulled},set:function(e){this._frustumCulled!==e&&this.viewer&&this.viewer.renderManager.render(),this._frustumCulled=e}},renderOrder:{get:function(){return this._renderOrder},set:function(e){this._renderOrder!==e&&this.viewer&&this.viewer.renderManager.render(),this._renderOrder=e}}}),Object.assign(Dt.prototype,Xe.prototype),Dt.prototype=Object.assign(Dt.prototype,{constructor:Dt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},setDirty:function(){this.isDirty=!0},activeCallback:function(e){},applyMatrix:function(e){this.viewer&&this.viewer.renderManager.render(),this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyMatrix4:function(e){this.applyMatrix(e)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Bt.setFromAxisAngle(e,t),this.quaternion.multiply(Bt),this},rotateOnWorldAxis:function(e,t){return Bt.setFromAxisAngle(e,t),this.quaternion.premultiply(Bt),this},rotateX:function(e){return this.rotateOnAxis(Ft,e)},rotateY:function(e){return this.rotateOnAxis(_t,e)},rotateZ:function(e){return this.rotateOnAxis(Ut,e)},setRotation:function(e,t,n){void 0!==e&&(this.rotation.x=Ke.degToRad(e)),void 0!==t&&(this.rotation.y=Ke.degToRad(t)),void 0!==n&&(this.rotation.z=Ke.degToRad(n))},getRotation:function(){return{x:Ke.radToDeg(this.rotation.x),y:Ke.radToDeg(this.rotation.y),z:Ke.radToDeg(this.rotation.z)}},setScale:function(e,t,n){this.scale.set(e,t,n)},translateOnAxis:function(e,t){return Mt.copy(e).applyQuaternion(this.quaternion),this.position.add(Mt.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Ft,e)},translateY:function(e){return this.translateOnAxis(_t,e)},translateZ:function(e){return this.translateOnAxis(Ut,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(It.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?Et.copy(e):Et.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),St.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?It.lookAt(St,Et,this.up):It.lookAt(Et,St,this.up),this.quaternion.setFromRotationMatrix(It),i&&(It.extractRotation(i.matrixWorld),Bt.setFromRotationMatrix(It),this.quaternion.premultiply(Bt.inverse()))},add:function(e){if(this.viewer&&this.viewer.renderManager.render(),arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.viewer=this.viewer,this.children.push(e),e.dispatchEvent(Pt)):console.error("Object3D.add: object not an instance of Object3D.",e),this)},remove:function(e){if(this.viewer&&this.viewer.renderManager.render(),arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(kt)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),It.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),It.multiply(e.parent.matrixWorld)),e.applyMatrix(It),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("Object3D: .getWorldPosition() target is now required"),e=new tt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),e=new qe),this.updateMatrixWorld(!0),this.matrixWorld.decompose(St,e,Tt),e},getWorldScale:function(e){return void 0===e&&(console.warn("Object3D: .getWorldScale() target is now required"),e=new tt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(St,Lt,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("Object3D: .getWorldDirection() target is now required"),e=new tt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){var e=this.matrix.clone();this.matrix.compose(this.position,this.quaternion,this.scale),this.matrix.equals(e)||this.viewer&&this.viewer.renderManager.render(),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){var t=this.matrixWorld.clone();null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0,this.matrixWorld.equals(t)||(this.viewer&&this.viewer.renderManager.render(),this.setDirty())}for(var n=this.children,i=0,r=n.length;i<r;i++)n[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){this.viewer&&this.viewer.renderManager.render();var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh&&0!==this.drawMode&&(i.drawMode=this.drawMode),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,A=o.length;s<A;s++){var l=o[s];r(e.shapes,l)}else r(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,A=this.material.length;s<A;s++)c.push(r(e.materials,this.material[s]));i.material=c}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(e).object)}if(t){var h=p(e.geometries),u=p(e.materials),d=p(e.textures),f=p(e.images);o=p(e.shapes);h.length>0&&(n.geometries=h),u.length>0&&(n.materials=u),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),o.length>0&&(n.shapes=o)}return n.object=i,n;function p(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(this.viewer&&this.viewer.renderManager.render(),void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}),Rt.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Rt,isScene:!0,copy:function(e,t){return Dt.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Dt.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ot=[new tt,new tt,new tt,new tt,new tt,new tt,new tt,new tt],Nt=new tt,Gt=new Jt,Qt=new tt,Ht=new tt,zt=new tt,Vt=new tt,jt=new tt,Wt=new tt,Xt=new tt,Zt=new tt,Yt=new tt,Kt=new tt;function Jt(e,t){this.min=void 0!==e?e:new tt(1/0,1/0,1/0),this.max=void 0!==t?t:new tt(-1/0,-1/0,-1/0)}function qt(e,t,n,i,r){var a,o;for(a=0,o=e.length-3;a<=o;a+=3){Kt.fromArray(e,a);var s=r.x*Math.abs(Kt.x)+r.y*Math.abs(Kt.y)+r.z*Math.abs(Kt.z),A=t.dot(Kt),l=n.dot(Kt),c=i.dot(Kt);if(Math.max(-Math.max(A,l,c),Math.min(A,l,c))>s)return!1}return!0}Object.assign(Jt.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,A=e.length;s<A;s+=3){var l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,A=e.count;s<A;s++){var l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=Nt.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("Box3: .getCenter() target is now required"),e=new tt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box3: .getSize() target is now required"),e=new tt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;if(t){if(t||console.log(e),null===t.boundingBox&&t.computeBoundingBox(),Gt.copy(t.boundingBox),Gt.applyMatrix4(e.matrixWorld),isNaN(Gt.min.x)||isNaN(Gt.max.x))return;this.expandByPoint(Gt.min),this.expandByPoint(Gt.max)}for(var n=e.children,i=0,r=n.length;i<r;i++)void 0===n[i].isAmrtAlphaHotSpotEntity&&this.expandByObject(n[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("Box3: .getParameter() target is now required"),t=new tt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,Nt),Nt.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Xt),Zt.subVectors(this.max,Xt),Qt.subVectors(e.a,Xt),Ht.subVectors(e.b,Xt),zt.subVectors(e.c,Xt),Vt.subVectors(Ht,Qt),jt.subVectors(zt,Ht),Wt.subVectors(Qt,zt);var t=[0,-Vt.z,Vt.y,0,-jt.z,jt.y,0,-Wt.z,Wt.y,Vt.z,0,-Vt.x,jt.z,0,-jt.x,Wt.z,0,-Wt.x,-Vt.y,Vt.x,0,-jt.y,jt.x,0,-Wt.y,Wt.x,0];return!!qt(t,Qt,Ht,zt,Zt)&&(!!qt(t=[1,0,0,0,1,0,0,0,1],Qt,Ht,zt,Zt)&&(Yt.crossVectors(Vt,jt),qt(t=[Yt.x,Yt.y,Yt.z],Qt,Ht,zt,Zt)))},clampPoint:function(e,t){return void 0===t&&(console.warn("Box3: .clampPoint() target is now required"),t=new tt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Nt.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Nt).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(Ot[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ot[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ot[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ot[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ot[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ot[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ot[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ot[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ot)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var $t=new Jt;function en(e,t){this.center=void 0!==e?e:new tt,this.radius=void 0!==t?t:0}Object.assign(en.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):$t.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(t=new tt),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(e=new Jt),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var tn=new tt,nn=new tt,rn=new tt,an=new tt,on=new tt,sn=new tt,An=new tt;function ln(e,t){this.origin=void 0!==e?e:new tt,this.direction=void 0!==t?t:new tt(0,0,-1)}Object.assign(ln.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(t=new tt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,tn)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("Ray: .closestPointToPoint() target is now required"),t=new tt),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=tn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(tn.copy(this.direction).multiplyScalar(t).add(this.origin),tn.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,i){nn.copy(e).add(t).multiplyScalar(.5),rn.copy(t).sub(e).normalize(),an.copy(this.origin).sub(nn);var r,a,o,s,A=.5*e.distanceTo(t),l=-this.direction.dot(rn),c=an.dot(this.direction),h=-an.dot(rn),u=an.lengthSq(),d=Math.abs(1-l*l);if(d>0)if(a=l*c-h,s=A*d,(r=l*h-c)>=0)if(a>=-s)if(a<=s){var f=1/d;o=(r*=f)*(r+l*(a*=f)+2*c)+a*(l*r+a+2*h)+u}else a=A,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+u;else a=-A,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+u;else a<=-s?o=-(r=Math.max(0,-(-l*A+c)))*r+(a=r>0?-A:Math.min(Math.max(-A,-h),A))*(a+2*h)+u:a<=s?(r=0,o=(a=Math.min(Math.max(-A,-h),A))*(a+2*h)+u):o=-(r=Math.max(0,-(l*A+c)))*r+(a=r>0?A:Math.min(Math.max(-A,-h),A))*(a+2*h)+u;else a=l>0?-A:A,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+u;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(rn).multiplyScalar(a).add(nn),o},intersectSphere:function(e,t){tn.subVectors(e.center,this.origin);var n=tn.dot(this.direction),i=tn.dot(tn)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,i,r,a,o,s,A=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return A>=0?(n=(e.min.x-h.x)*A,i=(e.max.x-h.x)*A):(n=(e.max.x-h.x)*A,i=(e.min.x-h.x)*A),l>=0?(r=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||r>i?null:((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,tn)},intersectTriangle:function(e,t,n,i,r){on.subVectors(t,e),sn.subVectors(n,e),An.crossVectors(on,sn);var a,o=this.direction.dot(An);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}an.subVectors(this.origin,e);var s=a*this.direction.dot(sn.crossVectors(an,sn));if(s<0)return null;var A=a*this.direction.dot(on.cross(an));if(A<0)return null;if(s+A>o)return null;var l=-a*an.dot(An);return l<0?null:this.at(l/o,r)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var cn=new tt,hn=new tt,un=new rt;function dn(e,t){this.normal=void 0!==e?e:new tt(1,0,0),this.constant=void 0!==t?t:0}Object.assign(dn.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var i=cn.subVectors(n,t).cross(hn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("Plane: .projectPoint() target is now required"),t=new tt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("Plane: .intersectLine() target is now required"),t=new tt);var n=e.delta(cn),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:t.copy(n).multiplyScalar(r).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("Plane: .coplanarPoint() target is now required"),e=new tt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||un.getNormalMatrix(e),i=this.coplanarPoint(cn).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var fn=new tt,pn=new tt,mn=new tt,gn=new tt,vn=new tt,yn=new tt,wn=new tt,xn=new tt,bn=new tt,Cn=new tt;function Mn(e,t,n){this.a=void 0!==e?e:new tt,this.b=void 0!==t?t:new tt,this.c=void 0!==n?n:new tt}Object.assign(Mn,{getNormal:function(e,t,n,i){void 0===i&&(i=new tt),i.subVectors(n,t),fn.subVectors(e,t),i.cross(fn);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},getBarycoord:function(e,t,n,i,r){fn.subVectors(i,t),pn.subVectors(n,t),mn.subVectors(e,t);var a=fn.dot(fn),o=fn.dot(pn),s=fn.dot(mn),A=pn.dot(pn),l=pn.dot(mn),c=a*A-o*o;if(void 0===r&&(r=new tt),0===c)return r.set(-2,-1,-1);var h=1/c,u=(A*s-o*l)*h,d=(a*l-o*s)*h;return r.set(1-u-d,d,u)},containsPoint:function(e,t,n,i){return Mn.getBarycoord(e,t,n,i,gn),gn.x>=0&&gn.y>=0&&gn.x+gn.y<=1},getUV:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,gn),s.set(0,0),s.addScaledVector(r,gn.x),s.addScaledVector(a,gn.y),s.addScaledVector(o,gn.z),s},isFrontFacing:function(e,t,n,i){return fn.subVectors(n,t),pn.subVectors(e,t),fn.cross(pn).dot(i)<0}}),Object.assign(Mn.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return fn.subVectors(this.c,this.b),pn.subVectors(this.a,this.b),.5*fn.cross(pn).length()},getMidpoint:function(e){return void 0===e&&(e=new tt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Mn.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(e=new dn),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Mn.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,r){return Mn.getUV(e,this.a,this.b,this.c,t,n,i,r)},containsPoint:function(e){return Mn.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Mn.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(t=new tt);var n,i,r=this.a,a=this.b,o=this.c;vn.subVectors(a,r),yn.subVectors(o,r),xn.subVectors(e,r);var s=vn.dot(xn),A=yn.dot(xn);if(s<=0&&A<=0)return t.copy(r);bn.subVectors(e,a);var l=vn.dot(bn),c=yn.dot(bn);if(l>=0&&c<=l)return t.copy(a);var h=s*c-l*A;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(r).addScaledVector(vn,n);Cn.subVectors(e,o);var u=vn.dot(Cn),d=yn.dot(Cn);if(d>=0&&u<=d)return t.copy(o);var f=u*A-s*d;if(f<=0&&A>=0&&d<=0)return i=A/(A-d),t.copy(r).addScaledVector(yn,i);var p=l*d-u*c;if(p<=0&&c-l>=0&&u-d>=0)return wn.subVectors(o,a),i=(c-l)/(c-l+(u-d)),t.copy(a).addScaledVector(wn,i);var m=1/(p+f+h);return n=f*m,i=h*m,t.copy(r).addScaledVector(vn,n).addScaledVector(yn,i)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Bn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},In={h:0,s:0,l:0},En={h:0,s:0,l:0};function Sn(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function Tn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Ln(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Fn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function _n(e,t,n,i,r,a){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new tt,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Sn,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}Object.assign(Sn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=Ke.euclideanModulo(e,1),t=Ke.clamp(t,0,1),n=Ke.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Tn(r,i,e+1/3),this.g=Tn(r,i,e),this.b=Tn(r,i,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,A=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(o,s,A)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=Bn[e];return void 0!==t?this.setHex(t):console.warn("Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Ln(e.r),this.g=Ln(e.g),this.b=Ln(e.b),this},copyLinearToSRGB:function(e){return this.r=Fn(e.r),this.g=Fn(e.g),this.b=Fn(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),s=Math.min(i,r,a),A=(s+o)/2;if(s===o)t=0,n=0;else{var l=o-s;switch(n=A<=.5?l/(o+s):l/(2-o-s),o){case i:t=(r-a)/l+(r<a?6:0);break;case r:t=(a-i)/l+2;break;case a:t=(i-r)/l+4}t/=6}return e.h=t,e.s=n,e.l=A,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(In),In.h+=e,In.s+=t,In.l+=n,this.setHSL(In.h,In.s,In.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(In),e.getHSL(En);var n=Ke.lerp(In.h,En.h,t),i=Ke.lerp(In.s,En.s,t),r=Ke.lerp(In.l,En.l,t);return this.setHSL(n,i,r),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Sn.NAMES=Bn,Object.assign(_n.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Un=0;function Pn(){Object.defineProperty(this,"id",{value:Un++}),this.uuid=Ke.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=L,this.blendDst=F,this.blendEquation=I,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=He,this.stencilZFail=He,this.stencilZPass=He,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function kn(e){Pn.call(this),this.type="MeshBasicMaterial",this.color=new Sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}function Dn(e,t,n){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=ze,this.updateRange={offset:0,count:-1},this.version=0}function Rn(e,t,n){Dn.call(this,new Int8Array(e),t,n)}function On(e,t,n){Dn.call(this,new Uint8Array(e),t,n)}function Nn(e,t,n){Dn.call(this,new Uint8ClampedArray(e),t,n)}function Gn(e,t,n){Dn.call(this,new Int16Array(e),t,n)}function Qn(e,t,n){Dn.call(this,new Uint16Array(e),t,n)}function Hn(e,t,n){Dn.call(this,new Int32Array(e),t,n)}function zn(e,t,n){Dn.call(this,new Uint32Array(e),t,n)}function Vn(e,t,n){Dn.call(this,new Float32Array(e),t,n)}function jn(e,t,n){Dn.call(this,new Float64Array(e),t,n)}function Wn(e,t,n){Dn.call(this,e,t,n)}function Xn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Zn(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Pn.prototype=Object.assign(Object.create(Xe.prototype),{constructor:Pn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(this.type+": '"+t+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),0!==this.vertexColors&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Pn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),kn.prototype=Object.create(Pn.prototype),kn.prototype.constructor=kn,kn.prototype.isMeshBasicMaterial=!0,kn.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(Dn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Dn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",i),a=new Sn),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Je),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new tt),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new At),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Rn.prototype=Object.create(Dn.prototype),Rn.prototype.constructor=Rn,On.prototype=Object.create(Dn.prototype),On.prototype.constructor=On,Nn.prototype=Object.create(Dn.prototype),Nn.prototype.constructor=Nn,Gn.prototype=Object.create(Dn.prototype),Gn.prototype.constructor=Gn,Qn.prototype=Object.create(Dn.prototype),Qn.prototype.constructor=Qn,Hn.prototype=Object.create(Dn.prototype),Hn.prototype.constructor=Hn,zn.prototype=Object.create(Dn.prototype),zn.prototype.constructor=zn,Vn.prototype=Object.create(Dn.prototype),Vn.prototype.constructor=Vn,jn.prototype=Object.create(Dn.prototype),jn.prototype.constructor=jn,Wn.prototype=Object.create(Dn.prototype),Wn.prototype.constructor=Wn,Object.assign(Xn.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,r=e.faces,a=0;a<r.length;a++){var o=r[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:i})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,i=e.vertices,r=e.faceVertexUvs,a=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=e.morphTargets,A=s.length;if(A>0){t=[];for(var l=0;l<A;l++)t[l]={name:s[l].name,data:[]};this.morphTargets.position=t}var c,h=e.morphNormals,u=h.length;if(u>0){c=[];for(l=0;l<u;l++)c[l]={name:h[l].name,data:[]};this.morphTargets.normal=c}var d=e.skinIndices,f=e.skinWeights,p=d.length===i.length,m=f.length===i.length;i.length>0&&0===n.length&&console.error("DirectGeometry: Faceless geometries are not supported.");for(l=0;l<n.length;l++){var g=n[l];this.vertices.push(i[g.a],i[g.b],i[g.c]);var v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var y=g.normal;this.normals.push(y,y,y)}var w,x=g.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var b=g.color;this.colors.push(b,b,b)}if(!0===a)void 0!==(w=r[0][l])?this.uvs.push(w[0],w[1],w[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new Je,new Je,new Je));if(!0===o)void 0!==(w=r[1][l])?this.uvs2.push(w[0],w[1],w[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new Je,new Je,new Je));for(var C=0;C<A;C++){var M=s[C].vertices;t[C].data.push(M[g.a],M[g.b],M[g.c])}for(C=0;C<u;C++){var B=h[C].vertexNormals[l];c[C].data.push(B.a,B.b,B.c)}p&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Yn=1,Kn=new vt,Jn=new Dt,qn=new tt,$n=new Jt,ei=new Jt,ti=new tt;function ni(){Object.defineProperty(this,"id",{value:Yn+=2}),this.uuid=Ke.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function ii(e,t,n,i,r,a,o,s,A){st.call(this,e,t,n,i,r,a,o,s,A),this.format=void 0!==o?o:ae,this.minFilter=void 0!==a?a:W,this.magFilter=void 0!==r?r:W,this.generateMipmaps=!1}ni.prototype=Object.assign(Object.create(Xe.prototype),{constructor:ni,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Zn(e)>65535?zn:Qn)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new rt).getNormalMatrix(e).applyToBufferAttribute(n),n.needsUpdate=!0);var i=this.attributes.tangent;void 0!==i&&((new rt).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},applyMatrix4:function(e){return this.applyMatrix(e),this},rotateX:function(e){return Kn.makeRotationX(e),this.applyMatrix(Kn),this},rotateY:function(e){return Kn.makeRotationY(e),this.applyMatrix(Kn),this},rotateZ:function(e){return Kn.makeRotationZ(e),this.applyMatrix(Kn),this},translate:function(e,t,n){return Kn.makeTranslation(e,t,n),this.applyMatrix(Kn),this},scale:function(e,t,n){return Kn.makeScale(e,t,n),this.applyMatrix(Kn),this},lookAt:function(e){return Jn.lookAt(e),Jn.updateMatrix(),this.applyMatrix(Jn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(qn).negate(),this.translate(qn.x,qn.y,qn.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new Vn(3*t.vertices.length,3),i=new Vn(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new Vn(t.lineDistances.length,1);this.setAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Vn(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var i=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(i=void 0,n.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Xn).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Dn(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Dn(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.setAttribute("color",new Dn(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Dn(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Dn(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],A=e.morphTargets[o],l=0,c=A.length;l<c;l++){var h=A[l],u=new Vn(3*h.data.length,3);u.name=h.name,s.push(u.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var d=new Vn(4*e.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Vn(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Jt);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];$n.setFromBufferAttribute(r),this.morphTargetsRelative?(ti.addVectors(this.boundingBox.min,$n.min),this.boundingBox.expandByPoint(ti),ti.addVectors(this.boundingBox.max,$n.max),this.boundingBox.expandByPoint(ti)):(this.boundingBox.expandByPoint($n.min),this.boundingBox.expandByPoint($n.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new en);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if($n.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];ei.setFromBufferAttribute(a),this.morphTargetsRelative?(ti.addVectors($n.min,ei.min),$n.expandByPoint(ti),ti.addVectors($n.max,ei.max),$n.expandByPoint(ti)):($n.expandByPoint(ei.min),$n.expandByPoint(ei.max))}$n.getCenter(n);var o=0;for(i=0,r=e.count;i<r;i++)ti.fromBufferAttribute(e,i),o=Math.max(o,n.distanceToSquared(ti));if(t)for(i=0,r=t.length;i<r;i++){a=t[i];for(var s=this.morphTargetsRelative,A=0,l=a.count;A<l;A++)ti.fromBufferAttribute(a,A),s&&(qn.fromBufferAttribute(e,A),ti.add(qn)),o=Math.max(o,n.distanceToSquared(ti))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new Dn(new Float32Array(n.length),3));else for(var i=t.normal.array,r=0,a=i.length;r<a;r++)i[r]=0;var o,s,A,l=t.normal.array,c=new tt,h=new tt,u=new tt,d=new tt,f=new tt;if(e){var p=e.array;for(r=0,a=e.count;r<a;r+=3)o=3*p[r+0],s=3*p[r+1],A=3*p[r+2],c.fromArray(n,o),h.fromArray(n,s),u.fromArray(n,A),d.subVectors(u,h),f.subVectors(c,h),d.cross(f),l[o]+=d.x,l[o+1]+=d.y,l[o+2]+=d.z,l[s]+=d.x,l[s+1]+=d.y,l[s+2]+=d.z,l[A]+=d.x,l[A+1]+=d.y,l[A+2]+=d.z}else for(r=0,a=n.length;r<a;r+=9)c.fromArray(n,r),h.fromArray(n,r+3),u.fromArray(n,r+6),d.subVectors(u,h),f.subVectors(c,h),d.cross(f),l[r]=d.x,l[r+1]=d.y,l[r+2]=d.z,l[r+3]=d.x,l[r+4]=d.y,l[r+5]=d.z,l[r+6]=d.x,l[r+7]=d.y,l[r+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,A=Math.min(o.length,r.length-s),l=0,c=s;l<A;l++,c++)r[c]=o[l];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)ti.x=e.getX(t),ti.y=e.getY(t),ti.z=e.getZ(t),ti.normalize(),e.setXYZ(t,ti.x,ti.y,ti.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=new n.constructor(t.length*i),a=0,o=0,s=0,A=t.length;s<A;s++){a=t[s]*i;for(var l=0;l<i;l++)r[o++]=n[a++]}return new Dn(r,i)}if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new ni,n=this.index.array,i=this.attributes;for(var r in i){var a=e(i[r],n);t.setAttribute(r,a)}var o=this.morphAttributes;for(r in o){for(var s=[],A=o[r],l=0,c=A.length;l<c;l++){a=e(A[l],n);s.push(a)}t.morphAttributes[r]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,u=(l=0,h.length);l<u;l++){var d=h[l];t.addGroup(d.start,d.count,d.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var n in r){var a=(u=r[n]).toJSON();""!==u.name&&(a.name=u.name),e.data.attributes[n]=a}var o={},s=!1;for(var n in this.morphAttributes){for(var A=this.morphAttributes[n],l=[],c=0,h=A.length;c<h;c++){var u;a=(u=A[c]).toJSON();""!==u.name&&(a.name=u.name),l.push(a)}l.length>0&&(o[n]=l,s=!0)}s&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(e.data.groups=JSON.parse(JSON.stringify(d)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new ni).copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var a=e.attributes;for(t in a){var o=a[t];this.setAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var A=[],l=s[t];for(n=0,i=l.length;n<i;n++)A.push(l[n].clone());this.morphAttributes[t]=A}this.morphTargetsRelative=e.morphTargetsRelative;var c=e.groups;for(n=0,i=c.length;n<i;n++){var h=c[n];this.addGroup(h.start,h.count,h.materialIndex)}var u=e.boundingBox;null!==u&&(this.boundingBox=u.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ii.prototype=Object.assign(Object.create(st.prototype),{constructor:ii,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var ri=new vt,ai=new ln,oi=new en,si=new tt,Ai=new tt,li=new tt,ci=new tt,hi=new tt,ui=new tt,di=new tt,fi=new tt,pi=new tt,mi=new Je,gi=new Je,vi=new Je,yi=new tt,wi=new tt;function xi(e,t){Dt.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new ni,this.material=void 0!==t?t:new kn({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function bi(e,t,n,i,r,a,o,s){if(null===(1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,2!==t.side,s)))return null;wi.copy(s),wi.applyMatrix4(e.matrixWorld);var A=n.ray.origin.distanceTo(wi);return A<n.near||A>n.far?null:{distance:A,point:wi.clone(),object:e}}function Ci(e,t,n,i,r,a,o,s,A,l,c,h){si.fromBufferAttribute(r,l),Ai.fromBufferAttribute(r,c),li.fromBufferAttribute(r,h);var u=e.morphTargetInfluences;if(t.morphTargets&&a&&u){di.set(0,0,0),fi.set(0,0,0),pi.set(0,0,0);for(var d=0,f=a.length;d<f;d++){var p=u[d],m=a[d];0!==p&&(ci.fromBufferAttribute(m,l),hi.fromBufferAttribute(m,c),ui.fromBufferAttribute(m,h),o?(di.addScaledVector(ci,p),fi.addScaledVector(hi,p),pi.addScaledVector(ui,p)):(di.addScaledVector(ci.sub(si),p),fi.addScaledVector(hi.sub(Ai),p),pi.addScaledVector(ui.sub(li),p)))}si.add(di),Ai.add(fi),li.add(pi)}var g=bi(e,t,n,i,si,Ai,li,yi);if(g){s&&(mi.fromBufferAttribute(s,l),gi.fromBufferAttribute(s,c),vi.fromBufferAttribute(s,h),g.uv=Mn.getUV(yi,si,Ai,li,mi,gi,vi,new Je)),A&&(mi.fromBufferAttribute(A,l),gi.fromBufferAttribute(A,c),vi.fromBufferAttribute(A,h),g.uv2=Mn.getUV(yi,si,Ai,li,mi,gi,vi,new Je));var v=new _n(l,c,h);Mn.getNormal(si,Ai,li,v.normal),g.face=v}return g}xi.prototype=Object.assign(Object.create(Dt.prototype),{constructor:xi,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Dt.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,a=Object.keys(r);if(a.length>0){var o=r[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("Mesh.updateMorphTargets() no longer supports Geometry. Use BufferGeometry instead.")}},raycast:function(e,t){var n,i=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),oi.copy(i.boundingSphere),oi.applyMatrix4(a),!1!==e.ray.intersectsSphere(oi)&&(ri.getInverse(a),ai.copy(e.ray).applyMatrix4(ri),null===i.boundingBox||!1!==ai.intersectsBox(i.boundingBox))))if(0===this.drawMode){if(i.isBufferGeometry){var o,s,A,l,c,h,u,d,f,p=i.index,m=i.attributes.position,g=i.morphAttributes.position,v=i.morphTargetsRelative,y=i.attributes.uv,w=i.attributes.uv2,x=i.groups,b=i.drawRange;if(null!==p)if(Array.isArray(r))for(l=0,h=x.length;l<h;l++)for(f=r[(d=x[l]).materialIndex],c=Math.max(d.start,b.start),u=Math.min(d.start+d.count,b.start+b.count);c<u;c+=3)o=p.getX(c),s=p.getX(c+1),A=p.getX(c+2),(n=Ci(this,f,e,ai,m,g,v,y,w,o,s,A))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=d.materialIndex,t.push(n));else for(l=Math.max(0,b.start),h=Math.min(p.count,b.start+b.count);l<h;l+=3)o=p.getX(l),s=p.getX(l+1),A=p.getX(l+2),(n=Ci(this,r,e,ai,m,g,v,y,w,o,s,A))&&(n.faceIndex=Math.floor(l/3),t.push(n));else if(void 0!==m)if(Array.isArray(r))for(l=0,h=x.length;l<h;l++)for(f=r[(d=x[l]).materialIndex],c=Math.max(d.start,b.start),u=Math.min(d.start+d.count,b.start+b.count);c<u;c+=3)(n=Ci(this,f,e,ai,m,g,v,y,w,o=c,s=c+1,A=c+2))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=d.materialIndex,t.push(n));else for(l=Math.max(0,b.start),h=Math.min(m.count,b.start+b.count);l<h;l+=3)(n=Ci(this,r,e,ai,m,g,v,y,w,o=l,s=l+1,A=l+2))&&(n.faceIndex=Math.floor(l/3),t.push(n))}else if(i.isGeometry){var C,M,B,I,E=Array.isArray(r),S=i.vertices,T=i.faces,L=i.faceVertexUvs[0];L.length>0&&(I=L);for(var F=0,_=T.length;F<_;F++){var U=T[F],P=E?r[U.materialIndex]:r;if(void 0!==P&&(C=S[U.a],M=S[U.b],B=S[U.c],n=bi(this,P,e,ai,C,M,B,yi))){if(I&&I[F]){var k=I[F];mi.copy(k[0]),gi.copy(k[1]),vi.copy(k[2]),n.uv=Mn.getUV(yi,C,M,B,mi,gi,vi,new Je)}n.face=U,n.faceIndex=F,t.push(n)}}}}else console.warn("Mesh: TriangleStripDrawMode and TriangleFanDrawMode are not supported by .raycast().")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),xi.prototype.setVideoTexture=function(e){var t=this.viewer;e.addEventListener("play",(function(e){t.renderManager.renderEnabled=!0}));var n=new ii(e);n.minFilter=W,n.magFilter=W,n.format=ae,(Array.isArray(this.material)?this.material:[this.material]).forEach((function(e){e.albedo0||(e.albedo0=e.albedo),e.albedo=n,e.color.setStyle("#ffffff"),e.needsUpdate=!0}))},xi.prototype.clearVideoTexture=function(){(Array.isArray(this.material)?this.material:[this.material]).forEach((function(e){void 0!==e.albedo0&&(e.albedo=e.albedo0),e.needsUpdate=!0}))};var Mi=0,Bi=new vt,Ii=new Dt,Ei=new tt;function Si(){Object.defineProperty(this,"id",{value:Mi+=2}),this.uuid=Ke.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1,this._verticesNeedUpdate=!1}Object.defineProperties(Si.prototype,{verticesNeedUpdate:{get:function(){return this._verticesNeedUpdate},set:function(e){this._verticesNeedUpdate=e}}}),Si.prototype=Object.assign(Object.create(Xe.prototype),{constructor:Si,isGeometry:!0,applyMatrix:function(e){for(var t=(new rt).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(e)}for(n=0,i=this.faces.length;n<i;n++){var r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(var a=0,o=r.vertexNormals.length;a<o;a++)r.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},applyMatrix4:function(e){return this.applyMatrix(e),this},rotateX:function(e){return Bi.makeRotationX(e),this.applyMatrix(Bi),this},rotateY:function(e){return Bi.makeRotationY(e),this.applyMatrix(Bi),this},rotateZ:function(e){return Bi.makeRotationZ(e),this.applyMatrix(Bi),this},translate:function(e,t,n){return Bi.makeTranslation(e,t,n),this.applyMatrix(Bi),this},scale:function(e,t,n){return Bi.makeScale(e,t,n),this.applyMatrix(Bi),this},lookAt:function(e){return Ii.lookAt(e),Ii.updateMatrix(),this.applyMatrix(Ii.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,i=e.attributes;if(void 0===i.position)return console.error("Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var r=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,o=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,A=void 0!==i.uv2?i.uv2.array:void 0;void 0!==A&&(this.faceVertexUvs[1]=[]);for(var l=0;l<r.length;l+=3)t.vertices.push((new tt).fromArray(r,l)),void 0!==o&&t.colors.push((new Sn).fromArray(o,l));function c(e,n,i,r){var l=void 0===o?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()],c=new _n(e,n,i,void 0===a?[]:[(new tt).fromArray(a,3*e),(new tt).fromArray(a,3*n),(new tt).fromArray(a,3*i)],l,r);t.faces.push(c),void 0!==s&&t.faceVertexUvs[0].push([(new Je).fromArray(s,2*e),(new Je).fromArray(s,2*n),(new Je).fromArray(s,2*i)]),void 0!==A&&t.faceVertexUvs[1].push([(new Je).fromArray(A,2*e),(new Je).fromArray(A,2*n),(new Je).fromArray(A,2*i)])}var h=e.groups;if(h.length>0)for(l=0;l<h.length;l++)for(var u=h[l],d=u.start,f=d,p=d+u.count;f<p;f+=3)void 0!==n?c(n[f],n[f+1],n[f+2],u.materialIndex):c(f,f+1,f+2,u.materialIndex);else if(void 0!==n)for(l=0;l<n.length;l+=3)c(n[l],n[l+1],n[l+2]);else for(l=0;l<r.length/3;l+=3)c(l,l+1,l+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ei).negate(),this.translate(Ei.x,Ei.y,Ei.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new vt;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new tt,t=new tt,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],a=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,r,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new tt;if(e){var s,A,l,c=new tt,h=new tt;for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],s=this.vertices[a.a],A=this.vertices[a.b],l=this.vertices[a.c],c.subVectors(l,A),h.subVectors(s,A),c.cross(h),o[a.a].add(c),o[a.b].add(c),o[a.c].add(c)}else for(this.computeFaceNormals(),i=0,r=this.faces.length;i<r;i++)o[(a=this.faces[i]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(i=0,r=this.faces.length;i<r;i++){var u=(a=this.faces[i]).vertexNormals;3===u.length?(u[0].copy(o[a.a]),u[1].copy(o[a.b]),u[2].copy(o[a.c])):(u[0]=o[a.a].clone(),u[1]=o[a.b].clone(),u[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(n=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for((r=this.faces[n]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var a=new Si;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)A=new tt,l={a:new tt,b:new tt,c:new tt},o.push(A),s.push(l)}var A,l,c=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)r=this.faces[n],A=c.faceNormals[n],l=c.vertexNormals[n],A.copy(r.normal),l.a.copy(r.vertexNormals[0]),l.b.copy(r.vertexNormals[1]),l.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Jt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new en),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,r=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,A=e.faces,l=this.colors,c=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new rt).getNormalMatrix(t));for(var h=0,u=o.length;h<u;h++){var d=o[h].clone();void 0!==t&&d.applyMatrix4(t),a.push(d)}for(h=0,u=c.length;h<u;h++)l.push(c[h].clone());for(h=0,u=A.length;h<u;h++){var f,p,m,g=A[h],v=g.vertexNormals,y=g.vertexColors;(f=new _n(g.a+r,g.b+r,g.c+r)).normal.copy(g.normal),void 0!==i&&f.normal.applyMatrix3(i).normalize();for(var w=0,x=v.length;w<x;w++)p=v[w].clone(),void 0!==i&&p.applyMatrix3(i).normalize(),f.vertexNormals.push(p);f.color.copy(g.color);for(w=0,x=y.length;w<x;w++)m=y[w],f.vertexColors.push(m.clone());f.materialIndex=g.materialIndex+n,s.push(f)}for(h=0,u=e.faceVertexUvs.length;h<u;h++){var b=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(w=0,x=b.length;w<x;w++){for(var C=b[w],M=[],B=0,I=C.length;B<I;B++)M.push(C[B].clone());this.faceVertexUvs[h].push(M)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,a,o,s,A={},l=[],c=[],h=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],void 0===A[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(A[t]=n,l.push(this.vertices[n]),c[n]=l.length-1):c[n]=c[A[t]];var u=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=c[r.a],r.b=c[r.b],r.c=c[r.c],a=[r.a,r.b,r.c];for(var d=0;d<3;d++)if(a[d]===a[(d+1)%3]){u.push(n);break}}for(n=u.length-1;n>=0;n--){var f=u[n];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}var p=this.vertices.length-l.length;return this.vertices=l,p},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new tt(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var i,r,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(i=[]),o&&o.length===t&&(r=[]);for(n=0;n<t;n++){var s=e[n]._id;i&&i.push(a[s]),r&&r.push(o[s])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var i=[],r=0;r<this.vertices.length;r++){var a=this.vertices[r];i.push(a.x,a.y,a.z)}var o=[],s=[],A={},l=[],c={},h=[],u={};for(r=0;r<this.faces.length;r++){var d=this.faces[r],f=void 0!==this.faceVertexUvs[0][r],p=d.normal.length()>0,m=d.vertexNormals.length>0,g=1!==d.color.r||1!==d.color.g||1!==d.color.b,v=d.vertexColors.length>0,y=0;if(y=C(y,0,0),y=C(y,1,!0),y=C(y,2,!1),y=C(y,3,f),y=C(y,4,p),y=C(y,5,m),y=C(y,6,g),y=C(y,7,v),o.push(y),o.push(d.a,d.b,d.c),o.push(d.materialIndex),f){var w=this.faceVertexUvs[0][r];o.push(I(w[0]),I(w[1]),I(w[2]))}if(p&&o.push(M(d.normal)),m){var x=d.vertexNormals;o.push(M(x[0]),M(x[1]),M(x[2]))}if(g&&o.push(B(d.color)),v){var b=d.vertexColors;o.push(B(b[0]),B(b[1]),B(b[2]))}}function C(e,t,n){return n?e|1<<t:e&~(1<<t)}function M(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==A[t]||(A[t]=s.length/3,s.push(e.x,e.y,e.z)),A[t]}function B(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=l.length,l.push(e.getHex())),c[t]}function I(e){var t=e.x.toString()+e.y.toString();return void 0!==u[t]||(u[t]=h.length/2,h.push(e.x,e.y)),u[t]}return e.data={},e.data.vertices=i,e.data.normals=s,l.length>0&&(e.data.colors=l),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new Si).copy(this)},copy:function(e){var t,n,i,r,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var A=e.colors;for(t=0,n=A.length;t<n;t++)this.colors.push(A[t].clone());var l=e.faces;for(t=0,n=l.length;t<n;t++)this.faces.push(l[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,r=c.length;i<r;i++){var h=c[i],u=[];for(a=0,o=h.length;a<o;a++){var d=h[a];u.push(d.clone())}this.faceVertexUvs[t].push(u)}}var f=e.morphTargets;for(t=0,n=f.length;t<n;t++){var p={};if(p.name=f[t].name,void 0!==f[t].vertices)for(p.vertices=[],i=0,r=f[t].vertices.length;i<r;i++)p.vertices.push(f[t].vertices[i].clone());if(void 0!==f[t].normals)for(p.normals=[],i=0,r=f[t].normals.length;i<r;i++)p.normals.push(f[t].normals[i].clone());this.morphTargets.push(p)}var m=e.morphNormals;for(t=0,n=m.length;t<n;t++){var g={};if(void 0!==m[t].vertexNormals)for(g.vertexNormals=[],i=0,r=m[t].vertexNormals.length;i<r;i++){var v=m[t].vertexNormals[i],y={};y.a=v.a.clone(),y.b=v.b.clone(),y.c=v.c.clone(),g.vertexNormals.push(y)}if(void 0!==m[t].faceNormals)for(g.faceNormals=[],i=0,r=m[t].faceNormals.length;i<r;i++)g.faceNormals.push(m[t].faceNormals[i].clone());this.morphNormals.push(g)}var w=e.skinWeights;for(t=0,n=w.length;t<n;t++)this.skinWeights.push(w[t].clone());var x=e.skinIndices;for(t=0,n=x.length;t<n;t++)this.skinIndices.push(x[t].clone());var b=e.lineDistances;for(t=0,n=b.length;t<n;t++)this.lineDistances.push(b[t]);var C=e.boundingBox;null!==C&&(this.boundingBox=C.clone());var M=e.boundingSphere;return null!==M&&(this.boundingSphere=M.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ti=function(e){A(n,e);var t=p(n);function n(e,i,a,o,s,A){var l;return r(this,n),(l=t.call(this)).type="BoxGeometry",l.parameters={width:e,height:i,depth:a,widthSegments:o,heightSegments:s,depthSegments:A},l.fromBufferGeometry(new Li(e,i,a,o,s,A)),l.mergeVertices(),l}return n}(Si),Li=function(e){A(n,e);var t=p(n);function n(e,i,a,o,s,A){var l;r(this,n),(l=t.call(this)).type="BoxBufferGeometry",l.parameters={width:e,height:i,depth:a,widthSegments:o,heightSegments:s,depthSegments:A};var c=d(l);e=e||1,i=i||1,a=a||1,o=Math.floor(o)||1,s=Math.floor(s)||1,A=Math.floor(A)||1;var h=[],u=[],f=[],p=[],m=0,g=0;function v(e,t,n,i,r,a,o,s,A,l,d){var v,y,w=a/A,x=o/l,b=a/2,C=o/2,M=s/2,B=A+1,I=l+1,E=0,S=0,T=new tt;for(y=0;y<I;y++){var L=y*x-C;for(v=0;v<B;v++){var F=v*w-b;T[e]=F*i,T[t]=L*r,T[n]=M,u.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=s>0?1:-1,f.push(T.x,T.y,T.z),p.push(v/A),p.push(1-y/l),E+=1}}for(y=0;y<l;y++)for(v=0;v<A;v++){var _=m+v+B*y,U=m+v+B*(y+1),P=m+(v+1)+B*(y+1),k=m+(v+1)+B*y;h.push(_,U,k),h.push(U,P,k),S+=6}c.addGroup(g,S,d),g+=S,m+=E}return v("z","y","x",-1,-1,a,i,e,A,s,0),v("z","y","x",1,-1,a,i,-e,A,s,1),v("x","z","y",1,1,e,a,i,o,A,2),v("x","z","y",1,-1,e,a,-i,o,A,3),v("x","y","z",1,-1,e,i,a,o,s,4),v("x","y","z",-1,-1,e,i,-a,o,s,5),l.setIndex(h),l.setAttribute("position",new Vn(u,3)),l.setAttribute("normal",new Vn(f,3)),l.setAttribute("uv",new Vn(p,2)),l}return n}(ni);function Fi(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function _i(e){for(var t={},n=0;n<e.length;n++){var i=Fi(e[n]);for(var r in i)t[r]=i[r]}return t}var Ui={clone:Fi,merge:_i};function Pi(e){Pn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(e))}function ki(){Dt.call(this),this.type="Camera",this.matrixWorldInverse=new vt,this.matrixWorldInverseR=new vt,this.rotateMatrix=(new vt).makeRotationFromEuler(new xt(0,1.570863267948966,0)),this.projectionMatrix=new vt,this.projectionMatrixInverse=new vt}function Di(e,t,n,i){ki.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Pi.prototype=Object.create(Pn.prototype),Pi.prototype.constructor=Pi,Pi.prototype.isShaderMaterial=!0,Pi.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Fi(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Pi.prototype.toJSON=function(e){var t=Pn.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var r={};for(var a in this.extensions)!0===this.extensions[a]&&(r[a]=!0);return Object.keys(r).length>0&&(t.extensions=r),t},ki.prototype=Object.assign(Object.create(Dt.prototype),{constructor:ki,isCamera:!0,copy:function(e,t){return Dt.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new tt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Dt.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverseR.getInverse(this.matrixWorld.clone().multiply(this.rotateMatrix)),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Di.prototype=Object.assign(Object.create(ki.prototype),{constructor:Di,isPerspectiveCamera:!0,copy:function(e,t){return ki.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Ke.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Ke.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Ke.RAD2DEG*Math.atan(Math.tan(.5*Ke.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Ke.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var A=this.filmOffset;0!==A&&(r+=e*A/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Dt.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var Ri=90;function Oi(e,t,n,i){Dt.call(this),this.type="CubeCamera";var r=new Di(Ri,1,e,t);r.up.set(0,-1,0),r.lookAt(new tt(1,0,0)),this.add(r);var a=new Di(Ri,1,e,t);a.up.set(0,-1,0),a.lookAt(new tt(-1,0,0)),this.add(a);var o=new Di(Ri,1,e,t);o.up.set(0,0,1),o.lookAt(new tt(0,1,0)),this.add(o);var s=new Di(Ri,1,e,t);s.up.set(0,0,-1),s.lookAt(new tt(0,-1,0)),this.add(s);var A=new Di(Ri,1,e,t);A.up.set(0,-1,0),A.lookAt(new tt(0,0,1)),this.add(A);var l=new Di(Ri,1,e,t);l.up.set(0,-1,0),l.lookAt(new tt(0,0,-1)),this.add(l),i=i||{format:ae,magFilter:W,minFilter:W},this.renderTarget=new Ni(n,n,i),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),i=this.renderTarget,c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,a),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,A),i.texture.generateMipmaps=c,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(n)},this.clear=function(e,t,n,i){for(var r=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,n,i);e.setRenderTarget(r)}}function Ni(e,t,n){lt.call(this,e,t,n)}function Gi(e,t,n,i,r,a,o,s,A,l,c,h){st.call(this,null,a,o,s,A,l,i,r,c,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==A?A:z,this.minFilter=void 0!==l?l:z,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Oi.prototype=Object.create(Dt.prototype),Oi.prototype.constructor=Oi,Ni.prototype=Object.create(lt.prototype),Ni.prototype.constructor=Ni,Ni.prototype.isWebGLRenderTargetCube=!0,Ni.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new Rt,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new Pi({type:"CubemapFromEquirect",uniforms:Fi(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;var a=new xi(new Li(5,5,5),r);n.add(a);var o=new Oi(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(e,n),a.geometry.dispose(),a.material.dispose(),this},Gi.prototype=Object.create(st.prototype),Gi.prototype.constructor=Gi,Gi.prototype.isDataTexture=!0;var Qi=new en,Hi=new tt;function zi(e,t,n,i,r,a){this.planes=[void 0!==e?e:new dn,void 0!==t?t:new dn,void 0!==n?n:new dn,void 0!==i?i:new dn,void 0!==r?r:new dn,void 0!==a?a:new dn]}Object.assign(zi.prototype,{set:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],A=n[5],l=n[6],c=n[7],h=n[8],u=n[9],d=n[10],f=n[11],p=n[12],m=n[13],g=n[14],v=n[15];return t[0].setComponents(o-i,c-s,f-h,v-p).normalize(),t[1].setComponents(o+i,c+s,f+h,v+p).normalize(),t[2].setComponents(o+r,c+A,f+u,v+m).normalize(),t[3].setComponents(o-r,c-A,f-u,v-m).normalize(),t[4].setComponents(o-a,c-l,f-d,v-g).normalize(),t[5].setComponents(o+a,c+l,f+d,v+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Qi.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Qi)},intersectsSprite:function(e){return Qi.center.set(0,0,0),Qi.radius=.7071067811865476,Qi.applyMatrix4(e.matrixWorld),this.intersectsSphere(Qi)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(Hi.x=i.normal.x>0?e.max.x:e.min.x,Hi.y=i.normal.y>0?e.max.y:e.min.y,Hi.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Hi)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},toArray:function(){for(var e=[],t=0;t<6;t++){var n=this.planes[t].normal.toArray();e.push.apply(e,n),n=null,e.push(this.planes[t].constant)}return e},setFromProjectionMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],A=n[5],l=n[6],c=n[7],h=n[8],u=n[9],d=n[10],f=n[11],p=n[12],m=n[13],g=n[14],v=n[15];return t[0].setComponents(o-i,c-s,f-h,v-p).normalize(),t[1].setComponents(o+i,c+s,f+h,v+p).normalize(),t[2].setComponents(o+r,c+A,f+u,v+m).normalize(),t[3].setComponents(o-r,c-A,f-u,v-m).normalize(),t[4].setComponents(o-a,c-l,f-d,v-g).normalize(),t[5].setComponents(o+a,c+l,f+d,v+g).normalize(),this}});var Vi={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)G(v) / 4(nl)(nv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif\n",common:"\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\n    \nbool isPerspectiveMatrix( mat4 m ) {\n\n  return m[ 2 ][ 3 ] == - 1.0;\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n#define cubeUV_textureSize (1024.0)\n\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\n\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\t// Clamp the value to the max mip level counts. hard coded to 6 mips\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\n\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\t// float powScale = exp2(roughnessLevel + mipLevel);\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\t// float scale =  1.0 / exp2(roughnessLevel + 2.0 + mipLevel);\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\t// float mipOffset = 0.75*(1.0 - 1.0/exp2(mipLevel))/exp2(roughnessLevel);\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\n\tfloat rcpPowScale = 1.0 / powScale;\n\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\n\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\n\t// round to nearest mipmap if we are not interpolating.\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\n\t// Tri linear interpolation.\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\n\tvec4 result = mix(color10, color20, t);\n\n\treturn vec4(result.rgb, 1.0);\n}\n\nvec4 textureCubeUVSample( sampler2D envMap, vec3 reflectedDirection) {\n\n\tvec2 uv_10 = getCubeUV(reflectedDirection, 0.0, 0.0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\n\treturn color10;\n}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t}  else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\tenvColor = envMapTexelToLinear( envColor );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n        \n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t  // Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) { \n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = -mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n#ifdef TOON\n\n\tuniform sampler2D gradientMap;\n\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t\t// dotNL will be from -1.0 to 1.0\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t\t#ifdef USE_GRADIENTMAP\n\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t\t#else\n\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t\t#endif\n\n\n\t}\n\n#endif\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t#ifdef TOON\n\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#else\n\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\n\t#endif\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = saturate( clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n\n#endif\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n    \n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_normalmap_pars_fragment:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpack2HalfToRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpack2HalfToRGBA( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\n\t\tvec2 f = fract( uv * size + 0.5 );\n\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\n\t\treturn c;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n\n}\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",amrt_aomap_fragment:"\n#if defined(USE_AOMAP)\n    float ambientOcclusion = mix(1.0, aoMapTexelToLinear(texture2D( aoMap, vUvAO )).g, aoScale);\n    reflectedLight.indirectDiffuse *= ambientOcclusion;\n    #if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n#endif\n",amrt_emissivemap_fragment:"\n#if defined(USE_EMISSIVEMAP)\n    vec4 emissiveColor = texture2D( emissiveMap, vUvEmissive );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",amrt_map_fragment:"\n#if defined( USE_ALBEDO )\n    vec4 texelColor = texture2D( albedo, vUvAlbedo );\n    texelColor = albedoTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif\n",amrt_map_pars_fragment:"\n\n// struct MapData\n// {\n//     vec3 Normal;\n//     vec3 Albedo;\n//     float Emission;\n//     float Metallic;\n//     float Smoothness;\n//     float Occlusion;\n//     float Alpha;\n// };\n\n#ifdef USE_ALBEDO\n\n\tuniform sampler2D albedo;\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform float normalScale;\n\n#endif\n\n#ifdef USE_NORMALMAP2\n\n\tuniform sampler2D normalMap2;\n\tuniform float normalScale2;\n\n#endif\n\n#ifdef USE_METALLICMAP\n\n\tuniform sampler2D metallicMap;\n\n#endif\n\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoScale;\n\n#endif\n\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n\n#ifdef USE_REFLECTMAP\n    #ifdef USE_REFLECTMAP_UV\n        uniform sampler2D reflectMap;\n    #else\n        uniform samplerCube reflectMap;\n    #endif\n\tuniform float reflectIntensity;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n\n#ifdef USE_DISSOLVE\n    uniform vec3 dissolveColor;\n    uniform float dissolveRatio;\n\tuniform sampler2D dissolveMap;\n#endif\n\n",amrt_metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n#if defined(USE_METALLICMAP)\n    metalnessFactor = metallicMapTexelToLinear(texture2D( metallicMap, vUvMetal )).r;\n#endif\n",amrt_alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tgl_FragColor.a = texture2D( alphaMap, vUvAlpha ).g;\n\n#endif\n",amrt_normal_fragment_maps:"\n\n#if defined( USE_NORMALMAP ) || defined( USE_NORMALMAP2 )\n\n    #if defined( USE_NORMALMAP ) && defined( USE_NORMALMAP2 )\n        vec3 mapN = BlendNormals( UnpackScaleNormal(  normalMapTexelToLinear(texture2D( normalMap, vUvNormal )), normalScale ) , UnpackScaleNormal( normalMap2TexelToLinear(texture2D( normalMap2, vUvNormal2 )), normalScale2 ) );\n    #elif defined( USE_NORMALMAP )\n        vec3 mapN = normalize(UnpackScaleNormal( normalMapTexelToLinear(texture2D( normalMap, vUvNormal )), normalScale));\n    #elif defined( USE_NORMALMAP2 )\n        vec3 mapN = normalize(UnpackScaleNormal( normalMap2TexelToLinear(texture2D( normalMap2, vUvNormal2 )), normalScale2));\n    #endif\n    \n    #ifdef USE_TANGENT\n    \n        normal = normalize( vTBN * mapN );\n    \n    #else\n    \n        normal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n    \n    #endif\n    \n#endif\n",amrt_roughnessmap_fragment:"\n#if defined(USE_ROUGHNESSMAP)\n    roughnessFactor = roughnessMapTexelToLinear(texture2D( roughnessMap, vUvRough )).r;\n#endif\n",amrt_uv_pars_fragment:"\n\n#ifdef USE_ALBEDO\n\n\tvarying vec2 vUvAlbedo;\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tvarying vec2 vUvNormal;\n\n#endif\n\n#ifdef USE_NORMALMAP2\n\n\tvarying vec2 vUvNormal2;\n\n#endif\n\n#ifdef USE_METALLICMAP\n\n\tvarying vec2 vUvMetal;\n\n#endif\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvarying vec2 vUvRough;\n\n#endif\n\n#ifdef USE_AOMAP\n\n\tvarying vec2 vUvAO;\n\n#endif\n\n#ifdef USE_EMISSIVEMAP\n\n\tvarying vec2 vUvEmissive;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tvarying vec2 vUvAlpha;\n\n#endif\n\n#ifdef USE_DISSOLVE\n\n    varying vec2 vUv;\n    \n#endif\n",amrt_uv_pars_vertex:"\n\nattribute vec2 uv2;\n\n#ifdef USE_ALBEDO\n\n\tvarying vec2 vUvAlbedo;\n\tuniform mat3 albedoUVTransform;\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tvarying vec2 vUvNormal;\n\tuniform mat3 normalUVTransform;\n\n#endif\n\n#ifdef USE_NORMALMAP2\n\n\tvarying vec2 vUvNormal2;\n\tuniform mat3 normal2UVTransform;\n\n#endif\n\n#ifdef USE_METALLICMAP\n\n\tvarying vec2 vUvMetal;\n\tuniform mat3 metalUVTransform;\n\n#endif\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvarying vec2 vUvRough;\n\tuniform mat3 roughUVTransform;\n\n#endif\n\n#ifdef USE_AOMAP\n\n\tvarying vec2 vUvAO;\n\tuniform mat3 aoUVTransform;\n\n#endif\n\n#ifdef USE_EMISSIVEMAP\n\n\tvarying vec2 vUvEmissive;\n\tuniform mat3 emissiveUVTransform;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tvarying vec2 vUvAlpha;\n    uniform mat3 alphaUVTransform;\n\n#endif\n\n#ifdef USE_DISSOLVE\n\n\tvarying vec2 vUv;\n\n#endif\n\n",amrt_uv_vertex:"\n\n#ifdef USE_ALBEDO\n\t\n\t#ifdef ALBEDO_UV1\n\n\t\tvUvAlbedo = ( albedoUVTransform * vec3( uv, 1 ) ).xy;\n\n\t#else\n\n\t\tvUvAlbedo = ( albedoUVTransform * vec3( uv2, 1 ) ).xy;\n\n\t#endif\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n    vUvNormal = ( normalUVTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_NORMALMAP2\n\n    vUvNormal2 = ( normal2UVTransform * vec3( uv2, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_METALLICMAP\n\n    vUvMetal = ( metalUVTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_ROUGHNESSMAP\n    \n    vUvRough = ( roughUVTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n    \n    vUvAlpha = ( alphaUVTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_AOMAP\n\t\n\t#ifdef AO_UV1\n\n\t\tvUvAO = ( aoUVTransform * vec3( uv, 1 ) ).xy;\n\n\t#else\n\n\t\tvUvAO = ( aoUVTransform * vec3( uv2, 1 ) ).xy;\n\n\t#endif\n\n#endif\n\n#ifdef USE_EMISSIVEMAP\n\t\n\t#ifdef EMISSIVE_UV1\n\n\t\tvUvEmissive = ( emissiveUVTransform * vec3( uv, 1 ) ).xy;\n\n\t#else\n\n\t\tvUvEmissive = ( emissiveUVTransform * vec3( uv2, 1 ) ).xy;\n\n\t#endif\n\n#endif\n\n#ifdef USE_DISSOLVE\n\n    vUv = uv;\n    \n#endif\n",amrt_worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_REFLECTMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n#endif\n",amrt_envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n        \n\n            vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n        \n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n        float maxMIPLevelScalar = float( maxMIPLevel );\n\n        float sigma = PI * roughness * roughness / ( 1.0 + roughness ) + 0.000001;\n        float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n        // clamp to allowable LOD ranges.\n        return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n    \n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in float rroughness,const in int maxMIPLevel ) {\n        \n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t  // Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n        #ifdef ENVMAP_TYPE_CUBE_UV\n\t\t    reflectVec = inverseTransformDirection( reflectVec, viewMatrixR );\n        #else\n            reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n        #endif\n        \n        reflectVec *= envYMatrix;\n        \n        float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\t\n            vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#endif\n\t\t\n\t\t\n\t\tenvMapColor = LinearTosRGB(envMapColor);\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",amrt_cube_uv_reflection_fragment:"\n#if defined(ENVMAP_TYPE_CUBE_UV) || defined(USE_REFLECTMAP_UV)\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\n// These shader functions convert between the UV coordinates of a single face of\n// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n// sampling a textureCube (not generally normalized).\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n\nvec3 bilinearCubeUVR(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = reflectMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = reflectMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = reflectMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = reflectMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n\n// These defines must match with PMREMGenerator\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n\nvec4 textureCubeUVR(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUVR(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUVR(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif\n",amrt_lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness,roughnessFactor, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_REFLECTMAP )\n    vec3 reflectVec = reflect( -geometry.viewDir,  geometry.normal );\n   \n    #ifdef USE_REFLECTMAP_UV\n        reflectVec = inverseTransformDirection( reflectVec, viewMatrixR ); \n        vec4 reflectdiffuse = textureCubeUVR( reflectMap, reflectVec, 0.0 );\n        reflectdiffuse = LinearTosRGB(reflectdiffuse);\n        radiance += reflectdiffuse.rgb * reflectIntensity;\n    #else\n        reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n        reflectVec = vec3( -1.0 * reflectVec.x, reflectVec.yz );\n        vec4 reflectdiffuse = textureCube( reflectMap, reflectVec );\n        reflectdiffuse.rgb = reflectMapTexelToLinear(reflectdiffuse).rgb;\n        reflectdiffuse = LinearTosRGB(reflectdiffuse);\n        radiance += reflectdiffuse.rgb * reflectIntensity;\n    #endif\n#endif\n",amrt_bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)G(v) / 4(nl)(nv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',amrt_lights_physical_fragment:"\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\n#if defined( USE_REFLECTMAP )\n    vec3 reflectVec = reflect( -geometry.viewDir,  geometry.normal );\n   \n    #ifdef USE_REFLECTMAP_UV\n        reflectVec = inverseTransformDirection( reflectVec, viewMatrixR );\n        reflectVec*=reflecYMatrix;\n        vec4 reflectdiffuse = textureCubeUVR( reflectMap, reflectVec, 0.0 );\n        reflectdiffuse = LinearTosRGB(reflectdiffuse);\n        diffuseColor.rgb += reflectdiffuse.rgb * reflectIntensity;\n    #else\n        reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n        reflectVec = vec3( -1.0 * reflectVec.x, reflectVec.yz );\n        reflectVec*=reflecYMatrix;\n        vec4 reflectdiffuse = textureCube( reflectMap, reflectVec );\n        reflectdiffuse.rgb = reflectMapTexelToLinear(reflectdiffuse).rgb;\n        reflectdiffuse = LinearTosRGB(reflectdiffuse);\n        diffuseColor.rgb += reflectdiffuse.rgb * reflectIntensity;\n    #endif\n#endif\n\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor ) * 0.779083699;\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = saturate( clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n\n#endif\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n        #ifdef TRANSPARENCY\n            directLight.color *= (1.0 - transparency);\n        #endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n        #ifdef TRANSPARENCY\n            directLight.color *= (1.0 - transparency);\n        #endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n        #ifdef TRANSPARENCY\n            directLight.color *= (1.0 - transparency);\n        #endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#ifdef TRANSPARENCY\n        irradiance *= (1.0 - transparency);\n    #endif\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness,roughnessFactor, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",amrt_dissolve_fragment:"\n#if defined( USE_DISSOLVE )\n    vec4 dissove = texture2D( dissolveMap, vUv );\n    if(dissove.r < dissolveRatio) discard;\n    if(abs(dissove.r - dissolveRatio) < 0.05){\n        gl_FragColor.rgb = dissolveColor;\n    }\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\nuniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nuniform float brightness;\nvarying vec3 vWorldDirection;\n\nvoid main() {\n\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n    gl_FragColor *= brightness;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV;\n\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\n\tvLineDistance = scale * lineDistance;\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transparency model\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",amrtbasic_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <amrt_uv_pars_vertex>\n\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <amrt_skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <amrt_uv_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <amrt_skinbase_vertex>\n\t#include <amrt_skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <amrt_skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <amrt_worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",amrtbasic_frag:"\n\nprecision mediump sampler2D;\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\n#define REFLECTIVITY\n//#define TRANSPARENCY\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float smoothness;\nuniform float metalness;\nuniform float opacity;\nuniform mat3 envYMatrix;\nuniform mat3 reflecYMatrix;\n\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\nvec3 BlendNormals(vec3 n1, vec3 n2)\n{\n    return normalize(vec3(n1.xy + n2.xy, n1.z*n2.z));\n}\n\nvec3 UnpackScaleNormal(vec4 packednormal, float bumpScale)\n{\n    vec3 normal = packednormal.xyz * 2.0 - 1.0;\n    normal.xy *= bumpScale;\n    return normal;\n}\nfloat Pow5( const in float x ) { float x2 = x*x; return x2*x2*x; }\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <amrt_uv_pars_fragment>\n\n\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n    vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n    vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n    \n    vec2 vUvs;\n    #if defined( USE_NORMALMAP2 )\n        vUvs = vUvNormal2;\n    #elif defined( USE_NORMALMAP )\n        vUvs = vUvNormal;\n    #endif\n    \n    vec2 st0 = dFdx( vUvs.st );\n    vec2 st1 = dFdy( vUvs.st );\n\n    float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n    vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n    vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n    vec3 N = normalize( surf_norm );\n\n    mat3 tsn = mat3( S, T, N );\n\n    mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n    return normalize( tsn * mapN );\n\n}\n\n#include <amrt_map_pars_fragment>\n\n#include <amrt_bsdfs>\n#include <amrt_cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <amrt_envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n    float roughnessFactor = 1.0 - smoothness;\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <amrt_map_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <amrt_roughnessmap_fragment>\n\t#include <amrt_metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <amrt_normal_fragment_maps>\n\t\n\t#include <amrt_emissivemap_fragment>\n\n    \n\n\t// accumulation\n\t#include <amrt_lights_physical_fragment>\n\t// #include <lights_fragment_begin>\n\t// #include <amrt_lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <amrt_aomap_fragment>\n\t\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    \n\t// this is a stub for the transparency model\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1.0 - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular));\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n    #include <amrt_dissolve_fragment>\n    #include <amrt_alphamap_fragment>\n}\n",amrtshadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <clipping_planes_pars_fragment>\n#include <amrt_skinning_pars_vertex>\n\nuniform vec4 shadowPlane;\nuniform vec3 lightDirection;\nuniform vec3 center;\n\nvarying vec4 worldPosition;\nvarying vec3 projectionPosition;\nvarying vec3 projectionCenter;\n\nvoid main() {\n    vec3 objectNormal = vec3( normal );\n    vec3 transformed = vec3( position );\n\n    #include <amrt_skinbase_vertex>\n\t#include <amrt_skinnormal_vertex>\n    #include <amrt_skinning_vertex>\n\n    vec4 mvPosition = vec4( transformed, 1.0 );\n    #ifdef USE_INSTANCING\n        mvPosition = instanceMatrix * mvPosition;\n    #endif\n\n    worldPosition = modelMatrix * mvPosition;\n\n    #ifdef USE_SKINNING\n        projectionCenter = (shadowSkinMatrix * vec4(center, 1.0)).xyz;\n    #else\n        projectionCenter = center;\n    #endif\n\n    projectionCenter = projectOnPlane(projectionCenter, shadowPlane.xyz * shadowPlane.w, shadowPlane.xyz);\n\n    projectionPosition = linePlaneIntersect(worldPosition.xyz, -lightDirection, shadowPlane.xyz * shadowPlane.w, shadowPlane.xyz);\n    gl_Position = projectionMatrix * viewMatrix * vec4(projectionPosition, 1.0);\n    \n\t#include <fog_vertex>\n}\n",amrtshadow_frag:"\nuniform float opacity;\n\n#include <common>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform vec3 color;\nuniform vec4 shadowPlane;\nuniform float shadowLength;\nuniform vec3 lightDirection;\n\nvarying vec4 worldPosition;\nvarying vec3 projectionPosition;\nvarying vec3 projectionCenter;\n\nvoid main() {\n\n    if(sideOfPlane(cameraPosition, shadowPlane.xyz * shadowPlane.w, shadowPlane.xyz) > 0.0) discard;\n    if(dot(lightDirection, shadowPlane.xyz) < 0.0) discard;\n\n    #include <clipping_planes_fragment>\n\n    float dis = distance(projectionPosition, projectionCenter) / shadowLength;\n    dis = smoothstep(0.05, 0.9, dis);\n\n    gl_FragColor = vec4(color, pow(max(1.0 - dis, 0.0), 2.0));\n\n\t#include <fog_fragment>\n}\n",acf_vert:"\n#ifdef USE_UV\n    varying vec2 vUv;\n#endif\n\nvoid main() {\n\n\t#ifdef USE_UV\n\n        vUv = uv;\n    \n    #endif\n\n\tvec4 mvPosition = vec4( position, 1.0 );\n    \n    mvPosition = modelViewMatrix * mvPosition;\n    \n    gl_Position = projectionMatrix * mvPosition;\n}\n",acf_frag:"\nuniform vec3 diffuse;\n\n#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, 1.0 );\n\n\t#ifdef USE_MAP\n        vec4 texelColor = texture2D( map, vUv );\n        diffuseColor *= texelColor;\n    #endif\n    \n\tgl_FragColor = diffuseColor;\n}\n",amrt_skinbase_vertex:"\n#ifdef USE_SKINNING\n\n        mat4 boneMatX = getBoneMatrix( skinIndex_4.x );\n        mat4 boneMatY = getBoneMatrix( skinIndex_4.y );\n        mat4 boneMatZ = getBoneMatrix( skinIndex_4.z );\n        mat4 boneMatW = getBoneMatrix( skinIndex_4.w );\n        \n        \n        #ifdef BONE_8\n            mat4 boneMatX_8 = getBoneMatrix( skinIndex_8.x );\n            mat4 boneMatY_8 = getBoneMatrix( skinIndex_8.y );\n            mat4 boneMatZ_8 = getBoneMatrix( skinIndex_8.z );\n            mat4 boneMatW_8 = getBoneMatrix( skinIndex_8.w );\n        #endif\n        \n        #ifdef BONE_12\n            mat4 boneMatX_12 = getBoneMatrix( skinIndex_12.x );\n            mat4 boneMatY_12 = getBoneMatrix( skinIndex_12.y );\n            mat4 boneMatZ_12 = getBoneMatrix( skinIndex_12.z );\n            mat4 boneMatW_12 = getBoneMatrix( skinIndex_12.w );\n        #endif\n        \n         #ifdef BONE_16\n            mat4 boneMatX_16 = getBoneMatrix( skinIndex_16.x );\n            mat4 boneMatY_16 = getBoneMatrix( skinIndex_16.y );\n            mat4 boneMatZ_16 = getBoneMatrix( skinIndex_16.z );\n            mat4 boneMatW_16 = getBoneMatrix( skinIndex_16.w );\n        #endif\n\n#endif\n",amrt_skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t\n    attribute vec4 skinIndex_4;\n\tattribute vec4 skinWeight_4;\n\t\n\t#ifdef BONE_8\n        attribute vec4 skinIndex_8;\n        attribute vec4 skinWeight_8;\n        \n\t#endif\n\t\n\t#ifdef BONE_12\n        attribute vec4 skinIndex_12;\n        attribute vec4 skinWeight_12;\n\t#endif\n\t\n\t#ifdef BONE_16\n        attribute vec4 skinIndex_16;\n        attribute vec4 skinWeight_16;\n\t#endif\n\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\t\t\n\t\tvec4 getSkinVertex(vec4 skinVertex, vec4 skinIndexTmp,vec4 skinWeightTmp){\n\t\t\n\t\t    mat4 boneMatX = getBoneMatrix( skinIndexTmp.x );\n            mat4 boneMatY = getBoneMatrix( skinIndexTmp.y );\n            mat4 boneMatZ = getBoneMatrix( skinIndexTmp.z );\n            mat4 boneMatW = getBoneMatrix( skinIndexTmp.w );\n            \n            vec4 skinned = vec4( 0.0 );\n\n            skinned += boneMatX * skinVertex * skinWeightTmp.x;\n            skinned += boneMatY * skinVertex * skinWeightTmp.y;\n            skinned += boneMatZ * skinVertex * skinWeightTmp.z;\n            skinned += boneMatW * skinVertex * skinWeightTmp.w;\n            return skinned;\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",amrt_skinning_vertex:"\n\n#ifdef USE_SKINNING\n\n        vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n        \n         vec4 skinned = vec4( 0.0 );\n        \n         skinned += boneMatX * skinVertex * skinWeight_4.x;\n         skinned += boneMatY * skinVertex * skinWeight_4.y;\n         skinned += boneMatZ * skinVertex * skinWeight_4.z;\n         skinned += boneMatW * skinVertex * skinWeight_4.w;\n         \n         #ifdef BONE_8\n            skinned += boneMatX_8 * skinVertex * skinWeight_8.x;\n            skinned += boneMatY_8 * skinVertex * skinWeight_8.y;\n            skinned += boneMatZ_8 * skinVertex * skinWeight_8.z;\n            skinned += boneMatW_8 * skinVertex * skinWeight_8.w;\n\n         #endif\n         \n         #ifdef BONE_12\n            skinned += boneMatX_12 * skinVertex * skinWeight_12.x;\n            skinned += boneMatY_12 * skinVertex * skinWeight_12.y;\n            skinned += boneMatZ_12 * skinVertex * skinWeight_12.z;\n            skinned += boneMatW_12 * skinVertex * skinWeight_12.w;\n         #endif\n         \n         #ifdef BONE_16\n            skinned += boneMatX_16 * skinVertex * skinWeight_16.x;\n            skinned += boneMatY_16 * skinVertex * skinWeight_16.y;\n            skinned += boneMatZ_16 * skinVertex * skinWeight_16.z;\n            skinned += boneMatW_16 * skinVertex * skinWeight_16.w;\n         #endif\n        \n         transformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",amrt_skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\t mat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight_4.x * boneMatX;\n\tskinMatrix += skinWeight_4.y * boneMatY;\n\tskinMatrix += skinWeight_4.z * boneMatZ;\n\tskinMatrix += skinWeight_4.w * boneMatW;\n\t\n\t#ifdef BONE_8\n        skinMatrix += skinWeight_8.x * boneMatX_8;\n        skinMatrix += skinWeight_8.y * boneMatY_8;\n        skinMatrix += skinWeight_8.z * boneMatZ_8;\n        skinMatrix += skinWeight_8.w * boneMatW_8;\n\t#endif\n\t\n\t#ifdef BONE_12\n        skinMatrix += skinWeight_12.x * boneMatX_12;\n        skinMatrix += skinWeight_12.y * boneMatY_12;\n        skinMatrix += skinWeight_12.z * boneMatZ_12;\n        skinMatrix += skinWeight_12.w * boneMatW_12;\n\t#endif\n\t\n\t#ifdef BONE_16\n        skinMatrix += skinWeight_16.x * boneMatX_16;\n        skinMatrix += skinWeight_16.y * boneMatY_16;\n        skinMatrix += skinWeight_16.z * boneMatZ_16;\n        skinMatrix += skinWeight_16.w * boneMatW_16;\n\t#endif\n\t\n    mat4 shadowSkinMatrix = skinMatrix;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\t\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n"},ji={common:{diffuse:{value:new Sn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new rt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Je(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Sn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Sn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rt}},sprite:{diffuse:{value:new Sn(15658734)},opacity:{value:1},center:{value:new Je(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rt}},amrtbasic:{diffuse:{value:new Sn(.5,.5,.5)},opacity:{value:1},emissive:{value:new Sn(0)},smoothness:{value:.5},metalness:{value:.5},transparency:{value:0},cutout:{value:1},albedo:{value:null},normalMap:{value:null},normalScale:{value:1},normalMap2:{value:null},normalScale2:{value:1},metallicMap:{value:null},roughnessMap:{value:null},aoMap:{value:null},aoScale:{value:1},emissiveMap:{value:null},reflectMap:{value:null},reflectIntensity:{value:0},envMapIntensity:{value:1},alphaMap:{value:null},dissolveMap:{value:null},dissolveRatio:{value:1},dissolveColor:{value:new Sn(0)},albedoUVTransform:{value:new rt},normalUVTransform:{value:new rt},normal2UVTransform:{value:new rt},metalUVTransform:{value:new rt},roughUVTransform:{value:new rt},aoUVTransform:{value:new rt},emissiveUVTransform:{value:new rt},alphaUVTransform:{value:new rt}},amrtshadow:{color:{value:new Sn(0)},shadowPlane:{value:new dn(new tt(0,-1),0)},lightDirection:{value:new tt(-1,-1,-1)},shadowLength:{value:1},center:{value:new tt(0,0,0)}}},Wi={basic:{uniforms:_i([ji.common,ji.specularmap,ji.envmap,ji.aomap,ji.lightmap,ji.fog]),vertexShader:Vi.meshbasic_vert,fragmentShader:Vi.meshbasic_frag},lambert:{uniforms:_i([ji.common,ji.specularmap,ji.envmap,ji.aomap,ji.lightmap,ji.emissivemap,ji.fog,ji.lights,{emissive:{value:new Sn(0)}}]),vertexShader:Vi.meshlambert_vert,fragmentShader:Vi.meshlambert_frag},phong:{uniforms:_i([ji.common,ji.specularmap,ji.envmap,ji.aomap,ji.lightmap,ji.emissivemap,ji.bumpmap,ji.normalmap,ji.displacementmap,ji.gradientmap,ji.fog,ji.lights,{emissive:{value:new Sn(0)},specular:{value:new Sn(1118481)},shininess:{value:30}}]),vertexShader:Vi.meshphong_vert,fragmentShader:Vi.meshphong_frag},standard:{uniforms:_i([ji.common,ji.envmap,ji.aomap,ji.lightmap,ji.emissivemap,ji.bumpmap,ji.normalmap,ji.displacementmap,ji.roughnessmap,ji.metalnessmap,ji.fog,ji.lights,{emissive:{value:new Sn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag},matcap:{uniforms:_i([ji.common,ji.bumpmap,ji.normalmap,ji.displacementmap,ji.fog,{matcap:{value:null}}]),vertexShader:Vi.meshmatcap_vert,fragmentShader:Vi.meshmatcap_frag},points:{uniforms:_i([ji.points,ji.fog]),vertexShader:Vi.points_vert,fragmentShader:Vi.points_frag},dashed:{uniforms:_i([ji.common,ji.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vi.linedashed_vert,fragmentShader:Vi.linedashed_frag},depth:{uniforms:_i([ji.common,ji.displacementmap]),vertexShader:Vi.depth_vert,fragmentShader:Vi.depth_frag},normal:{uniforms:_i([ji.common,ji.bumpmap,ji.normalmap,ji.displacementmap,{opacity:{value:1}}]),vertexShader:Vi.normal_vert,fragmentShader:Vi.normal_frag},sprite:{uniforms:_i([ji.sprite,ji.fog]),vertexShader:Vi.sprite_vert,fragmentShader:Vi.sprite_frag},background:{uniforms:{uvTransform:{value:new rt},t2D:{value:null}},vertexShader:Vi.background_vert,fragmentShader:Vi.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1},brightness:{value:1}},vertexShader:Vi.cube_vert,fragmentShader:Vi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vi.equirect_vert,fragmentShader:Vi.equirect_frag},distanceRGBA:{uniforms:_i([ji.common,ji.displacementmap,{referencePosition:{value:new tt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vi.distanceRGBA_vert,fragmentShader:Vi.distanceRGBA_frag},shadow:{uniforms:_i([ji.lights,ji.fog,{color:{value:new Sn(0)},opacity:{value:1}}]),vertexShader:Vi.shadow_vert,fragmentShader:Vi.shadow_frag},acf:{uniforms:{diffuse:{value:new Sn(0)},map:{value:null}},vertexShader:Vi.acf_vert,fragmentShader:Vi.acf_frag}};function Xi(){var e=null,t=!1,n=null;function i(r,a){!1!==t&&(n(r,a),e.requestAnimationFrame(i))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Zi(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);void 0===r?t.set(n,function(t,n){var i=t.array,r=t.usage,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,i,r),t.onUploadCallback();var o=e.FLOAT;return i instanceof Float32Array?o=e.FLOAT:i instanceof Float64Array?console.warn("WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=e.UNSIGNED_SHORT:i instanceof Int16Array?o=e.SHORT:i instanceof Uint32Array?o=e.UNSIGNED_INT:i instanceof Int32Array?o=e.INT:i instanceof Int8Array?o=e.BYTE:i instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(n,i)):r.version<n.version&&(!function(t,n,i){var r=n.array,a=n.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,r):(e.bufferSubData(i,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,n,i),r.version=n.version)}}}function Yi(e,t,n,i){Si.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Ki(e,t,n,i)),this.mergeVertices()}function Ki(e,t,n,i){ni.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var r,a,o=(e=e||1)/2,s=(t=t||1)/2,A=Math.floor(n)||1,l=Math.floor(i)||1,c=A+1,h=l+1,u=e/A,d=t/l,f=[],p=[],m=[],g=[];for(a=0;a<h;a++){var v=a*d-s;for(r=0;r<c;r++){var y=r*u-o;p.push(y,-v,0),m.push(0,0,1),g.push(r/A),g.push(1-a/l)}}for(a=0;a<l;a++)for(r=0;r<A;r++){var w=r+c*a,x=r+c*(a+1),b=r+1+c*(a+1),C=r+1+c*a;f.push(w,x,C),f.push(x,b,C)}this.setIndex(f),this.setAttribute("position",new Vn(p,3)),this.setAttribute("normal",new Vn(m,3)),this.setAttribute("uv",new Vn(g,2))}function Ji(e,t,n,i){var r,a,o=new Sn(0),s=0,A=null,l=0;function c(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,i)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),c(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){c(o,s=e)},render:function(t,i,h,u){var d=i.background,f=e.vr,p=f.getSession&&f.getSession();if(p&&"additive"===p.environmentBlendMode&&(d=null),null===d?(c(o,s),A=null,l=0):d&&d.isColor&&(c(d,1),u=!0,A=null,l=0),(e.autoClear||u)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLRenderTargetCube)){void 0===a&&((a=new xi(new Li(1,1,1),new Pi({type:"BackgroundCubeMaterial",uniforms:Fi(Wi.cube.uniforms),vertexShader:Wi.cube.vertexShader,fragmentShader:Wi.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),n.update(a));var m=d.isWebGLRenderTargetCube?d.texture:d;a.material.uniforms.tCube.value=m,a.material.uniforms.tFlip.value=d.isWebGLRenderTargetCube?1:-1,a.material.uniforms.brightness.value=null==d.brightness||null==d.brightness?1:d.brightness,A===d&&l===m.version||(a.material.needsUpdate=!0,A=d,l=m.version),t.unshift(a,a.geometry,a.material,0,0,null)}else d&&d.isTexture&&(void 0===r&&((r=new xi(new Ki(2,2),new Pi({type:"BackgroundMaterial",uniforms:Fi(Wi.background.uniforms),vertexShader:Wi.background.vertexShader,fragmentShader:Wi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(r)),r.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),r.material.uniforms.uvTransform.value.copy(d.matrix),A===d&&l===d.version||(r.material.needsUpdate=!0,A=d,l=d.version),t.unshift(r,r.geometry,r.material,0,0,null))}}}function qi(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r)},this.renderInstances=function(i,o,s,A){if(0!==A){var l,c;if(a)l=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("WebGLBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,o,s,A),n.update(s,r,A)}}}function $i(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var A=!0===n.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),p=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=c>0,v=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=t.get("EXT_texture_filter_anisotropic");return i=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:A,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:u,maxAttributes:d,maxVertexUniforms:f,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function er(){var e=this,t=null,n=0,i=!1,r=!1,a=new dn,o=new rt,s={value:null,needsUpdate:!1};function A(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function l(t,n,i,r){var A=null!==t?t.length:0,l=null;if(0!==A){if(l=s.value,!0!==r||null===l){var c=i+4*A,h=n.matrixWorldInverse;o.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var u=0,d=i;u!==A;++u,d+=4)a.copy(t[u]).applyMatrix4(h,o),a.normal.toArray(l,d),l[d+3]=a.constant}s.value=l,s.needsUpdate=!0}return e.numPlanes=A,l}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,a){var o=0!==e.length||r||0!==n||i;return i=r,t=l(e,a,0),n=e.length,o},this.beginShadows=function(){r=!0,l(null)},this.endShadows=function(){r=!1,A()},this.setState=function(e,a,o,c,h,u){if(!i||null===e||0===e.length||r&&!o)r?l(null):A();else{var d=r?0:n,f=4*d,p=h.clippingState||null;s.value=p,p=l(e,c,f,u);for(var m=0;m!==f;++m)p[m]=t[m];h.clippingState=p,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=d}}}function tr(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("WebGLRenderer: "+e+" extension not supported."),t}}}function nr(e,t,n){var i=new WeakMap,r=new WeakMap;function a(e){var o=e.target,s=i.get(o);for(var A in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[A]);o.removeEventListener("dispose",a),i.delete(o);var l=r.get(s);l&&(t.remove(l),r.delete(s)),n.memory.geometries--}function o(n){var i=[],a=n.index,o=n.attributes.position,s=0;if(null!==a){var A=a.array;s=a.version;for(var l=0,c=A.length;l<c;l+=3){var h=A[l+0],u=A[l+1],d=A[l+2];i.push(h,u,u,d,d,h)}}else{A=o.array;s=o.version;for(l=0,c=A.length/3-1;l<c;l+=3){h=l+0,u=l+1,d=l+2;i.push(h,u,u,d,d,h)}}var f=new(Zn(i)>65535?zn:Qn)(i,1);f.version=s,t.update(f,e.ELEMENT_ARRAY_BUFFER);var p=r.get(n);p&&t.remove(p),r.set(n,f)}return{get:function(e,t){var r=i.get(t);return r||(t.addEventListener("dispose",a),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new ni).setFromObject(e)),r=t._bufferGeometry),i.set(t,r),n.memory.geometries++,r)},update:function(n){var i=n.index,r=n.attributes;for(var a in null!==i&&t.update(i,e.ELEMENT_ARRAY_BUFFER),r)t.update(r[a],e.ARRAY_BUFFER);var o=n.morphAttributes;for(var a in o)for(var s=o[a],A=0,l=s.length;A<l;A++)t.update(s[A],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=r.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return r.get(e)}}}function ir(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r)},this.renderInstances=function(i,A,l,c){if(0!==c){var h,u;if(s)h=e,u="drawElementsInstanced";else if(u="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("WebGLIndexedBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](r,l,a,A*o,c),n.update(l,r,c)}}}function rr(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(r=r||1,t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=r*(n-2);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("WebGLInfo: Unknown draw mode:",i)}}}}function ar(e,t){return Math.abs(t[1])-Math.abs(e[1])}function or(e){var t={},n=new Float32Array(8);return{update:function(i,r,a,o){var s=i.morphTargetInfluences,A=s.length,l=t[r.id];if(void 0===l){l=[];for(var c=0;c<A;c++)l[c]=[c,0];t[r.id]=l}var h=a.morphTargets&&r.morphAttributes.position,u=a.morphNormals&&r.morphAttributes.normal;for(c=0;c<A;c++){0!==(f=l[c])[1]&&(h&&r.deleteAttribute("morphTarget"+c),u&&r.deleteAttribute("morphNormal"+c))}for(c=0;c<A;c++){(f=l[c])[0]=c,f[1]=s[c]}l.sort(ar);var d=0;for(c=0;c<8;c++){var f;if(f=l[c]){var p=f[0],m=f[1];if(m){h&&r.setAttribute("morphTarget"+c,h[p]),u&&r.setAttribute("morphNormal"+c,u[p]),n[c]=m,d+=m;continue}}n[c]=0}var g=r.morphTargetsRelative?1:1-d;o.getUniforms().setValue(e,"morphTargetBaseInfluence",g),o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function sr(e,t,n,i){var r={};return{update:function(a){var o=i.render.frame,s=a.geometry,A=t.get(a,s);return r[A.id]!==o&&(s.isGeometry&&A.updateFromObject(a),t.update(A),r[A.id]=o),a.isInstancedMesh&&n.update(a.instanceMatrix,e.ARRAY_BUFFER),A},dispose:function(){r={}}}}function Ar(e,t,n,i,r,a,o,s,A,l){e=void 0!==e?e:[],t=void 0!==t?t:k,o=void 0!==o?o:ae,st.call(this,e,t,n,i,r,a,o,s,A,l),this.flipY=!1}function lr(e,t,n,i){st.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=z,this.minFilter=z,this.wrapR=Q,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function cr(e,t,n,i){st.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=z,this.minFilter=z,this.wrapR=Q,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Wi.physical={uniforms:_i([Wi.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Sn(0)},clearcoatNormalScale:{value:new Je(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag},Wi.amrtbasic={uniforms:_i([ji.envmap,ji.amrtbasic,ji.fog,ji.lights,{envYMatrix:{value:new rt},reflecYMatrix:{value:new rt}}]),vertexShader:Vi.amrtbasic_vert,fragmentShader:Vi.amrtbasic_frag},Wi.amrtshadow={uniforms:_i([ji.fog,ji.amrtshadow,ji.lights]),vertexShader:Vi.amrtshadow_vert,fragmentShader:Vi.amrtshadow_frag},Yi.prototype=Object.create(Si.prototype),Yi.prototype.constructor=Yi,Ki.prototype=Object.create(ni.prototype),Ki.prototype.constructor=Ki,Ar.prototype=Object.create(st.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isCubeTexture=!0,Object.defineProperty(Ar.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),lr.prototype=Object.create(st.prototype),lr.prototype.constructor=lr,lr.prototype.isDataTexture2DArray=!0,cr.prototype=Object.create(st.prototype),cr.prototype.constructor=cr,cr.prototype.isDataTexture3D=!0;var hr=new st,ur=new lr,dr=new cr,fr=new Ar,pr=[],mr=[],gr=new Float32Array(16),vr=new Float32Array(9),yr=new Float32Array(4);function wr(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=pr[r];if(void 0===a&&(a=new Float32Array(r),pr[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function xr(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function br(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function Cr(e,t){var n=mr[t];void 0===n&&(n=new Int32Array(t),mr[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Mr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Br(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(xr(n,t))return;e.uniform2fv(this.addr,t),br(n,t)}}function Ir(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(xr(n,t))return;e.uniform3fv(this.addr,t),br(n,t)}}function Er(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(xr(n,t))return;e.uniform4fv(this.addr,t),br(n,t)}}function Sr(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(xr(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),br(n,t)}else{if(xr(n,i))return;yr.set(i),e.uniformMatrix2fv(this.addr,!1,yr),br(n,i)}}function Tr(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(xr(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),br(n,t)}else{if(xr(n,i))return;vr.set(i),e.uniformMatrix3fv(this.addr,!1,vr),br(n,i)}}function Lr(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(xr(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),br(n,t)}else{if(xr(n,i))return;gr.set(i),e.uniformMatrix4fv(this.addr,!1,gr),br(n,i)}}function Fr(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||hr,r)}function _r(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||ur,r)}function Ur(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||dr,r)}function Pr(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||fr,r)}function kr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Dr(e,t){var n=this.cache;xr(n,t)||(e.uniform2iv(this.addr,t),br(n,t))}function Rr(e,t){var n=this.cache;xr(n,t)||(e.uniform3iv(this.addr,t),br(n,t))}function Or(e,t){var n=this.cache;xr(n,t)||(e.uniform4iv(this.addr,t),br(n,t))}function Nr(e,t){e.uniform1fv(this.addr,t)}function Gr(e,t){e.uniform1iv(this.addr,t)}function Qr(e,t){e.uniform2iv(this.addr,t)}function Hr(e,t){e.uniform3iv(this.addr,t)}function zr(e,t){e.uniform4iv(this.addr,t)}function Vr(e,t){var n=wr(t,this.size,2);e.uniform2fv(this.addr,n)}function jr(e,t){var n=wr(t,this.size,3);e.uniform3fv(this.addr,n)}function Wr(e,t){var n=wr(t,this.size,4);e.uniform4fv(this.addr,n)}function Xr(e,t){var n=wr(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Zr(e,t){var n=wr(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Yr(e,t){var n=wr(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Kr(e,t,n){var i=t.length,r=Cr(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTexture2D(t[a]||hr,r[a])}function Jr(e,t,n){var i=t.length,r=Cr(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTextureCube(t[a]||fr,r[a])}function qr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Mr;case 35664:return Br;case 35665:return Ir;case 35666:return Er;case 35674:return Sr;case 35675:return Tr;case 35676:return Lr;case 35678:case 36198:return Fr;case 35679:return Ur;case 35680:return Pr;case 36289:return _r;case 5124:case 35670:return kr;case 35667:case 35671:return Dr;case 35668:case 35672:return Rr;case 35669:case 35673:return Or}}(t.type)}function $r(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Nr;case 35664:return Vr;case 35665:return jr;case 35666:return Wr;case 35674:return Xr;case 35675:return Zr;case 35676:return Yr;case 35678:return Kr;case 35680:return Jr;case 5124:case 35670:return Gr;case 35667:case 35671:return Qr;case 35668:case 35672:return Hr;case 35669:case 35673:return zr}}(t.type)}function ea(e){this.id=e,this.seq=[],this.map={}}$r.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),br(t,e)},ea.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}};var ta=/([\w\d_]+)(\])?(\[|\.)?/g;function na(e,t){e.seq.push(t),e.map[t.id]=t}function ia(e,t,n){var i=e.name,r=i.length;for(ta.lastIndex=0;;){var a=ta.exec(i),o=ta.lastIndex,s=a[1],A="]"===a[2],l=a[3];if(A&&(s|=0),void 0===l||"["===l&&o+2===r){na(n,void 0===l?new qr(s,e,t):new $r(s,e,t));break}var c=n.map[s];void 0===c&&na(n,c=new ea(s)),n=c}}function ra(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var r=e.getActiveUniform(t,i);ia(r,e.getUniformLocation(t,r.name),this)}}function aa(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}ra.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},ra.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},ra.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},ra.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var oa=0;function sa(e){switch(e){case Pe:return["Linear","( value )"];case ke:return["sRGB","( value )"];case Re:return["RGBE","( value )"];case Oe:return["RGBM","( value, 7.0 )"];case Ne:return["RGBM","( value, 16.0 )"];case Ge:return["RGBD","( value, 256.0 )"];case De:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Aa(e,t,n){var i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function la(e,t){var n=sa(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ca(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Uncharted2";break;case 4:n="OptimizedCineon";break;case 5:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ha(e){return""!==e}function ua(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function da(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var fa=/^[ \t]*#include +<([\w\d./]+)>/gm;function pa(e){return e.replace(fa,ma)}function ma(e,t){var n=Vi[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return pa(n)}var ga=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function va(e){return e.replace(ga,ya)}function ya(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function wa(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function xa(e,t,n,i,r,a){var o,s,A,l,c,h=e.getContext(),u=i.defines,d=r.vertexShader,f=r.fragmentShader,p=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(a),m=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case k:case D:t="ENVMAP_TYPE_CUBE";break;case O:case N:t="ENVMAP_TYPE_CUBE_UV";break;case 303:case R:t="ENVMAP_TYPE_EQUIREC";break;case 305:t="ENVMAP_TYPE_SPHERE"}return t}(a),g=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case D:case R:t="ENVMAP_MODE_REFRACTION"}return t}(a),v=function(e){var t="ENVMAP_BLENDING_MULTIPLY";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(a),y=e.gammaFactor>0?e.gammaFactor:1,w=a.isWebGL2?"":function(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||!t.vertexTangents?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":"",n.get("OES_texture_half_float")?"#extension OES_texture_half_float : enable":""].filter(ha).join("\n")}(i.extensions,a,t),x=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(u),b=h.createProgram(),C=a.numMultiviewViews;if(i.isRawShaderMaterial?((o=[x].filter(ha).join("\n")).length>0&&(o+="\n"),(s=[w,x].filter(ha).join("\n")).length>0&&(s+="\n")):(o=[wa(a),"#define SHADER_NAME "+r.name,x,a.instancing?"#define USE_INSTANCING":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+g:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.dissolveMap?"#define USE_DISSOLVE":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.albedo?"#define USE_ALBEDO":"",1===a.albedoUV?"#define ALBEDO_UV2":"#define ALBEDO_UV1",a.normalMap2?"#define USE_NORMALMAP2":"",a.metallicMap?"#define USE_METALLICMAP":"",1===a.aoUV?"#define AO_UV2":"#define AO_UV1",1===a.emissiveUV?"#define EMISSIVE_UV2":"#define EMISSIVE_UV1",a.reflectMap?"#define USE_REFLECTMAP":"",a.boneNum>4?"#define BONE_8":"",a.boneNum>8?"#define BONE_12":"",a.boneNum>12?"#define BONE_16":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","\n"].filter(ha).join("\n"),s=[w,wa(a),"#define SHADER_NAME "+r.name,x,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.envMap?"#define "+g:"",a.envMap?"#define "+v:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.dissolveMap?"#define USE_DISSOLVE":"",a.sheen?"#define USE_SHEEN":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensions&&i.extensions.shaderTextureLOD||a.envMap||a.reflectMap)&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform mat4 viewMatrixR;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?Vi.tonemapping_pars_fragment:"",0!==a.toneMapping?ca("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Vi.encodings_pars_fragment:"",a.mapEncoding?la("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?la("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?la("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?la("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(A="linearToOutputTexel",l=a.outputEncoding,c=sa(l),"vec4 "+A+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"):"",a.albedoEncoding?la("albedoTexelToLinear",a.albedoEncoding):"",a.normalMapEncoding?la("normalMapTexelToLinear",a.normalMapEncoding):"",a.normalMap2Encoding?la("normalMap2TexelToLinear",a.normalMap2Encoding):"",a.metallicMapEncoding?la("metallicMapTexelToLinear",a.metallicMapEncoding):"",a.roughnessMapEncoding?la("roughnessMapTexelToLinear",a.roughnessMapEncoding):"",a.aoMapEncoding?la("aoMapTexelToLinear",a.aoMapEncoding):"",a.reflectMapEncoding?la("reflectMapTexelToLinear",a.reflectMapEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",a.albedo?"#define USE_ALBEDO":"",1===a.albedoUV?"#define ALBEDO_UV2":"#define ALBEDO_UV1",a.normalMap2?"#define USE_NORMALMAP2":"",a.metallicMap?"#define USE_METALLICMAP":"",1===a.aoUV?"#define AO_UV2":"#define AO_UV1",1===a.emissiveUV?"#define EMISSIVE_UV2":"#define EMISSIVE_UV1",a.reflectMap?"#define USE_REFLECTMAP":"",a.reflectMapUV?"#define USE_REFLECTMAP_UV":"",a.transparency?"#define TRANSPARENCY":"","\n"].filter(ha).join("\n")),d=da(d=ua(d=pa(d),a),a),f=da(f=ua(f=pa(f),a),a),d=va(d),f=va(f),a.isWebGL2&&!i.isRawShaderMaterial){var M=!1,B=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==d.match(B)&&null!==f.match(B)&&(M=!0,d=d.replace(B,""),f=f.replace(B,"")),o=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+o,s=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s,C>0&&(o=(o=o.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+C+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+C+"];","uniform mat4 projectionMatrices["+C+"];","uniform mat4 viewMatrices["+C+"];","uniform mat3 normalMatrices["+C+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),s=(s=s.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+C+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var I,E,S=o+d,T=s+f,L=aa(h,h.VERTEX_SHADER,S),F=aa(h,h.FRAGMENT_SHADER,T);if(h.attachShader(b,L),h.attachShader(b,F),void 0!==i.index0AttributeName?h.bindAttribLocation(b,0,i.index0AttributeName):!0===a.morphTargets&&h.bindAttribLocation(b,0,"position"),h.linkProgram(b),e.debug.checkShaderErrors){var _=h.getProgramInfoLog(b).trim(),U=h.getShaderInfoLog(L).trim(),P=h.getShaderInfoLog(F).trim(),G=!0,Q=!0;if(!1===h.getProgramParameter(b,h.LINK_STATUS)){G=!1;var H=Aa(h,L,"vertex"),z=Aa(h,F,"fragment");console.error("WebGLProgram: shader error: ",h.getError(),"gl.VALIDATE_STATUS",h.getProgramParameter(b,h.VALIDATE_STATUS),"gl.getProgramInfoLog",_,H,z)}else""!==_?console.warn("WebGLProgram: gl.getProgramInfoLog()",_):""!==U&&""!==P||(Q=!1);Q&&(this.diagnostics={runnable:G,material:i,programLog:_,vertexShader:{log:U,prefix:o},fragmentShader:{log:P,prefix:s}})}return h.deleteShader(L),h.deleteShader(F),this.getUniforms=function(){return void 0===I&&(I=new ra(h,b)),I},this.getAttributes=function(){return void 0===E&&(E=function(e,t){for(var n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<i;r++){var a=e.getActiveAttrib(t,r).name;n[a]=e.getAttribLocation(t,a)}return n}(h,b)),E},this.destroy=function(){h.deleteProgram(b),this.program=void 0},this.name=r.name,this.id=oa++,this.cacheKey=n,this.usedTimes=1,this.program=b,this.vertexShader=L,this.fragmentShader=F,this.numMultiviewViews=C,this}function ba(e,t,n){var i=[],r=n.isWebGL2,a=n.logarithmicDepthBuffer,o=n.floatVertexTextures,s=n.precision,A=n.maxVertexUniforms,l=n.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite",AMRTBasicMaterial:"amrtbasic",ACFBasicMaterial:"acf",AMRTShadowMaterial:"amrtshadow"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","albedo","albedoEncoding","albedoUV","normalMap2","metallicMap","aoUV","emissiveUV","reflectMap","reflectMapUV","reflectMapEncoding","normalMapEncoding","normalMap2Encoding","metallicMapEncoding","roughnessMapEncoding","aoMapEncoding","transparency","boneNum","dissolveMap","dissolveRatio"];function u(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=Pe,n===Pe&&t&&(n=De),n}this.getParameters=function(t,i,h,d,f,p,m){var g=c[t.type],v=m.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(o)return 1024;var n=A,i=Math.floor((n-20)/4),r=Math.min(i,t.length);return r<t.length?(console.warn("WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}(m):0,y=m.boneNum?m.boneNum:0;null!==t.precision&&(s=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("WebGLProgram.getParameters:",t.precision,"not supported, using",s,"instead.");var w=e.getRenderTarget(),x=w&&w.isWebGLMultiviewRenderTarget?w.numViews:0;return{isWebGL2:r,shaderID:g,precision:s,instancing:!0===m.isInstancedMesh,supportsVertexTextures:l,numMultiviewViews:x,outputEncoding:u(w?w.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:u(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:u(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:u(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===O||t.envMap.mapping===N),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:u(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,tangentSpaceNormalMap:0===t.normalMapType,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!d,useFog:t.fog,fogExp2:d&&d.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:a,skinning:t.skinning&&v>0,maxBones:v,useVertexTexture:o,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numDirLightShadows:i.directionalShadowMap.length,numPointLightShadows:i.pointShadowMap.length,numSpotLightShadows:i.spotShadowMap.length,numClippingPlanes:f,numClipIntersection:p,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:t.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking,albedo:!!t.albedo,albedoUV:t.albedoUV,normalMap2:!!t.normalMap2,metallicMap:!!t.metallicMap,aoUV:t.aoUV,emissiveUV:t.emissiveUV,reflectMap:!!t.reflectMap,reflectMapUV:!!t.reflectMap&&!t.reflectMap.isCubeTexture,aoMapEncoding:u(t.aoMap,e.gammaInput),roughnessMapEncoding:u(t.roughnessMap,e.gammaInput),metallicMapEncoding:u(t.metallicMap,e.gammaInput),normalMapEncoding:u(t.normalMap,e.gammaInput),normalMap2Encoding:u(t.normalMap2,e.gammaInput),albedoEncoding:u(t.albedo,e.gammaInput),reflectMapEncoding:u(t.reflectMap,e.gammaInput),transparency:void 0!==t.transparency&&t.transparency>0,boneNum:y,dissolveMap:!!t.dissolveMap,dissolveRatio:t.dissolveRatio}},this.getProgramCacheKey=function(t,n){var i=[];if(n.shaderID?i.push(n.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);for(var a=0;a<h.length;a++)i.push(n[h[a]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.push(e.gammaFactor),i.join()},this.acquireProgram=function(n,r,a,o){for(var s,A=0,l=i.length;A<l;A++){var c=i[A];if(c.cacheKey===o){++(s=c).usedTimes;break}}return void 0===s&&(s=new xa(e,t,o,n,r,a),i.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),e.destroy()}},this.programs=i}function Ca(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Ma(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ba(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ia(){var e=[],t=0,n=[],i=[],r={id:-1};function a(n,i,a,o,s,A){var l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:a,program:a.program||r,groupOrder:o,renderOrder:n.renderOrder,z:s,group:A},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=a,l.program=a.program||r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=s,l.group=A),t++,l}return{opaque:n,transparent:i,init:function(){t=0,n.length=0,i.length=0},push:function(e,t,r,o,s,A){var l=a(e,t,r,o,s,A);(!0===r.transparent?i:n).push(l)},unshift:function(e,t,r,o,s,A){var l=a(e,t,r,o,s,A);(!0===r.transparent?i:n).unshift(l)},sort:function(){n.length>1&&n.sort(Ma),i.length>1&&i.sort(Ba)}}}function Ea(){var e=new WeakMap;function t(n){var i=n.target;i.removeEventListener("dispose",t),e.delete(i)}return{get:function(n,i){var r,a=e.get(n);return void 0===a?(r=new Ia,e.set(n,new WeakMap),e.get(n).set(i,r),n.addEventListener("dispose",t)):void 0===(r=a.get(i))&&(r=new Ia,a.set(i,r)),r},dispose:function(){e=new WeakMap}}}function Sa(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new tt,color:new Sn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Je};break;case"SpotLight":n={position:new tt,direction:new tt,color:new Sn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Je};break;case"PointLight":n={position:new tt,color:new Sn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Je,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new tt,skyColor:new Sn,groundColor:new Sn};break;case"RectAreaLight":n={color:new Sn,position:new tt,halfWidth:new tt,halfHeight:new tt}}return e[t.id]=n,n}}}var Ta=0;function La(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Fa(){for(var e=new Sa,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new tt);var i=new tt,r=new vt,a=new vt;return{setup:function(n,o,s){for(var A=0,l=0,c=0,h=0;h<9;h++)t.probe[h].set(0,0,0);var u=0,d=0,f=0,p=0,m=0,g=0,v=0,y=0,w=s.matrixWorldInverse;n.sort(La),h=0;for(var x=n.length;h<x;h++){var b=n[h],C=b.color,M=b.intensity,B=b.distance,I=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)A+=C.r*M,l+=C.g*M,c+=C.b*M;else if(b.isLightProbe)for(var E=0;E<9;E++)t.probe[E].addScaledVector(b.sh.coefficients[E],M);else if(b.isDirectionalLight){if((T=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(w),T.shadow=b.castShadow,b.castShadow){var S=b.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,t.directionalShadowMap[u]=I,t.directionalShadowMatrix[u]=b.shadow.matrix,g++}t.directional[u]=T,u++}else if(b.isSpotLight){if((T=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(w),T.color.copy(C).multiplyScalar(M),T.distance=B,T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(w),T.coneCos=Math.cos(b.angle),T.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),T.decay=b.decay,T.shadow=b.castShadow,b.castShadow){S=b.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,t.spotShadowMap[f]=I,t.spotShadowMatrix[f]=b.shadow.matrix,y++}t.spot[f]=T,f++}else if(b.isRectAreaLight){(T=e.get(b)).color.copy(C).multiplyScalar(M),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(w),a.identity(),r.copy(b.matrixWorld),r.premultiply(w),a.extractRotation(r),T.halfWidth.set(.5*b.width,0,0),T.halfHeight.set(0,.5*b.height,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),t.rectArea[p]=T,p++}else if(b.isPointLight){if((T=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(w),T.color.copy(b.color).multiplyScalar(b.intensity),T.distance=b.distance,T.decay=b.decay,T.shadow=b.castShadow,b.castShadow){S=b.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,T.shadowCameraNear=S.camera.near,T.shadowCameraFar=S.camera.far,t.pointShadowMap[d]=I,t.pointShadowMatrix[d]=b.shadow.matrix,v++}t.point[d]=T,d++}else if(b.isHemisphereLight){var T;(T=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),T.direction.transformDirection(w),T.direction.normalize(),T.skyColor.copy(b.color).multiplyScalar(M),T.groundColor.copy(b.groundColor).multiplyScalar(M),t.hemi[m]=T,m++}}t.ambient[0]=A,t.ambient[1]=l,t.ambient[2]=c;var L=t.hash;L.directionalLength===u&&L.pointLength===d&&L.spotLength===f&&L.rectAreaLength===p&&L.hemiLength===m&&L.numDirectionalShadows===g&&L.numPointShadows===v&&L.numSpotShadows===y||(t.directional.length=u,t.spot.length=f,t.rectArea.length=p,t.point.length=d,t.hemi.length=m,t.directionalShadowMap.length=g,t.pointShadowMap.length=v,t.spotShadowMap.length=y,t.directionalShadowMatrix.length=g,t.pointShadowMatrix.length=v,t.spotShadowMatrix.length=y,L.directionalLength=u,L.pointLength=d,L.spotLength=f,L.rectAreaLength=p,L.hemiLength=m,L.numDirectionalShadows=g,L.numPointShadows=v,L.numSpotShadows=y,t.version=Ta++)},state:t}}function _a(){var e=new Fa,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(i){e.setup(t,n,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function Ua(){var e=new WeakMap;function t(n){var i=n.target;i.removeEventListener("dispose",t),e.delete(i)}return{get:function(n,i){var r;return!1===e.has(n)?(r=new _a,e.set(n,new WeakMap),e.get(n).set(i,r),n.addEventListener("dispose",t)):!1===e.get(n).has(i)?(r=new _a,e.get(n).set(i,r)):r=e.get(n).get(i),r},dispose:function(){e=new WeakMap}}}function Pa(e){Pn.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function ka(e){Pn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new tt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Pa.prototype=Object.create(Pn.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isMeshDepthMaterial=!0,Pa.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ka.prototype=Object.create(Pn.prototype),ka.prototype.constructor=ka,ka.prototype.isMeshDistanceMaterial=!0,ka.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function Da(e,t,n){var i=new zi,r=new Je,a=new Je,o=new At,s=[],A=[],l={},c={0:1,1:0,2:2},h=new Pi({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Je},radius:{value:4}},vertexShader:"\n\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n    #ifdef HORIZONAL_PASS\n\n      vec2 distribution = unpack2HalfToRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n    #else\n\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n\n    #endif\n\n  }\n\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n  float std_dev = sqrt( squared_mean - mean * mean );\n\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),u=h.clone();u.defines.HORIZONAL_PASS=1;var d=new ni;d.setAttribute("position",new Dn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var f=new xi(d,h),p=this;function m(n,i){var r=t.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,h,f,null),u.uniforms.shadow_pass.value=n.mapPass.texture,u.uniforms.resolution.value=n.mapSize,u.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,u,f,null)}function g(e,t,n){var i=e<<0|t<<1|n<<2,r=s[i];return void 0===r&&(r=new Pa({depthPacking:Qe,morphTargets:e,skinning:t}),s[i]=r),r}function v(e,t,n){var i=e<<0|t<<1|n<<2,r=A[i];return void 0===r&&(r=new ka({morphTargets:e,skinning:t}),A[i]=r),r}function y(t,n,i,r,a,o){var s=t.geometry,A=null,h=g,u=t.customDepthMaterial;if(!0===i.isPointLight&&(h=v,u=t.customDistanceMaterial),void 0===u){var d=!1;!0===n.morphTargets&&(!0===s.isBufferGeometry?d=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(d=s.morphTargets&&s.morphTargets.length>0));var f=!1;!0===t.isSkinnedMesh&&!0===n.skinning&&(f=!0),A=h(d,f,!0===t.isInstancedMesh)}else A=u;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var p=A.uuid,m=n.uuid,y=l[p];void 0===y&&(y={},l[p]=y);var w=y[m];void 0===w&&(w=A.clone(),y[m]=w),A=w}return A.visible=n.visible,A.wireframe=n.wireframe,A.side=3===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],A.clipShadows=n.clipShadows,A.clippingPlanes=n.clippingPlanes,A.clipIntersection=n.clipIntersection,A.wireframeLinewidth=n.wireframeLinewidth,A.linewidth=n.linewidth,!0===i.isPointLight&&!0===A.isMeshDistanceMaterial&&(A.referencePosition.setFromMatrixPosition(i.matrixWorld),A.nearDistance=r,A.farDistance=a),A}function w(n,r,a,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var A=t.update(n),l=n.material;if(Array.isArray(l))for(var c=A.groups,h=0,u=c.length;h<u;h++){var d=c[h],f=l[d.materialIndex];if(f&&f.visible){var p=y(n,f,o,a.near,a.far,s);e.renderBufferDirect(a,null,A,p,n,d)}}else if(l.visible){p=y(n,l,o,a.near,a.far,s);e.renderBufferDirect(a,null,A,p,n,null)}}for(var m=n.children,g=0,v=m.length;g<v;g++)w(m[g],r,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,s,A){if(!1!==p.enabled&&(!1!==p.autoUpdate||!1!==p.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),u=e.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(var d=0,f=t.length;d<f;d++){var g=t[d],v=g.shadow;if(void 0!==v){r.copy(v.mapSize);var y=v.getFrameExtents();if(r.multiply(y),a.copy(v.mapSize),(r.x>n||r.y>n)&&(console.warn("WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),r.x>n&&(a.x=Math.floor(n/y.x),r.x=a.x*y.x,v.mapSize.x=a.x),r.y>n&&(a.y=Math.floor(n/y.y),r.y=a.y*y.y,v.mapSize.y=a.y)),null===v.map&&!v.isPointLightShadow&&3===this.type){var x={minFilter:W,magFilter:W,format:oe};v.map=new lt(r.x,r.y,x),v.map.texture.name=g.name+".shadowMap",v.mapPass=new lt(r.x,r.y,x),v.camera.updateProjectionMatrix()}if(null===v.map){x={minFilter:z,magFilter:z,format:oe};v.map=new lt(r.x,r.y,x),v.map.texture.name=g.name+".shadowMap",v.camera.updateProjectionMatrix()}e.setRenderTarget(v.map),e.clear();for(var b=v.getViewportCount(),C=0;C<b;C++){var M=v.getViewport(C);o.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),u.viewport(o),v.updateMatrices(g,C),i=v.getFrustum(),w(s,A,v.camera,g,this.type)}v.isPointLightShadow||3!==this.type||m(v,A)}else console.warn("WebGLShadowMap:",g,"has no shadow.")}p.needsUpdate=!1,e.setRenderTarget(l,c,h)}}}function Ra(e,t,n){var i,r,a=n.isWebGL2;var o=new function(){var t=!1,n=new At,i=null,r=new At(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},A=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(t){t?Y(e.DEPTH_TEST):K(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},l=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,A=null,l=null;return{setTest:function(n){t||(n?Y(e.STENCIL_TEST):K(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&A===i||(e.stencilOp(t,n,i),o=t,s=n,A=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,A=null,l=null}}},c=e.getParameter(e.MAX_VERTEX_ATTRIBS),h=new Uint8Array(c),u=new Uint8Array(c),d=new Uint8Array(c),f={},p=null,m=null,g=null,v=null,y=null,w=null,x=null,b=null,C=null,M=!1,B=null,P=null,k=null,D=null,R=null,O=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),N=!1,G=0,Q=e.getParameter(e.VERSION);-1!==Q.indexOf("WebGL")?(G=parseFloat(/^WebGL\ ([0-9])/.exec(Q)[1]),N=G>=1):-1!==Q.indexOf("OpenGL ES")&&(G=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(Q)[1]),N=G>=2);var H=null,z={},V=new At,j=new At;function W(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<i;o++)e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return a}var X={};function Z(n,i){(h[n]=1,0===u[n]&&(e.enableVertexAttribArray(n),u[n]=1),d[n]!==i)&&((a?e:t.get("ANGLE_instanced_arrays"))[a?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),d[n]=i)}function Y(t){!0!==f[t]&&(e.enable(t),f[t]=!0)}function K(t){!1!==f[t]&&(e.disable(t),f[t]=!1)}X[e.TEXTURE_2D]=W(e.TEXTURE_2D,e.TEXTURE_2D,1),X[e.TEXTURE_CUBE_MAP]=W(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),o.setClear(0,0,0,1),A.setClear(1),l.setClear(0),Y(e.DEPTH_TEST),A.setFunc(3),te(!1),ne(1),Y(e.CULL_FACE),ee(0);var J=(s(i={},I,e.FUNC_ADD),s(i,101,e.FUNC_SUBTRACT),s(i,102,e.FUNC_REVERSE_SUBTRACT),i);if(a)J[103]=e.MIN,J[104]=e.MAX;else{var q=t.get("EXT_blend_minmax");q&&null!==q&&(J[103]=q.MIN_EXT,J[104]=q.MAX_EXT)}var $=(s(r={},E,e.ZERO),s(r,S,e.ONE),s(r,T,e.SRC_COLOR),s(r,L,e.SRC_ALPHA),s(r,210,e.SRC_ALPHA_SATURATE),s(r,U,e.DST_COLOR),s(r,_,e.DST_ALPHA),s(r,203,e.ONE_MINUS_SRC_COLOR),s(r,F,e.ONE_MINUS_SRC_ALPHA),s(r,209,e.ONE_MINUS_DST_COLOR),s(r,207,e.ONE_MINUS_DST_ALPHA),r);function ee(t,n,i,r,a,o,s,A){if(0!==t){if(m||(Y(e.BLEND),m=!0),5===t)a=a||n,o=o||i,s=s||r,n===v&&a===x||(e.blendEquationSeparate(J[n],J[a]),v=n,x=a),i===y&&r===w&&o===b&&s===C||(e.blendFuncSeparate($[i],$[r],$[o],$[s]),y=i,w=r,b=o,C=s),g=t,M=null;else if(t!==g||A!==M){if(v===I&&x===I||(e.blendEquation(e.FUNC_ADD),v=I,x=I),A)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("WebGLState: Invalid blending: ",t)}y=null,w=null,b=null,C=null,g=t,M=A}}else m&&(K(e.BLEND),m=!1)}function te(t){B!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),B=t)}function ne(t){0!==t?(Y(e.CULL_FACE),t!==P&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):K(e.CULL_FACE),P=t}function ie(t,n,i){t?(Y(e.POLYGON_OFFSET_FILL),D===n&&R===i||(e.polygonOffset(n,i),D=n,R=i)):K(e.POLYGON_OFFSET_FILL)}function re(t){void 0===t&&(t=e.TEXTURE0+O-1),H!==t&&(e.activeTexture(t),H=t)}return{buffers:{color:o,depth:A,stencil:l},initAttributes:function(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function(e){Z(e,0)},enableAttributeAndDivisor:Z,disableUnusedAttributes:function(){for(var t=0,n=u.length;t!==n;++t)u[t]!==h[t]&&(e.disableVertexAttribArray(t),u[t]=0)},enable:Y,disable:K,useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:ee,setMaterial:function(t,n){2===t.side?K(e.CULL_FACE):Y(e.CULL_FACE);var i=1===t.side;n&&(i=!i),te(i),1===t.blending&&!1===t.transparent?ee(0):ee(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),A.setFunc(t.depthFunc),A.setTest(t.depthTest),A.setMask(t.depthWrite),o.setMask(t.colorWrite);var r=t.stencilWrite;l.setTest(r),r&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),ie(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:te,setCullFace:ne,setLineWidth:function(t){t!==k&&(N&&e.lineWidth(t),k=t)},setPolygonOffset:ie,setScissorTest:function(t){t?Y(e.SCISSOR_TEST):K(e.SCISSOR_TEST)},activeTexture:re,bindTexture:function(t,n){null===H&&re();var i=z[H];void 0===i&&(i={type:void 0,texture:void 0},z[H]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||X[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=z[H];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},scissor:function(t){!1===V.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),V.copy(t))},viewport:function(t){!1===j.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),j.copy(t))},reset:function(){for(var t=0;t<u.length;t++)1===u[t]&&(e.disableVertexAttribArray(t),u[t]=0);f={},H=null,z={},p=null,g=null,B=null,P=null,o.reset(),A.reset(),l.reset()}}}function Oa(e,t,n,i,r,a,o){var A,l,c,h=r.isWebGL2,u=r.maxTextures,d=r.maxCubemapSize,f=r.maxTextureSize,p=r.maxSamples,m=new WeakMap,g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d");function v(e,t){return g?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function y(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Ke.floorPowerOfTwo:Math.floor,o=a(r*e.width),s=a(r*e.height);void 0===c&&(c=v(o,s));var A=n?v(o,s):c;return A.width=o,A.height=s,A.getContext("2d").drawImage(e,0,0,o,s),console.warn("Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),A}return"data"in e&&console.warn("Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function w(e){return Ke.isPowerOfTwo(e.width)&&Ke.isPowerOfTwo(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==z&&e.minFilter!==W}function b(t,n,r,a){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log(Math.max(r,a))*Math.LOG2E}function C(n,i){if(!1===h)return n;var r=n;return n===e.RED&&(i===e.FLOAT&&(r=e.R32F),i===e.HALF_FLOAT&&(r=e.R16F),i===e.UNSIGNED_BYTE&&(r=e.R8)),n===e.RGB&&(i===e.FLOAT&&(r=e.RGB32F),i===e.HALF_FLOAT&&(r=e.RGB16F),i===e.UNSIGNED_BYTE&&(r=e.RGB8)),n===e.RGBA&&(i===e.FLOAT&&(r=e.RGBA32F),i===e.HALF_FLOAT&&(r=e.RGBA16F),i===e.UNSIGNED_BYTE&&(r=e.RGBA8)),r===e.R16F||r===e.R32F||r===e.RGBA16F||r===e.RGBA32F?t.get("EXT_color_buffer_float"):r!==e.RGB16F&&r!==e.RGB32F||console.warn("Floating point textures with RGB format not supported. Please use RGBA instead."),r}function M(t){return t===z||t===V||t===j?e.NEAREST:e.LINEAR}function B(t){var n=t.target;n.removeEventListener("dispose",B),function(t){var n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&m.delete(n),o.memory.textures--}function I(t){var n=t.target;n.removeEventListener("dispose",I),function(t){var n=i.get(t),r=i.get(t.texture);if(!t)return;void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(n.__webglColorTexture),e.deleteTexture(n.__webglDepthStencilTexture),o.memory.textures-=2;a=0;for(var s=n.__webglViewFramebuffers.length;a<s;a++)e.deleteFramebuffer(n.__webglViewFramebuffers[a])}i.remove(t.texture),i.remove(t)}(n),o.memory.textures--}var E=0;function S(t,r){var a=i.get(t);if(t.isVideoTexture&&function(e){var t=o.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(t),t.version>0&&a.__version!==t.version){var s=t.image;if(void 0===s)console.warn("Texture marked for update but image is undefined");else if(!1!==s.complete)return void k(a,t,r)}n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function T(t,r){if(6===t.image.length){var o=i.get(t);if(t.version>0&&o.__version!==t.version){P(o,t),n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var s=t&&t.isCompressedTexture,A=t.image[0]&&t.image[0].isDataTexture,l=[],c=0;c<6;c++)l[c]=s||A?A?t.image[c].image:t.image[c]:y(t.image[c],!1,!0,d);var u,f=l[0],p=w(f)||h,m=a.convert(t.format),g=a.convert(t.type),v=C(m,g);if(U(e.TEXTURE_CUBE_MAP,t,p),s){for(c=0;c<6;c++){u=l[c].mipmaps;for(var M=0;M<u.length;M++){var B=u[M];t.format!==oe&&t.format!==ae?null!==m?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+c,M,v,B.width,B.height,0,B.data):console.warn("Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+c,M,v,B.width,B.height,0,m,g,B.data)}}o.__maxMipLevel=u.length-1}else{u=t.mipmaps;for(c=0;c<6;c++)if(A){n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,v,l[c].width,l[c].height,0,m,g,l[c].data);for(M=0;M<u.length;M++){var I=(B=u[M]).image[c].image;n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+c,M+1,v,I.width,I.height,0,m,g,I.data)}}else{n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,v,m,g,l[c]);for(M=0;M<u.length;M++){B=u[M];n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+c,M+1,v,m,g,B.image[c])}}o.__maxMipLevel=u.length}x(t,p)&&b(e.TEXTURE_CUBE_MAP,t,f.width,f.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture)}}function L(t,r){n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_CUBE_MAP,i.get(t).__webglTexture)}var F=(s(A={},G,e.REPEAT),s(A,Q,e.CLAMP_TO_EDGE),s(A,H,e.MIRRORED_REPEAT),A),_=(s(l={},z,e.NEAREST),s(l,V,e.NEAREST_MIPMAP_NEAREST),s(l,j,e.NEAREST_MIPMAP_LINEAR),s(l,W,e.LINEAR),s(l,X,e.LINEAR_MIPMAP_NEAREST),s(l,Z,e.LINEAR_MIPMAP_LINEAR),l);function U(n,a,o){o?(e.texParameteri(n,e.TEXTURE_WRAP_S,F[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,F[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,F[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,_[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,_[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===Q&&a.wrapT===Q||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,M(a.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,M(a.minFilter)),a.minFilter!==z&&a.minFilter!==W&&console.warn("Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(a.type===q&&null===t.get("OES_texture_float_linear"))return;if(a.type===$&&null===(h||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function P(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",B),t.__webglTexture=e.createTexture(),o.memory.textures++)}function k(t,i,r){var o=e.TEXTURE_2D;i.isDataTexture2DArray&&(o=e.TEXTURE_2D_ARRAY),i.isDataTexture3D&&(o=e.TEXTURE_3D),P(t,i),n.activeTexture(e.TEXTURE0+r),n.bindTexture(o,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment);var s=function(e){return!h&&(e.wrapS!==Q||e.wrapT!==Q||e.minFilter!==z&&e.minFilter!==W)}(i)&&!1===w(i.image),A=y(i.image,s,!1,f),l=w(A)||h,c=a.convert(i.format),u=a.convert(i.type),d=C(c,u);U(o,i,l);var p,m=i.mipmaps;if(i.isDepthTexture){if(d=e.DEPTH_COMPONENT,i.type===q){if(!1===h)throw new Error("Float Depth Texture only supported in WebGL2.0");d=e.DEPTH_COMPONENT32F}else h&&(d=e.DEPTH_COMPONENT16);i.format===ce&&d===e.DEPTH_COMPONENT&&i.type!==K&&i.type!==J&&(console.warn("Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=K,u=a.convert(i.type)),i.format===he&&(d=e.DEPTH_STENCIL,i.type!==ie&&(console.warn(" Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ie,u=a.convert(i.type))),n.texImage2D(e.TEXTURE_2D,0,d,A.width,A.height,0,c,u,null)}else if(i.isDataTexture)if(m.length>0&&l){for(var g=0,v=m.length;g<v;g++)p=m[g],n.texImage2D(e.TEXTURE_2D,g,d,p.width,p.height,0,c,u,p.data);i.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else n.texImage2D(e.TEXTURE_2D,0,d,A.width,A.height,0,c,u,A.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(g=0,v=m.length;g<v;g++)p=m[g],i.format!==oe&&i.format!==ae?null!==c?n.compressedTexImage2D(e.TEXTURE_2D,g,d,p.width,p.height,0,p.data):console.warn(" Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,g,d,p.width,p.height,0,c,u,p.data);t.__maxMipLevel=m.length-1}else if(i.isDataTexture2DArray)n.texImage3D(e.TEXTURE_2D_ARRAY,0,d,A.width,A.height,A.depth,0,c,u,A.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(e.TEXTURE_3D,0,d,A.width,A.height,A.depth,0,c,u,A.data),t.__maxMipLevel=0;else if(m.length>0&&l){for(g=0,v=m.length;g<v;g++)p=m[g],n.texImage2D(e.TEXTURE_2D,g,d,c,u,p);i.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else n.texImage2D(e.TEXTURE_2D,0,d,c,u,A),t.__maxMipLevel=0;x(i,l)&&b(e.TEXTURE_2D,i,A.width,A.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function D(t,r,o,s){var A=a.convert(r.texture.format),l=a.convert(r.texture.type),c=C(A,l);n.texImage2D(s,0,c,r.width,r.height,0,A,l,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,s,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function R(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){if(i){var r=N(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH_COMPONENT16,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){r=N(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{var o=C(a.convert(n.texture.format),a.convert(n.texture.type));if(i){r=N(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,r,o,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,o,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t){var n=i.get(t),r=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===ce)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,r,0);else{if(n.depthTexture.format!==he)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,r,0)}}(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),R(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),R(n.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function N(e){return h&&e.isWebGLMultisampleRenderTarget?Math.min(p,e.samples):0}var Y=!1,ee=!1;this.allocateTextureUnit=function(){var e=E;return e>=u&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+u),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=S,this.setTexture2DArray=function(t,r){var a=i.get(t);t.version>0&&a.__version!==t.version?k(a,t,r):(n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture))},this.setTexture3D=function(t,r){var a=i.get(t);t.version>0&&a.__version!==t.version?k(a,t,r):(n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_3D,a.__webglTexture))},this.setTextureCube=T,this.setTextureCubeDynamic=L,this.setupRenderTarget=function(r){var s=i.get(r),A=i.get(r.texture);r.addEventListener("dispose",I),A.__webglTexture=e.createTexture(),o.memory.textures++;var l=!0===r.isWebGLRenderTargetCube,c=!0===r.isWebGLMultisampleRenderTarget,u=!0===r.isWebGLMultiviewRenderTarget,d=w(r)||h;if(l){s.__webglFramebuffer=[];for(var f=0;f<6;f++)s.__webglFramebuffer[f]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),c)if(h){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s.__webglColorRenderbuffer);var p=C(a.convert(r.texture.format),a.convert(r.texture.type)),m=N(r);e.renderbufferStorageMultisample(e.RENDERBUFFER,m,p,r.width,r.height),e.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,s.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),r.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),R(s.__webglDepthRenderbuffer,r,!0)),e.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(u){var g=r.width,v=r.height,y=r.numViews;e.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer);var M=t.get("OVR_multiview2");o.memory.textures+=2;var B=e.createTexture();e.bindTexture(e.TEXTURE_2D_ARRAY,B),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA8,g,v,y,0,e.RGBA,e.UNSIGNED_BYTE,null),M.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,B,0,0,y);var E=e.createTexture();e.bindTexture(e.TEXTURE_2D_ARRAY,E),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.DEPTH24_STENCIL8,g,v,y,0,e.DEPTH_STENCIL,e.UNSIGNED_INT_24_8,null),M.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,E,0,0,y);var S=new Array(y);for(f=0;f<y;++f)S[f]=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,S[f]),e.framebufferTextureLayer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,B,0,f);s.__webglColorTexture=B,s.__webglDepthStencilTexture=E,s.__webglViewFramebuffers=S,e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D_ARRAY,null)}if(l){n.bindTexture(e.TEXTURE_CUBE_MAP,A.__webglTexture),U(e.TEXTURE_CUBE_MAP,r.texture,d);for(f=0;f<6;f++)D(s.__webglFramebuffer[f],r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+f);x(r.texture,d)&&b(e.TEXTURE_CUBE_MAP,r.texture,r.width,r.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else u||(n.bindTexture(e.TEXTURE_2D,A.__webglTexture),U(e.TEXTURE_2D,r.texture,d),D(s.__webglFramebuffer,r,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),x(r.texture,d)&&b(e.TEXTURE_2D,r.texture,r.width,r.height),n.bindTexture(e.TEXTURE_2D,null));r.depthBuffer&&O(r)},this.updateRenderTargetMipmap=function(t){var r=t.texture;if(x(r,w(t)||h)){var a=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(r).__webglTexture;n.bindTexture(a,o),b(a,r,t.width,t.height),n.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(h){var n=i.get(t);e.bindFramebuffer(e.READ_FRAMEBUFFER,n.__webglMultisampledFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n.__webglFramebuffer);var r=t.width,a=t.height,o=e.COLOR_BUFFER_BIT;t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT),e.blitFramebuffer(0,0,r,a,0,0,r,a,o,e.NEAREST)}else console.warn(" WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===Y&&(console.warn(" don't use render targets as textures. Use their .texture property instead."),Y=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===ee&&(console.warn(" don't use cube render targets as textures. Use their .texture property instead."),ee=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?T(e,t):L(e,t)}}function Na(e,t,n){var i=n.isWebGL2;return{convert:function(n){var r;if(n===Y)return e.UNSIGNED_BYTE;if(n===ee)return e.UNSIGNED_SHORT_4_4_4_4;if(n===te)return e.UNSIGNED_SHORT_5_5_5_1;if(n===ne)return e.UNSIGNED_SHORT_5_6_5;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===K)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===J)return e.UNSIGNED_INT;if(n===q)return e.FLOAT;if(n===$)return i?e.HALF_FLOAT:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(n===re)return e.ALPHA;if(n===ae)return e.RGB;if(n===oe)return e.RGBA;if(n===se)return e.LUMINANCE;if(n===Ae)return e.LUMINANCE_ALPHA;if(n===ce)return e.DEPTH_COMPONENT;if(n===he)return e.DEPTH_STENCIL;if(n===ue)return e.RED;if(n===de||n===fe||n===pe||n===me){if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===de)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===fe)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===pe)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===me)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===ge||n===ve||n===ye||n===we){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===ge)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===ve)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===ye)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===we)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===xe)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((n===Me||n===Be)&&null!==(r=t.get("WEBGL_compressed_texture_etc"))){if(n===Me)return r.COMPRESSED_RGB8_ETC2;if(n===Be)return r.COMPRESSED_RGBA8_ETC2_EAC}return n===be||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n?null!==(r=t.get("WEBGL_compressed_texture_astc"))?n:null:n===Ce?null!==(r=t.get("EXT_texture_compression_bptc"))?n:null:n===ie?i?e.UNSIGNED_INT_24_8:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Ga(e,t,n,i){lt.call(this,e,t,i),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function Qa(e,t){var n,i,r,a,o,s,A,l=e.extensions,c=e.properties,h=0;function u(e){return e.isArrayCamera?e.cameras:(o[0]=e,o)}this.isAvailable=function(){if(void 0===A){var e=l.get("OVR_multiview2");if(A=null!==e&&!1===t.getContextAttributes().antialias){h=t.getParameter(e.MAX_VIEWS_OVR),n=new Ga(0,0,2),s=new Je,a=[],r=[],o=[];for(var i=0;i<h;i++)a[i]=new vt,r[i]=new rt}}return A},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>h)return!1;for(var n=1,i=t.length;n<i;n++)if(t[0].viewport.z!==t[n].viewport.z||t[0].viewport.w!==t[n].viewport.w)return!1;return!0}(t)&&(i=e.getRenderTarget(),function(t){if(i?s.set(i.width,i.height):e.getDrawingBufferSize(s),t.isArrayCamera){var r=t.cameras[0].viewport;n.setSize(r.z,r.w),n.setNumViews(t.cameras.length)}else n.setSize(s.x,s.y),n.setNumViews(2)}(t),e.setRenderTarget(n))},this.detachCamera=function(r){n===e.getRenderTarget()&&(e.setRenderTarget(i),function(e){var i=n,r=i.numViews,a=c.get(i).__webglViewFramebuffers,o=i.width,A=i.height;if(e.isArrayCamera)for(var l=0;l<r;l++){var h=e.cameras[l].viewport,u=h.x,d=h.y,f=u+h.z,p=d+h.w;t.bindFramebuffer(t.READ_FRAMEBUFFER,a[l]),t.blitFramebuffer(0,0,o,A,u,d,f,p,t.COLOR_BUFFER_BIT,t.NEAREST)}else t.bindFramebuffer(t.READ_FRAMEBUFFER,a[0]),t.blitFramebuffer(0,0,o,A,0,0,s.x,s.y,t.COLOR_BUFFER_BIT,t.NEAREST)}(r))},this.updateCameraProjectionMatricesUniform=function(e,n){for(var i=u(e),r=0;r<i.length;r++)a[r].copy(i[r].projectionMatrix);n.setValue(t,"projectionMatrices",a)},this.updateCameraViewMatricesUniform=function(e,n){for(var i=u(e),r=0;r<i.length;r++)a[r].copy(i[r].matrixWorldInverse);n.setValue(t,"viewMatrices",a)},this.updateObjectMatricesUniforms=function(e,n,i){for(var o=u(n),s=0;s<o.length;s++)a[s].multiplyMatrices(o[s].matrixWorldInverse,e.matrixWorld),r[s].getNormalMatrix(a[s]);i.setValue(t,"modelViewMatrices",a),i.setValue(t,"normalMatrices",r)}}function Ha(){Dt.call(this),this.type="Group"}function za(e){Di.call(this),this.cameras=e||[]}Ga.prototype=Object.assign(Object.create(lt.prototype),{constructor:Ga,isWebGLMultiviewRenderTarget:!0,copy:function(e){return lt.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),Ha.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Ha,isGroup:!0}),za.prototype=Object.assign(Object.create(Di.prototype),{constructor:za,isArrayCamera:!0});var Va,ja=new tt,Wa=new tt;function Xa(e,t,n){ja.setFromMatrixPosition(t.matrixWorld),Wa.setFromMatrixPosition(n.matrixWorld);var i=ja.distanceTo(Wa),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),A=(r[9]+1)/r[5],l=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],u=o*c,d=o*h,f=i/(-c+h),p=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(p),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var m=o+f,g=s+f,v=u-p,y=d+(i-p),w=A*s/g*m,x=l*s/g*m;e.projectionMatrix.makePerspective(v,y,w,x,m,g)}function Za(e){var t,n,i=this,r=null,a=null,o=[],s=new vt,A=new vt,l=1,c="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(a=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",x,!1));var h=new vt,u=new qe,d=new tt,f=new Di,p=new Di;p.viewport=new At,p.layers.enable(1);var m=new Di;m.viewport=new At,m.layers.enable(2);var g=new za([p,m]);function v(){return null!==r&&!0===r.isPresenting}g.layers.enable(1),g.layers.enable(2);var y,w=new Je;function x(){if(v()){var a=r.getEyeParameters("left");t=2*a.renderWidth*l,n=a.renderHeight*l,y=e.getPixelRatio(),e.getSize(w),e.setDrawingBufferSize(t,n,1),p.viewport.set(0,0,t/2,n),m.viewport.set(t/2,0,t/2,n),I.start(),i.dispatchEvent({type:"sessionstart"})}else i.enabled&&e.setDrawingBufferSize(w.width,w.height,y),I.stop(),i.dispatchEvent({type:"sessionend"})}var b=[],C=[];function M(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),n=0,i=t.length;n<i;n++){var r=t[n];if(r&&("Daydream Controller"===r.id||"Gear VR Controller"===r.id||"Oculus Go Controller"===r.id||"OpenVR Gamepad"===r.id||r.id.startsWith("Oculus Touch")||r.id.startsWith("HTC Vive Focus")||r.id.startsWith("Spatial Controller"))){var a=r.hand;if(0===e&&(""===a||"right"===a))return r;if(1===e&&"left"===a)return r}}}function B(e,i){null!==i&&4===i.length&&e.set(i[0]*t,i[1]*n,i[2]*t,i[3]*n)}this.enabled=!1,this.getController=function(e){var t=o[e];return void 0===t&&((t=new Ha).matrixAutoUpdate=!1,t.visible=!1,o[e]=t),t},this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e),I.setContext(e)},this.setFramebufferScaleFactor=function(e){l=e},this.setReferenceSpaceType=function(e){c=e},this.getCamera=function(e){var t="local-floor"===c?1.6:0;if(r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(a),"local-floor"===c){var n=r.stageParameters;n?s.fromArray(n.sittingToStandingTransform):s.makeTranslation(0,t,0)}var i=a.pose;f.matrix.copy(s),f.matrix.decompose(f.position,f.quaternion,f.scale),null!==i.orientation&&(u.fromArray(i.orientation),f.quaternion.multiply(u)),null!==i.position&&(u.setFromRotationMatrix(s),d.fromArray(i.position),d.applyQuaternion(u),f.position.add(d)),f.updateMatrixWorld(),e.matrixWorld.copy(f.matrixWorld);for(var l=e.children,v=0,y=l.length;v<y;v++)l[v].updateMatrixWorld(!0);p.near=e.near,m.near=e.near,p.far=e.far,m.far=e.far,p.matrixWorldInverse.fromArray(a.leftViewMatrix),m.matrixWorldInverse.fromArray(a.rightViewMatrix),A.getInverse(s),"local-floor"===c&&(p.matrixWorldInverse.multiply(A),m.matrixWorldInverse.multiply(A));var w=e.parent;null!==w&&(h.getInverse(w.matrixWorld),p.matrixWorldInverse.multiply(h),m.matrixWorldInverse.multiply(h)),p.matrixWorld.getInverse(p.matrixWorldInverse),m.matrixWorld.getInverse(m.matrixWorldInverse),p.projectionMatrix.fromArray(a.leftProjectionMatrix),m.projectionMatrix.fromArray(a.rightProjectionMatrix),Xa(g,p,m);var x=r.getLayers();if(x.length){var I=x[0];B(p.viewport,I.leftBounds),B(m.viewport,I.rightBounds)}return function(){for(var e=0;e<o.length;e++){var t=o[e],n=M(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;var i=n.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(s),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var r="Daydream Controller"===n.id?0:1;void 0===b[e]&&(b[e]=!1),b[e]!==n.buttons[r].pressed&&(b[e]=n.buttons[r].pressed,!0===b[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"}))),r=2,void 0===C[e]&&(C[e]=!1),void 0!==n.buttons[r]&&C[e]!==n.buttons[r].pressed&&(C[e]=n.buttons[r].pressed,!0===C[e]?t.dispatchEvent({type:"squeezestart"}):(t.dispatchEvent({type:"squeezeend"}),t.dispatchEvent({type:"squeeze"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return s},this.isPresenting=v;var I=new Xi;this.setAnimationLoop=function(e){I.setAnimationLoop(e),v()&&I.start()},this.submitFrame=function(){v()&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",x)},this.setFrameOfReferenceType=function(){console.warn("setFrameOfReferenceType() has been deprecated.")}}function Ya(e,t){var n=this,i=null,r=null,a="local-floor",o=null,s=[],A=[];var l=new Di;l.layers.enable(1),l.viewport=new At;var c=new Di;c.layers.enable(2),c.viewport=new At;var h=new za([l,c]);function u(e){for(var t=0;t<s.length;t++)A[t]===e.inputSource&&s[t].dispatchEvent({type:e.type})}function d(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),y.stop(),n.dispatchEvent({type:"sessionend"})}function f(e){r=e,y.setContext(i),y.start(),n.dispatchEvent({type:"sessionstart"})}function p(){for(var e=0;e<s.length;e++)A[e]=m(e)}function m(e){for(var t=i.inputSources,n=0;n<t.length;n++){var r=t[n],a=r.handedness;if(0===e&&("none"===a||"right"===a))return r;if(1===e&&"left"===a)return r}}function g(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}h.layers.enable(1),h.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new Ha).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){a=e},this.getSession=function(){return i},this.setSession=function(e){null!==(i=e)&&(i.addEventListener("select",u),i.addEventListener("selectstart",u),i.addEventListener("selectend",u),i.addEventListener("squeeze",u),i.addEventListener("squeezestart",u),i.addEventListener("squeezeend",u),i.addEventListener("end",d),i.updateRenderState({baseLayer:new XRWebGLLayer(i,t)}),i.requestReferenceSpace(a).then(f),i.addEventListener("inputsourceschange",p),p())},this.getCamera=function(e){var t=e.parent,n=h.cameras;g(h,t);for(var i=0;i<n.length;i++)g(n[i],t);e.matrixWorld.copy(h.matrixWorld);for(var r=e.children,a=(i=0,r.length);i<a;i++)r[i].updateMatrixWorld(!0);return Xa(h,l,c),h},this.isPresenting=function(){return null!==i&&null!==r};var v=null;var y=new Xi;y.setAnimationLoop((function(t,n){if(null!==(o=n.getViewerPose(r))){var a=o.views,l=i.renderState.baseLayer;e.setFramebuffer(l.framebuffer);for(var c=0;c<a.length;c++){var u=a[c],d=l.getViewport(u),f=u.transform.inverse.matrix,p=h.cameras[c];p.matrix.fromArray(f).getInverse(p.matrix),p.projectionMatrix.fromArray(u.projectionMatrix),p.viewport.set(d.x,d.y,d.width,d.height),0===c&&h.matrix.copy(p.matrix)}}for(c=0;c<s.length;c++){var m=s[c],g=A[c];if(g){var y=n.getPose(g.targetRaySpace,r);if(null!==y){m.matrix.fromArray(y.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}v&&v(t)})),this.setAnimationLoop=function(e){v=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("getStandingMatrix() is no longer needed."),new vt},this.getDevice=function(){console.warn("getDevice() has been deprecated.")},this.setDevice=function(){console.warn("etDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Ka(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,A=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,u=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,f,p,m,g,v,y,w,x,b,C,M,B,I,E,S,T,L,F=this,_=!1,U=null,P=0,k=0,D=null,R=null,O=-1,N={geometry:null,program:null,wireframe:!1},G=null,Q=null,H=new At,z=new At,V=null,j=t.width,W=t.height,X=1,Z=new At(0,0,j,W),K=new At(0,0,j,W),J=!1,ee=new zi,te=new er,ne=!1,ie=!1,re=new vt,ae=new tt;function se(){return null===D?X:1}this.acfFrustum=ee;try{var Ae={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:A,powerPreference:l,failIfMajorPerformanceCaveat:c,xrCompatible:!0};t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",pe,!1);try{le=le||{}}catch(e){var le={}}if(null===(d=n||t.getContext(le&&le.isWebGL2?"webgl2":"webgl",Ae)||t.getContext("experimental-webgl",Ae)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error(e.message),e}function ce(){f=new tr(d),!1===(p=new $i(d,f,e)).isWebGL2&&(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),L=new Na(d,f,p),(m=new Ra(d,f,p)).scissor(z.copy(K).multiplyScalar(X).floor()),m.viewport(H.copy(Z).multiplyScalar(X).floor()),g=new rr(d),v=new Ca,y=new Oa(d,f,m,v,p,L,g),w=new Zi(d),x=new nr(d,w,g),b=new sr(d,x,w,g),E=new or(d),C=new ba(F,f,p),M=new Ea,B=new Ua,I=new Ji(F,m,b,s),S=new qi(d,f,g,p),T=new ir(d,f,g,p),g.programs=C.programs,F.capabilities=p,F.extensions=f,F.properties=v,F.renderLists=M,F.state=m,F.info=g}ce();var he="undefined"!=typeof navigator&&"xr"in navigator?new Ya(F,d):new Za(F);this.vr=he;var ue=new Qa(F,d),de=new Da(F,b,p.maxTextureSize);function fe(e){e.preventDefault(),console.log("Context Lost."),_=!0}function pe(){console.log("Context Restored."),_=!1,ce()}function me(e){var t=e.target;t.removeEventListener("dispose",me),function(e){ge(e),v.remove(e)}(t)}function ge(e){var t=v.get(e).program;e.program=void 0,void 0!==t&&C.releaseProgram(t)}this.shadowMap=de,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(e){void 0!==e&&(X=e,this.setSize(j,W,!1))},this.getSize=function(e){return void 0===e&&(e=new Je),e.set(j,W)},this.setSize=function(e,n,i){he.isPresenting()?console.warn("Can't change size while VR device is presenting."):(j=e,W=n,t.width=Math.floor(e*X),t.height=Math.floor(n*X),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(e=new Je),e.set(j*X,W*X).floor()},this.setDrawingBufferSize=function(e,n,i){j=e,W=n,X=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(e=new At),e.copy(H)},this.getViewport=function(e){return e.copy(Z)},this.setViewport=function(e,t,n,i){e.isVector4?Z.set(e.x,e.y,e.z,e.w):Z.set(e,t,n,i),m.viewport(H.copy(Z).multiplyScalar(X).floor())},this.getScissor=function(e){return e.copy(K)},this.setScissor=function(e,t,n,i){e.isVector4?K.set(e.x,e.y,e.z,e.w):K.set(e,t,n,i),m.scissor(z.copy(K).multiplyScalar(X).floor())},this.getScissorTest=function(){return J},this.setScissorTest=function(e){m.setScissorTest(J=e)},this.getClearColor=function(){return I.getClearColor()},this.setClearColor=function(){I.setClearColor.apply(I,arguments)},this.getClearAlpha=function(){return I.getClearAlpha()},this.setClearAlpha=function(){I.setClearAlpha.apply(I,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=d.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=d.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=d.STENCIL_BUFFER_BIT),d.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",pe,!1),M.dispose(),B.dispose(),v.dispose(),b.dispose(),he.dispose(),ye.stop()},this.renderBufferImmediate=function(e,t){m.initAttributes();var n=v.get(e);e.hasPositions&&!n.position&&(n.position=d.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=d.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=d.createBuffer()),e.hasColors&&!n.color&&(n.color=d.createBuffer());var i=t.getAttributes();e.hasPositions&&(d.bindBuffer(d.ARRAY_BUFFER,n.position),d.bufferData(d.ARRAY_BUFFER,e.positionArray,d.DYNAMIC_DRAW),m.enableAttribute(i.position),d.vertexAttribPointer(i.position,3,d.FLOAT,!1,0,0)),e.hasNormals&&(d.bindBuffer(d.ARRAY_BUFFER,n.normal),d.bufferData(d.ARRAY_BUFFER,e.normalArray,d.DYNAMIC_DRAW),m.enableAttribute(i.normal),d.vertexAttribPointer(i.normal,3,d.FLOAT,!1,0,0)),e.hasUvs&&(d.bindBuffer(d.ARRAY_BUFFER,n.uv),d.bufferData(d.ARRAY_BUFFER,e.uvArray,d.DYNAMIC_DRAW),m.enableAttribute(i.uv),d.vertexAttribPointer(i.uv,2,d.FLOAT,!1,0,0)),e.hasColors&&(d.bindBuffer(d.ARRAY_BUFFER,n.color),d.bufferData(d.ARRAY_BUFFER,e.colorArray,d.DYNAMIC_DRAW),m.enableAttribute(i.color),d.vertexAttribPointer(i.color,3,d.FLOAT,!1,0,0)),m.disableUnusedAttributes(),d.drawArrays(d.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,a){var o=r.isMesh&&r.matrixWorld.determinant()<0;m.setMaterial(i,o);var s=Be(e,t,i,r),A=!1;N.geometry===n.id&&N.program===s.id&&N.wireframe===(!0===i.wireframe)||(N.geometry=n.id,N.program=s.id,N.wireframe=!0===i.wireframe,A=!0),r.morphTargetInfluences&&(E.update(r,n,i,s),A=!0);var l=n.index,c=n.attributes.position;if((null===l||0!==l.count)&&void 0!==c&&0!==c.count){var h,u=1;!0===i.wireframe&&(l=x.getWireframeAttribute(n),u=2);var g=S;null!==l&&(h=w.get(l),(g=T).setIndex(h)),A&&(!function(e,t,n,i){if(!1===p.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===f.get("ANGLE_instanced_arrays"))return;m.initAttributes();var r=t.attributes,a=i.getAttributes(),o=n.defaultAttributeValues;for(var s in a){var A=a[s];if(A>=0){var l=r[s];if(void 0!==l){var c=l.normalized,h=l.itemSize;if(void 0===(C=w.get(l)))continue;var u=C.buffer,g=C.type,v=C.bytesPerElement;if(l.isInterleavedBufferAttribute){var y=l.data,x=y.stride,b=l.offset;y&&y.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(A,y.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=y.meshPerAttribute*y.count)):m.enableAttribute(A),d.bindBuffer(d.ARRAY_BUFFER,u),d.vertexAttribPointer(A,h,g,c,x*v,b*v)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(A,l.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(A),d.bindBuffer(d.ARRAY_BUFFER,u),d.vertexAttribPointer(A,h,g,c,0,0)}else if("instanceMatrix"===s){if(void 0===e.instanceMatrix)continue;var C;if(void 0===(C=w.get(e.instanceMatrix)))continue;u=C.buffer,g=C.type;m.enableAttributeAndDivisor(A+0,1),m.enableAttributeAndDivisor(A+1,1),m.enableAttributeAndDivisor(A+2,1),m.enableAttributeAndDivisor(A+3,1),d.bindBuffer(d.ARRAY_BUFFER,u),d.vertexAttribPointer(A+0,4,g,!1,64,0),d.vertexAttribPointer(A+1,4,g,!1,64,16),d.vertexAttribPointer(A+2,4,g,!1,64,32),d.vertexAttribPointer(A+3,4,g,!1,64,48)}else if(void 0!==o){var M=o[s];if(void 0!==M)switch(M.length){case 2:d.vertexAttrib2fv(A,M);break;case 3:d.vertexAttrib3fv(A,M);break;case 4:d.vertexAttrib4fv(A,M);break;default:d.vertexAttrib1fv(A,M)}}}}m.disableUnusedAttributes()}(r,n,i,s),null!==l&&d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h.buffer));var v=1/0;null!==l?v=l.count:void 0!==c&&(v=c.count);var y=n.drawRange.start*u,b=n.drawRange.count*u,C=null!==a?a.start*u:0,M=null!==a?a.count*u:1/0,B=Math.max(y,C),I=Math.min(v,y+b,C+M)-1,L=Math.max(0,I-B+1);if(0!==L){if(r.isMesh)if(!0===i.wireframe)m.setLineWidth(i.wireframeLinewidth*se()),g.setMode(d.LINES);else switch(r.drawMode){case 0:g.setMode(d.TRIANGLES);break;case 1:g.setMode(d.TRIANGLE_STRIP);break;case 2:g.setMode(d.TRIANGLE_FAN)}else if(r.isLine){var F=i.linewidth;void 0===F&&(F=1),m.setLineWidth(F*se()),r.isLineSegments?g.setMode(d.LINES):r.isLineLoop?g.setMode(d.LINE_LOOP):g.setMode(d.LINE_STRIP)}else r.isPoints?g.setMode(d.POINTS):r.isSprite&&g.setMode(d.TRIANGLES);r.isInstancedMesh?g.renderInstances(n,B,L,r.count):n.isInstancedBufferGeometry?g.renderInstances(n,B,L,n.maxInstancedCount):g.render(B,L)}}},this.compile=function(e,t){(u=B.get(e,t)).init(),e.traverse((function(e){e.isLight&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)Me(t.material[n],e.fog,t);else Me(t.material,e.fog,t)}))};var ve=null;var ye=new Xi;function we(e,t,n,i){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){i&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);var r=b.update(e);(a=e.material).visible&&h.push(e,r,a,n,ae.z,null)}}else if(e.isImmediateRenderObject)i&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re),h.push(e,null,e.material,n,ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton&&e.skeleton.frame!==g.render.frame&&(e.skeleton.update(),e.skeleton.frame=g.render.frame),!e.frustumCulled||ee.intersectsObject(e))){i&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);r=b.update(e);var a=e.material;if(Array.isArray(a))for(var o=r.groups,s=0,A=o.length;s<A;s++){var l=o[s],c=a[l.materialIndex];c&&c.visible&&h.push(e,r,c,n,ae.z,l)}else a.visible&&h.push(e,r,a,n,ae.z,null)}}function xe(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){i&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);var r=b.update(e);(a=e.material).visible&&h.push(e,r,a,n,ae.z,null)}}else if(e.isImmediateRenderObject)i&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re),h.push(e,null,e.material,n,ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton&&e.skeleton.frame!==g.render.frame&&(e.skeleton.update(),e.skeleton.frame=g.render.frame),!e.frustumCulled||ee.intersectsObject(e))){i&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(re);r=b.update(e);var a=e.material;if(Array.isArray(a))for(var o=r.groups,s=0,A=o.length;s<A;s++){var l=o[s],c=a[l.materialIndex];c&&c.visible&&h.push(e,r,c,n,ae.z,l)}else a.visible&&h.push(e,r,a,n,ae.z,null)}var d=e.children;for(s=0,A=d.length;s<A;s++)xe(d[s],t,n,i)}}function be(e,t,n,i){for(var r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,A=o.geometry,l=void 0===i?o.material:i,c=o.group;if(n.isArrayCamera)if(Q=n,he.enabled&&ue.isAvailable())Ce(s,t,n,A,l,c);else for(var h=n.cameras,d=0,f=h.length;d<f;d++){var p=h[d];s.layers.test(p.layers)&&(m.viewport(H.copy(p.viewport)),u.setupLights(p),Ce(s,t,p,A,l,c))}else Q=null,Ce(s,t,n,A,l,c)}}function Ce(e,t,n,i,r,a){if(e.onBeforeRender(F,t,n,i,r,a),u=B.get(t,Q||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){m.setMaterial(r);var o=Be(n,t.fog,r,e);N.geometry=null,N.program=null,N.wireframe=!1,function(e,t){e.render((function(e){F.renderBufferImmediate(e,t)}))}(e,o)}else F.renderBufferDirect(n,t.fog,i,r,e,a);e.onAfterRender(F,t,n,i,r,a),u=B.get(t,Q||n)}function Me(e,t,n){var i=v.get(e),r=u.state.lights,a=u.state.shadowsArray,o=r.state.version,s=C.getParameters(e,r.state,a,t,te.numPlanes,te.numIntersection,n),A=C.getProgramCacheKey(e,s),l=i.program,c=!0;if(void 0===l)e.addEventListener("dispose",me);else if(l.cacheKey!==A)ge(e);else if(i.lightsStateVersion!==o)i.lightsStateVersion=o,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var h=Wi[s.shaderID];i.shader={name:e.type,uniforms:Fi(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,F),A=C.getProgramCacheKey(e,s),l=C.acquireProgram(e,i.shader,s,A),i.program=l,e.program=l}var d=l.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<F.maxMorphTargets;f++)d["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<F.maxMorphNormals;f++)d["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var p=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=te.numPlanes,i.numIntersection=te.numIntersection,p.clippingPlanes=te.uniform),i.fog=t,i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isAMRTBasicMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(p.ambientLightColor.value=r.state.ambient,p.lightProbe.value=r.state.probe,p.directionalLights.value=r.state.directional,p.spotLights.value=r.state.spot,p.rectAreaLights.value=r.state.rectArea,p.pointLights.value=r.state.point,p.hemisphereLights.value=r.state.hemi,p.directionalShadowMap.value=r.state.directionalShadowMap,p.directionalShadowMatrix.value=r.state.directionalShadowMatrix,p.spotShadowMap.value=r.state.spotShadowMap,p.spotShadowMatrix.value=r.state.spotShadowMatrix,p.pointShadowMap.value=r.state.pointShadowMap,p.pointShadowMatrix.value=r.state.pointShadowMatrix);var m=i.program.getUniforms(),g=ra.seqWithValue(m.seq,p);i.uniformsList=g}function Be(e,t,n,i){y.resetTextureUnits();var r=v.get(n),a=u.state.lights;if(ne&&(ie||e!==G)){var o=e===G&&n.id===O;te.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,r,o)}n.version===r.__version&&(void 0===r.program||n.fog&&r.fog!==t||r.needsLights&&r.lightsStateVersion!==a.state.version?n.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===te.numPlanes&&r.numIntersection===te.numIntersection||(n.needsUpdate=!0)),n.version!==r.__version&&(Me(n,t,i),r.__version=n.version);var s,A,l=!1,c=!1,h=!1,f=r.program,g=f.getUniforms(),w=r.shader.uniforms;if(m.useProgram(f.program)&&(l=!0,c=!0,h=!0),n.id!==O&&(O=n.id,c=!0),l||G!==e){if(f.numMultiviewViews>0?ue.updateCameraProjectionMatricesUniform(e,g):g.setValue(d,"projectionMatrix",e.projectionMatrix),p.logarithmicDepthBuffer&&g.setValue(d,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),G!==e&&(G=e,c=!0,h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.isAMRTBasicMaterial||n.isACFBasicMaterial||n.isAMRTShadowMaterial||n.envMap){var x=g.map.cameraPosition;void 0!==x&&x.setValue(d,ae.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isAMRTBasicMaterial||n.isACFBasicMaterial||n.isShaderMaterial)&&g.setValue(d,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isAMRTBasicMaterial||n.isACFBasicMaterial||n.isShaderMaterial||n.skinning||n.isAMRTShadowMaterial)&&(f.numMultiviewViews>0?ue.updateCameraViewMatricesUniform(e,g):(g.setValue(d,"viewMatrix",e.matrixWorldInverse),g.setValue(d,"viewMatrixR",e.matrixWorldInverseR)))}if(n.skinning){g.setOptional(d,i,"bindMatrix"),g.setOptional(d,i,"bindMatrixInverse");var b=i.skeleton;if(b){var C=b.bones;if(p.floatVertexTextures){if(void 0===b.boneTexture){var M=Math.sqrt(4*C.length);M=Ke.ceilPowerOfTwo(M),M=Math.max(M,4);var B=new Float32Array(M*M*4);B.set(b.boneMatrices);var I=new Gi(B,M,M,oe,q);b.boneMatrices=B,b.boneTexture=I,b.boneTextureSize=M}g.setValue(d,"boneTexture",b.boneTexture,y),g.setValue(d,"boneTextureSize",b.boneTextureSize)}else g.setOptional(d,b,"boneMatrices")}}return(c||r.receiveShadow!==i.receiveShadow)&&(r.receiveShadow=i.receiveShadow,g.setValue(d,"receiveShadow",i.receiveShadow)),c&&(g.setValue(d,"toneMappingExposure",F.toneMappingExposure),g.setValue(d,"toneMappingWhitePoint",F.toneMappingWhitePoint),r.needsLights&&(A=h,(s=w).ambientLightColor.needsUpdate=A,s.lightProbe.needsUpdate=A,s.directionalLights.needsUpdate=A,s.pointLights.needsUpdate=A,s.spotLights.needsUpdate=A,s.rectAreaLights.needsUpdate=A,s.hemisphereLights.needsUpdate=A),t&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(w,t),n.isMeshBasicMaterial?Ie(w,n):n.isMeshLambertMaterial?(Ie(w,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(w,n)):n.isMeshPhongMaterial?(Ie(w,n),n.isMeshToonMaterial?function(e,t){Ee(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(w,n):Ee(w,n)):n.isMeshStandardMaterial?(Ie(w,n),n.isMeshPhysicalMaterial?function(e,t){Se(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(w,n):Se(w,n)):n.isAMRTBasicMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.emissive.value.copy(t.emissive),e.smoothness.value=t.smoothness,e.metalness.value=t.metallic,e.reflectivity.value=t.reflectivity,e.transparency.value=t.transparency,e.envYMatrix.value.copy(t.envYMatrix),e.reflecYMatrix.value.copy(t.reflecYMatrix),t.albedo&&(e.albedo.value=t.albedo,!0===t.albedo.matrixAutoUpdate&&t.albedo.updateMatrix(),e.albedoUVTransform.value.copy(t.albedo.matrix));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value=t.normalScale,!0===t.normalMap.matrixAutoUpdate&&t.normalMap.updateMatrix(),e.normalUVTransform.value.copy(t.normalMap.matrix));t.normalMap2&&(e.normalMap2.value=t.normalMap2,e.normalScale2.value=t.normalScale2,!0===t.normalMap2.matrixAutoUpdate&&t.normalMap2.updateMatrix(),e.normal2UVTransform.value.copy(t.normalMap2.matrix));t.metallicMap&&(e.metallicMap.value=t.metallicMap,!0===t.metallicMap.matrixAutoUpdate&&t.metallicMap.updateMatrix(),e.metalUVTransform.value.copy(t.metallicMap.matrix));t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,!0===t.roughnessMap.matrixAutoUpdate&&t.roughnessMap.updateMatrix(),e.roughUVTransform.value.copy(t.roughnessMap.matrix));t.aoMap&&(e.aoMap.value=t.aoMap,e.aoScale.value=t.aoScale,!0===t.aoMap.matrixAutoUpdate&&t.aoMap.updateMatrix(),e.aoUVTransform.value.copy(t.aoMap.matrix));t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap,!0===t.emissiveMap.matrixAutoUpdate&&t.emissiveMap.updateMatrix(),e.emissiveUVTransform.value.copy(t.emissiveMap.matrix));t.reflectMap&&(e.reflectMap.value=t.reflectMap,e.reflectIntensity.value=t.reflectIntensity);e.cutout.value=t.cutout,t.envMap&&(e.envMap.value=t.envMap,e.envMapIntensity.value=t.envMapIntensity,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=8);t.alphaMap&&(e.alphaMap.value=t.alphaMap,!0===t.alphaMap.matrixAutoUpdate&&t.alphaMap.updateMatrix(),e.alphaUVTransform.value.copy(t.alphaMap.matrix));t.dissolveMap&&(e.dissolveMap.value=t.dissolveMap,e.dissolveRatio.value=t.dissolveRatio,e.dissolveColor.value=t.dissolveColor,!0===t.dissolveMap.matrixAutoUpdate&&t.dissolveMap.updateMatrix())}(w,n):n.isAMRTShadowMaterial?function(e,t){e.color.value=t.color,e.shadowPlane.value=t.shadowPlane,e.lightDirection.value=t.lightDirection,e.shadowLength.value=t.shadowLength,e.center.value=t.center}(w,n):n.isMeshMatcapMaterial?(Ie(w,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,n)):n.isMeshDepthMaterial?(Ie(w,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,n)):n.isMeshDistanceMaterial?(Ie(w,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(w,n)):n.isMeshNormalMaterial?(Ie(w,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(w,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(w,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*X,e.scale.value=.5*W,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(w,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(w,n):n.isShadowMaterial?(w.color.value.copy(n.color),w.opacity.value=n.opacity):n.isACFBasicMaterial&&(n.color&&w.diffuse.value.copy(n.color),n.map&&(w.map.value=n.map)),void 0!==w.ltc_1&&(w.ltc_1.value=ji.LTC_1),void 0!==w.ltc_2&&(w.ltc_2.value=ji.LTC_2),ra.upload(d,r.uniformsList,w,y),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ra.upload(d,r.uniformsList,w,y),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(d,"center",i.center),f.numMultiviewViews>0?ue.updateObjectMatricesUniforms(i,e,g):(g.setValue(d,"modelViewMatrix",i.modelViewMatrix),g.setValue(d,"normalMatrix",i.normalMatrix)),g.setValue(d,"modelMatrix",i.matrixWorld),f}function Ie(e,t){var n;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=v.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function Ee(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Se(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}ye.setAnimationLoop((function(e){he.isPresenting()||ve&&ve(e)})),"undefined"!=typeof window&&ye.setContext(window),this.setAnimationLoop=function(e){ve=e,he.setAnimationLoop(e),ye.start()},this.render=function(e,t){var n,i;if(void 0!==arguments[2]&&(console.warn("the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),t&&t.isCamera){if(!_){N.geometry=null,N.program=null,N.wireframe=!1,O=-1,G=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),he.enabled&&he.isPresenting()&&(t=he.getCamera(t)),(u=B.get(e,t)).init(),e.onBeforeRender(F,e,t,n||D),re.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromMatrix(re),ie=this.localClippingEnabled,ne=te.init(this.clippingPlanes,ie,t),(h=M.get(e,t)).init(),xe(e,t,0,F.sortObjects),!0===F.sortObjects&&h.sort(),ne&&te.beginShadows();var r=u.state.shadowsArray;de.render(r,e,t),u.setupLights(t),ne&&te.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),he.enabled&&ue.isAvailable()&&ue.attachCamera(t),I.render(h,e,t,i);var a=h.opaque,o=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&be(a,e,t,s),o.length&&be(o,e,t,s)}else a.length&&be(a,e,t),o.length&&be(o,e,t);e.onAfterRender(F,e,t),null!==D&&(y.updateRenderTargetMipmap(D),y.updateMultisampleRenderTarget(D)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),he.enabled&&(ue.isAvailable()&&ue.detachCamera(t),he.submitFrame()),h=null,u=null}}else console.error("camera is not an instance of Camera.")},this.renderArray=function(e,t,n){if(!_){N.geometry=null,N.program=null,N.wireframe=!1,O=-1,G=null,null===n.parent&&n.updateMatrixWorld(),(u=B.get(t,n)).init(),re.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ee.setFromMatrix(re),ie=this.localClippingEnabled,ne=te.init(this.clippingPlanes,ie,n),(h=M.get(t,n)).init();for(var i=0;i<e.length;i++)we(e[i],n,0,F.sortObjects);!0===F.sortObjects&&h.sort(),ne&&te.beginShadows();var r=u.state.shadowsArray;de.render(r,t,n),u.setupLights(n),ne&&te.endShadows();var a=h.opaque,o=h.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;a.length&&be(a,t,n,s),o.length&&be(o,t,n,s)}else a.length&&be(a,t,n),o.length&&be(o,t,n);null!==D&&(y.updateRenderTargetMipmap(D),y.updateMultisampleRenderTarget(D)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),he.enabled&&(ue.isAvailable()&&ue.detachCamera(n),he.submitFrame()),h=null,u=null}},this.setFramebuffer=function(e){U!==e&&null===D&&d.bindFramebuffer(d.FRAMEBUFFER,e),U=e},this.getActiveCubeFace=function(){return P},this.getActiveMipmapLevel=function(){return k},this.getRenderTarget=function(){return D},this.setRenderTarget=function(e,t,n){D=e,P=t,k=n,e&&void 0===v.get(e).__webglFramebuffer&&y.setupRenderTarget(e);var i=U,r=!1;if(e){var a=v.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(i=a[t||0],r=!0):i=e.isWebGLMultisampleRenderTarget?v.get(e).__webglMultisampledFramebuffer:a,H.copy(e.viewport),z.copy(e.scissor),V=e.scissorTest}else H.copy(Z).multiplyScalar(X).floor(),z.copy(K).multiplyScalar(X).floor(),V=J;if(R!==i&&(d.bindFramebuffer(d.FRAMEBUFFER,i),R=i),m.viewport(H),m.scissor(z),m.setScissorTest(V),r){var o=v.get(e.texture);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+(t||0),o.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=v.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==o&&(s=s[o]),s){var A=!1;s!==R&&(d.bindFramebuffer(d.FRAMEBUFFER,s),A=!0);try{var l=e.texture,c=l.format,h=l.type;if(c!==oe&&L.convert(c)!==d.getParameter(d.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("renderTarget is not in RGBA or implementation defined format.");if(!(h===Y||L.convert(h)===d.getParameter(d.IMPLEMENTATION_COLOR_READ_TYPE)||h===q&&(p.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||h===$&&(p.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("renderTarget is not in UnsignedByteType or implementation defined type.");d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&d.readPixels(t,n,i,r,L.convert(c),L.convert(h),a):console.error("readPixels from renderTarget failed. Framebuffer not complete.")}finally{A&&d.bindFramebuffer(d.FRAMEBUFFER,R)}}}else console.error("renderTarget is not WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i),o=L.convert(t.format);y.setTexture2D(t,0),d.copyTexImage2D(d.TEXTURE_2D,n,o,e.x,e.y,r,a,0),m.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i){var r=t.image.width,a=t.image.height,o=L.convert(n.format),s=L.convert(n.type);y.setTexture2D(n,0),t.isDataTexture?d.texSubImage2D(d.TEXTURE_2D,i||0,e.x,e.y,r,a,o,s,t.image.data):d.texSubImage2D(d.TEXTURE_2D,i||0,e.x,e.y,o,s,t.image),m.unbindTexture()},this.initTexture=function(e){y.setTexture2D(e,0),m.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ja(e,t){this.name="",this.color=new Sn(e),this.density=void 0!==t?t:25e-5}function qa(e,t,n){this.name="",this.color=new Sn(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function $a(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ze,this.updateRange={offset:0,count:-1},this.version=0}function eo(e,t,n,i){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}function to(e){Pn.call(this),this.type="SpriteMaterial",this.color=new Sn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.assign(Za.prototype,Xe.prototype),Object.assign(Ya.prototype,Xe.prototype),Object.assign(Ja.prototype,{isFogExp2:!0,clone:function(){return new Ja(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(qa.prototype,{isFog:!0,clone:function(){return new qa(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty($a.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign($a.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(eo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(eo.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}}),to.prototype=Object.create(Pn.prototype),to.prototype.constructor=to,to.prototype.isSpriteMaterial=!0,to.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var no=new tt,io=new tt,ro=new tt,ao=new Je,oo=new Je,so=new vt,Ao=new tt,lo=new tt,co=new tt,ho=new Je,uo=new Je,fo=new Je;function po(e){if(Dt.call(this),this.type="Sprite",void 0===Va){Va=new ni;var t=new $a(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Va.setIndex([0,1,2,0,2,3]),Va.setAttribute("position",new eo(t,3,0,!1)),Va.setAttribute("uv",new eo(t,2,3,!1))}this.geometry=Va,this.material=void 0!==e?e:new to,this.center=new Je(.5,.5)}function mo(e,t,n,i,r,a){ao.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(oo.x=a*ao.x-r*ao.y,oo.y=r*ao.x+a*ao.y):oo.copy(ao),e.copy(t),e.x+=oo.x,e.y+=oo.y,e.applyMatrix4(so)}po.prototype=Object.assign(Object.create(Dt.prototype),{constructor:po,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),io.setFromMatrixScale(this.matrixWorld),so.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ro.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&io.multiplyScalar(-ro.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;mo(Ao.set(-.5,-.5,0),ro,a,io,n,i),mo(lo.set(.5,-.5,0),ro,a,io,n,i),mo(co.set(.5,.5,0),ro,a,io,n,i),ho.set(0,0),uo.set(1,0),fo.set(1,1);var o=e.ray.intersectTriangle(Ao,lo,co,!1,no);if(null!==o||(mo(lo.set(-.5,.5,0),ro,a,io,n,i),uo.set(0,1),null!==(o=e.ray.intersectTriangle(Ao,co,lo,!1,no)))){var s=e.ray.origin.distanceTo(no);s<e.near||s>e.far||t.push({distance:s,point:no.clone(),uv:Mn.getUV(no,Ao,lo,co,ho,uo,fo,new Je),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Dt.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var go=new tt,vo=new tt;function yo(){Dt.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function wo(e,t){e&&e.isGeometry&&console.error("SkinnedMesh no longer supports Geometry. Use BufferGeometry instead."),xi.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new vt,this.bindMatrixInverse=new vt}yo.prototype=Object.assign(Object.create(Dt.prototype),{constructor:yo,isLOD:!0,copy:function(e){Dt.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){go.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(go);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){go.setFromMatrixPosition(e.matrixWorld),vo.setFromMatrixPosition(this.matrixWorld);var n=go.distanceTo(vo);t[0].object.visible=!0;for(var i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<r;i++)t[i].object.visible=!1}},toJSON:function(e){var t=Dt.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),wo.prototype=Object.assign(Object.create(xi.prototype),{constructor:wo,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new At,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){xi.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var xo=new vt,bo=new vt;function Co(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new vt)}}function Mo(){Dt.call(this),this.type="Bone"}Object.assign(Co.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new vt;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=e.length;r<a;r++){var o=e[r]?e[r].matrixWorld:bo;xo.multiplyMatrices(o,t[r]),xo.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new Co(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}}),Mo.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Mo,isBone:!0});var Bo=new vt,Io=new vt,Eo=[],So=new xi,To=new Jt;function Lo(e,t,n){xi.call(this,e,t),this.bufferArray=new Float32Array(16*n),this.instanceMatrix=new Dn(this.bufferArray,16),this.count=n,this.objects=[],null==this.geometry.boundingBox&&this.geometry.computeBoundingBox(),To.copy(this.geometry.boundingBox)}function Fo(e){Pn.call(this),this.type="LineBasicMaterial",this.color=new Sn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Lo.prototype=Object.assign(Object.create(xi.prototype),{constructor:Lo,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,i=this.count;if(So.geometry=this.geometry,So.material=this.material,void 0!==So.material)for(var r=0;r<i;r++)this.getMatrixAt(r,Bo),Io.multiplyMatrices(n,Bo),So.matrixWorld=Io,So.raycast(e,Eo),Eo.length>0&&(Eo[0].instanceId=r,Eo[0].object=this,t.push(Eo[0]),Eo.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e),0===e?(this.geometry.boundingBox.copy((new Jt).copy(To).applyMatrix4(t)),null==this.geometry.boundingSphere&&(this.geometry.boundingSphere=new en)):this.geometry.boundingBox.union((new Jt).copy(To).applyMatrix4(t)),this.geometry.boundingBox.getBoundingSphere(this.geometry.boundingSphere)},updateMorphTargets:function(){}}),Fo.prototype=Object.create(Pn.prototype),Fo.prototype.constructor=Fo,Fo.prototype.isLineBasicMaterial=!0,Fo.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var _o=new tt,Uo=new tt,Po=new vt,ko=new ln,Do=new en;function Ro(e,t,n){1===n&&console.error("Line: parameter LinePieces no longer supported. Use LineSegments instead."),Dt.call(this),this.type="Line",this.geometry=void 0!==e?e:new ni,this.material=void 0!==t?t:new Fo({color:16777215*Math.random()})}Ro.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Ro,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)_o.fromBufferAttribute(t,i-1),Uo.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=_o.distanceTo(Uo);e.setAttribute("lineDistance",new Vn(n,1))}else console.warn("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;(n=e.lineDistances)[0]=0;for(i=1,r=a.length;i<r;i++)n[i]=n[i-1],n[i]+=a[i-1].distanceTo(a[i])}return this},raycast:function(e,t){var n=e.linePrecision,i=this.geometry,r=this.matrixWorld;if(null===i.boundingSphere&&i.computeBoundingSphere(),Do.copy(i.boundingSphere),Do.applyMatrix4(r),Do.radius+=n,!1!==e.ray.intersectsSphere(Do)){Po.getInverse(r),ko.copy(e.ray).applyMatrix4(Po);var a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new tt,A=new tt,l=new tt,c=new tt,h=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var u=i.index,d=i.attributes.position.array;if(null!==u)for(var f=u.array,p=0,m=f.length-1;p<m;p+=h){var g=f[p],v=f[p+1];if(s.fromArray(d,3*g),A.fromArray(d,3*v),!(ko.distanceSqToSegment(s,A,c,l)>o))c.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(c))<e.near||x>e.far||t.push({distance:x,point:l.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}else for(p=0,m=d.length/3-1;p<m;p+=h){if(s.fromArray(d,3*p),A.fromArray(d,3*p+3),!(ko.distanceSqToSegment(s,A,c,l)>o))c.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(c))<e.near||x>e.far||t.push({distance:x,point:l.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){var y=i.vertices,w=y.length;for(p=0;p<w-1;p+=h){var x;if(!(ko.distanceSqToSegment(y[p],y[p+1],c,l)>o))c.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(c))<e.near||x>e.far||t.push({distance:x,point:l.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Oo=new tt,No=new tt;function Go(e,t){Ro.call(this,e,t),this.type="LineSegments"}function Qo(e,t){Ro.call(this,e,t),this.type="LineLoop"}function Ho(e){Pn.call(this),this.type="PointsMaterial",this.color=new Sn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Go.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Go,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)Oo.fromBufferAttribute(t,i),No.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+Oo.distanceTo(No);e.setAttribute("lineDistance",new Vn(n,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;for(n=e.lineDistances,i=0,r=a.length;i<r;i+=2)Oo.copy(a[i]),No.copy(a[i+1]),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+Oo.distanceTo(No)}return this}}),Qo.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Qo,isLineLoop:!0}),Ho.prototype=Object.create(Pn.prototype),Ho.prototype.constructor=Ho,Ho.prototype.isPointsMaterial=!0,Ho.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var zo=new vt,Vo=new ln,jo=new en,Wo=new tt;function Xo(e,t){Dt.call(this),this.type="Points",this.geometry=void 0!==e?e:new ni,this.material=void 0!==t?t:new Ho({color:16777215*Math.random()}),this.updateMorphTargets()}function Zo(e,t,n,i,r,a,o){var s=Vo.distanceSqToPoint(e);if(s<n){var A=new tt;Vo.closestPointToPoint(e,A),A.applyMatrix4(i);var l=r.ray.origin.distanceTo(A);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:A,index:t,face:null,object:o})}}function Yo(e,t,n,i,r,a,o,s,A,l,c,h){st.call(this,null,a,o,s,A,l,i,r,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ko(e,t,n,i,r,a,o,s,A){st.call(this,e,t,n,i,r,a,o,s,A),this.needsUpdate=!0}function Jo(e,t,n,i,r,a,o,s,A,l){if((l=void 0!==l?l:ce)!==ce&&l!==he)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===ce&&(n=K),void 0===n&&l===he&&(n=ie),st.call(this,null,i,r,a,o,s,l,n,A),this.image={width:e,height:t},this.magFilter=void 0!==o?o:z,this.minFilter=void 0!==s?s:z,this.flipY=!1,this.generateMipmaps=!1}function qo(e){ni.call(this),this.type="WireframeGeometry";var t,n,i,r,a,o,s,A,l,c,h=[],u=[0,0],d={},f=["a","b","c"];if(e&&e.isGeometry){var p=e.faces;for(t=0,i=p.length;t<i;t++){var m=p[t];for(n=0;n<3;n++)s=m[f[n]],A=m[f[(n+1)%3]],u[0]=Math.min(s,A),u[1]=Math.max(s,A),void 0===d[l=u[0]+","+u[1]]&&(d[l]={index1:u[0],index2:u[1]})}for(l in d)o=d[l],c=e.vertices[o.index1],h.push(c.x,c.y,c.z),c=e.vertices[o.index2],h.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var g,v,y,w,x,b,C;if(c=new tt,null!==e.index){for(g=e.attributes.position,v=e.index,0===(y=e.groups).length&&(y=[{start:0,count:v.count,materialIndex:0}]),r=0,a=y.length;r<a;++r)for(t=x=(w=y[r]).start,i=x+w.count;t<i;t+=3)for(n=0;n<3;n++)s=v.getX(t+n),A=v.getX(t+(n+1)%3),u[0]=Math.min(s,A),u[1]=Math.max(s,A),void 0===d[l=u[0]+","+u[1]]&&(d[l]={index1:u[0],index2:u[1]});for(l in d)o=d[l],c.fromBufferAttribute(g,o.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(g,o.index2),h.push(c.x,c.y,c.z)}else for(t=0,i=(g=e.attributes.position).count/3;t<i;t++)for(n=0;n<3;n++)b=3*t+n,c.fromBufferAttribute(g,b),h.push(c.x,c.y,c.z),C=3*t+(n+1)%3,c.fromBufferAttribute(g,C),h.push(c.x,c.y,c.z)}this.setAttribute("position",new Vn(h,3))}function $o(e,t,n){Si.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new es(e,t,n)),this.mergeVertices()}function es(e,t,n){ni.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i,r,a=[],o=[],s=[],A=[],l=1e-5,c=new tt,h=new tt,u=new tt,d=new tt,f=new tt;e.length<3&&console.error("ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=t+1;for(i=0;i<=n;i++){var m=i/n;for(r=0;r<=t;r++){var g=r/t;e(g,m,h),o.push(h.x,h.y,h.z),g-l>=0?(e(g-l,m,u),d.subVectors(h,u)):(e(g+l,m,u),d.subVectors(u,h)),m-l>=0?(e(g,m-l,u),f.subVectors(h,u)):(e(g,m+l,u),f.subVectors(u,h)),c.crossVectors(d,f).normalize(),s.push(c.x,c.y,c.z),A.push(g,m)}}for(i=0;i<n;i++)for(r=0;r<t;r++){var v=i*p+r,y=i*p+r+1,w=(i+1)*p+r+1,x=(i+1)*p+r;a.push(v,y,x),a.push(y,w,x)}this.setIndex(a),this.setAttribute("position",new Vn(o,3)),this.setAttribute("normal",new Vn(s,3)),this.setAttribute("uv",new Vn(A,2))}function ts(e,t,n,i){Si.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new ns(e,t,n,i)),this.mergeVertices()}function ns(e,t,n,i){ni.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1;var r=[],a=[];function o(e,t,n,i){var r,a,o=Math.pow(2,i),A=[];for(r=0;r<=o;r++){A[r]=[];var l=e.clone().lerp(n,r/o),c=t.clone().lerp(n,r/o),h=o-r;for(a=0;a<=h;a++)A[r][a]=0===a&&r===o?l:l.clone().lerp(c,a/h)}for(r=0;r<o;r++)for(a=0;a<2*(o-r)-1;a++){var u=Math.floor(a/2);a%2==0?(s(A[r][u+1]),s(A[r+1][u]),s(A[r][u])):(s(A[r][u+1]),s(A[r+1][u+1]),s(A[r+1][u]))}}function s(e){r.push(e.x,e.y,e.z)}function A(t,n){var i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function l(e,t,n,i){i<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=i/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var n=new tt,i=new tt,r=new tt,a=0;a<t.length;a+=3)A(t[a+0],n),A(t[a+1],i),A(t[a+2],r),o(n,i,r,e)}(i=i||0),function(e){for(var t=new tt,n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){for(var e=new tt,t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];var n=c(e)/2/Math.PI+.5,i=h(e)/Math.PI+.5;a.push(n,1-i)}(function(){for(var e=new tt,t=new tt,n=new tt,i=new tt,o=new Je,s=new Je,A=new Je,h=0,u=0;h<r.length;h+=9,u+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(a[u+0],a[u+1]),s.set(a[u+2],a[u+3]),A.set(a[u+4],a[u+5]),i.copy(e).add(t).add(n).divideScalar(3);var d=c(i);l(o,u+0,e,d),l(s,u+2,t,d),l(A,u+4,n,d)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],n=a[e+2],i=a[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),i<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Vn(r,3)),this.setAttribute("normal",new Vn(r.slice(),3)),this.setAttribute("uv",new Vn(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function is(e,t){Si.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new rs(e,t)),this.mergeVertices()}function rs(e,t){ns.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function as(e,t){Si.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new os(e,t)),this.mergeVertices()}function os(e,t){ns.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ss(e,t){Si.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new As(e,t)),this.mergeVertices()}function As(e,t){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];ns.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ls(e,t){Si.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new cs(e,t)),this.mergeVertices()}function cs(e,t){var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];ns.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function hs(e,t,n,i,r,a){Si.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},void 0!==a&&console.warn("TubeGeometry: taper has been removed.");var o=new us(e,t,n,i,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function us(e,t,n,i,r){ni.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},t=t||64,n=n||1,i=i||8,r=r||!1;var a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,A=new tt,l=new tt,c=new Je,h=new tt,u=[],d=[],f=[],p=[];function m(r){h=e.getPointAt(r/t,h);var o=a.normals[r],c=a.binormals[r];for(s=0;s<=i;s++){var f=s/i*Math.PI*2,p=Math.sin(f),m=-Math.cos(f);l.x=m*o.x+p*c.x,l.y=m*o.y+p*c.y,l.z=m*o.z+p*c.z,l.normalize(),d.push(l.x,l.y,l.z),A.x=h.x+n*l.x,A.y=h.y+n*l.y,A.z=h.z+n*l.z,u.push(A.x,A.y,A.z)}}!function(){for(o=0;o<t;o++)m(o);m(!1===r?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=i;s++)c.x=o/t,c.y=s/i,f.push(c.x,c.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=i;o++){var e=(i+1)*(s-1)+(o-1),n=(i+1)*s+(o-1),r=(i+1)*s+o,a=(i+1)*(s-1)+o;p.push(e,n,a),p.push(n,r,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Vn(u,3)),this.setAttribute("normal",new Vn(d,3)),this.setAttribute("uv",new Vn(f,2))}function ds(e,t,n,i,r,a,o){Si.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},void 0!==o&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new fs(e,t,n,i,r,a)),this.mergeVertices()}function fs(e,t,n,i,r,a){ni.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,a=a||3;var o,s,A=[],l=[],c=[],h=[],u=new tt,d=new tt,f=new tt,p=new tt,m=new tt,g=new tt,v=new tt;for(o=0;o<=n;++o){var y=o/n*r*Math.PI*2;for(E(y,r,a,e,f),E(y+.01,r,a,e,p),g.subVectors(p,f),v.addVectors(p,f),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize(),s=0;s<=i;++s){var w=s/i*Math.PI*2,x=-t*Math.cos(w),b=t*Math.sin(w);u.x=f.x+(x*v.x+b*m.x),u.y=f.y+(x*v.y+b*m.y),u.z=f.z+(x*v.z+b*m.z),l.push(u.x,u.y,u.z),d.subVectors(u,f).normalize(),c.push(d.x,d.y,d.z),h.push(o/n),h.push(s/i)}}for(s=1;s<=n;s++)for(o=1;o<=i;o++){var C=(i+1)*(s-1)+(o-1),M=(i+1)*s+(o-1),B=(i+1)*s+o,I=(i+1)*(s-1)+o;A.push(C,M,I),A.push(M,B,I)}function E(e,t,n,i,r){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,A=Math.cos(s);r.x=i*(2+A)*.5*a,r.y=i*(2+A)*o*.5,r.z=i*Math.sin(s)*.5}this.setIndex(A),this.setAttribute("position",new Vn(l,3)),this.setAttribute("normal",new Vn(c,3)),this.setAttribute("uv",new Vn(h,2))}function ps(e,t,n,i,r){Si.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new ms(e,t,n,i,r)),this.mergeVertices()}function ms(e,t,n,i,r){ni.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;var a,o,s=[],A=[],l=[],c=[],h=new tt,u=new tt,d=new tt;for(a=0;a<=n;a++)for(o=0;o<=i;o++){var f=o/i*r,p=a/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),A.push(u.x,u.y,u.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(o/i),c.push(a/n)}for(a=1;a<=n;a++)for(o=1;o<=i;o++){var m=(i+1)*a+o-1,g=(i+1)*(a-1)+o-1,v=(i+1)*(a-1)+o,y=(i+1)*a+o;s.push(m,g,y),s.push(g,v,y)}this.setIndex(s),this.setAttribute("position",new Vn(A,3)),this.setAttribute("normal",new Vn(l,3)),this.setAttribute("uv",new Vn(c,2))}Xo.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Xo,isPoints:!0,raycast:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),jo.copy(n.boundingSphere),jo.applyMatrix4(i),jo.radius+=r,!1!==e.ray.intersectsSphere(jo)){zo.getInverse(i),Vo.copy(e.ray).applyMatrix4(zo);var a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isBufferGeometry){var s=n.index,A=n.attributes.position.array;if(null!==s)for(var l=s.array,c=0,h=l.length;c<h;c++){var u=l[c];Wo.fromArray(A,3*u),Zo(Wo,u,o,i,e,t,this)}else{c=0;for(var d=A.length/3;c<d;c++)Wo.fromArray(A,3*c),Zo(Wo,c,o,i,e,t,this)}}else{var f=n.vertices;for(c=0,d=f.length;c<d;c++)Zo(f[c],c,o,i,e,t,this)}}},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,a=Object.keys(r);if(a.length>0){var o=r[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("Points.updateMorphTargets() does not support Geometry. Use BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Yo.prototype=Object.create(st.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isCompressedTexture=!0,Ko.prototype=Object.create(st.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isCanvasTexture=!0,Jo.prototype=Object.create(st.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isDepthTexture=!0,qo.prototype=Object.create(ni.prototype),qo.prototype.constructor=qo,$o.prototype=Object.create(Si.prototype),$o.prototype.constructor=$o,es.prototype=Object.create(ni.prototype),es.prototype.constructor=es,ts.prototype=Object.create(Si.prototype),ts.prototype.constructor=ts,ns.prototype=Object.create(ni.prototype),ns.prototype.constructor=ns,is.prototype=Object.create(Si.prototype),is.prototype.constructor=is,rs.prototype=Object.create(ns.prototype),rs.prototype.constructor=rs,as.prototype=Object.create(Si.prototype),as.prototype.constructor=as,os.prototype=Object.create(ns.prototype),os.prototype.constructor=os,ss.prototype=Object.create(Si.prototype),ss.prototype.constructor=ss,As.prototype=Object.create(ns.prototype),As.prototype.constructor=As,ls.prototype=Object.create(Si.prototype),ls.prototype.constructor=ls,cs.prototype=Object.create(ns.prototype),cs.prototype.constructor=cs,hs.prototype=Object.create(Si.prototype),hs.prototype.constructor=hs,us.prototype=Object.create(ni.prototype),us.prototype.constructor=us,us.prototype.toJSON=function(){var e=ni.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},ds.prototype=Object.create(Si.prototype),ds.prototype.constructor=ds,fs.prototype=Object.create(ni.prototype),fs.prototype.constructor=fs,ps.prototype=Object.create(Si.prototype),ps.prototype.constructor=ps,ms.prototype=Object.create(ni.prototype),ms.prototype.constructor=ms;var gs=function(e,t,n){n=n||2;var i,r,a,o,s,A,l,c=t&&t.length,h=c?t[0]*n:e.length,u=vs(e,0,h,n,!0),d=[];if(!u||u.next===u.prev)return d;if(c&&(u=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=vs(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(Ss(o));for(s.sort(Bs),r=0;r<s.length;r++)Is(s[r],n),n=ys(n,n.next);return n}(e,t,u,n)),e.length>80*n){i=a=e[0],r=o=e[1];for(var f=n;f<h;f+=n)(s=e[f])<i&&(i=s),(A=e[f+1])<r&&(r=A),s>a&&(a=s),A>o&&(o=A);l=0!==(l=Math.max(a-i,o-r))?1/l:0}return ws(u,d,n,i,r,l),d};function vs(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=Ds(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=Ds(a,e[a],e[a+1],o);return o&&_s(o,o.next)&&(Rs(o),o=o.next),o}function ys(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!_s(i,i.next)&&0!==Fs(i.prev,i,i.next))i=i.next;else{if(Rs(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function ws(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Es(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,A,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(A=l;s>0||A>0&&i;)0!==s&&(0===A||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,A--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(e,i,r,a);for(var s,A,l=e;e.prev!==e.next;)if(s=e.prev,A=e.next,a?bs(e,i,r,a):xs(e))t.push(s.i/n),t.push(e.i/n),t.push(A.i/n),Rs(e),e=A.next,l=A.next;else if((e=A)===l){o?1===o?ws(e=Cs(e,t,n),t,n,i,r,a,2):2===o&&Ms(e,t,n,i,r,a):ws(ys(e),t,n,i,r,a,1);break}}}function xs(e){var t=e.prev,n=e,i=e.next;if(Fs(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(Ts(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Fs(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function bs(e,t,n,i){var r=e.prev,a=e,o=e.next;if(Fs(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,A=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=Es(s,A,t,n,i),u=Es(l,c,t,n,i),d=e.prevZ,f=e.nextZ;d&&d.z>=h&&f&&f.z<=u;){if(d!==e.prev&&d!==e.next&&Ts(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Fs(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&Ts(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Fs(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Ts(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Fs(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=u;){if(f!==e.prev&&f!==e.next&&Ts(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Fs(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Cs(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!_s(r,a)&&Us(r,i,i.next,a)&&Ps(r,a)&&Ps(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),Rs(i),Rs(i.next),i=e=a),i=i.next}while(i!==e);return i}function Ms(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Ls(o,s)){var A=ks(o,s);return o=ys(o,o.next),A=ys(A,A.next),ws(o,t,n,i,r,a),void ws(A,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function Bs(e,t){return e.x-t.x}function Is(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n.prev;var A,l=n,c=n.x,h=n.y,u=1/0;i=n.next;for(;i!==l;)r>=i.x&&i.x>=c&&r!==i.x&&Ts(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&((A=Math.abs(a-i.y)/(r-i.x))<u||A===u&&i.x>n.x)&&Ps(i,e)&&(n=i,u=A),i=i.next;return n}(e,t)){var n=ks(t,e);ys(n,n.next)}}function Es(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ss(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ts(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function Ls(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Us(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Ps(e,t)&&Ps(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function Fs(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _s(e,t){return e.x===t.x&&e.y===t.y}function Us(e,t,n,i){return!!(_s(e,n)&&_s(t,i)||_s(e,i)&&_s(n,t))||Fs(e,t,n)>0!=Fs(e,t,i)>0&&Fs(n,i,e)>0!=Fs(n,i,t)>0}function Ps(e,t){return Fs(e.prev,e,e.next)<0?Fs(e,t,e.next)>=0&&Fs(e,e.prev,t)>=0:Fs(e,t,e.prev)<0||Fs(e,e.next,t)<0}function ks(e,t){var n=new Os(e.i,e.x,e.y),i=new Os(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Ds(e,t,n,i){var r=new Os(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Rs(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Os(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Ns={area:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},isClockWise:function(e){return Ns.area(e)<0},triangulateShape:function(e,t){var n=[],i=[],r=[];Gs(e),Qs(n,e);var a=e.length;t.forEach(Gs);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,Qs(n,t[o]);var s=gs(n,i);for(o=0;o<s.length;o+=3)r.push(s.slice(o,o+3));return r}};function Gs(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Qs(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function Hs(e,t){Si.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new zs(e,t)),this.mergeVertices()}function zs(e,t){ni.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,i=[],r=[],a=0,o=e.length;a<o;a++){s(e[a])}function s(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,A=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:c-2,u=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3,f=t.extrudePath,p=void 0!==t.UVGenerator?t.UVGenerator:Vs;void 0!==t.amount&&(console.warn("ExtrudeBufferGeometry: amount has been renamed to depth."),A=t.amount);var m,g,v,y,w,x,b,C,M=!1;f&&(m=f.getSpacedPoints(s),M=!0,l=!1,g=f.computeFrenetFrames(s,!1),v=new tt,y=new tt,w=new tt),l||(d=0,c=0,h=0,u=0);var B=e.extractPoints(o),I=B.shape,E=B.holes;if(!Ns.isClockWise(I))for(I=I.reverse(),b=0,C=E.length;b<C;b++)x=E[b],Ns.isClockWise(x)&&(E[b]=x.reverse());var S=Ns.triangulateShape(I,E),T=I;for(b=0,C=E.length;b<C;b++)x=E[b],I=I.concat(x);function L(e,t,n){return t||console.error("ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var F,_,U,P,k,D,R=I.length,O=S.length;function N(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,A=n.x-e.x,l=n.y-e.y,c=o*o+s*s,h=o*l-s*A;if(Math.abs(h)>Number.EPSILON){var u=Math.sqrt(c),d=Math.sqrt(A*A+l*l),f=t.x-s/u,p=t.y+o/u,m=((n.x-l/d-f)*l-(n.y+A/d-p)*A)/(o*l-s*A),g=(i=f+o*m-e.x)*i+(r=p+s*m-e.y)*r;if(g<=2)return new Je(i,r);a=Math.sqrt(g/2)}else{var v=!1;o>Number.EPSILON?A>Number.EPSILON&&(v=!0):o<-Number.EPSILON?A<-Number.EPSILON&&(v=!0):Math.sign(s)===Math.sign(l)&&(v=!0),v?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new Je(i/a,r/a)}for(var G=[],Q=0,H=T.length,z=H-1,V=Q+1;Q<H;Q++,z++,V++)z===H&&(z=0),V===H&&(V=0),G[Q]=N(T[Q],T[z],T[V]);var j,W,X=[],Z=G.concat();for(b=0,C=E.length;b<C;b++){for(x=E[b],j=[],Q=0,z=(H=x.length)-1,V=Q+1;Q<H;Q++,z++,V++)z===H&&(z=0),V===H&&(V=0),j[Q]=N(x[Q],x[z],x[V]);X.push(j),Z=Z.concat(j)}for(F=0;F<d;F++){for(U=F/d,P=c*Math.cos(U*Math.PI/2),_=h*Math.sin(U*Math.PI/2)+u,Q=0,H=T.length;Q<H;Q++)K((k=L(T[Q],G[Q],_)).x,k.y,-P);for(b=0,C=E.length;b<C;b++)for(x=E[b],j=X[b],Q=0,H=x.length;Q<H;Q++)K((k=L(x[Q],j[Q],_)).x,k.y,-P)}for(_=h+u,Q=0;Q<R;Q++)k=l?L(I[Q],Z[Q],_):I[Q],M?(y.copy(g.normals[0]).multiplyScalar(k.x),v.copy(g.binormals[0]).multiplyScalar(k.y),w.copy(m[0]).add(y).add(v),K(w.x,w.y,w.z)):K(k.x,k.y,0);for(W=1;W<=s;W++)for(Q=0;Q<R;Q++)k=l?L(I[Q],Z[Q],_):I[Q],M?(y.copy(g.normals[W]).multiplyScalar(k.x),v.copy(g.binormals[W]).multiplyScalar(k.y),w.copy(m[W]).add(y).add(v),K(w.x,w.y,w.z)):K(k.x,k.y,A/s*W);for(F=d-1;F>=0;F--){for(U=F/d,P=c*Math.cos(U*Math.PI/2),_=h*Math.sin(U*Math.PI/2)+u,Q=0,H=T.length;Q<H;Q++)K((k=L(T[Q],G[Q],_)).x,k.y,A+P);for(b=0,C=E.length;b<C;b++)for(x=E[b],j=X[b],Q=0,H=x.length;Q<H;Q++)k=L(x[Q],j[Q],_),M?K(k.x,k.y+m[s-1].y,m[s-1].x+P):K(k.x,k.y,A+P)}function Y(e,t){var n,i;for(Q=e.length;--Q>=0;){n=Q,(i=Q-1)<0&&(i=e.length-1);var r=0,a=s+2*d;for(r=0;r<a;r++){var o=R*r,A=R*(r+1);q(t+n+o,t+i+o,t+i+A,t+n+A)}}}function K(e,t,n){a.push(e),a.push(t),a.push(n)}function J(e,t,r){$(e),$(t),$(r);var a=i.length/3,o=p.generateTopUV(n,i,a-3,a-2,a-1);ee(o[0]),ee(o[1]),ee(o[2])}function q(e,t,r,a){$(e),$(t),$(a),$(t),$(r),$(a);var o=i.length/3,s=p.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){i.push(a[3*e+0]),i.push(a[3*e+1]),i.push(a[3*e+2])}function ee(e){r.push(e.x),r.push(e.y)}!function(){var e=i.length/3;if(l){var t=0,r=R*t;for(Q=0;Q<O;Q++)J((D=S[Q])[2]+r,D[1]+r,D[0]+r);for(r=R*(t=s+2*d),Q=0;Q<O;Q++)J((D=S[Q])[0]+r,D[1]+r,D[2]+r)}else{for(Q=0;Q<O;Q++)J((D=S[Q])[2],D[1],D[0]);for(Q=0;Q<O;Q++)J((D=S[Q])[0]+R*s,D[1]+R*s,D[2]+R*s)}n.addGroup(e,i.length/3-e,0)}(),function(){var e=i.length/3,t=0;for(Y(T,t),t+=T.length,b=0,C=E.length;b<C;b++)Y(x=E[b],t),t+=x.length;n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Vn(i,3)),this.setAttribute("uv",new Vn(r,2)),this.computeVertexNormals()}Hs.prototype=Object.create(Si.prototype),Hs.prototype.constructor=Hs,Hs.prototype.toJSON=function(){var e=Si.prototype.toJSON.call(this);return js(this.parameters.shapes,this.parameters.options,e)},zs.prototype=Object.create(ni.prototype),zs.prototype.constructor=zs,zs.prototype.toJSON=function(){var e=ni.prototype.toJSON.call(this);return js(this.parameters.shapes,this.parameters.options,e)};var Vs={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],A=t[3*i+1],l=t[3*r],c=t[3*r+1];return[new Je(a,o),new Je(s,A),new Je(l,c)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],A=t[3*n+2],l=t[3*i],c=t[3*i+1],h=t[3*i+2],u=t[3*r],d=t[3*r+1],f=t[3*r+2],p=t[3*a],m=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<.01?[new Je(o,1-A),new Je(l,1-h),new Je(u,1-f),new Je(p,1-g)]:[new Je(s,1-A),new Je(c,1-h),new Je(d,1-f),new Je(m,1-g)]}};function js(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Ws(e,t){Si.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Xs(e,t)),this.mergeVertices()}function Xs(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new Si;var i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),zs.call(this,i,t),this.type="TextBufferGeometry"}function Zs(e,t,n,i,r,a,o){Si.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Ys(e,t,n,i,r,a,o)),this.mergeVertices()}function Ys(e,t,n,i,r,a,o){ni.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,A,l=Math.min(a+o,Math.PI),c=0,h=[],u=new tt,d=new tt,f=[],p=[],m=[],g=[];for(A=0;A<=n;A++){var v=[],y=A/n,w=0;for(0==A&&0==a?w=.5/t:A==n&&l==Math.PI&&(w=-.5/t),s=0;s<=t;s++){var x=s/t;u.x=-e*Math.cos(i+x*r)*Math.sin(a+y*o),u.y=e*Math.cos(a+y*o),u.z=e*Math.sin(i+x*r)*Math.sin(a+y*o),p.push(u.x,u.y,u.z),d.copy(u).normalize(),m.push(d.x,d.y,d.z),g.push(x+w,1-y),v.push(c++)}h.push(v)}for(A=0;A<n;A++)for(s=0;s<t;s++){var b=h[A][s+1],C=h[A][s],M=h[A+1][s],B=h[A+1][s+1];(0!==A||a>0)&&f.push(b,C,B),(A!==n-1||l<Math.PI)&&f.push(C,M,B)}this.setIndex(f),this.setAttribute("position",new Vn(p,3)),this.setAttribute("normal",new Vn(m,3)),this.setAttribute("uv",new Vn(g,2))}function Ks(e,t,n,i,r,a){Si.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new Js(e,t,n,i,r,a)),this.mergeVertices()}function Js(e,t,n,i,r,a){ni.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},e=e||.5,t=t||1,r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var o,s,A,l=[],c=[],h=[],u=[],d=e,f=(t-e)/(i=void 0!==i?Math.max(1,i):1),p=new tt,m=new Je;for(s=0;s<=i;s++){for(A=0;A<=n;A++)o=r+A/n*a,p.x=d*Math.cos(o),p.y=d*Math.sin(o),c.push(p.x,p.y,p.z),h.push(0,0,1),m.x=(p.x/t+1)/2,m.y=(p.y/t+1)/2,u.push(m.x,m.y);d+=f}for(s=0;s<i;s++){var g=s*(n+1);for(A=0;A<n;A++){var v=o=A+g,y=o+n+1,w=o+n+2,x=o+1;l.push(v,y,x),l.push(y,w,x)}}this.setIndex(l),this.setAttribute("position",new Vn(c,3)),this.setAttribute("normal",new Vn(h,3)),this.setAttribute("uv",new Vn(u,2))}function qs(e,t,n,i){Si.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new $s(e,t,n,i)),this.mergeVertices()}function $s(e,t,n,i){ni.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t)||12,n=n||0,i=i||2*Math.PI,i=Ke.clamp(i,0,2*Math.PI);var r,a,o,s=[],A=[],l=[],c=1/t,h=new tt,u=new Je;for(a=0;a<=t;a++){var d=n+a*c*i,f=Math.sin(d),p=Math.cos(d);for(o=0;o<=e.length-1;o++)h.x=e[o].x*f,h.y=e[o].y,h.z=e[o].x*p,A.push(h.x,h.y,h.z),u.x=a/t,u.y=o/(e.length-1),l.push(u.x,u.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var m=r=o+a*e.length,g=r+e.length,v=r+e.length+1,y=r+1;s.push(m,g,y),s.push(g,v,y)}if(this.setIndex(s),this.setAttribute("position",new Vn(A,3)),this.setAttribute("uv",new Vn(l,2)),this.computeVertexNormals(),i===2*Math.PI){var w=this.attributes.normal.array,x=new tt,b=new tt,C=new tt;for(r=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)x.x=w[o+0],x.y=w[o+1],x.z=w[o+2],b.x=w[r+o+0],b.y=w[r+o+1],b.z=w[r+o+2],C.addVectors(x,b).normalize(),w[o+0]=w[r+o+0]=C.x,w[o+1]=w[r+o+1]=C.y,w[o+2]=w[r+o+2]=C.z}}function eA(e,t){Si.call(this),this.type="ShapeGeometry","object"===i(t)&&(console.warn("ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new tA(e,t)),this.mergeVertices()}function tA(e,t,n){ni.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12,n=n||!1;var i=[],r=[],a=[],o=[],s=0,A=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),n||(this.addGroup(s,A,l),s+=A,A=0);function c(e){var n,s,l,c=r.length/3,h=e.extractPoints(t),u=h.shape,d=h.holes;for(!1===Ns.isClockWise(u)&&(u=u.reverse()),n=0,s=d.length;n<s;n++)l=d[n],!0===Ns.isClockWise(l)&&(d[n]=l.reverse());var f=Ns.triangulateShape(u,d);for(n=0,s=d.length;n<s;n++)l=d[n],u=u.concat(l);for(n=0,s=u.length;n<s;n++){var p=u[n];r.push(p.x,p.y,0),a.push(0,0,1),o.push(p.x,p.y)}for(n=0,s=f.length;n<s;n++){var m=f[n],g=m[0]+c,v=m[1]+c,y=m[2]+c;i.push(g,v,y),A+=3}}this.setIndex(i),this.setAttribute("position",new Vn(r,3)),this.setAttribute("normal",new Vn(a,3)),this.setAttribute("uv",new Vn(o,2))}function nA(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}function iA(e,t){ni.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,i,r,a,o=[],s=Math.cos(Ke.DEG2RAD*t),A=[0,0],l={},c=["a","b","c"];e.isBufferGeometry?(a=new Si).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,u=a.faces,d=0,f=u.length;d<f;d++)for(var p=u[d],m=0;m<3;m++)n=p[c[m]],i=p[c[(m+1)%3]],A[0]=Math.min(n,i),A[1]=Math.max(n,i),void 0===l[r=A[0]+","+A[1]]?l[r]={index1:A[0],index2:A[1],face1:d,face2:void 0}:l[r].face2=d;for(r in l){var g=l[r];if(void 0===g.face2||u[g.face1].normal.dot(u[g.face2].normal)<=s){var v=h[g.index1];o.push(v.x,v.y,v.z),v=h[g.index2],o.push(v.x,v.y,v.z)}}this.setAttribute("position",new Vn(o,3))}function rA(e,t,n,i,r,a,o,s){Si.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new aA(e,t,n,i,r,a,o,s)),this.mergeVertices()}function aA(e,t,n,i,r,a,o,s){ni.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s};var A=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var l=[],c=[],h=[],u=[],d=0,f=[],p=n/2,m=0;function g(n){var r,a,f,g=new Je,v=new tt,y=0,w=!0===n?e:t,x=!0===n?1:-1;for(a=d,r=1;r<=i;r++)c.push(0,p*x,0),h.push(0,x,0),u.push(.5,.5),d++;for(f=d,r=0;r<=i;r++){var b=r/i*s+o,C=Math.cos(b),M=Math.sin(b);v.x=w*M,v.y=p*x,v.z=w*C,c.push(v.x,v.y,v.z),h.push(0,x,0),g.x=.5*C+.5,g.y=.5*M*x+.5,u.push(g.x,g.y),d++}for(r=0;r<i;r++){var B=a+r,I=f+r;!0===n?l.push(I,I+1,B):l.push(I+1,I,B),y+=3}A.addGroup(m,y,!0===n?1:2),m+=y}!function(){var a,g,v=new tt,y=new tt,w=0,x=(t-e)/n;for(g=0;g<=r;g++){var b=[],C=g/r,M=C*(t-e)+e;for(a=0;a<=i;a++){var B=a/i,I=B*s+o,E=Math.sin(I),S=Math.cos(I);y.x=M*E,y.y=-C*n+p,y.z=M*S,c.push(y.x,y.y,y.z),v.set(E,x,S).normalize(),h.push(v.x,v.y,v.z),u.push(B,1-C),b.push(d++)}f.push(b)}for(a=0;a<i;a++)for(g=0;g<r;g++){var T=f[g][a],L=f[g+1][a],F=f[g+1][a+1],_=f[g][a+1];l.push(T,L,_),l.push(L,F,_),w+=6}A.addGroup(m,w,0),m+=w}(),!1===a&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(l),this.setAttribute("position",new Vn(c,3)),this.setAttribute("normal",new Vn(h,3)),this.setAttribute("uv",new Vn(u,2))}function oA(e,t,n,i,r,a,o){rA.call(this,0,e,t,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}function sA(e,t,n,i,r,a,o){aA.call(this,0,e,t,n,i,r,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}function AA(e,t,n,i){Si.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new lA(e,t,n,i)),this.mergeVertices()}function lA(e,t,n,i){ni.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var r,a,o=[],s=[],A=[],l=[],c=new tt,h=new Je;for(s.push(0,0,0),A.push(0,0,1),l.push(.5,.5),a=0,r=3;a<=t;a++,r+=3){var u=n+a/t*i;c.x=e*Math.cos(u),c.y=e*Math.sin(u),s.push(c.x,c.y,c.z),A.push(0,0,1),h.x=(s[r]/e+1)/2,h.y=(s[r+1]/e+1)/2,l.push(h.x,h.y)}for(r=1;r<=t;r++)o.push(r,r+1,0);this.setIndex(o),this.setAttribute("position",new Vn(s,3)),this.setAttribute("normal",new Vn(A,3)),this.setAttribute("uv",new Vn(l,2))}Ws.prototype=Object.create(Si.prototype),Ws.prototype.constructor=Ws,Xs.prototype=Object.create(zs.prototype),Xs.prototype.constructor=Xs,Zs.prototype=Object.create(Si.prototype),Zs.prototype.constructor=Zs,Ys.prototype=Object.create(ni.prototype),Ys.prototype.constructor=Ys,Ks.prototype=Object.create(Si.prototype),Ks.prototype.constructor=Ks,Js.prototype=Object.create(ni.prototype),Js.prototype.constructor=Js,qs.prototype=Object.create(Si.prototype),qs.prototype.constructor=qs,$s.prototype=Object.create(ni.prototype),$s.prototype.constructor=$s,eA.prototype=Object.create(Si.prototype),eA.prototype.constructor=eA,eA.prototype.toJSON=function(){var e=Si.prototype.toJSON.call(this);return nA(this.parameters.shapes,e)},tA.prototype=Object.create(ni.prototype),tA.prototype.constructor=tA,tA.prototype.toJSON=function(){var e=ni.prototype.toJSON.call(this);return nA(this.parameters.shapes,e)},iA.prototype=Object.create(ni.prototype),iA.prototype.constructor=iA,rA.prototype=Object.create(Si.prototype),rA.prototype.constructor=rA,aA.prototype=Object.create(ni.prototype),aA.prototype.constructor=aA,oA.prototype=Object.create(rA.prototype),oA.prototype.constructor=oA,sA.prototype=Object.create(aA.prototype),sA.prototype.constructor=sA,AA.prototype=Object.create(Si.prototype),AA.prototype.constructor=AA,lA.prototype=Object.create(ni.prototype),lA.prototype.constructor=lA;var cA=Object.freeze({__proto__:null,WireframeGeometry:qo,ParametricGeometry:$o,ParametricBufferGeometry:es,TetrahedronGeometry:is,TetrahedronBufferGeometry:rs,OctahedronGeometry:as,OctahedronBufferGeometry:os,IcosahedronGeometry:ss,IcosahedronBufferGeometry:As,DodecahedronGeometry:ls,DodecahedronBufferGeometry:cs,PolyhedronGeometry:ts,PolyhedronBufferGeometry:ns,TubeGeometry:hs,TubeBufferGeometry:us,TorusKnotGeometry:ds,TorusKnotBufferGeometry:fs,TorusGeometry:ps,TorusBufferGeometry:ms,TextGeometry:Ws,TextBufferGeometry:Xs,SphereGeometry:Zs,SphereBufferGeometry:Ys,RingGeometry:Ks,RingBufferGeometry:Js,PlaneGeometry:Yi,PlaneBufferGeometry:Ki,LatheGeometry:qs,LatheBufferGeometry:$s,ShapeGeometry:eA,ShapeBufferGeometry:tA,ExtrudeGeometry:Hs,ExtrudeBufferGeometry:zs,EdgesGeometry:iA,ConeGeometry:oA,ConeBufferGeometry:sA,CylinderGeometry:rA,CylinderBufferGeometry:aA,CircleGeometry:AA,CircleBufferGeometry:lA,BoxGeometry:Ti,BoxBufferGeometry:Li});function hA(e){Pn.call(this),this.type="ShadowMaterial",this.color=new Sn(0),this.transparent=!0,this.setValues(e)}function uA(e){Pi.call(this,e),this.type="RawShaderMaterial"}function dA(e){Pn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Sn(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function fA(e){dA.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Je(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function pA(e){Pn.call(this),this.type="MeshPhongMaterial",this.color=new Sn(16777215),this.specular=new Sn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function mA(e){pA.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function gA(e){Pn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function vA(e){Pn.call(this),this.type="MeshLambertMaterial",this.color=new Sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function yA(e){Pn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Sn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function wA(e){Fo.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function xA(e){Pn.call(this),this.defines={STANDARD:""},this.type="AMRTBasicMaterial",this.color=new Sn(16777215),this.albedo=null,this.albedoUV=0,this.normalMap=null,this.normalScale=1,this.normalMap2=null,this.normalScale2=1,this.metallicMap=null,this.metallic=0,this.roughnessMap=null,this.smoothness=0,this.aoMap=null,this.aoScale=1,this.aoUV=0,this.emissive=new Sn(0),this.emissiveMap=null,this.emissiveUV=0,this.reflectMap=null,this.reflectIntensity=0,this.cutout=.5,this.reflectivity=1,this.transparency=0,this.opacity=1,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.vertexTangents=!0,this.normalMapType=0,this.envRotateY=0,this.envYMatrix=new rt,this.reflectRotateY=0,this.reflecYMatrix=new rt,this.dissolveMap=null,this.dissolveRatio=0,this.dissolveColor=new Sn(16774921),this.setValues(e),this.__defineSetter__("envRotateY",(function(e){this.envYMatrix=(new rt).rotateY(e)})),this.__defineSetter__("reflectRotateY",(function(e){this.reflecYMatrix=(new rt).rotateY(e)}))}function bA(e){Pn.call(this),this.type="AMRTShadowMaterial",this.color=new Sn(0),this.shadowPlane=new dn(new tt(0,-1,0),0),this.lightDirection=new tt(-1,-1,-1),this.shadowLength=1,this.center=new tt(0,0,0),this.skinning=!1,this.morphTargets=!1,this.transparent=!0,this.depthWrite=!1,this.stencilWrite=!0,this.stencilRef=0,this.stencilFunc=514,this.stencilFail=He,this.stencilZFail=He,this.stencilZPass=7682,this.setValues(e)}hA.prototype=Object.create(Pn.prototype),hA.prototype.constructor=hA,hA.prototype.isShadowMaterial=!0,hA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this},uA.prototype=Object.create(Pi.prototype),uA.prototype.constructor=uA,uA.prototype.isRawShaderMaterial=!0,dA.prototype=Object.create(Pn.prototype),dA.prototype.constructor=dA,dA.prototype.isMeshStandardMaterial=!0,dA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},fA.prototype=Object.create(dA.prototype),fA.prototype.constructor=fA,fA.prototype.isMeshPhysicalMaterial=!0,fA.prototype.copy=function(e){return dA.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new Sn).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},pA.prototype=Object.create(Pn.prototype),pA.prototype.constructor=pA,pA.prototype.isMeshPhongMaterial=!0,pA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},mA.prototype=Object.create(pA.prototype),mA.prototype.constructor=mA,mA.prototype.isMeshToonMaterial=!0,mA.prototype.copy=function(e){return pA.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},gA.prototype=Object.create(Pn.prototype),gA.prototype.constructor=gA,gA.prototype.isMeshNormalMaterial=!0,gA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},vA.prototype=Object.create(Pn.prototype),vA.prototype.constructor=vA,vA.prototype.isMeshLambertMaterial=!0,vA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},yA.prototype=Object.create(Pn.prototype),yA.prototype.constructor=yA,yA.prototype.isMeshMatcapMaterial=!0,yA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},wA.prototype=Object.create(Fo.prototype),wA.prototype.constructor=wA,wA.prototype.isLineDashedMaterial=!0,wA.prototype.copy=function(e){return Fo.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},xA.prototype=Object.create(Pn.prototype),xA.prototype.constructor=xA,xA.prototype.isAMRTBasicMaterial=!0,xA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.albedo=e.albedo,this.albedoUV=e.albedoUV,this.normalMap=e.normalMap,this.normalScale=e.normalScale,this.normalMap2=e.normalMap2,this.normalScale2=e.normalScale2,this.metallicMap=e.metallicMap,this.metallic=e.metallic,this.roughnessMap=e.roughnessMap,this.smoothness=e.smoothness,this.aoMap=e.aoMap,this.aoScale=e.aoScale,this.aoUV=e.aoUV,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveUV=e.emissiveUV,this.reflectMap=e.reflectMap,this.reflectIntensity=e.reflectIntensity,this.cutout=e.cutout,this.reflectivity=e.reflectivity,this.transparency=e.transparency,this.opacity=e.opacity,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.vertexTangents=e.vertexTangents,this.normalMapType=e.normalMapType,this.envRotateY=e.envRotateY,this.envYMatrix=e.envYMatrix,this.reflectRotateY=e.reflectRotateY,this.reflecYMatrix=e.reflecYMatrix,this},xA.prototype.dispose=function(){Pn.prototype.dispose.call(this),this.albedo&&this.albedo.dispose(),this.metallicMap&&this.metallicMap.dispose(),this.roughnessMap&&this.roughnessMap.dispose(),this.aoMap&&this.aoMap.dispose(),this.emissiveMap&&this.emissiveMap.dispose(),this.reflectMap&&this.reflectMap.dispose(),this.envMap&&this.envMap.dispose()},Object.defineProperty(xA.prototype,"alphaMap",{get(){return this._alphaMap||null},set(e){this._alphaMap=e,e&&(this.transparent=!0)}}),bA.prototype=Object.create(Pn.prototype),bA.prototype.constructor=bA,bA.prototype.isAMRTShadowMaterial=!0,bA.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.color.copy(e.color),this.shadowPlane.copy(e.shadowPlane),this.lightDirection.copy(e.lightDirection),this.shadowLength=e.shadowLength,this.center.copy(e.center),this};var CA=Object.freeze({__proto__:null,ShadowMaterial:hA,SpriteMaterial:to,RawShaderMaterial:uA,ShaderMaterial:Pi,PointsMaterial:Ho,MeshPhysicalMaterial:fA,MeshStandardMaterial:dA,MeshPhongMaterial:pA,MeshToonMaterial:mA,MeshNormalMaterial:gA,MeshLambertMaterial:vA,MeshDepthMaterial:Pa,MeshDistanceMaterial:ka,MeshBasicMaterial:kn,MeshMatcapMaterial:yA,LineDashedMaterial:wA,LineBasicMaterial:Fo,AMRTBasicMaterial:xA,AMRTShadowMaterial:bA,Material:Pn}),MA={arraySlice:function(e,t,n){return MA.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,A=0;A!==t;++A)r[o++]=e[s+A];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}},subclip:function(e,t,n,i,r){r=r||30;var a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var A=a.tracks[s],l=A.getValueSize(),c=[],h=[],u=0;u<A.times.length;++u){var d=A.times[u]*r;if(!(d<n||d>=i)){c.push(A.times[u]);for(var f=0;f<l;++f)h.push(A.values[u*l+f])}}0!==c.length&&(A.times=MA.convertArray(c,A.times.constructor),A.values=MA.convertArray(h,A.values.constructor),o.push(A))}a.tracks=o;var p=1/0;for(s=0;s<a.tracks.length;++s)p>a.tracks[s].times[0]&&(p=a.tracks[s].times[0]);for(s=0;s<a.tracks.length;++s)a.tracks[s].shift(-1*p);return a.resetDuration(),a}};function BA(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function IA(e,t,n,i){BA.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function EA(e,t,n,i){BA.call(this,e,t,n,i)}function SA(e,t,n,i){BA.call(this,e,t,n,i)}function TA(e,t,n,i){if(void 0===e)throw new Error("KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=MA.convertArray(t,this.TimeBufferType),this.values=MA.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function LA(e,t,n){TA.call(this,e,t,n)}function FA(e,t,n,i){TA.call(this,e,t,n,i)}function _A(e,t,n,i){TA.call(this,e,t,n,i)}function UA(e,t,n,i){BA.call(this,e,t,n,i)}function PA(e,t,n,i){TA.call(this,e,t,n,i)}function kA(e,t,n,i){TA.call(this,e,t,n,i)}function DA(e,t,n,i){TA.call(this,e,t,n,i)}function RA(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Ke.generateUUID(),this.duration<0&&this.resetDuration()}function OA(e){if(void 0===e.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return _A;case"vector":case"vector2":case"vector3":case"vector4":return DA;case"color":return FA;case"quaternion":return PA;case"bool":case"boolean":return LA;case"string":return kA}throw new Error("KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];MA.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function NA(e,t,n){var i=this,r=!1,a=0,o=0,s=void 0,A=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,o),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return A.push(e,t),this},this.removeHandler=function(e){var t=A.indexOf(e);return-1!==t&&A.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=A.length;t<n;t+=2){var i=A[t],r=A[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}}Object.assign(BA.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var A=n+a>>>1;e<t[A]?a=A:n=A+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(BA.prototype,{beforeStart_:BA.prototype.copySampleValue_,afterEnd_:BA.prototype.copySampleValue_}),IA.prototype=Object.assign(Object.create(BA.prototype),{constructor:IA,DefaultSettings_:{endingStart:Fe,endingEnd:Fe},intervalChanged_:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case _e:r=e,o=2*t-n;break;case Ue:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case _e:a=e,s=2*n-t;break;case Ue:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var A=.5*(n-t),l=this.valueSize;this._weightPrev=A/(t-o),this._weightNext=A/(s-n),this._offsetPrev=r*l,this._offsetNext=a*l},interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,A=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,u=this._weightNext,d=(n-t)/(i-t),f=d*d,p=f*d,m=-h*p+2*h*f-h*d,g=(1+h)*p+(-1.5-2*h)*f+(-.5+h)*d+1,v=(-1-u)*p+(1.5+u)*f+.5*d,y=u*p-u*f,w=0;w!==o;++w)r[w]=m*a[l+w]+g*a[A+w]+v*a[s+w]+y*a[c+w];return r}}),EA.prototype=Object.assign(Object.create(BA.prototype),{constructor:EA,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,A=s-o,l=(n-t)/(i-t),c=1-l,h=0;h!==o;++h)r[h]=a[A+h]*c+a[s+h]*l;return r}}),SA.prototype=Object.assign(Object.create(BA.prototype),{constructor:SA,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(TA,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:MA.convertArray(e.times,Array),values:MA.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(TA.prototype,{constructor:TA,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Te,InterpolantFactoryMethodDiscrete:function(e){return new SA(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new EA(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new IA(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Se:t=this.InterpolantFactoryMethodDiscrete;break;case Te:t=this.InterpolantFactoryMethodLinear;break;case Le:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Se;case this.InterpolantFactoryMethodLinear:return Te;case this.InterpolantFactoryMethodSmooth:return Le}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=MA.arraySlice(n,r,a),this.values=MA.arraySlice(this.values,r*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&MA.isTypedArray(i)){o=0;for(var A=i.length;o!==A;++o){var l=i[o];if(isNaN(l)){console.error("KeyframeTrack: Value is not a valid number.",this,o,l),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),i=this.getInterpolation()===Le,r=1,a=e.length-1,o=1;o<a;++o){var s=!1,A=e[o];if(A!==e[o+1]&&(1!==o||A!==A[0]))if(i)s=!0;else for(var l=o*n,c=l-n,h=l+n,u=0;u!==n;++u){var d=t[l+u];if(d!==t[c+u]||d!==t[h+u]){s=!0;break}}if(s){if(o!==r){e[r]=e[o];var f=o*n,p=r*n;for(u=0;u!==n;++u)t[p+u]=t[f+u]}++r}}if(a>0){e[r]=e[a];for(f=a*n,p=r*n,u=0;u!==n;++u)t[p+u]=t[f+u];++r}return r!==e.length&&(this.times=MA.arraySlice(e,0,r),this.values=MA.arraySlice(t,0,r*n)),this},clone:function(){var e=MA.arraySlice(this.times,0),t=MA.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),LA.prototype=Object.assign(Object.create(TA.prototype),{constructor:LA,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Se,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),FA.prototype=Object.assign(Object.create(TA.prototype),{constructor:FA,ValueTypeName:"color"}),_A.prototype=Object.assign(Object.create(TA.prototype),{constructor:_A,ValueTypeName:"number"}),UA.prototype=Object.assign(Object.create(BA.prototype),{constructor:UA,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,A=(n-t)/(i-t),l=s+o;s!==l;s+=4)qe.slerpFlat(r,0,a,s-o,a,s,A);return r}}),PA.prototype=Object.assign(Object.create(TA.prototype),{constructor:PA,ValueTypeName:"quaternion",DefaultInterpolation:Te,InterpolantFactoryMethodLinear:function(e){return new UA(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),kA.prototype=Object.assign(Object.create(TA.prototype),{constructor:kA,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Se,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),DA.prototype=Object.assign(Object.create(TA.prototype),{constructor:DA,ValueTypeName:"vector"}),Object.assign(RA,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(OA(n[r]).scale(i));return new RA(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},r=0,a=n.length;r!==a;++r)t.push(TA.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],A=[];s.push((o+r-1)%r,o,(o+1)%r),A.push(0,1,0);var l=MA.getKeyframeOrder(s);s=MA.sortedArray(s,1,l),A=MA.sortedArray(A,1,l),i||0!==s[0]||(s.push(r),A.push(A[0])),a.push(new _A(".morphTargetInfluences["+t[o].name+"]",s,A).scale(1/n))}return new RA(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],A=s.name.match(r);if(A&&A.length>1){var l=i[h=A[1]];l||(i[h]=l=[]),l.push(s)}}var c=[];for(var h in i)c.push(RA.CreateFromMorphTargetSequence(h,i[h],t,n));return c},parseAnimation:function(e,t){if(!e)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];MA.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],A=0;A<s.length;A++){var l=s[A].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},h=0;h<l.length;h++)if(l[h].morphTargets)for(var u=0;u<l[h].morphTargets.length;u++)c[l[h].morphTargets[u]]=-1;for(var d in c){var f=[],p=[];for(u=0;u!==l[h].morphTargets.length;++u){var m=l[h];f.push(m.time),p.push(m.morphTarget===d?1:0)}i.push(new _A(".morphTargetInfluence["+d+"]",f,p))}a=c.length*(o||1)}else{var g=".bones["+t[A].name+"]";n(DA,g+".position",l,"pos",i),n(PA,g+".quaternion",l,"rot",i),n(DA,g+".scale",l,"scl",i)}}return 0===i.length?null:new RA(r,a,i)}}),Object.assign(RA.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new RA(this.name,this.duration,e)}}),RA.prototype.slice=function(e){var t=[],n=0,i=this;return e.forEach((function(e,r){var a=[];i.tracks.forEach((function(t){var i,r=t.constructor==DA?3:4,o=t.times.toArray().concat([]).slice(e[0],e[1]+1),s=t.values.toArray().concat([]).slice(e[0]*r,(e[1]+1)*r);0==o.length&&(o.push(0),s=t.values.toArray().concat([])),o.forEach((function(e,t){o[t]-=n})),t.constructor==DA?i=new DA(t.name,o,s):t.constructor==PA&&(i=new PA(t.name,o,s)),a.push(i)}));var o=new RA("Take_"+r,-1,a);t.push(o),n=o.duration})),t},Float32Array.prototype.toArray=function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e};var GA=new NA;function QA(e){this.manager=void 0!==e?e:GA,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(QA.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var HA={enabled:!0,files:{},add:function(e,t){!1!==this.enabled&&(e.indexOf("?time=")>-1&&(e=e.substring(0,e.indexOf("?time="))),this.files[e]=t)},get:function(e){if(!1!==this.enabled)return e.indexOf("?time=")>-1&&(e=e.substring(0,e.indexOf("?time="))),this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},zA={};function VA(e){QA.call(this,e)}function jA(e){QA.call(this,e)}function WA(e){QA.call(this,e)}function XA(e){QA.call(this,e)}function ZA(e){QA.call(this,e)}function YA(e){QA.call(this,e)}function KA(e){QA.call(this,e)}function JA(){this.type="Curve",this.arcLengthDivisions=200}function qA(e,t,n,i,r,a,o,s){JA.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function $A(e,t,n,i,r,a){qA.call(this,e,t,n,n,i,r,a),this.type="ArcCurve"}function el(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var A=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,A*=o,l*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}VA.prototype=Object.assign(Object.create(QA.prototype),{constructor:VA,load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this;if(void 0===zA[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var o=a[1],s=!!a[2],A=a[3];A=decodeURIComponent(A),s&&(A=atob(A));try{var l,c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":for(var h=new Uint8Array(A.length),u=0;u<A.length;u++)h[u]=A.charCodeAt(u);l="blob"===c?new Blob([h.buffer],{type:o}):h.buffer;break;case"document":var d=new DOMParser;l=d.parseFromString(A,o);break;case"json":l=JSON.parse(A);break;default:l=A}setTimeout((function(){t&&t(l),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{zA[e]=[],zA[e].push({onLoad:t,onProgress:n,onError:i});var f=new XMLHttpRequest;for(var p in f.open("GET",e,!0),f.addEventListener("load",(function(t){var n=this.response,i=zA[e];if(delete zA[e],200===this.status||0===this.status){0===this.status&&console.warn("FileLoader: HTTP Status 0 received."),HA.add(e,n);for(var a=0,o=i.length;a<o;a++){(s=i[a]).onLoad&&s.onLoad(n)}r.manager.itemEnd(e)}else{for(a=0,o=i.length;a<o;a++){var s;(s=i[a]).onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),f.addEventListener("progress",(function(t){for(var n=zA[e],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(t)}}),!1),f.addEventListener("error",(function(t){var n=zA[e];delete zA[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),f.addEventListener("abort",(function(t){var n=zA[e];delete zA[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(f.responseType=this.responseType),void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials),f.overrideMimeType&&f.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)f.setRequestHeader(p,this.requestHeader[p]);f.send(null)}return r.manager.itemStart(e),f}zA[e].push({onLoad:t,onProgress:n,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),jA.prototype=Object.assign(Object.create(QA.prototype),{constructor:jA,load:function(e,t,n,i){var r=this,a=new VA(r.manager);a.setPath(r.path),a.load(e,(function(e){t(r.parse(JSON.parse(e)))}),n,i)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var i=RA.parse(e[n]);t.push(i)}return t}}),WA.prototype=Object.assign(Object.create(QA.prototype),{constructor:WA,load:function(e,t,n,i){var r=this,a=[],o=new Yo;o.image=a;var s=new VA(this.manager);function A(A){s.load(e[A],(function(e){var n=r.parse(e,!0);a[A]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(o.minFilter=W),o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,c=0,h=e.length;c<h;++c)A(c);else s.load(e,(function(e){var n=r.parse(e,!0);if(n.isCubemap)for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var A=0;A<n.mipmapCount;A++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+A]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=W),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,i);return o}}),XA.prototype=Object.assign(Object.create(QA.prototype),{constructor:XA,load:function(e,t,n,i){var r=this,a=new Gi,o=new VA(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,(function(e){var n=r.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:Q,a.wrapT=void 0!==n.wrapT?n.wrapT:Q,a.magFilter=void 0!==n.magFilter?n.magFilter:W,a.minFilter=void 0!==n.minFilter?n.minFilter:W,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Z),1===n.mipmapCount&&(a.minFilter=W),a.needsUpdate=!0,t&&t(a,n))}),n,i),a}}),ZA.prototype=Object.assign(Object.create(QA.prototype),{constructor:ZA,load:function(e,t,n,i){void 0===this.path||e.startsWith("data:")||(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=HA.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",A,!1),t&&t(this),r.manager.itemEnd(e)}function A(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",A,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return HA.add(e,o),o.addEventListener("load",s,!1),o.addEventListener("error",A,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}),YA.prototype=Object.assign(Object.create(QA.prototype),{constructor:YA,load:function(e,t,n,i){var r=new Ar,a=new ZA(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(var A=0;A<e.length;++A)s(A);return r}}),KA.prototype=Object.assign(Object.create(QA.prototype),{constructor:KA,load:function(e,t,n,i){var r=new st,a=new ZA(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){r.image=n;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?ae:oe,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}),Object.assign(JA.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),a=0;for(i.push(0),n=1;n<=e;n++)a+=(t=this.getPoint(n/e)).distanceTo(r),i.push(a),r=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,A=a-1;s<=A;)if((o=i[r=Math.floor(s+(A-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){A=r;break}A=r-1}if(i[r=A]===n)return r/(a-1);var l=i[r];return(r+(n-l)/(i[r+1]-l))/(a-1)},getTangent:function(e){var t=1e-4,n=e-t,i=e+t;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,i,r,a=new tt,o=[],s=[],A=[],l=new tt,c=new vt;for(n=0;n<=e;n++)i=n/e,o[n]=this.getTangentAt(i),o[n].normalize();s[0]=new tt,A[0]=new tt;var h=Number.MAX_VALUE,u=Math.abs(o[0].x),d=Math.abs(o[0].y),f=Math.abs(o[0].z);for(u<=h&&(h=u,a.set(1,0,0)),d<=h&&(h=d,a.set(0,1,0)),f<=h&&a.set(0,0,1),l.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],l),A[0].crossVectors(o[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),A[n]=A[n-1].clone(),l.crossVectors(o[n-1],o[n]),l.length()>Number.EPSILON&&(l.normalize(),r=Math.acos(Ke.clamp(o[n-1].dot(o[n]),-1,1)),s[n].applyMatrix4(c.makeRotationAxis(l,r))),A[n].crossVectors(o[n],s[n]);if(!0===t)for(r=Math.acos(Ke.clamp(s[0].dot(s[e]),-1,1)),r/=e,o[0].dot(l.crossVectors(s[0],s[e]))>0&&(r=-r),n=1;n<=e;n++)s[n].applyMatrix4(c.makeRotationAxis(o[n],r*n)),A[n].crossVectors(o[n],s[n]);return{tangents:o,normals:s,binormals:A}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),qA.prototype=Object.create(JA.prototype),qA.prototype.constructor=qA,qA.prototype.isEllipseCurve=!0,qA.prototype.getPoint=function(e,t){for(var n=t||new Je,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),A=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,u=A-this.aY;s=h*l-u*c+this.aX,A=h*c+u*l+this.aY}return n.set(s,A)},qA.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},qA.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},qA.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},$A.prototype=Object.create(qA.prototype),$A.prototype.constructor=$A,$A.prototype.isArcCurve=!0;var tl=new tt,nl=new el,il=new el,rl=new el;function al(e,t,n,i){JA.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}function ol(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function sl(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Al(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}function ll(e,t,n,i){JA.call(this),this.type="CubicBezierCurve",this.v0=e||new Je,this.v1=t||new Je,this.v2=n||new Je,this.v3=i||new Je}function cl(e,t,n,i){JA.call(this),this.type="CubicBezierCurve3",this.v0=e||new tt,this.v1=t||new tt,this.v2=n||new tt,this.v3=i||new tt}function hl(e,t){JA.call(this),this.type="LineCurve",this.v1=e||new Je,this.v2=t||new Je}function ul(e,t){JA.call(this),this.type="LineCurve3",this.v1=e||new tt,this.v2=t||new tt}function dl(e,t,n){JA.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Je,this.v1=t||new Je,this.v2=n||new Je}function fl(e,t,n){JA.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new tt,this.v1=t||new tt,this.v2=n||new tt}function pl(e){JA.call(this),this.type="SplineCurve",this.points=e||[]}al.prototype=Object.create(JA.prototype),al.prototype.constructor=al,al.prototype.isCatmullRomCurve3=!0,al.prototype.getPoint=function(e,t){var n,i,r,a,o=t||new tt,s=this.points,A=s.length,l=(A-(this.closed?0:1))*e,c=Math.floor(l),h=l-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/A)+1)*A:0===h&&c===A-1&&(c=A-2,h=1),this.closed||c>0?n=s[(c-1)%A]:(tl.subVectors(s[0],s[1]).add(s[0]),n=tl),i=s[c%A],r=s[(c+1)%A],this.closed||c+2<A?a=s[(c+2)%A]:(tl.subVectors(s[A-1],s[A-2]).add(s[A-1]),a=tl),"centripetal"===this.curveType||"chordal"===this.curveType){var u="chordal"===this.curveType?.5:.25,d=Math.pow(n.distanceToSquared(i),u),f=Math.pow(i.distanceToSquared(r),u),p=Math.pow(r.distanceToSquared(a),u);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),nl.initNonuniformCatmullRom(n.x,i.x,r.x,a.x,d,f,p),il.initNonuniformCatmullRom(n.y,i.y,r.y,a.y,d,f,p),rl.initNonuniformCatmullRom(n.z,i.z,r.z,a.z,d,f,p)}else"catmullrom"===this.curveType&&(nl.initCatmullRom(n.x,i.x,r.x,a.x,this.tension),il.initCatmullRom(n.y,i.y,r.y,a.y,this.tension),rl.initCatmullRom(n.z,i.z,r.z,a.z,this.tension));return o.set(nl.calc(h),il.calc(h),rl.calc(h)),o},al.prototype.copy=function(e){JA.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},al.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},al.prototype.fromJSON=function(e){JA.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new tt).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ll.prototype=Object.create(JA.prototype),ll.prototype.constructor=ll,ll.prototype.isCubicBezierCurve=!0,ll.prototype.getPoint=function(e,t){var n=t||new Je,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Al(e,i.x,r.x,a.x,o.x),Al(e,i.y,r.y,a.y,o.y)),n},ll.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},ll.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},ll.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},cl.prototype=Object.create(JA.prototype),cl.prototype.constructor=cl,cl.prototype.isCubicBezierCurve3=!0,cl.prototype.getPoint=function(e,t){var n=t||new tt,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Al(e,i.x,r.x,a.x,o.x),Al(e,i.y,r.y,a.y,o.y),Al(e,i.z,r.z,a.z,o.z)),n},cl.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},cl.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},cl.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},hl.prototype=Object.create(JA.prototype),hl.prototype.constructor=hl,hl.prototype.isLineCurve=!0,hl.prototype.getPoint=function(e,t){var n=t||new Je;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},hl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},hl.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},hl.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},hl.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},hl.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ul.prototype=Object.create(JA.prototype),ul.prototype.constructor=ul,ul.prototype.isLineCurve3=!0,ul.prototype.getPoint=function(e,t){var n=t||new tt;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},ul.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ul.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ul.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ul.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},dl.prototype=Object.create(JA.prototype),dl.prototype.constructor=dl,dl.prototype.isQuadraticBezierCurve=!0,dl.prototype.getPoint=function(e,t){var n=t||new Je,i=this.v0,r=this.v1,a=this.v2;return n.set(sl(e,i.x,r.x,a.x),sl(e,i.y,r.y,a.y)),n},dl.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},dl.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},dl.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},fl.prototype=Object.create(JA.prototype),fl.prototype.constructor=fl,fl.prototype.isQuadraticBezierCurve3=!0,fl.prototype.getPoint=function(e,t){var n=t||new tt,i=this.v0,r=this.v1,a=this.v2;return n.set(sl(e,i.x,r.x,a.x),sl(e,i.y,r.y,a.y),sl(e,i.z,r.z,a.z)),n},fl.prototype.copy=function(e){return JA.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},fl.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},fl.prototype.fromJSON=function(e){return JA.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},pl.prototype=Object.create(JA.prototype),pl.prototype.constructor=pl,pl.prototype.isSplineCurve=!0,pl.prototype.getPoint=function(e,t){var n=t||new Je,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],A=i[a],l=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return n.set(ol(o,s.x,A.x,l.x,c.x),ol(o,s.y,A.y,l.y,c.y)),n},pl.prototype.copy=function(e){JA.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this},pl.prototype.toJSON=function(){var e=JA.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e},pl.prototype.fromJSON=function(e){JA.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new Je).fromArray(i))}return this};var ml=Object.freeze({__proto__:null,ArcCurve:$A,CatmullRomCurve3:al,CubicBezierCurve:ll,CubicBezierCurve3:cl,EllipseCurve:qA,LineCurve:hl,LineCurve3:ul,QuadraticBezierCurve:dl,QuadraticBezierCurve3:fl,SplineCurve:pl});function gl(){JA.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function vl(e){gl.call(this),this.type="Path",this.currentPoint=new Je,e&&this.setFromPoints(e)}function yl(e){vl.call(this,e),this.uuid=Ke.generateUUID(),this.type="Shape",this.holes=[]}function wl(e,t){Dt.call(this),this.type="Light",this.color=new Sn(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function xl(e,t,n){wl.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Dt.DefaultUp),this.updateMatrix(),this.groundColor=new Sn(t)}function bl(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Je(512,512),this.map=null,this.mapPass=null,this.matrix=new vt,this._frustum=new zi,this._frameExtents=new Je(1,1),this._viewportCount=1,this._viewports=[new At(0,0,1,1)]}function Cl(){bl.call(this,new Di(50,1,.5,500))}function Ml(e,t,n,i,r,a){wl.call(this,e,t),this.type="SpotLight",this.position.copy(Dt.DefaultUp),this.updateMatrix(),this.target=new Dt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new Cl}function Bl(){bl.call(this,new Di(90,1,.5,500)),this._frameExtents=new Je(4,2),this._viewportCount=6,this._viewports=[new At(2,1,1,1),new At(0,1,1,1),new At(3,1,1,1),new At(1,1,1,1),new At(3,0,1,1),new At(1,0,1,1)],this._cubeDirections=[new tt(1,0,0),new tt(-1,0,0),new tt(0,0,1),new tt(0,0,-1),new tt(0,1,0),new tt(0,-1,0)],this._cubeUps=[new tt(0,1,0),new tt(0,1,0),new tt(0,1,0),new tt(0,1,0),new tt(0,0,1),new tt(0,0,-1)]}function Il(e,t,n,i){wl.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new Bl}function El(e,t,n,i,r,a){ki.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function Sl(){bl.call(this,new El(-5,5,5,-5,.5,500))}function Tl(e,t){wl.call(this,e,t),this.type="DirectionalLight",this.position.copy(Dt.DefaultUp),this.updateMatrix(),this.target=new Dt,this.shadow=new Sl}function Ll(e,t){wl.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Fl(e,t,n,i){wl.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function _l(e){QA.call(this,e),this.textures={}}gl.prototype=Object.assign(Object.create(JA.prototype),{constructor:gl,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new hl(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var r=n[i]-t,a=this.curves[i],o=a.getLength(),s=0===o?0:1-r/o;return a.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),A=0;A<s.length;A++){var l=s[A];t&&t.equals(l)||(n.push(l),t=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){JA.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=JA.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){JA.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push((new ml[i.type]).fromJSON(i))}return this}}),vl.prototype=Object.assign(Object.create(gl.prototype),{constructor:vl,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new hl(this.currentPoint.clone(),new Je(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,i){var r=new dl(this.currentPoint.clone(),new Je(e,t),new Je(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(e,t,n,i,r,a){var o=new ll(this.currentPoint.clone(),new Je(e,t),new Je(n,i),new Je(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this},splineThru:function(e){var t=new pl([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this},absarc:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this},ellipse:function(e,t,n,i,r,a,o,s){var A=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+A,t+l,n,i,r,a,o,s),this},absellipse:function(e,t,n,i,r,a,o,s){var A=new qA(e,t,n,i,r,a,o,s);if(this.curves.length>0){var l=A.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(A);var c=A.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return gl.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=gl.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return gl.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),yl.prototype=Object.assign(Object.create(vl.prototype),{constructor:yl,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){vl.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=vl.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){vl.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push((new vl).fromJSON(i))}return this}}),wl.prototype=Object.assign(Object.create(Dt.prototype),{constructor:wl,isLight:!0,copy:function(e){return Dt.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Dt.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),xl.prototype=Object.assign(Object.create(wl.prototype),{constructor:xl,isHemisphereLight:!0,copy:function(e){return wl.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(bl.prototype,{_projScreenMatrix:new vt,_lightPositionWorld:new tt,_lookTarget:new tt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),r.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Cl.prototype=Object.assign(Object.create(bl.prototype),{constructor:Cl,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*Ke.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),bl.prototype.updateMatrices.call(this,e)}}),Ml.prototype=Object.assign(Object.create(wl.prototype),{constructor:Ml,isSpotLight:!0,copy:function(e){return wl.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Bl.prototype=Object.assign(Object.create(bl.prototype),{constructor:Bl,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var n=this.camera,i=this.matrix,r=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;r.setFromMatrixPosition(e.matrixWorld),n.position.copy(r),a.copy(n.position),a.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(a),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromMatrix(o)}}),Il.prototype=Object.assign(Object.create(wl.prototype),{constructor:Il,isPointLight:!0,copy:function(e){return wl.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),El.prototype=Object.assign(Object.create(ki.prototype),{constructor:El,isOrthographicCamera:!0,copy:function(e,t){return ki.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var A=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;a=(r+=c*(this.view.offsetX/A))+c*(this.view.width/A),s=(o-=h*(this.view.offsetY/l))-h*(this.view.height/l)}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Dt.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Sl.prototype=Object.assign(Object.create(bl.prototype),{constructor:Sl,isDirectionalLightShadow:!0,updateMatrices:function(e){bl.prototype.updateMatrices.call(this,e)}}),Tl.prototype=Object.assign(Object.create(wl.prototype),{constructor:Tl,isDirectionalLight:!0,copy:function(e){return wl.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ll.prototype=Object.assign(Object.create(wl.prototype),{constructor:Ll,isAmbientLight:!0}),Fl.prototype=Object.assign(Object.create(wl.prototype),{constructor:Fl,isRectAreaLight:!0,copy:function(e){return wl.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=wl.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),_l.prototype=Object.assign(Object.create(QA.prototype),{constructor:_l,load:function(e,t,n,i){var r=this,a=new VA(r.manager);a.setPath(r.path),a.load(e,(function(e){t(r.parse(JSON.parse(e)))}),n,i)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("MaterialLoader: Undefined texture",e),t[e]}var i=new CA[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new Sn).setHex(e.sheen)),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(i.vertexColors=e.vertexColors),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.uniforms)for(var r in e.uniforms){var a=e.uniforms[r];switch(i.uniforms[r]={},a.type){case"t":i.uniforms[r].value=n(a.value);break;case"c":i.uniforms[r].value=(new Sn).setHex(a.value);break;case"v2":i.uniforms[r].value=(new Je).fromArray(a.value);break;case"v3":i.uniforms[r].value=(new tt).fromArray(a.value);break;case"v4":i.uniforms[r].value=(new At).fromArray(a.value);break;case"m3":i.uniforms[r].value=(new rt).fromArray(a.value);case"m4":i.uniforms[r].value=(new vt).fromArray(a.value);break;default:i.uniforms[r].value=a.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)i.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap),i.transparent=!0),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new Je).fromArray(s)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Je).fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});var Ul={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Pl(){ni.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function kl(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Dn.call(this,e,t,n),this.meshPerAttribute=i||1}function Dl(e){QA.call(this,e)}Pl.prototype=Object.assign(Object.create(ni.prototype),{constructor:Pl,isInstancedBufferGeometry:!0,copy:function(e){return ni.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=ni.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),kl.prototype=Object.assign(Object.create(Dn.prototype),{constructor:kl,isInstancedBufferAttribute:!0,copy:function(e){return Dn.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Dn.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Dl.prototype=Object.assign(Object.create(QA.prototype),{constructor:Dl,load:function(e,t,n,i){var r=this,a=new VA(r.manager);a.setPath(r.path),a.load(e,(function(e){t(r.parse(JSON.parse(e)))}),n,i)},parse:function(e){var t=e.isInstancedBufferGeometry?new Pl:new ni,n=e.data.index;if(void 0!==n){var i=new Rl[n.type](n.array);t.setIndex(new Dn(i,1))}var r=e.data.attributes;for(var a in r){var o=r[a],s=(i=new Rl[o.type](o.array),new(o.isInstancedBufferAttribute?kl:Dn)(i,o.itemSize,o.normalized));void 0!==o.name&&(s.name=o.name),t.setAttribute(a,s)}var A=e.data.morphAttributes;if(A)for(var a in A){for(var l=A[a],c=[],h=0,u=l.length;h<u;h++){o=l[h],s=new Dn(i=new Rl[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),c.push(s)}t.morphAttributes[a]=c}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var d=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==d){h=0;for(var f=d.length;h!==f;++h){var p=d[h];t.addGroup(p.start,p.count,p.materialIndex)}}var m=e.data.boundingSphere;if(void 0!==m){var g=new tt;void 0!==m.center&&g.fromArray(m.center),t.boundingSphere=new en(g,m.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var Rl={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ol(e){QA.call(this,e)}Ol.prototype=Object.assign(Object.create(QA.prototype),{constructor:Ol,load:function(e,t,n,i){var r=this,a=""===this.path?Ul.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new VA(r.manager);o.setPath(this.path),o.load(e,(function(n){var a=null;try{a=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(a,t):console.error("ObjectLoader: Can't load "+e)}),n,i)},parse:function(e,t){var n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,i,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=(new yl).fromJSON(e[n]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var i=new Dl,r=0,a=e.length;r<a;r++){var o,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new cA[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new cA[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new cA[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new cA[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new cA[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new cA[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new cA[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new cA[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new cA[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new cA[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new cA[s.type]((new ml[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new cA[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new cA[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var A=[],l=0,c=s.shapes.length;l<c;l++){var h=t[s.shapes[l]];A.push(h)}o=new cA[s.type](A,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(A=[],l=0,c=s.shapes.length;l<c;l++){h=t[s.shapes[l]];A.push(h)}var u=s.options.extrudePath;void 0!==u&&(s.options.extrudePath=(new ml[u.type]).fromJSON(u)),o=new cA[s.type](A,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n},parseMaterials:function(e,t){var n={},i={};if(void 0!==e){var r=new _l;r.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var A=[],l=0;l<s.materials.length;l++){var c=s.materials[l];void 0===n[c.uuid]&&(n[c.uuid]=r.parse(c)),A.push(n[c.uuid])}i[s.uuid]=A}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=RA.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),t.push(r)}return t},parseImages:function(e,t){var n=this,i={};function r(e){return n.manager.itemStart(e),a.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var a=new ZA(new NA(t));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=e.length;o<s;o++){var A=e[o],l=A.url;if(Array.isArray(l)){i[A.uuid]=[];for(var c=0,h=l.length;c<h;c++){var u=l[c],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;i[A.uuid].push(r(d))}}else{d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(A.url)?A.url:n.resourcePath+A.url;i[A.uuid]=r(d)}}}return i},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,a=e.length;r<a;r++){var o,s=e[r];void 0===s.image&&console.warn('ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new Ar(t[s.image]):new st(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,Gl)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],Ql),o.wrapT=n(s.wrap[1],Ql)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,Hl)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,Hl)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),i[s.uuid]=o}return i},parseObject:function(e,t,n){var i;function r(e){return void 0===t[e]&&console.warn("ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var a=e[i];void 0===n[a]&&console.warn("ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":i=new Rt,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Sn(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new qa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new Ja(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Di(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new El(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Ll(e.color,e.intensity);break;case"DirectionalLight":i=new Tl(e.color,e.intensity);break;case"PointLight":i=new Il(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new Fl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Ml(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new xl(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=r(e.geometry),s=a(e.material);i=o.bones&&o.bones.length>0?new wo(o,s):new xi(o,s);break;case"InstancedMesh":o=r(e.geometry),s=a(e.material);var A=e.count,l=e.instanceMatrix;(i=new Lo(o,s,A)).instanceMatrix=new Dn(new Float32Array(l.array),16);break;case"LOD":i=new yo;break;case"Line":i=new Ro(r(e.geometry),a(e.material),e.mode);break;case"LineLoop":i=new Qo(r(e.geometry),a(e.material));break;case"LineSegments":i=new Go(r(e.geometry),a(e.material));break;case"PointCloud":case"Points":i=new Xo(r(e.geometry),a(e.material));break;case"Sprite":i=new po(a(e.material));break;case"Group":i=new Ha;break;default:i=new Dt}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.drawMode&&i.setDrawMode(e.drawMode),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)i.add(this.parseObject(c[h],t,n));if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var u=e.levels,d=0;d<u.length;d++){var f=u[d],p=i.getObjectByProperty("uuid",f.object);void 0!==p&&i.addLevel(p,f.distance)}}return i}});var Nl,Gl={UVMapping:P,CubeReflectionMapping:k,CubeRefractionMapping:D,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:R,SphericalReflectionMapping:305,CubeUVReflectionMapping:O,CubeUVRefractionMapping:N},Ql={RepeatWrapping:G,ClampToEdgeWrapping:Q,MirroredRepeatWrapping:H},Hl={NearestFilter:z,NearestMipmapNearestFilter:V,NearestMipmapLinearFilter:j,LinearFilter:W,LinearMipmapNearestFilter:X,LinearMipmapLinearFilter:Z};function zl(e){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),QA.call(this,e),this.options=void 0}function Vl(){this.type="ShapePath",this.color=new Sn,this.subPaths=[],this.currentPath=null}function jl(e){this.type="Font",this.data=e}function Wl(e,t,n,i,r){var a=r.glyphs[e]||r.glyphs["?"];if(a){var o,s,A,l,c,h,u,d,f=new Vl;if(a.o)for(var p=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),m=0,g=p.length;m<g;){switch(p[m++]){case"m":o=p[m++]*t+n,s=p[m++]*t+i,f.moveTo(o,s);break;case"l":o=p[m++]*t+n,s=p[m++]*t+i,f.lineTo(o,s);break;case"q":A=p[m++]*t+n,l=p[m++]*t+i,c=p[m++]*t+n,h=p[m++]*t+i,f.quadraticCurveTo(c,h,A,l);break;case"b":A=p[m++]*t+n,l=p[m++]*t+i,c=p[m++]*t+n,h=p[m++]*t+i,u=p[m++]*t+n,d=p[m++]*t+i,f.bezierCurveTo(c,h,u,d,A,l)}}return{offsetX:a.ha*t,path:f}}console.error('Font: character "'+e+'" does not exists in font family '+r.familyName+".")}function Xl(e){QA.call(this,e)}zl.prototype=Object.assign(Object.create(QA.prototype),{constructor:zl,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=HA.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===r.options?createImageBitmap(e):createImageBitmap(e,r.options)})).then((function(n){HA.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}),Object.assign(Vl.prototype,{moveTo:function(e,t){return this.currentPath=new vl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this},bezierCurveTo:function(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new yl;a.curves=r.curves,t.push(a)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],A=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=t[a],A=-A,s=t[r],l=-l),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=l*(e.x-o.x)-A*(e.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var r=Ns.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return n(a);var o,s,A,l=[];if(1===a.length)return s=a[0],(A=new yl).curves=s.curves,l.push(A),l;var c=!r(a[0].getPoints());c=e?!c:c;var h,u,d=[],f=[],p=[],m=0;f[m]=void 0,p[m]=[];for(var g=0,v=a.length;g<v;g++)o=r(h=(s=a[g]).getPoints()),(o=e?!o:o)?(!c&&f[m]&&m++,f[m]={s:new yl,p:h},f[m].s.curves=s.curves,c&&m++,p[m]=[]):p[m].push({h:s,p:h[0]});if(!f[0])return n(a);if(f.length>1){for(var y=!1,w=[],x=0,b=f.length;x<b;x++)d[x]=[];for(x=0,b=f.length;x<b;x++)for(var C=p[x],M=0;M<C.length;M++){for(var B=C[M],I=!0,E=0;E<f.length;E++)i(B.p,f[E].p)&&(x!==E&&w.push({froms:x,tos:E,hole:M}),I?(I=!1,d[E].push(B)):y=!0);I&&d[x].push(B)}w.length>0&&(y||(p=d))}g=0;for(var S=f.length;g<S;g++){A=f[g].s,l.push(A);for(var T=0,L=(u=p[g]).length;T<L;T++)A.holes.push(u[T].h)}return l}}),Object.assign(jl.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],i=function(e,t,n){for(var i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=[],s=0,A=0,l=0;l<i.length;l++){var c=i[l];if("\n"===c)s=0,A-=a;else{var h=Wl(c,r,s,A,n);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),r=0,a=i.length;r<a;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),Xl.prototype=Object.assign(Object.create(QA.prototype),{constructor:Xl,load:function(e,t,n,i){var r=this,a=new VA(this.manager);a.setPath(this.path),a.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var i=r.parse(n);t&&t(i)}),n,i)},parse:function(e){return new jl(e)}});var Zl={getContext:function(){return void 0===Nl&&(Nl=new(window.AudioContext||window.webkitAudioContext)),Nl},setContext:function(e){Nl=e}};function Yl(e){QA.call(this,e)}function Kl(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new tt)}function Jl(e,t){wl.call(this,void 0,t),this.sh=void 0!==e?e:new Kl}function ql(e,t,n){Jl.call(this,void 0,n);var i=(new Sn).set(e),r=(new Sn).set(t),a=new tt(i.r,i.g,i.b),o=new tt(r.r,r.g,r.b),s=Math.sqrt(Math.PI),A=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(A)}function $l(e,t){Jl.call(this,void 0,t);var n=(new Sn).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Yl.prototype=Object.assign(Object.create(QA.prototype),{constructor:Yl,load:function(e,t,n,i){var r=new VA(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(e,(function(e){var n=e.slice(0);Zl.getContext().decodeAudioData(n,(function(e){t(e)}))}),n,i)}}),Object.assign(Kl.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScale(a[1],.488603*i),t.addScale(a[2],.488603*r),t.addScale(a[3],.488603*n),t.addScale(a[4],n*i*1.092548),t.addScale(a[5],i*r*1.092548),t.addScale(a[6],.315392*(3*r*r-1)),t.addScale(a[7],n*r*1.092548),t.addScale(a[8],.546274*(n*n-i*i)),t},getIrradianceAt:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScale(a[1],1.023328*i),t.addScale(a[2],1.023328*r),t.addScale(a[3],1.023328*n),t.addScale(a[4],.858086*n*i),t.addScale(a[5],.858086*i*r),t.addScale(a[6],.743125*r*r-.247708),t.addScale(a[7],.858086*n*r),t.addScale(a[8],.429043*(n*n-i*i)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}),Object.assign(Kl,{getBasisAt:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}),Jl.prototype=Object.assign(Object.create(wl.prototype),{constructor:Jl,isLightProbe:!0,copy:function(e){return wl.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return wl.prototype.toJSON.call(this,e)}}),ql.prototype=Object.assign(Object.create(Jl.prototype),{constructor:ql,isHemisphereLightProbe:!0,copy:function(e){return Jl.prototype.copy.call(this,e),this},toJSON:function(e){return Jl.prototype.toJSON.call(this,e)}}),$l.prototype=Object.assign(Object.create(Jl.prototype),{constructor:$l,isAmbientLightProbe:!0,copy:function(e){return Jl.prototype.copy.call(this,e),this},toJSON:function(e){return Jl.prototype.toJSON.call(this,e)}});var ec=new vt,tc=new vt;function nc(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Di,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Di,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function ic(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(nc.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,i,r=e.projectionMatrix.clone(),a=t.eyeSep/2,o=a*t.near/t.focus,s=t.near*Math.tan(Ke.DEG2RAD*t.fov*.5)/t.zoom;tc.elements[12]=-a,ec.elements[12]=a,n=-s*t.aspect+o,i=s*t.aspect+o,r.elements[0]=2*t.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(r),n=-s*t.aspect-o,i=s*t.aspect-o,r.elements[0]=2*t.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(tc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ec)}}),Object.assign(ic.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var rc=new tt,ac=new qe,oc=new tt,sc=new tt;function Ac(){Dt.call(this),this.type="AudioListener",this.context=Zl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ic}function lc(e){Dt.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Ac.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Ac,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){Dt.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(rc,ac,oc),sc.set(0,0,-1).applyQuaternion(ac),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(rc.x,i),t.positionY.linearRampToValueAtTime(rc.y,i),t.positionZ.linearRampToValueAtTime(rc.z,i),t.forwardX.linearRampToValueAtTime(sc.x,i),t.forwardY.linearRampToValueAtTime(sc.y,i),t.forwardZ.linearRampToValueAtTime(sc.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(rc.x,rc.y,rc.z),t.setOrientation(sc.x,sc.y,sc.z,n.x,n.y,n.z)}}),lc.prototype=Object.assign(Object.create(Dt.prototype),{constructor:lc,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var cc=new tt,hc=new qe,uc=new tt,dc=new tt;function fc(e){lc.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function pc(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function mc(e,t,n){this.binding=e,this.valueSize=n;var i,r=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":r=Array,i=this._select;break;default:i=this._lerp}this.buffer=new r(4*n),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}fc.prototype=Object.assign(Object.create(lc.prototype),{constructor:fc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(Dt.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(cc,hc,uc),dc.set(0,0,1).applyQuaternion(hc);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(cc.x,n),t.positionY.linearRampToValueAtTime(cc.y,n),t.positionZ.linearRampToValueAtTime(cc.z,n),t.orientationX.linearRampToValueAtTime(dc.x,n),t.orientationY.linearRampToValueAtTime(dc.y,n),t.orientationZ.linearRampToValueAtTime(dc.z,n)}else t.setPosition(cc.x,cc.y,cc.z),t.setOrientation(dc.x,dc.y,dc.z)}}}),Object.assign(pc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(mc.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,r<1){var o=3*t;this._mixBufferRegion(n,i,o,1-r,t)}for(var s=t,A=t+t;s!==A;++s)if(n[s]!==n[s+t]){a.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=3*n;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,i){qe.slerpFlat(e,t,e,t,e,n,i)},_lerp:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}});var gc="\\[\\]\\.:\\/",vc=new RegExp("[\\[\\]\\.:\\/]","g"),yc="[^\\[\\]\\.:\\/]",wc="[^"+gc.replace("\\.","")+"]",xc=/((?:WC+[\/:])*)/.source.replace("WC",yc),bc=/(WCOD+)?/.source.replace("WCOD",wc),Cc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",yc),Mc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",yc),Bc=new RegExp("^"+xc+bc+Cc+Mc+"$"),Ic=["material","materials","bones"];function Ec(e,t,n){var i=n||Sc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Sc(e,t,n){this.path=t,this.parsedPath=n||Sc.parseTrackName(t),this.node=Sc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Tc(){this.uuid=Ke.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function Lc(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var i=t.tracks,r=i.length,a=new Array(r),o={endingStart:Fe,endingEnd:Fe},s=0;s!==r;++s){var A=i[s].createInterpolant(null);a[s]=A,A.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ee,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Fc(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function _c(e){"string"==typeof e&&(console.warn("Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Uc(e,t,n){$a.call(this,e,t),this.meshPerAttribute=n||1}function Pc(e,t,n,i){this.ray=new ln(e,t),this.near=n||0,this.far=i||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function kc(e,t){return e.distance-t.distance}function Dc(e,t,n,i){if(!1!==e.visible&&!e.isAmrtAlphaHotSpotEntity&&(e.raycast(t,n),!0===i))for(var r=e.children,a=0,o=r.length;a<o;a++)Dc(r[a],t,n,!0)}function Rc(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function Oc(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}Object.assign(Ec.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Sc,{Composite:Ec,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Sc.Composite(e,t,n):new Sc(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(vc,"")},parseTrackName:function(e){var t=Bc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==Ic.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}),Object.assign(Sc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Sc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[i];if(void 0!==s){var A=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?A=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(A=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===r){r=o;break}}else{if(!e.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===r){r=o;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][A]}else{var c=t.nodeName;console.error("PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e)}}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Sc.prototype,{_getValue_unbound:Sc.prototype.getValue,_setValue_unbound:Sc.prototype.setValue}),Object.assign(Tc.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,A=void 0,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],u=h.uuid,d=i[u];if(void 0===d){d=t++,i[u]=d,e.push(h);for(var f=0,p=s;f!==p;++f)o[f].push(new Sc(h,r[f],a[f]))}else if(d<n){A=e[d];var m=--n,g=e[m];i[g.uuid]=d,e[d]=g,i[u]=m,e[m]=h;for(f=0,p=s;f!==p;++f){var v=o[f],y=v[m],w=v[d];v[d]=y,void 0===w&&(w=new Sc(h,r[f],a[f])),v[m]=w}}else e[d]!==A&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,r=i.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],A=s.uuid,l=n[A];if(void 0!==l&&l>=t){var c=t++,h=e[c];n[h.uuid]=l,e[l]=h,n[A]=c,e[c]=s;for(var u=0,d=r;u!==d;++u){var f=i[u],p=f[c],m=f[l];f[l]=p,f[c]=m}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,a=r.length,o=0,s=arguments.length;o!==s;++o){var A=arguments[o],l=A.uuid,c=i[l];if(void 0!==c)if(delete i[l],c<n){var h=--n,u=e[h],d=e[v=--t];i[u.uuid]=c,e[c]=u,i[d.uuid]=h,e[h]=d,e.pop();for(var f=0,p=a;f!==p;++f){var m=(y=r[f])[h],g=y[v];y[c]=m,y[h]=g,y.pop()}}else{var v;i[(d=e[v=--t]).uuid]=c,e[c]=d,e.pop();for(f=0,p=a;f!==p;++f){var y;(y=r[f])[c]=y[v],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,A=s.length,l=this.nCachedObjects_,c=new Array(A);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(c);for(var h=l,u=s.length;h!==u;++h){var d=s[h];c[h]=new Sc(d,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}),Object.assign(Lc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var i=this._mixer,r=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,A=a.sampleValues;return s[0]=r,s[1]=r+n,A[0]=e/o,A[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var A=this._interpolants,l=this._propertyBindings,c=0,h=A.length;c!==h;++c)A[c].evaluate(o),l[c].accumulate(i,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,i=this.loop,r=this._loopCount,a=2202===i;if(0===e)return-1===r?t:a&&1==(1&r)?n-t:t;if(i===Ie){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=n||t<0){var o=Math.floor(t/n);t-=n*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var A=e<0;this._setEndings(A,!A,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&1==(1&r))return n-t}return t},_setEndings:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=_e,i.endingEnd=_e):(i.endingStart=e?this.zeroSlopeAtStart?_e:Fe:Ue,i.endingEnd=t?this.zeroSlopeAtEnd?_e:Fe:Ue)},_scheduleFading:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}),Fc.prototype=Object.assign(Object.create(Xe.prototype),{constructor:Fc,_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,A=this._bindingsByRootAndName,l=A[s];void 0===l&&(l={},A[s]=l);for(var c=0;c!==r;++c){var h=i[c],u=h.name,d=l[u];if(void 0!==d)a[c]=d;else{if(void 0!==(d=a[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,u));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;++(d=new mc(Sc.create(n,u,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,u),a[c]=d}o[c].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,A=s[s.length-1],l=e._byClipCacheIndex;A._byClipCacheIndex=l,s[l]=A,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,r=i[t],a=this._bindings;void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],A=e._cacheIndex;s._cacheIndex=A,t[A]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new EA(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?RA.findByName(n,e):e,a=null!==r?r.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var A=o.actionByRoot[i];if(void 0!==A)return A;s=o.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var l=new Lc(this,r,t);return this._bindAction(l,s),this._addInactiveAction(l,a,i),l},existingAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?RA.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==t;++r)e[r].reset();for(r=0;r!==i;++r)n[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}var s=this._bindings,A=this._nActiveBindings;for(o=0;o!==A;++o)s[o].apply(a);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var A=a[o];this._deactivateAction(A);var l=A._cacheIndex,c=t[t.length-1];A._cacheIndex=null,A._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(A)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),_c.prototype.clone=function(){return new _c(void 0===this.value.clone?this.value:this.value.clone())},Uc.prototype=Object.assign(Object.create($a.prototype),{constructor:Uc,isInstancedInterleavedBuffer:!0,copy:function(e){return $a.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Pc.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var i=n||[];return Dc(e,this,i,t),i.sort(kc),i},intersectObjects:function(e,t,n){var i=n||[];if(!1===Array.isArray(e))return console.warn("Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,a=e.length;r<a;r++)Dc(e[r],this,i,t);return i.sort(kc),i}}),Object.assign(Rc.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ke.clamp(t/this.radius,-1,1))),this}}),Object.assign(Oc.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var Nc=new Je;function Gc(e,t){this.min=void 0!==e?e:new Je(1/0,1/0),this.max=void 0!==t?t:new Je(-1/0,-1/0)}Object.assign(Gc.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=Nc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(e=new Je),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(e=new Je),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(t=new Je),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(t=new Je),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Nc.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Qc=new tt,Hc=new tt;function zc(e,t){this.start=void 0!==e?e:new tt,this.end=void 0!==t?t:new tt}function Vc(e){Dt.call(this),this.material=e,this.render=function(){}}Object.assign(zc.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("Line3: .getCenter() target is now required"),e=new tt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("Line3: .delta() target is now required"),e=new tt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("Line3: .at() target is now required"),t=new tt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Qc.subVectors(e,this.start),Hc.subVectors(this.end,this.start);var n=Hc.dot(Hc),i=Hc.dot(Qc)/n;return t&&(i=Ke.clamp(i,0,1)),i},closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("Line3: .closestPointToPoint() target is now required"),n=new tt),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Vc.prototype=Object.create(Dt.prototype),Vc.prototype.constructor=Vc,Vc.prototype.isImmediateRenderObject=!0;var jc=new tt,Wc=new tt,Xc=new rt,Zc=["a","b","c"];function Yc(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var A=new ni,l=new Vn(2*o*3,3);A.setAttribute("position",l),Go.call(this,A,new Fo({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}Yc.prototype=Object.create(Go.prototype),Yc.prototype.constructor=Yc,Yc.prototype.update=function(){this.object.updateMatrixWorld(!0),Xc.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var i=n.vertices,r=n.faces,a=0,o=0,s=r.length;o<s;o++)for(var A=r[o],l=0,c=A.vertexNormals.length;l<c;l++){var h=i[A[Zc[l]]],u=A.vertexNormals[l];jc.copy(h).applyMatrix4(e),Wc.copy(u).applyMatrix3(Xc).normalize().multiplyScalar(this.size).add(jc),t.setXYZ(a,jc.x,jc.y,jc.z),a+=1,t.setXYZ(a,Wc.x,Wc.y,Wc.z),a+=1}else if(n&&n.isBufferGeometry){var d=n.attributes.position,f=n.attributes.normal;for(a=0,l=0,c=d.count;l<c;l++)jc.set(d.getX(l),d.getY(l),d.getZ(l)).applyMatrix4(e),Wc.set(f.getX(l),f.getY(l),f.getZ(l)),Wc.applyMatrix3(Xc).normalize().multiplyScalar(this.size).add(jc),t.setXYZ(a,jc.x,jc.y,jc.z),a+=1,t.setXYZ(a,Wc.x,Wc.y,Wc.z),a+=1}t.needsUpdate=!0};var Kc=new tt;function Jc(e,t){Dt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new ni,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,a=1;r<32;r++,a++){var o=r/32*Math.PI*2,s=a/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Vn(i,3));var A=new Fo({fog:!1});this.cone=new Go(n,A),this.add(this.cone),this.update()}Jc.prototype=Object.create(Dt.prototype),Jc.prototype.constructor=Jc,Jc.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Jc.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Kc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Kc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var qc=new tt,$c=new vt,eh=new vt;function th(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,th(e.children[n]));return t}function nh(e){for(var t=th(e),n=new ni,i=[],r=[],a=new Sn(0,0,1),o=new Sn(0,1,0),s=0;s<t.length;s++){var A=t[s];A.parent&&A.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(a.r,a.g,a.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new Vn(i,3)),n.setAttribute("color",new Vn(r,3));var l=new Fo({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Go.call(this,n,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function ih(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var i=new Ys(t,4,2),r=new kn({wireframe:!0,fog:!1});xi.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function rh(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var n=new ni;n.setAttribute("position",new Vn([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere();var i=new Fo({fog:!1});Ro.call(this,n,i);var r=new ni;r.setAttribute("position",new Vn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new xi(r,new kn({side:1,fog:!1}))),this.update()}nh.prototype=Object.create(Go.prototype),nh.prototype.constructor=nh,nh.prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,i=n.getAttribute("position");eh.getInverse(this.root.matrixWorld);for(var r=0,a=0;r<t.length;r++){var o=t[r];o.parent&&o.parent.isBone&&($c.multiplyMatrices(eh,o.matrixWorld),qc.setFromMatrixPosition($c),i.setXYZ(a,qc.x,qc.y,qc.z),$c.multiplyMatrices(eh,o.parent.matrixWorld),qc.setFromMatrixPosition($c),i.setXYZ(a+1,qc.x,qc.y,qc.z),a+=2)}n.getAttribute("position").needsUpdate=!0,Dt.prototype.updateMatrixWorld.call(this,e)},ih.prototype=Object.create(xi.prototype),ih.prototype.constructor=ih,ih.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ih.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},rh.prototype=Object.create(Ro.prototype),rh.prototype.constructor=rh,rh.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},rh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var ah=new tt,oh=new Sn,sh=new Sn;function Ah(e,t,n){Dt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var i=new os(t);i.rotateY(.5*Math.PI),this.material=new kn({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var r=i.getAttribute("position"),a=new Float32Array(3*r.count);i.setAttribute("color",new Dn(a,3)),this.add(new xi(i,this.material)),this.update()}function lh(e,t){this.lightProbe=e,this.size=t;var n={GAMMA_OUTPUT:""},i=new Pi({defines:n,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),r=new Ys(1,32,16);xi.call(this,r,i),this.onBeforeRender()}function ch(e,t,n,i){e=e||10,t=t||10,n=new Sn(void 0!==n?n:4473924),i=new Sn(void 0!==i?i:8947848);for(var r=t/2,a=e/t,o=e/2,s=[],A=[],l=0,c=0,h=-o;l<=t;l++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var u=l===r?n:i;u.toArray(A,c),c+=3,u.toArray(A,c),c+=3,u.toArray(A,c),c+=3,u.toArray(A,c),c+=3}var d=new ni;d.setAttribute("position",new Vn(s,3)),d.setAttribute("color",new Vn(A,3));var f=new Fo({vertexColors:2});Go.call(this,d,f)}function hh(e,t,n,i,r,a){e=e||10,t=t||16,n=n||8,i=i||64,r=new Sn(void 0!==r?r:4473924),a=new Sn(void 0!==a?a:8947848);var o,s,A,l,c,h,u,d=[],f=[];for(l=0;l<=t;l++)A=l/t*(2*Math.PI),o=Math.sin(A)*e,s=Math.cos(A)*e,d.push(0,0,0),d.push(o,0,s),u=1&l?r:a,f.push(u.r,u.g,u.b),f.push(u.r,u.g,u.b);for(l=0;l<=n;l++)for(u=1&l?r:a,h=e-e/n*l,c=0;c<i;c++)A=c/i*(2*Math.PI),o=Math.sin(A)*h,s=Math.cos(A)*h,d.push(o,0,s),f.push(u.r,u.g,u.b),A=(c+1)/i*(2*Math.PI),o=Math.sin(A)*h,s=Math.cos(A)*h,d.push(o,0,s),f.push(u.r,u.g,u.b);var p=new ni;p.setAttribute("position",new Vn(d,3)),p.setAttribute("color",new Vn(f,3));var m=new Fo({vertexColors:2});Go.call(this,p,m)}function uh(e,t,n,i){this.audio=e,this.range=t||1,this.divisionsInnerAngle=n||16,this.divisionsOuterAngle=i||2;var r=new ni,a=this.divisionsInnerAngle+2*this.divisionsOuterAngle,o=new Float32Array(3*(3*a+3));r.setAttribute("position",new Dn(o,3));var s=new Fo({color:65280}),A=new Fo({color:16776960});Ro.call(this,r,[A,s]),this.update()}Ah.prototype=Object.create(Dt.prototype),Ah.prototype.constructor=Ah,Ah.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ah.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");oh.copy(this.light.color),sh.copy(this.light.groundColor);for(var n=0,i=t.count;n<i;n++){var r=n<i/2?oh:sh;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(ah.setFromMatrixPosition(this.light.matrixWorld).negate())},lh.prototype=Object.create(xi.prototype),lh.prototype.constructor=lh,lh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},lh.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},ch.prototype=Object.assign(Object.create(Go.prototype),{constructor:ch,copy:function(e){return Go.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),hh.prototype=Object.create(Go.prototype),hh.prototype.constructor=hh,uh.prototype=Object.create(Ro.prototype),uh.prototype.constructor=uh,uh.prototype.update=function(){var e,t,n=this.audio,i=this.range,r=this.divisionsInnerAngle,a=this.divisionsOuterAngle,o=Ke.degToRad(n.panner.coneInnerAngle),s=Ke.degToRad(n.panner.coneOuterAngle),A=o/2,l=s/2,c=0,h=0,u=this.geometry,d=u.attributes.position;function f(n,r,a,o){var s=(r-n)/a;for(d.setXYZ(c,0,0,0),h++,e=n;e<r;e+=s)t=c+h,d.setXYZ(t,Math.sin(e)*i,0,Math.cos(e)*i),d.setXYZ(t+1,Math.sin(Math.min(e+s,r))*i,0,Math.cos(Math.min(e+s,r))*i),d.setXYZ(t+2,0,0,0),h+=3;u.addGroup(c,h,o),c+=h,h=0}u.clearGroups(),f(-l,-A,a,0),f(-A,A,r,1),f(A,l,a,0),d.needsUpdate=!0,o===s&&(this.material[0].visible=!1)},uh.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var dh=new tt,fh=new tt,ph=new rt;function mh(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var A=new ni,l=new Vn(2*o*3,3);A.setAttribute("position",l),Go.call(this,A,new Fo({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}mh.prototype=Object.create(Go.prototype),mh.prototype.constructor=mh,mh.prototype.update=function(){this.object.updateMatrixWorld(!0),ph.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,n=this.object.geometry,i=n.vertices,r=n.faces,a=0,o=0,s=r.length;o<s;o++){var A=r[o],l=A.normal;dh.copy(i[A.a]).add(i[A.b]).add(i[A.c]).divideScalar(3).applyMatrix4(e),fh.copy(l).applyMatrix3(ph).normalize().multiplyScalar(this.size).add(dh),t.setXYZ(a,dh.x,dh.y,dh.z),a+=1,t.setXYZ(a,fh.x,fh.y,fh.z),a+=1}t.needsUpdate=!0};var gh=new tt,vh=new tt,yh=new tt;function wh(e,t,n){Dt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var i=new ni;i.setAttribute("position",new Vn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var r=new Fo({fog:!1});this.lightPlane=new Ro(i,r),this.add(this.lightPlane),(i=new ni).setAttribute("position",new Vn([0,0,0,0,0,1],3)),this.targetLine=new Ro(i,r),this.add(this.targetLine),this.update()}wh.prototype=Object.create(Dt.prototype),wh.prototype.constructor=wh,wh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},wh.prototype.update=function(){gh.setFromMatrixPosition(this.light.matrixWorld),vh.setFromMatrixPosition(this.light.target.matrixWorld),yh.subVectors(vh,gh),this.lightPlane.lookAt(vh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vh),this.targetLine.scale.z=yh.length()};var xh=new tt,bh=new ki;function Ch(e){var t=new ni,n=new Fo({color:16777215,vertexColors:1}),i=[],r=[],a={},o=new Sn(16755200),s=new Sn(16711680),A=new Sn(43775),l=new Sn(16777215),c=new Sn(3355443);function h(e,t,n){u(e,n),u(t,n)}function u(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",A),h("u2","u3",A),h("u3","u1",A),h("c","t",l),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),t.setAttribute("position",new Vn(i,3)),t.setAttribute("color",new Vn(r,3)),Go.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Mh(e,t,n,i,r,a,o){xh.set(r,a,o).unproject(i);var s=t[e];if(void 0!==s)for(var A=n.getAttribute("position"),l=0,c=s.length;l<c;l++)A.setXYZ(s[l],xh.x,xh.y,xh.z)}Ch.prototype=Object.create(Go.prototype),Ch.prototype.constructor=Ch,Ch.prototype.update=function(){var e=this.geometry,t=this.pointMap;bh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Mh("c",t,e,bh,0,0,-1),Mh("t",t,e,bh,0,0,1),Mh("n1",t,e,bh,-1,-1,-1),Mh("n2",t,e,bh,1,-1,-1),Mh("n3",t,e,bh,-1,1,-1),Mh("n4",t,e,bh,1,1,-1),Mh("f1",t,e,bh,-1,-1,1),Mh("f2",t,e,bh,1,-1,1),Mh("f3",t,e,bh,-1,1,1),Mh("f4",t,e,bh,1,1,1),Mh("u1",t,e,bh,.7,1.1,-1),Mh("u2",t,e,bh,-.7,1.1,-1),Mh("u3",t,e,bh,0,2,-1),Mh("cf1",t,e,bh,-1,0,1),Mh("cf2",t,e,bh,1,0,1),Mh("cf3",t,e,bh,0,-1,1),Mh("cf4",t,e,bh,0,1,1),Mh("cn1",t,e,bh,-1,0,-1),Mh("cn2",t,e,bh,1,0,-1),Mh("cn3",t,e,bh,0,-1,-1),Mh("cn4",t,e,bh,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Bh=new Jt;function Ih(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new ni;r.setIndex(new Dn(n,1)),r.setAttribute("position",new Dn(i,3)),Go.call(this,r,new Fo({color:t})),this.matrixAutoUpdate=!1,this.update()}function Eh(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new ni;i.setIndex(new Dn(n,1)),i.setAttribute("position",new Vn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Go.call(this,i,new Fo({color:t})),this.geometry.computeBoundingSphere()}function Sh(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==n?n:16776960,r=new ni;r.setAttribute("position",new Vn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),Ro.call(this,r,new Fo({color:i}));var a=new ni;a.setAttribute("position",new Vn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new xi(a,new kn({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}Ih.prototype=Object.create(Go.prototype),Ih.prototype.constructor=Ih,Ih.prototype.update=function(e){if(void 0===e&&(void 0!==this.object&&Bh.setFromObject(this.object),!Bh.isEmpty())){var t=Bh.min,n=Bh.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Ih.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ih.prototype.copy=function(e){return Go.prototype.copy.call(this,e),this.object=e.object,this},Ih.prototype.clone=function(){return(new this.constructor).copy(this)},Eh.prototype=Object.create(Go.prototype),Eh.prototype.constructor=Eh,Eh.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Dt.prototype.updateMatrixWorld.call(this,e))},Sh.prototype=Object.create(Ro.prototype),Sh.prototype.constructor=Sh,Sh.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),Dt.prototype.updateMatrixWorld.call(this,e)};var Th,Lh,Fh=new tt;function _h(e,t,n,i,r,a){Dt.call(this),void 0===e&&(e=new tt(0,0,1)),void 0===t&&(t=new tt(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===a&&(a=.2*r),void 0===Th&&((Th=new ni).setAttribute("position",new Vn([0,0,0,0,1,0],3)),(Lh=new aA(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ro(Th,new Fo({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new xi(Lh,new kn({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}function Uh(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new ni;n.setAttribute("position",new Vn(t,3)),n.setAttribute("color",new Vn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new Fo({vertexColors:2});Go.call(this,n,i)}_h.prototype=Object.create(Dt.prototype),_h.prototype.constructor=_h,_h.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Fh.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Fh,t)}},_h.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},_h.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},_h.prototype.copy=function(e){return Dt.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},_h.prototype.clone=function(){return(new this.constructor).copy(this)},Uh.prototype=Object.create(Go.prototype),Uh.prototype.constructor=Uh;var Ph=function(e){XA.call(this,e),this.type=Y};Ph.prototype=Object.assign(Object.create(XA.prototype),{constructor:Ph,parse:function(e){var t=function(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var i=e.pos,r=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));0>(r=s.indexOf("\n"))&&a<t&&i<e.byteLength;)o+=s,a+=s.length,i+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(!1!==n&&(e.pos+=a+r+1),o+s.slice(0,r))},i=function(e,t,n,i){var r=e[t+3],a=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*a,n[i+1]=e[t+1]*a,n[i+2]=e[t+2]*a},r=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function n(n){e[0]=n;var i=t[0],r=i>>16&32768,a=i>>12&2047,o=i>>23&255;return o<103?r:o>142?(r|=31744,r|=(255==o?0:1)&&8388607&i):o<113?r|=((a|=2048)>>114-o)+(a>>113-o&1):(r|=o-112<<10|a>>1,r+=1&a)}return function(e,t,i,r){var a=e[t+3],o=Math.pow(2,a-128)/255;i[r+0]=n(e[t+0]*o),i[r+1]=n(e[t+1]*o),i[r+2]=n(e[t+2]*o)}}(),a=new Uint8Array(e);a.pos=0;var o=function(e){var i,r,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,A=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(i=n(e)))return t(1,"no header found");if(!(r=i.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(l.valid|=1,l.programtype=r[1],l.string+=i+"\n";!1!==(i=n(e));)if(l.string+=i+"\n","#"!==i.charAt(0)){if((r=i.match(a))&&(l.gamma=parseFloat(r[1],10)),(r=i.match(o))&&(l.exposure=parseFloat(r[1],10)),(r=i.match(s))&&(l.valid|=2,l.format=r[1]),(r=i.match(A))&&(l.valid|=4,l.height=parseInt(r[1],10),l.width=parseInt(r[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=i+"\n";return 2&l.valid?4&l.valid?l:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==o){var s=o.width,A=o.height,l=function(e,n,i){var r,a,o,s,A,l,c,h,u,d,f,p,m,g=n,v=i;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(r=new Uint8Array(4*n*i))||!r.length)return t(4,"unable to allocate buffer space");for(a=0,o=0,h=4*g,m=new Uint8Array(4),l=new Uint8Array(h);v>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(m[0]=e[o++],m[1]=e[o++],m[2]=e[o++],m[3]=e[o++],2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=g)return t(3,"bad rgbe scanline format");for(c=0;c<h&&o<e.byteLength;){if((p=(s=e[o++])>128)&&(s-=128),0===s||c+s>h)return t(3,"bad scanline data");if(p)for(A=e[o++],u=0;u<s;u++)l[c++]=A;else l.set(e.subarray(o,o+s),c),c+=s,o+=s}for(d=g,u=0;u<d;u++)f=0,r[a]=l[u+f],f+=g,r[a+1]=l[u+f],f+=g,r[a+2]=l[u+f],f+=g,r[a+3]=l[u+f],a+=4;v--}return r}(a.subarray(a.pos),s,A);if(-1!==l){switch(this.type){case Y:var c=l,h=le,u=Y;break;case q:for(var d=l.length/4*3,f=new Float32Array(d),p=0;p<d;p++)i(l,4*p,f,3*p);c=f,h=ae,u=q;break;case $:d=l.length/4*3;var m=new Uint16Array(d);for(p=0;p<d;p++)r(l,4*p,m,3*p);c=m,h=ae,u=$;break;default:console.error("RGBELoader: unsupported type: ",this.type)}return{width:s,height:A,data:c,header:o.string,gamma:o.gamma,exposure:o.exposure,format:h,type:u}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,n,i){return XA.prototype.load.call(this,e,(function(e,n){switch(e.type){case Y:e.encoding=Re,e.minFilter=z,e.magFilter=z,e.generateMipmaps=!1,e.flipY=!0;break;case q:case $:e.encoding=Pe,e.minFilter=W,e.magFilter=W,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,i)}});for(var kh=[],Dh=0;Dh<256;Dh++)kh[Dh]=(Dh<16?"0":"")+Dh.toString(16);var Rh=1234567,Oh={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(kh[255&e]+kh[e>>8&255]+kh[e>>16&255]+kh[e>>24&255]+"-"+kh[255&t]+kh[t>>8&255]+"-"+kh[t>>16&15|64]+kh[t>>24&255]+"-"+kh[63&n|128]+kh[n>>8&255]+"-"+kh[n>>16&255]+kh[n>>24&255]+kh[255&i]+kh[i>>8&255]+kh[i>>16&255]+kh[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Rh=e%2147483647),((Rh=16807*Rh%2147483647)-1)/2147483646},degToRad:function(e){return e*Oh.DEG2RAD},radToDeg:function(e){return e*Oh.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),A=o(n/2),l=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),u=o((t-i)/2),d=a((i-t)/2),f=o((i-t)/2);switch(r){case"XYX":e.set(s*c,A*h,A*u,s*l);break;case"YZY":e.set(A*u,s*c,A*h,s*l);break;case"ZXZ":e.set(A*h,A*u,s*c,s*l);break;case"XZX":e.set(s*c,A*f,A*d,s*l);break;case"YXY":e.set(A*d,s*c,A*f,s*l);break;case"ZYZ":e.set(A*f,A*d,s*c,s*l);break;default:console.warn("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function Nh(e){return void 0===e&&(e=[]),console.warn("MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Gh(e){console.warn("ClosedSplineCurve3 has been deprecated. Use CatmullRomCurve3 instead."),al.call(this,e),this.type="catmullrom",this.closed=!0}function Qh(e){console.warn("SplineCurve3 has been deprecated. Use CatmullRomCurve3 instead."),al.call(this,e),this.type="catmullrom"}function Hh(e){console.warn("Spline has been removed. Use CatmullRomCurve3 instead."),al.call(this,e),this.type="catmullrom"}JA.create=function(e,t){return console.log("Curve.create() has been deprecated"),e.prototype=Object.create(JA.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(gl.prototype,{createPointsGeometry:function(e){console.warn("CurvePath: .createPointsGeometry() has been removed. Use new Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("CurvePath: .createSpacedPointsGeometry() has been removed. Use new Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("CurvePath: .createGeometry() has been removed. Use new Geometry().setFromPoints( points ) instead.");for(var t=new Si,n=0,i=e.length;n<i;n++){var r=e[n];t.vertices.push(new tt(r.x,r.y,r.z||0))}return t}}),Object.assign(vl.prototype,{fromPoints:function(e){return console.warn("Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Gh.prototype=Object.create(al.prototype),Qh.prototype=Object.create(al.prototype),Hh.prototype=Object.create(al.prototype),Object.assign(Hh.prototype,{initFromArray:function(){console.error("Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("Spline: .reparametrizeByArcLength() has been removed.")}}),ch.prototype.setColors=function(){console.error("GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Object.assign(QA.prototype,{extractUrlBase:function(e){return console.warn("Loader: .extractUrlBase() has been deprecated. Use LoaderUtils.extractUrlBase() instead."),Ul.extractUrlBase(e)}}),QA.Handlers={add:function(){console.error("Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Ol.prototype,{setTexturePath:function(e){return console.warn("ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Gc.prototype,{center:function(e){return console.warn("Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Jt.prototype,{center:function(e){return console.warn("Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),zc.prototype.center=function(e){return console.warn("Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Ke,{random16:function(){return console.warn("Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ke.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ke.ceilPowerOfTwo(e)}}),Object.assign(rt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(vt.prototype,{extractPosition:function(e){return console.warn("Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new tt).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("Matrix4: .translate() has been removed.")},rotateX:function(){console.error("Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,a){return console.warn("Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)}}),dn.prototype.isIntersectionLine=function(e){return console.warn("Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},qe.prototype.multiplyVector3=function(e){return console.warn("Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(ln.prototype,{isIntersectionBox:function(e){return console.warn("Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Mn.prototype,{area:function(){return console.warn("Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Mn,{barycoordFromPoint:function(e,t,n,i,r){return console.warn("Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Mn.getBarycoord(e,t,n,i,r)},normal:function(e,t,n,i){return console.warn("Triangle: .normal() has been renamed to .getNormal()."),Mn.getNormal(e,t,n,i)}}),Object.assign(yl.prototype,{extractAllPoints:function(e){return console.warn("Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Hs(this,e)},makeGeometry:function(e){return console.warn("Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eA(this,e)}}),Object.assign(Je.prototype,{fromAttribute:function(e,t,n){return console.warn("Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(tt.prototype,{setEulerFromRotationMatrix:function(){console.error("Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(At.prototype,{fromAttribute:function(e,t,n){return console.warn("Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Si.prototype,{computeTangents:function(){console.error("Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("Geometry: .computeLineDistances() has been removed. Use Line.computeLineDistances() instead.")}}),Object.assign(Dt.prototype,{getChildByName:function(e){return console.warn("Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("Object3D: .getWorldRotation() has been removed. Use Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Dt.prototype,{eulerOrder:{get:function(){return console.warn("Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(yo.prototype,{objects:{get:function(){return console.warn("LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Co.prototype,"useVertexTexture",{get:function(){console.warn("Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("Skeleton: useVertexTexture has been removed.")}}),wo.prototype.initBones=function(){console.error("SkinnedMesh: initBones() has been removed.")},Object.defineProperty(JA.prototype,"__arcLengthDivisions",{get:function(){return console.warn("Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Di.prototype.setLens=function(e,t){console.warn("PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(wl.prototype,{onlyShadow:{set:function(){console.warn("Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("Light: .shadowCameraVisible has been removed. Use new CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Dn.prototype,{length:{get:function(){return console.warn("BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ve},set:function(){console.warn("BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ve)}}}),Object.assign(Dn.prototype,{setDynamic:function(e){return console.warn("BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ve:ze),this},copyIndicesArray:function(){console.error("BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ni.prototype,{addIndex:function(e){console.warn("BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Dn(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)}}),Object.defineProperties(ni.prototype,{drawcalls:{get:function(){return console.error("BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties($a.prototype,{dynamic:{get:function(){return console.warn("InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Ve},set:function(e){console.warn("InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign($a.prototype,{setDynamic:function(e){return console.warn("InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ve:ze),this},setArray:function(){console.error("InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(zs.prototype,{getArrays:function(){console.error("ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(_c.prototype,{dynamic:{set:function(){console.warn("Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Pn.prototype,{wrapAround:{get:function(){console.warn("Material: .wrapAround has been removed.")},set:function(){console.warn("Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("Material: .overdraw has been removed.")},set:function(){console.warn("Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("Material: .wrapRGB has been removed."),new Sn}},shading:{get:function(){console.error(this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn(this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn(this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(pA.prototype,{metal:{get:function(){return console.warn("MeshPhongMaterial: .metal has been removed. Use MeshStandardMaterial instead."),!1},set:function(){console.warn("MeshPhongMaterial: .metal has been removed. Use MeshStandardMaterial instead")}}}),Object.defineProperties(Pi.prototype,{derivatives:{get:function(){return console.warn("ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn(" ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ka.prototype,{clearTarget:function(e,t,n,i){console.warn("WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Ka.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(Da.prototype,{cullFace:{get:function(){console.warn("WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ni.prototype,{activeCubeFace:{set:function(){console.warn("WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(lt.prototype,{wrapS:{get:function(){return console.warn("WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Za.prototype,{standing:{set:function(){console.warn("WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("WebVRManager: .userHeight has been removed.")}}}),Object.defineProperties(lc.prototype,{load:{value:function(e){console.warn("Audio: .load has been deprecated. Use AudioLoader instead.");var t=this;return(new Yl).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("Audio: .startTime is now .play( delay ).")}}}),pc.prototype.getData=function(){return console.warn("AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Oi.prototype.updateCubeMap=function(e,t){return console.warn("CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var zh={merge:function(e,t,n){var i;console.warn("GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};at.crossOrigin=void 0,at.loadTexture=function(e,t,n,i){console.warn("ImageUtils.loadTexture has been deprecated. Use TextureLoader() instead.");var r=new KA;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},at.loadTextureCube=function(e,t,n,i){console.warn("ImageUtils.loadTextureCube has been deprecated. Use CubeTextureLoader() instead.");var r=new YA;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},at.loadCompressedTexture=function(){console.error("ImageUtils.loadCompressedTexture has been removed. Use DDSLoader instead.")},at.loadCompressedTextureCube=function(){console.error("ImageUtils.loadCompressedTextureCube has been removed. Use DDSLoader instead.")};var Vh={createMultiMaterialObject:function(){console.error("SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function jh(e,t){Si.call(this),this.type="ExtrudeGeometry2",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Wh(e,t)),this.mergeVertices()}function Wh(e,t){ni.call(this),this.type="ExtrudeBufferGeometry2",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,i=[],r=[],a=0,o=e.length;a<o;a++){s(e[a])}function s(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,A=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:c-2,u=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3,f=t.extrudePath,p=void 0!==t.UVGenerator?t.UVGenerator:Xh;void 0!==t.amount&&(console.warn("ExtrudeBufferGeometry2: amount has been renamed to depth."),A=t.amount);var m,g,v,y,w,x,b,C,M=!1;f&&(m=f.getSpacedPoints(s),M=!0,l=!1,g=f.computeFrenetFrames(s,!1),v=new tt,y=new tt,w=new tt),l||(d=0,c=0,h=0,u=0);var B=e.extractPoints(o),I=B.shape,E=B.holes;if(!Ns.isClockWise(I))for(I=I.reverse(),b=0,C=E.length;b<C;b++)x=E[b],Ns.isClockWise(x)&&(E[b]=x.reverse());var S=Ns.triangulateShape(I,E),T=I;for(b=0,C=E.length;b<C;b++)x=E[b],I=I.concat(x);function L(e,t,n){return t||console.error("ExtrudeGeometry2: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var F,_,U,P,k,D=I.length,R=S.length;function O(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,A=n.x-e.x,l=n.y-e.y,c=o*o+s*s,h=o*l-s*A;if(Math.abs(h)>Number.EPSILON){var u=Math.sqrt(c),d=Math.sqrt(A*A+l*l),f=t.x-s/u,p=t.y+o/u,m=((n.x-l/d-f)*l-(n.y+A/d-p)*A)/(o*l-s*A),g=(i=f+o*m-e.x)*i+(r=p+s*m-e.y)*r;if(g<=2)return new Je(i,r);a=Math.sqrt(g/2)}else{var v=!1;o>Number.EPSILON?A>Number.EPSILON&&(v=!0):o<-Number.EPSILON?A<-Number.EPSILON&&(v=!0):Math.sign(s)===Math.sign(l)&&(v=!0),v?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new Je(i/a,r/a)}for(var N=[],G=0,Q=T.length,H=Q-1,z=G+1;G<Q;G++,H++,z++)H===Q&&(H=0),z===Q&&(z=0),N[G]=O(T[G],T[H],T[z]);var V,j,W=[],X=N.concat();for(b=0,C=E.length;b<C;b++){for(x=E[b],V=[],G=0,H=(Q=x.length)-1,z=G+1;G<Q;G++,H++,z++)H===Q&&(H=0),z===Q&&(z=0),V[G]=O(x[G],x[H],x[z]);W.push(V),X=X.concat(V)}for(F=0;F<d;F++){for(U=F/d,P=c*Math.cos(U*Math.PI/2),_=h*Math.sin(U*Math.PI/2)+u,G=0,Q=T.length;G<Q;G++)Y((k=L(T[G],N[G],_)).x,k.y,-P);for(b=0,C=E.length;b<C;b++)for(x=E[b],V=W[b],G=0,Q=x.length;G<Q;G++)Y((k=L(x[G],V[G],_)).x,k.y,-P)}for(_=h+u,G=0;G<D;G++)k=l?L(I[G],X[G],_):I[G],M?(y.copy(g.normals[0]).multiplyScalar(k.x),v.copy(g.binormals[0]).multiplyScalar(k.y),w.copy(m[0]).add(y).add(v),Y(w.x,w.y,w.z)):Y(k.x,k.y,0);for(j=1;j<=s;j++)for(G=0;G<D;G++)k=l?L(I[G],X[G],_):I[G],M?(y.copy(g.normals[j]).multiplyScalar(k.x),v.copy(g.binormals[j]).multiplyScalar(k.y),w.copy(m[j]).add(y).add(v),Y(w.x,w.y,w.z)):Y(k.x,k.y,A/s*j);for(F=d-1;F>=0;F--){for(U=F/d,P=c*Math.cos(U*Math.PI/2),_=h*Math.sin(U*Math.PI/2)+u,G=0,Q=T.length;G<Q;G++)Y((k=L(T[G],N[G],_)).x,k.y,A+P);for(b=0,C=E.length;b<C;b++)for(x=E[b],V=W[b],G=0,Q=x.length;G<Q;G++)k=L(x[G],V[G],_),M?Y(k.x,k.y+m[s-1].y,m[s-1].x+P):Y(k.x,k.y,A+P)}function Z(e,t){var n,i;for(G=e.length;--G>=0;){n=G,(i=G-1)<0&&(i=e.length-1);var r=0,a=s+2*d;for(r=0;r<a;r++){var o=D*r,A=D*(r+1);q(t+n+o,t+i+o,t+i+A,t+n+A)}}}function Y(e,t,n){a.push(e),a.push(t),a.push(n)}function K(e,t,n,r){for(var a=t/2,o=0,s=0;o<t&&s<a;o++,s++){for(var A,l,c,h,u=[],d=0;d<2;d++){var f=o+2*d;f>=t&&(f=t-1);var p=e[f];u.push(p[r?2:0]+n),u.push(p[1]+n),u.push(p[r?0:2]+n)}o%2==1&&(o+=2);for(var m=0;m<u.length;m++)$(u[m]);for(var g,v,y,w,x,b,C,M,B,I,E=0,S=i.length/3,T=0;T<3;T++){v=2==T?S-6:S-6+T+1,x=new Je(i[3*(g=S-6+T)],i[3*g+1]),b=new Je(i[3*v],i[3*v+1]);var L=(B=new Je(b.x-x.x,b.y-x.y)).length();B.normalize();for(var F=3;F<6;F++){w=5==F?S-3:S-6+F+1,C=new Je(i[3*(y=S-6+F)],i[3*y+1]),M=new Je(i[3*w],i[3*w+1]),(I=new Je(M.x-C.x,M.y-C.y)).normalize();var _=B.dot(I);if(1-Math.abs(_)<1e-10){if(x.equals(C)&&b.equals(M)||x.equals(M)&&b.equals(C))break;L>E&&(E=L,A=x,l=b,c=C,h=M);break}}}if(E>0)J(S-6,S-5,S-4,A,l,!0),J(S-3,S-2,S-1,c,h,!1);else{console.log("Error: !!!");var U=[];for(T=0;T<3;T++){v=2==T?S-6:S-6+T+1,x=new Je(i[3*(g=S-6+T)],i[3*g+1]),b=new Je(i[3*v],i[3*v+1]);L=(B=new Je(b.x-x.x,b.y-x.y)).length();U.push([L,x,b])}var P=function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0};U.sort(P),J(S-6,S-5,S-4,U[1][1],U[1][2],!0),U=[];for(F=3;F<6;F++){w=5==F?S-3:S-6+F+1,C=new Je(i[3*(y=S-6+F)],i[3*y+1]),M=new Je(i[3*w],i[3*w+1]),I=new Je(M.x-C.x,M.y-C.y);L=B.length();U.push([L,C,M])}U.sort(P),J(S-3,S-2,S-1,U[1][1],U[1][2],!1)}}}function J(e,t,r,a,o,s){var A=p.generateTopUV(n,i,e,t,r,a,o,s);ee(A[0]),ee(A[1]),ee(A[2])}function q(e,t,r,a){$(e),$(t),$(a),$(t),$(r),$(a);var o=i.length/3,s=p.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){i.push(a[3*e+0]),i.push(a[3*e+1]),i.push(a[3*e+2])}function ee(e){r.push(e.x),r.push(e.y)}!function(){var e=i.length/3;if(l){var t=0;K(S,R,D*t,!0),K(S,R,D*(t=s+2*d),!1)}else{K(S,R,0,!0),K(S,R,D*s,!1)}n.addGroup(e,i.length/3-e,0)}(),function(){var e=i.length/3,t=0;for(Z(T,t),t+=T.length,b=0,C=E.length;b<C;b++)Z(x=E[b],t),t+=x.length;n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Vn(i,3)),this.setAttribute("uv",new Vn(r,2)),this.computeVertexNormals()}jh.prototype=Object.create(Si.prototype),jh.prototype.constructor=jh,jh.prototype.toJSON=function(){var e=Si.prototype.toJSON.call(this);return Zh(this.parameters.shapes,this.parameters.options,e)},Wh.prototype=Object.create(ni.prototype),Wh.prototype.constructor=Wh,Wh.prototype.toJSON=function(){var e=ni.prototype.toJSON.call(this);return Zh(this.parameters.shapes,this.parameters.options,e)};var Xh={generateTopUV:function(e,t,n,i,r,a,o,s){var A=new Je(t[3*n],t[3*n+1]),l=new Je(t[3*i],t[3*i+1]),c=new Je(t[3*r],t[3*r+1]);if(null===a||null===o)return[new Je(A.x,A.y),new Je(l.x,l.y),new Je(c.x,c.y)];for(var h,u=[A,l,c],d=[0,0,0],f=[0,0,0],p=0;p<u.length;p++)u[p].equals(a)||u[p].equals(o)?u[p].equals(a)?(d[0]=p,f[p]=0):(d[1]=p,f[p]=1):(h=u[p],d[2]=p,f[p]=2);var m=new Je(a.x+o.x,a.y+o.y);m=m.divideScalar(2);var g=new Je(o.x-a.x,o.y-a.y),v=g.length()/2;g.normalize();var y=new Je(h.x-m.x,h.y-m.y),w=new Je(1,0),x=g.dot(w),b=Math.acos(x),C=!1,M=g.x*g.y>0;(M&&b>Math.PI/2||!M&&b<Math.PI/2)&&(C=!0,b=Math.PI-b),x=Math.cos(b);for(var B=Math.sin(b),I=y.x*x+y.y*B,E=-y.x*B+y.y*x,S=[],T=0;T<3;T++){var L;switch(f[T]){case 0:L=new Je(C?v:-v,0);break;case 1:L=new Je(C?-v:v,0);break;case 2:L=new Je(I,E)}S.push(L)}return S},generateSideWallUV:function(e,t,n,i,r,a){var o=[3*n,3*i,3*r,3*a],s=[t[o[0]+2],t[o[1]+2],t[o[2]+2],t[o[3]+2]];s.sort((function(e,t){return e<t?-1:e>t?1:0}));for(var A=[],l=0;l<2;l++)for(var c=0;c<o.length;c++)t[o[c]+2]==s[l]&&(0==l||1==l&&o[c]!=A[0])&&(A[l]=o[c]);var h=!1,u=t[A[0]]-t[A[1]],d=t[A[0]+1]-t[A[1]+1];u*d>=0&&(h=!0);var f=(u=Math.abs(u))+(d=Math.abs(d)),p=d/f,m=u/f;if(h)return[new Je(t[o[0]]*m+t[o[0]+1]*p,1-t[o[0]+2]),new Je(t[o[1]]*m+t[o[1]+1]*p,1-t[o[1]+2]),new Je(t[o[2]]*m+t[o[2]+1]*p,1-t[o[2]+2]),new Je(t[o[3]]*m+t[o[3]+1]*p,1-t[o[3]+2])];for(c=0;c<o.length;c++)o[c]!=A[0]&&o[c]!=A[1]&&A.push(o[c]);for(var g=[],v=0;v<4;v++){var y=new Je;y.x=t[o[v]]*m;for(var w=0,x=0;x<2;x++)o[v]==A[2*x]?w=A[2*x+1]:o[v]==A[2*x+1]&&(w=A[2*x]);y.x+=t[w+1]*p,y.y=1-t[o[v]+2],g.push(y)}return g}};function Zh(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Yh(e){return function(e){for(var t="0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>8*(3-i%4)+4&15)+t.charAt(e[i>>2]>>8*(3-i%4)&15);return n}(function(e){for(var t=e,n=Array(80),i=1732584193,r=-271733879,a=-1732584194,o=271733878,s=-1009589776,A=0;A<t.length;A+=16){for(var l=i,c=r,h=a,u=o,d=s,f=0;f<80;f++){n[f]=f<16?t[A+f]:$h(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);var p=qh(qh($h(i,5),Kh(f,r,a,o)),qh(qh(s,n[f]),Jh(f)));s=o,o=a,a=$h(r,30),r=i,i=p}i=qh(i,l),r=qh(r,c),a=qh(a,h),o=qh(o,u),s=qh(s,d)}return new Array(i,r,a,o,s)}(function(e){for(var t=1+(e.length+8>>6),n=new Array(16*t),i=0;i<16*t;i++)n[i]=0;for(i=0;i<e.length;i++)n[i>>2]|=e.charCodeAt(i)<<24-8*(3&i);return n[i>>2]|=128<<24-8*(3&i),n[16*t-1]=8*e.length,n}(e)))}function Kh(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function Jh(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function qh(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function $h(e,t){return e<<t|e>>>32-t}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:M}}));var eu="http://10.10.10.139:4080/common/downloadFile/",tu=function(){function e(){r(this,e)}return o(e,null,[{key:"getModelById",value:function(t){try{var n=this.post({url:"https://open.laozicloud.com/v4/auth/getModelFile",body:"modelId="+t+"&token="+nu.token,async:!1});if(6e4===n.resp_code)return n.datas;if(60301!==n.resp_code)throw new Error("");if(""==n.resp_msg)throw console.warn(n.resp_msg),new Error(n.resp_msg);if("token"===n.resp_msg&&(nu.token=nu.checkDevloper(),nu.token))return e.getModelById(t)}catch(e){throw new Error("")}}},{key:"getLocalModelById",value:function(e){try{var t=this.post({url:"http://10.10.10.139:4080/model/preview",body:"id="+e,async:!1});if(t&&6e4===t.resp_code)return JSON.parse(t.datas.paths);throw new Error("")}catch(e){throw new Error("")}}},{key:"authorization",value:function(e){var t=this.post({url:"https://open.laozicloud.com/v4/auth/authentication",body:e,async:!1});try{if(t&&6e4===t.resp_code)return t.datas;throw new Error(",")}catch(e){throw new Error(",")}}},{key:"post",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0===e.async&&(e.async=!0);var t=new XMLHttpRequest;if(e.async&&(t.responseType="json"),t.open("POST",e.url,e.async),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&e.onSuccess&&e.onSuccess(t.response)},t.onerror=function(t){e.onFaild&&e.onFaild(t)},t.send(e.body),!e.async)return JSON.parse(t.response)}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0===e.async&&(e.async=!0);var t=new XMLHttpRequest;if(e.async&&(t.responseType="json"),t.open("GET",e.url,e.async),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&e.onSuccess&&e.onSuccess(t.response)},t.onerror=function(t){e.onFaild&&e.onFaild(t)},t.send(),!e.async)return JSON.parse(t.response)}},{key:"setLocalPath",value:function(e,t){return e.m.forEach((function(n,i){e.m[i]=t+"m/"+n})),e.mat.forEach((function(n,i){e.mat[i]=t+"mat/"+n})),void 0!==e.scene&&""!=e.scene&&(e.scene=t+e.scene),void 0!==e.nodes&&""!=e.nodes&&(e.nodes=t+"nodes/"+e.nodes),void 0!==e.i&&""!=e.i&&(e.i=t+"instance/"+e.i),void 0!==e.ii&&e.ii.forEach((function(n,i){e.ii[i]=t+"instance/"+n})),e.localPath=t+"Texture/",e.bim&&(e.bim=t+e.bim),e}},{key:"setOnlinePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eu;return e.m.forEach((function(n,i){e.m[i]=t+n})),e.mat.forEach((function(n,i){e.mat[i]=t+n})),void 0!==e.scene&&""!=e.scene&&(e.scene=t+e.scene),void 0!==e.nodes&&""!=e.nodes&&(e.nodes=t+e.nodes),void 0!==e.i&&""!=e.i&&(e.i=t+e.i),void 0!==e.ii&&e.ii.forEach((function(n,i){e.ii[i]=t+n})),e.localPath=t,e}},{key:"getFileList",value:function(e){try{var t=this.get({url:e+"fileList.json",method:"GET",async:!1});return Array.isArray(t.addition)&&(t.addition=t.addition.map((function(t){return e+t}))),Array.isArray(t.a)&&(t.a=t.a.map((function(t){return e+t}))),Array.isArray(t.m)&&(t.m=t.m.map((function(t){return e+t}))),Array.isArray(t.mat)&&(t.mat=t.mat.map((function(t){return e+t}))),Array.isArray(t.instance)&&(t.instance=t.instance.map((function(t){return e+t}))),Array.isArray(t.skin)&&(t.skin=t.skin.map((function(t){return e+t}))),Array.isArray(t.bone)&&(t.bone=t.bone.map((function(t){return e+t}))),t.scene&&(t.scene=e+t.scene),t.sky&&(t.sky.a=e+t.sky.a,t.sky.b=e+t.sky.b),t.bim&&(t.bim=e+t.bim),t}catch(e){console.error("fileList.json")}}},{key:"getCoordsByAddressOrCityCode",value:function(t,n,i){var r='http://api.tianditu.gov.cn/administrative?postStr={"searchWord":"'.concat(void 0!==t?t:n,'","searchType":"').concat(void 0!==t?1:0,'","needSubInfo":"false","needAll":"false","needPolygon":"true","needPre":"true"}&tk=a7fbb569ae07158a0350f2952b4ee2a1');e.get({url:r,async:!0,onSuccess:function(e){"ok"===e.msg&&(e.data[0].coord=[e.data[0].lnt,e.data[0].lat],i(e.data[0]))}})}},{key:"getCoordsByCityCode",value:function(t,n){e.getCoordsByAddressOrCityCode(void 0,t,n)}},{key:"getCoordsByAddress",value:function(t,n){e.getCoordsByAddressOrCityCode(t,void 0,n)}}]),e}(),nu=new(function(){function e(){r(this,e),this.token=null}return o(e,[{key:"init",value:function(e){this.options=e}},{key:"checkDevloper",value:function(){if(!this.options.appkey||""===this.options.appkey)throw new Error("[appkey]!");if(!this.options.appsecret||""===this.options.appsecret)throw new Error("[appsecret]!");var e=(new Date).getTime(),t=parseInt(1e6*Math.random()),n=Yh(this.options.appsecret+e+t),i="appkey="+this.options.appkey+"&random="+t+"&sign="+n+"&source=3&timeStamp="+e;return tu.authorization(i)}},{key:"offlineValidation",value:function(e){var t=this;try{callRuntimeCallbacks&&callRuntimeCallbacks([function(n){n.onRuntimeInitialized=function(){var i=0;n&&n.ccall&&(i=n.ccall("WEB_API_CheckLicenseData","number",["string","string","string","string"],[t.options.developerID,t.options.appID,t.options.secretKey,t.options.offlinekey])),e(i)}}])}catch(t){e(0)}}}]),e}());function iu(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(iu.prototype,{setSize:function(){},render:function(){console.error("Pass: .render() must be implemented in derived pass.")}}),iu.FullScreenQuad=function(){var e=new El(-1,1,1,-1,0,1),t=new Ki(2,2),n=function(e){this._mesh=new xi(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{render:function(t){t.render(this._mesh,e)}}),n}();var ru=function(e,t,n,i,r){iu.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};ru.prototype=Object.assign(Object.create(iu.prototype),{constructor:ru,render:function(e,t,n){var i,r,a=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(i=e.getClearColor().getHex(),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(i,r),this.scene.overrideMaterial=null,e.autoClear=a}}),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:M}}));var au={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},ou=function(e,t){iu.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof Pi?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Ui.clone(e.uniforms),this.material=new Pi({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new iu.FullScreenQuad(this.material)};ou.prototype=Object.assign(Object.create(iu.prototype),{constructor:ou,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var su=function(e,t){iu.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};su.prototype=Object.assign(Object.create(iu.prototype),{constructor:su,render:function(e,t,n){var i,r,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(i=0,r=1):(i=1,r=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,i,4294967295),o.buffers.stencil.setClear(r),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}});var Au=function(){iu.call(this),this.needsSwap=!1};Au.prototype=Object.create(iu.prototype),Object.assign(Au.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});var lu=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:W,magFilter:W,format:oe,stencilBuffer:!0},i=e.getSize(new Je);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new lt(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===au&&console.error("EffectComposer relies on CopyShader"),void 0===ou&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new ou(au),this.clock=new ic};Object.assign(lu.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,i=this.renderer.getRenderTarget(),r=!1,a=this.passes.length;for(n=0;n<a;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==su&&(t instanceof su?r=!0:t instanceof Au&&(r=!1))}this.renderer.setRenderTarget(i)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new Je);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var cu=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(cu.prototype,{setSize:function(){},render:function(){console.error("Pass: .render() must be implemented in derived pass.")}}),cu.FullScreenQuad=function(){var e=new El(-1,1,1,-1,0,1),t=new Ki(2,2),n=function(e){this._mesh=new xi(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{render:function(t){t.render(this._mesh,e)}}),n}();var hu={uniforms:{tDiffuse:{value:null},resolution:{value:new Je(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},uu={defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Je(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","\tvUv = uv;","\tSMAAEdgeDetectionVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","\tvec4 delta;","\tvec3 C = texture2D( colorTex, texcoord ).rgb;","\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","\tvec3 t = abs( C - Cleft );","\tdelta.x = max( max( t.r, t.g ), t.b );","\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","\tt = abs( C - Ctop );","\tdelta.y = max( max( t.r, t.g ), t.b );","\tvec2 edges = step( threshold, delta.xy );","\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","\t\tdiscard;","\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","\tt = abs( C - Cright );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","\tt = abs( C - Cbottom );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","\tt = abs( C - Cleftleft );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","\tt = abs( C - Ctoptop );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );","\tedges.xy *= step( 0.5 * maxDelta, delta.xy );","\treturn vec4( edges, 0.0, 0.0 );","}","void main() {","\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},du={defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Je(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","\tvPixcoord = texcoord / resolution;","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","\tvUv = uv;","\tSMAABlendingWeightCalculationVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","#if __VERSION__ == 100","vec2 round( vec2 x ) {","\treturn sign( x ) * floor( abs( x ) + 0.5 );","}","#endif","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","\te.r = bias + e.r * scale;","\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x += 0.25 * resolution.x;","\ttexcoord.x += resolution.x;","\ttexcoord.x += 2.0 * resolution.x;","\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","\treturn texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x -= 0.25 * resolution.x;","\ttexcoord.x -= resolution.x;","\ttexcoord.x -= 2.0 * resolution.x;","\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","\treturn texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y -= 0.25 * resolution.y;","\ttexcoord.y -= resolution.y;","\ttexcoord.y -= 2.0 * resolution.y;","\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","\treturn texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y += 0.25 * resolution.y;","\ttexcoord.y += resolution.y;","\ttexcoord.y += 2.0 * resolution.y;","\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","\treturn texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","\treturn texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","\tvec2 e = texture2D( edgesTex, texcoord ).rg;","\tif ( e.g > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","\t\tcoords.y = offset[ 1 ].y;","\t\td.x = coords.x;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;","\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","\t\td.y = coords.x;","\t\td = d / resolution.x - pixcoord.x;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","\t}","\tif ( e.r > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","\t\tcoords.x = offset[ 0 ].x;","\t\td.x = coords.y;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;","\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","\t\td.y = coords.y;","\t\td = d / resolution.y - pixcoord.y;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","\t}","\treturn weights;","}","void main() {","\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},fu={uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Je(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","\tvUv = uv;","\tSMAANeighborhoodBlendingVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","\tvec4 a;","\ta.xz = texture2D( blendTex, texcoord ).xz;","\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;","\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;","\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","\t\treturn texture2D( colorTex, texcoord, 0.0 );","\t} else {","\t\tvec2 offset;","\t\toffset.x = a.a > a.b ? a.a : -a.b;","\t\toffset.y = a.g > a.r ? -a.g : a.r;","\t\tif ( abs( offset.x ) > abs( offset.y )) {","\t\t\toffset.y = 0.0;","\t\t} else {","\t\t\toffset.x = 0.0;","\t\t}","\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );","\t\ttexcoord += sign( offset ) * resolution;","\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );","\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","\t\tC.xyz = pow(C.xyz, vec3(2.2));","\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));","\t\tvec4 mixed = mix(C, Cop, s);","\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","\t\treturn mixed;","\t}","}","void main() {","\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")},pu=function(e,t){iu.call(this),this.edgesRT=new lt(e,t,{depthBuffer:!1,generateMipmaps:!1,minFilter:W,format:ae}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new lt(e,t,{depthBuffer:!1,generateMipmaps:!1,minFilter:W,format:oe}),this.weightsRT.texture.name="SMAAPass.weights";var n,i,r=this;(n=new Image).src=this.getAreaTexture(),n.onload=function(){r.areaTexture.needsUpdate=!0},this.areaTexture=new st,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=n,this.areaTexture.format=ae,this.areaTexture.minFilter=W,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1,(i=new Image).src=this.getSearchTexture(),i.onload=function(){r.searchTexture.needsUpdate=!0},this.searchTexture=new st,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=i,this.searchTexture.magFilter=z,this.searchTexture.minFilter=z,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,void 0===uu&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=Ui.clone(uu.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new Pi({defines:Object.assign({},uu.defines),uniforms:this.uniformsEdges,vertexShader:uu.vertexShader,fragmentShader:uu.fragmentShader}),this.uniformsWeights=Ui.clone(du.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new Pi({defines:Object.assign({},du.defines),uniforms:this.uniformsWeights,vertexShader:du.vertexShader,fragmentShader:du.fragmentShader}),this.uniformsBlend=Ui.clone(fu.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new Pi({uniforms:this.uniformsBlend,vertexShader:fu.vertexShader,fragmentShader:fu.fragmentShader}),this.needsSwap=!1,this.fsQuad=new iu.FullScreenQuad(null)};pu.prototype=Object.assign(Object.create(iu.prototype),{constructor:pu,render:function(e,t,n){this.uniformsEdges.tDiffuse.value=n.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=n.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},setSize:function(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)},getAreaTexture:function(){return"data:image/png;base64,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"},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var mu=function e(){r(this,e)};mu.FXAA="FXAA",mu.SMAA="SMAA",mu.MSAA="MSAA",mu.SSAA="SSAA";var gu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.options=t,this.pass={enabled:!0},this.antiAliasing=t.antialias||mu.FXAA,this.isPostProcessing=!0}return o(e,[{key:"init",value:function(){}},{key:"render",value:function(){}},{key:"enabled",get:function(){this.pass.enabled},set:function(e){this.pass.enabled=e}},{key:"setSize",value:function(e,t){}}]),e}(),vu=function(e,t,n,i){this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==i?i:[],this.visibleEdgeColor=new Sn(1,1,1),this.hiddenEdgeColor=new Sn(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,iu.call(this),this.resolution=void 0!==e?new Je(e.x,e.y):new Je(256,256);var r={minFilter:W,magFilter:W,format:oe},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new kn({color:16777215}),this.maskBufferMaterial.side=2,this.renderTargetMaskBuffer=new lt(this.resolution.x,this.resolution.y,r),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Pa,this.depthMaterial.side=2,this.depthMaterial.depthPacking=Qe,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=2,this.prepareMaskMaterial.fragmentShader=function(e,t){var n=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new lt(this.resolution.x,this.resolution.y,r),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new lt(a,o,r),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new lt(a,o,r),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new lt(Math.round(a/2),Math.round(o/2),r),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new lt(a,o,r),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new lt(Math.round(a/2),Math.round(o/2),r),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Je(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Je(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===au&&console.error("OutlinePass relies on CopyShader");var s=au;this.copyUniforms=Ui.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Pi({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Sn,this.oldClearAlpha=1,this.fsQuad=new iu.FullScreenQuad(null),this.tempPulseColor1=new Sn,this.tempPulseColor2=new Sn,this.textureMatrix=new vt};vu.prototype=Object.assign(Object.create(iu.prototype),{constructor:vu,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var n=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,i),this.renderTargetBlurBuffer1.setSize(n,i),this.renderTargetEdgeBuffer1.setSize(n,i),this.separableBlurMaterial1.uniforms.texSize.value=new Je(n,i),n=Math.round(n/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(n,i),this.renderTargetEdgeBuffer2.setSize(n,i),this.separableBlurMaterial2.uniforms.texSize.value=new Je(n,i)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function n(e){e.isMesh&&t.push(e)}for(var i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(n)}this.renderScene.traverse((function(n){if(n.isMesh||n.isLine||n.isSprite){for(var i=!1,r=0;r<t.length;r++){if(t[r].id===n.id){i=!0;break}}if(!i){var a=n.visible;e&&!n.bVisible||(n.visible=e),n.bVisible=a}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},toggleVisibleOfSelectedObjects:function(e){e?this.selectedObjects.map((function(e){(e.isMesh||e.isLine||e.isSprite)&&(e.__visible=e.visible,e.visible=!0)})):this.selectedObjects.map((function(e){(e.isMesh||e.isLine||e.isSprite)&&(e.visible=e.__visible,delete e.__visible)}))},render:function(e,t,n,i,r){if(this.selectedObjects.length>0){this.showTransform=!1,this.renderScene.getObjectByName("ObjectControls")&&this.renderScene.getObjectByName("ObjectControls").visible&&(this.showTransform=!0,this.renderScene.getObjectByName("ObjectControls").visible=!1),this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new Je(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),this.toggleVisibleOfSelectedObjects(!0),e.render(this.renderScene,this.renderCamera),this.toggleVisibleOfSelectedObjects(!1),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Je(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=vu.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=vu.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=vu.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=vu.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.fsQuad.render(e)),this.showTransform&&(this.renderScene.getObjectByName("ObjectControls").visible=!0)},getPrepareMaskMaterial:function(){return new Pi({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Je(.5,.5)},textureMatrix:{value:new vt}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new Pi({uniforms:{maskTexture:{value:null},texSize:{value:new Je(.5,.5)},visibleEdgeColor:{value:new tt(1,1,1)},hiddenEdgeColor:{value:new tt(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new Pi({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Je(.5,.5)},direction:{value:new Je(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new Pi({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:2,depthTest:!1,depthWrite:!1,transparent:!0})}}),vu.BlurDirectionX=new Je(1,0),vu.BlurDirectionY=new Je(0,1);var yu=function(e,t,n,i){this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==i?i:[],this.visibleEdgeColor=new Sn(1,1,1),this.hiddenEdgeColor=new Sn(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,iu.call(this),this.resolution=void 0!==e?new Je(e.x,e.y):new Je(256,256);var r={minFilter:W,magFilter:W,format:oe},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new kn({color:16777215}),this.maskBufferMaterial.side=2,this.renderTargetMaskBuffer=new lt(this.resolution.x,this.resolution.y,r),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Pa,this.depthMaterial.side=2,this.depthMaterial.depthPacking=Qe,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=2,this.prepareMaskMaterial.fragmentShader=function(e,t){var n=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetMaskDownSampleBuffer=new lt(a,o,r),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new lt(a,o,r),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new lt(Math.round(a/2),Math.round(o/2),r),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new lt(a,o,r),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new lt(Math.round(a/2),Math.round(o/2),r),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Je(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Je(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===au&&console.error("OutlinePass relies on CopyShader");var s=au;this.copyUniforms=Ui.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Pi({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Sn,this.oldClearAlpha=1,this.fsQuad=new iu.FullScreenQuad(null),this.tempPulseColor1=new Sn,this.tempPulseColor2=new Sn,this.textureMatrix=new vt};yu.prototype=Object.assign(Object.create(iu.prototype),{constructor:yu,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var n=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,i),this.renderTargetBlurBuffer1.setSize(n,i),this.renderTargetEdgeBuffer1.setSize(n,i),this.separableBlurMaterial1.uniforms.texSize.value=new Je(n,i),n=Math.round(n/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(n,i),this.renderTargetEdgeBuffer2.setSize(n,i),this.separableBlurMaterial2.uniforms.texSize.value=new Je(n,i)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function n(e){e.isMesh&&t.push(e)}for(var i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(n)}this.renderScene.traverse((function(n){if(n.isMesh||n.isLine||n.isSprite){for(var i=!1,r=0;r<t.length;r++){if(t[r].id===n.id){i=!0;break}}if(!i){var a=n.visible;e&&!n.bVisible||(n.visible=e),n.bVisible=a}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,n,i,r){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.prepareMaskMaterial,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.renderArray(this.selectedObjects,this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Je(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=yu.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=yu.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=yu.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=yu.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.fsQuad.render(e)),this.showTransform&&(this.renderScene.getObjectByName("ObjectControls").visible=!0)},getPrepareMaskMaterial:function(){return new Pi({uniforms:{},vertexShader:["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","\tgl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new Pi({uniforms:{maskTexture:{value:null},texSize:{value:new Je(.5,.5)},visibleEdgeColor:{value:new tt(1,1,1)},hiddenEdgeColor:{value:new tt(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new Pi({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Je(.5,.5)},direction:{value:new Je(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new Pi({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:2,depthTest:!1,depthWrite:!1,transparent:!0})}}),yu.BlurDirectionX=new Je(1,0),yu.BlurDirectionY=new Je(0,1);var wu=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).antiAliasing=mu.SMAA,i.selectedColor=e.color||"#fff709",i.objects=[],null==e.strength&&(e.strength=6.5),null==e.glow&&(e.glow=1),null==e.thickness&&(e.thickness=2),i}return o(n,[{key:"init",value:function(e){this.pass=new yu(new Je(e.width,e.height),e.scene,e.camera),this.pass.edgeStrength=this.options.strength,this.pass.edgeGlow=this.options.glow,this.pass.edgeThickness=this.options.thickness,this.pass.visibleEdgeColor.set(this.selectedColor),this.pass.hiddenEdgeColor.set(this.selectedColor),this.pass.downSampleRatio=window.devicePixelRatio,this.pass.selectedObjects=this.objects,g(l(n.prototype),"init",this).call(this)}},{key:"add",value:function(e){var t=this;this.objects.includes(e)||(this.objects.push(e),e.traverse((function(e){e.isMesh&&!t.pass.selectedObjects.includes(e)&&t.pass.selectedObjects.push(e)})))}},{key:"remove",value:function(e){if(this.objects.includes(e)){this.objects.splice(this.objects.indexOf(e),1);var t=[];e.traverse((function(e){e.isMesh&&t.push(e)}));for(var n=this.pass.selectedObjects.length-1;n>=0;n--)t.includes(this.pass.selectedObjects[n])&&this.pass.selectedObjects.splice(n,1)}}},{key:"clear",value:function(){this.objects=[],this.pass.selectedObjects&&(this.pass.selectedObjects=[])}}]),n}(gu),xu={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Sn(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},bu=function(e,t,n,i){iu.call(this),this.strength=void 0!==t?t:1,this.radius=n,this.threshold=i,this.resolution=void 0!==e?new Je(e.x,e.y):new Je(256,256),this.clearColor=new Sn(0,0,0);var r={minFilter:W,magFilter:W,format:oe};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new lt(a,o,r),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var A=new lt(a,o,r);A.texture.name="UnrealBloomPass.h"+s,A.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(A);var l=new lt(a,o,r);l.texture.name="UnrealBloomPass.v"+s,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),a=Math.round(a/2),o=Math.round(o/2)}void 0===xu&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var c=xu;this.highPassUniforms=Ui.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Pi({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Je(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new tt(1,1,1),new tt(1,1,1),new tt(1,1,1),new tt(1,1,1),new tt(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===au&&console.error("UnrealBloomPass relies on CopyShader");var u=au;this.copyUniforms=Ui.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Pi({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Sn,this.oldClearAlpha=1,this.basic=new kn,this.fsQuad=new iu.FullScreenQuad(null)};bu.prototype=Object.assign(Object.create(iu.prototype),{constructor:bu,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var n=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(n,i);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(n,i),this.renderTargetsVertical[r].setSize(n,i),this.separableBlurMaterials[r].uniforms.texSize.value=new Je(n,i),n=Math.round(n/2),i=Math.round(i/2)},render:function(e,t,n,i,r){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=bu.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=bu.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a},getSeperableBlurMaterial:function(e){return new Pi({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new Je(.5,.5)},direction:{value:new Je(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new Pi({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),bu.BlurDirectionX=new Je(1,0),bu.BlurDirectionY=new Je(0,1);var Cu=function(e,t,n,i){iu.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==i?i:0,void 0===au&&console.error("SSAARenderPass relies on CopyShader");var r=au;this.copyUniforms=Ui.clone(r.uniforms),this.copyMaterial=new Pi({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.fsQuad=new iu.FullScreenQuad(this.copyMaterial)};Cu.prototype=Object.assign(Object.create(iu.prototype),{constructor:Cu,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,n){this.sampleRenderTarget||(this.sampleRenderTarget=new lt(n.width,n.height,{minFilter:W,magFilter:W,format:oe}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var i=Cu.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],r=e.autoClear;e.autoClear=!1;var a=e.getClearColor().getHex(),o=e.getClearAlpha(),s=1/i.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var A=n.width,l=n.height,c=0;c<i.length;c++){var h=i[c];this.camera.setViewOffset&&this.camera.setViewOffset(A,l,.0625*h[0],.0625*h[1],A,l);var u=s;if(this.unbiased)u+=.03125*((c+.5)/i.length-.5);this.copyUniforms.opacity.value=u,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===c&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=r,e.setClearColor(a,o)}}),Cu.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var Mu=function(e,t,n){void 0===t&&(console.warn('TransformControls: The second parameter "domElement" is now mandatory.'),t=document),Dt.call(this),this.name="TransformControls",this.visible=!1;var i=new Bu(n);this.add(i);var r=new Iu;this.add(r);var a=this;G("camera",e),G("object",void 0),G("enabled",!0),G("axis",null),G("mode","translate"),G("translationSnap",null),G("rotationSnap",null),G("space","world"),G("size",1),G("dragging",!1),G("showX",!0),G("showY",!0),G("showZ",!0);var o={type:"change"},s={type:"mouseDown"},A={type:"mouseUp",mode:a.mode},l={type:"objectChange"},c=new Pc,h=new tt,u=new tt,d=new qe,f={X:new tt(1,0,0),Y:new tt(0,1,0),Z:new tt(0,0,1)},p=new tt,m=new tt,g=new tt,v=new tt,y=new tt,w=new tt,x=0,b=new tt,C=new qe,M=new tt,B=new tt,I=new qe,E=new qe,S=new tt,T=new tt,L=new qe,F=new tt,_=new tt,U=new qe,P=new qe,k=new tt,D=new tt,R=new tt,O=new qe,N=new tt;function G(e,t){var n=t;Object.defineProperty(a,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,r[e]=t,i[e]=t,a.dispatchEvent({type:e+"-changed",value:t}),a.dispatchEvent(o))}}),a[e]=t,r[e]=t,i[e]=t}function Q(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var n=e.changedTouches?e.changedTouches[0]:e,i=t.getBoundingClientRect();return{x:(n.clientX-i.left)/i.width*2-1,y:-(n.clientY-i.top)/i.height*2+1,button:e.button}}function H(e){a.enabled&&a.pointerHover(Q(e))}function z(e){a.enabled&&(document.addEventListener("mousemove",V,!1),a.pointerHover(Q(e)),a.pointerDown(Q(e)))}function V(e){a.enabled&&a.pointerMove(Q(e))}function j(e){a.enabled&&(document.removeEventListener("mousemove",V,!1),a.pointerUp(Q(e)))}G("worldPosition",_),G("worldPositionStart",T),G("worldQuaternion",U),G("worldQuaternionStart",L),G("cameraPosition",b),G("cameraQuaternion",C),G("pointStart",p),G("pointEnd",m),G("rotationAxis",v),G("rotationAngle",x),G("eye",D),t.addEventListener("mousedown",z,!1),t.addEventListener("touchstart",z,!1),t.addEventListener("mousemove",H,!1),t.addEventListener("touchmove",H,!1),t.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",j,!1),t.addEventListener("touchend",j,!1),t.addEventListener("touchcancel",j,!1),t.addEventListener("touchleave",j,!1),this.dispose=function(){t.removeEventListener("mousedown",z),t.removeEventListener("touchstart",z),t.removeEventListener("mousemove",H),document.removeEventListener("mousemove",V),t.removeEventListener("touchmove",H),t.removeEventListener("touchmove",V),document.removeEventListener("mouseup",j),t.removeEventListener("touchend",j),t.removeEventListener("touchcancel",j),t.removeEventListener("touchleave",j),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(B,I,S),this.object.matrixWorld.decompose(_,U,k),E.copy(I).inverse(),P.copy(U).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(b,C,M),D.copy(b).sub(_).normalize(),Dt.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var t=c.intersectObjects(i.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){c.setFromCamera(e,this.camera);var t=c.intersectObjects([r],!0)[0]||!1;if(t){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),R.copy(this.object.position),O.copy(this.object.quaternion),N.copy(this.object.scale),this.object.matrixWorld.decompose(T,L,F),p.copy(t.point).sub(T)}this.dragging=!0,s.mode=this.mode,this.dispatchEvent(s)}},this.pointerMove=function(e){var t=this.axis,n=this.mode,i=this.object,a=this.space;if("scale"===n?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var s=c.intersectObjects([r],!0)[0]||!1;if(!1!==s){if(m.copy(s.point).sub(T),"translate"===n)g.copy(m).sub(p),"local"===a&&"XYZ"!==t&&g.applyQuaternion(P),-1===t.indexOf("X")&&(g.x=0),-1===t.indexOf("Y")&&(g.y=0),-1===t.indexOf("Z")&&(g.z=0),"local"===a&&"XYZ"!==t?g.applyQuaternion(O).divide(S):g.applyQuaternion(E).divide(S),i.position.copy(g).add(R),this.translationSnap&&("local"===a&&(i.position.applyQuaternion(d.copy(O).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(O)),"world"===a&&(i.parent&&i.position.add(h.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(h.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var A=m.length()/p.length();m.dot(p)<0&&(A*=-1),u.set(A,A,A)}else h.copy(p),u.copy(m),h.applyQuaternion(P),u.applyQuaternion(P),u.divide(h),-1===t.search("X")&&(u.x=1),-1===t.search("Y")&&(u.y=1),-1===t.search("Z")&&(u.z=1);i.scale.copy(N).multiply(u)}else if("rotate"===n){g.copy(m).sub(p);var b=20/_.distanceTo(h.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(v.copy(D),x=m.angleTo(p),y.copy(p).normalize(),w.copy(m).normalize(),x*=w.cross(y).dot(D)<0?1:-1):"XYZE"===t?(v.copy(g).cross(D).normalize(),x=g.dot(h.copy(v).cross(this.eye))*b):"X"!==t&&"Y"!==t&&"Z"!==t||(v.copy(f[t]),h.copy(f[t]),"local"===a&&h.applyQuaternion(U),x=g.dot(h.cross(D).normalize())*b),this.rotationSnap&&(x=Math.round(x/this.rotationSnap)*this.rotationSnap),this.rotationAngle=x,"local"===a&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(O),i.quaternion.multiply(d.setFromAxisAngle(v,x)).normalize()):(v.applyQuaternion(E),i.quaternion.copy(d.setFromAxisAngle(v,x)),i.quaternion.multiply(O).normalize())}l.pointer=e,this.dispatchEvent(o),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(A.mode=this.mode,this.dispatchEvent(A)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return a.mode},this.setMode=function(e){a.mode=e},this.setTranslationSnap=function(e){a.translationSnap=e},this.setRotationSnap=function(e){a.rotationSnap=e},this.setSize=function(e){a.size=e},this.setSpace=function(e){a.space=e},this.update=function(){}};Mu.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Mu,isTransformControls:!0});var Bu=function(e){Dt.call(this),this.type="TransformControlsGizmo";var t=new kn({depthTest:!1,depthWrite:!1,transparent:!0,side:2,fog:!1}),n=new Fo({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),i=t.clone();i.opacity=.15;var r=t.clone();r.opacity=.33;var a=t.clone();a.color.set(16711680);var o=t.clone();o.color.set(65280);var s=t.clone();s.color.set(255);var A=t.clone();A.opacity=.25;var l=A.clone();l.color.set(16776960);var c=A.clone();c.color.set(65535);var h=A.clone();h.color.set(16711935),t.clone().color.set(16776960);var u=n.clone();u.color.set(16711680);var d=n.clone();d.color.set(65280);var f=n.clone();f.color.set(255);var p=n.clone();p.color.set(65535);var m=n.clone();m.color.set(16711935);var g=n.clone();g.color.set(16776960);var v=n.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var w=new aA(0,.05,.2,12,1,!1),x=new Li(.125,.125,.125),b=new ni;b.setAttribute("position",new Vn([0,0,0,1,0,0],3));var C=function(e,t){for(var n=new ni,i=[],r=0;r<=64*t;++r)i.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return n.setAttribute("position",new Vn(i,3)),n},M={X:[[new xi(w,a),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new xi(w,a),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Ro(b,u)]],Y:[[new xi(w,o),[0,1,0],null,null,"fwd"],[new xi(w,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Ro(b,d),null,[0,0,Math.PI/2]]],Z:[[new xi(w,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new xi(w,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Ro(b,f),null,[0,-Math.PI/2,0]]],XYZ:[[new xi(new os(.1,0),A.clone()),[0,0,0],[0,0,0]]],XY:[[new xi(new Ki(.295,.295),l.clone()),[.15,.15,0]],[new Ro(b,g),[.18,.3,0],null,[.125,1,1]],[new Ro(b,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new xi(new Ki(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Ro(b,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Ro(b,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new xi(new Ki(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Ro(b,m),[.18,0,.3],null,[.125,1,1]],[new Ro(b,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]};e&&(delete M.XYZ,delete M.XY,delete M.YZ,delete M.XZ);var B={X:[[new xi(new aA(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new xi(new aA(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new xi(new aA(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new xi(new os(.2,0),i)]],XY:[[new xi(new Ki(.4,.4),i),[.2,.2,0]]],YZ:[[new xi(new Ki(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new xi(new Ki(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]};e&&(delete B.XYZ,delete B.XY,delete B.YZ,delete B.XZ);var I,E={START:[[new xi(new os(.01,2),r),null,null,null,"helper"]],END:[[new xi(new os(.01,2),r),null,null,null,"helper"]],DELTA:[[new Ro((I=new ni,I.setAttribute("position",new Vn([0,0,0,1,1,1],3)),I),r),null,null,null,"helper"]],X:[[new Ro(b,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ro(b,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ro(b,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},S={X:[[new Ro(C(1,.5),u)],[new xi(new os(.04,0),a),[0,0,.99],null,[1,3,1]]],Y:[[new Ro(C(1,.5),d),null,[0,0,-Math.PI/2]],[new xi(new os(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new Ro(C(1,.5),f),null,[0,Math.PI/2,0]],[new xi(new os(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new Ro(C(1.25,1),y),null,[0,Math.PI/2,0]],[new xi(new aA(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new xi(new aA(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new xi(new aA(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new xi(new aA(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Ro(C(1,1),v),null,[0,Math.PI/2,0]]]},T={AXIS:[[new Ro(b,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={X:[[new xi(new ms(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new xi(new ms(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new xi(new ms(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new xi(new ms(1.25,.1,2,24),i)]],XYZE:[[new xi(new Ys(.7,10,8),i)]]},F={X:[[new xi(x,a),[.8,0,0],[0,0,-Math.PI/2]],[new Ro(b,u),null,null,[.8,1,1]]],Y:[[new xi(x,o),[0,.8,0]],[new Ro(b,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new xi(x,s),[0,0,.8],[Math.PI/2,0,0]],[new Ro(b,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new xi(x,l),[.85,.85,0],null,[2,2,.2]],[new Ro(b,g),[.855,.98,0],null,[.125,1,1]],[new Ro(b,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new xi(x,c),[0,.85,.85],null,[.2,2,2]],[new Ro(b,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Ro(b,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new xi(x,h),[.85,0,.85],null,[2,.2,2]],[new Ro(b,m),[.855,0,.98],null,[.125,1,1]],[new Ro(b,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new xi(new Li(.125,.125,.125),A.clone()),[1.1,0,0]]],XYZY:[[new xi(new Li(.125,.125,.125),A.clone()),[0,1.1,0]]],XYZZ:[[new xi(new Li(.125,.125,.125),A.clone()),[0,0,1.1]]]},_={X:[[new xi(new aA(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new xi(new aA(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new xi(new aA(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new xi(x,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new xi(x,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new xi(x,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new xi(new Li(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new xi(new Li(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new xi(new Li(.2,.2,.2),i),[0,0,1.1]]]},U={X:[[new Ro(b,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ro(b,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ro(b,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P=function(e){var t=new Dt;for(var n in e)for(var i=e[n].length;i--;){var r=e[n][i][0].clone(),a=e[n][i][1],o=e[n][i][2],s=e[n][i][3],A=e[n][i][4];r.name=n,r.tag=A,a&&r.position.set(a[0],a[1],a[2]),o&&r.rotation.set(o[0],o[1],o[2]),s&&r.scale.set(s[0],s[1],s[2]),r.updateMatrix();var l=r.geometry.clone();l.applyMatrix(r.matrix),r.geometry=l,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t},k=new tt(0,0,0),D=new xt,R=new tt(0,1,0),O=new tt(0,0,0),N=new vt,G=new qe,Q=new qe,H=new qe,z=new tt(1,0,0),V=new tt(0,1,0),j=new tt(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(M)),this.add(this.gizmo.rotate=P(S)),this.add(this.gizmo.scale=P(F)),this.add(this.picker.translate=P(B)),this.add(this.picker.rotate=P(L)),this.add(this.picker.scale=P(_)),this.add(this.helper.translate=P(E)),this.add(this.helper.rotate=P(T)),this.add(this.helper.scale=P(U)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:H;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var n=[];n=(n=(n=n.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var i=0;i<n.length;i++){var r=n[i];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);var a=this.worldPosition.distanceTo(this.cameraPosition);if(r.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==r.tag){if(r.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){var o=.99;"X"!==r.name&&"XYZX"!==r.name||Math.abs(R.copy(z).applyQuaternion(t).dot(this.eye))>o&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Y"!==r.name&&"XYZY"!==r.name||Math.abs(R.copy(V).applyQuaternion(t).dot(this.eye))>o&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Z"!==r.name&&"XYZZ"!==r.name||Math.abs(R.copy(j).applyQuaternion(t).dot(this.eye))>o&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XY"===r.name&&Math.abs(R.copy(j).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"YZ"===r.name&&Math.abs(R.copy(z).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XZ"===r.name&&Math.abs(R.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),-1!==r.name.search("X")&&(R.copy(z).applyQuaternion(t).dot(this.eye)<0?"fwd"===r.tag?r.visible=!1:r.scale.x*=-1:"bwd"===r.tag&&(r.visible=!1)),-1!==r.name.search("Y")&&(R.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===r.tag?r.visible=!1:r.scale.y*=-1:"bwd"===r.tag&&(r.visible=!1)),-1!==r.name.search("Z")&&(R.copy(j).applyQuaternion(t).dot(this.eye)<0?"fwd"===r.tag?r.visible=!1:r.scale.z*=-1:"bwd"===r.tag&&(r.visible=!1))}else"rotate"===this.mode&&(Q.copy(t),R.copy(this.eye).applyQuaternion(G.copy(t).inverse()),-1!==r.name.search("E")&&r.quaternion.setFromRotationMatrix(N.lookAt(this.eye,O,V)),"X"===r.name&&(G.setFromAxisAngle(z,Math.atan2(-R.y,R.z)),G.multiplyQuaternions(Q,G),r.quaternion.copy(G)),"Y"===r.name&&(G.setFromAxisAngle(V,Math.atan2(R.x,R.z)),G.multiplyQuaternions(Q,G),r.quaternion.copy(G)),"Z"===r.name&&(G.setFromAxisAngle(j,Math.atan2(R.y,R.x)),G.multiplyQuaternions(Q,G),r.quaternion.copy(G)));r.visible=r.visible&&(-1===r.name.indexOf("X")||this.showX),r.visible=r.visible&&(-1===r.name.indexOf("Y")||this.showY),r.visible=r.visible&&(-1===r.name.indexOf("Z")||this.showZ),r.visible=r.visible&&(-1===r.name.indexOf("E")||this.showX&&this.showY&&this.showZ),r.material._opacity=r.material._opacity||r.material.opacity,r.material._color=r.material._color||r.material.color.clone(),r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled?this.axis&&(r.name===this.axis||this.axis.split("").some((function(e){return r.name===e}))?(r.material.opacity=1,r.material.color.lerp(new Sn(1,1,1),.5)):(r.material.opacity*=.25,r.material.color.lerp(new Sn(1,1,1),.5))):(r.material.opacity*=.5,r.material.color.lerp(new Sn(1,1,1),.5))}else r.visible=!1,"AXIS"===r.name?(r.position.copy(this.worldPositionStart),r.visible=!!this.axis,"X"===this.axis&&(G.setFromEuler(D.set(0,0,0)),r.quaternion.copy(t).multiply(G),Math.abs(R.copy(z).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Y"===this.axis&&(G.setFromEuler(D.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(G),Math.abs(R.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Z"===this.axis&&(G.setFromEuler(D.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(G),Math.abs(R.copy(j).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"XYZE"===this.axis&&(G.setFromEuler(D.set(0,Math.PI/2,0)),R.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(N.lookAt(O,R,V)),r.quaternion.multiply(G),r.visible=this.dragging),"E"===this.axis&&(r.visible=!1)):"START"===r.name?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):"END"===r.name?(r.position.copy(this.worldPosition),r.visible=this.dragging):"DELTA"===r.name?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),k.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),k.applyQuaternion(this.worldQuaternionStart.clone().inverse()),r.scale.copy(k),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=-1!==this.axis.search(r.name)))}Dt.prototype.updateMatrixWorld.call(this)}};Bu.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Bu,isTransformControlsGizmo:!0});var Iu=function(){xi.call(this,new Ki(1e5,1e5,2,2),new kn({visible:!1,wireframe:!0,side:2,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new tt(1,0,0),t=new tt(0,1,0),n=new tt(0,0,1),i=new tt,r=new tt,a=new tt,o=new vt,s=new qe;this.updateMatrixWorld=function(){var A=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(A="local"),e.set(1,0,0).applyQuaternion("local"===A?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===A?this.worldQuaternion:s),n.set(0,0,1).applyQuaternion("local"===A?this.worldQuaternion:s),a.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(e),r.copy(e).cross(a);break;case"Y":a.copy(this.eye).cross(t),r.copy(t).cross(a);break;case"Z":a.copy(this.eye).cross(n),r.copy(n).cross(a);break;case"XY":r.copy(n);break;case"YZ":r.copy(e);break;case"XZ":a.copy(n),r.copy(t);break;case"XYZ":case"E":r.set(0,0,0)}break;case"rotate":default:r.set(0,0,0)}0===r.length()?this.quaternion.copy(this.cameraQuaternion):(o.lookAt(i.set(0,0,0),r,a),this.quaternion.setFromRotationMatrix(o)),Dt.prototype.updateMatrixWorld.call(this)}};Iu.prototype=Object.assign(Object.create(xi.prototype),{constructor:Iu,isTransformControlsPlane:!0});var Eu,Su=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this,e)).antiAliasing=mu.SMAA,a.options.strength=void 0!==a.options.strength?a.options.strength:1,a.options.radius=void 0!==a.options.radius?a.options.radius:0,a.options.threshold=void 0!==a.options.threshold?a.options.threshold:0,a._bloomPass={},a._materials={},a._darkMaterial=new kn({color:"black"}),a._objects=[],a.isUnrealBloom=!0,a.viewer=i,a}return o(n,[{key:"init",value:function(e){var t=new Je(e.width,e.height);this._bloomPass=new bu(t,this.options.strength,this.options.radius,this.options.threshold),this._bloomLayer=new bt,this._bloomLayer.set(1),this._composer=new lu(e.renderer),this._composer.renderToScreen=!1;var i=new Cu(e.scene,e.camera);i.sampleLevel=4,this._composer.addPass(i),this._composer.addPass(new ou(au)),this._composer.addPass(this._bloomPass),this.pass=new ou(new Pi({uniforms:{baseTexture:{value:null},bloomTexture:{value:this._composer.renderTarget2.texture}},vertexShader:"varying vec2 vUv;\n\t\t\t    void main() {\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t    }",fragmentShader:"uniform sampler2D baseTexture;\n                    uniform sampler2D bloomTexture;\n                    varying vec2 vUv;\n                    vec4 getTexture( sampler2D texelToLinearTexture ) {\n                        return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );\n                    }\n                    void main() {\n                        gl_FragColor = ( getTexture( baseTexture ) + vec4( 1.0 ) * getTexture( bloomTexture ) );\n                    }",defines:{}}),"baseTexture"),this.pass.needsSwap=!0,g(l(n.prototype),"init",this).call(this)}},{key:"setSize",value:function(e,t){this._composer.setSize(e,t)}},{key:"setStrength",value:function(e){this._bloomPass.strength=e,this.viewer.renderManager.render()}},{key:"getStrength",value:function(){return this._bloomPass.strength}},{key:"setRadius",value:function(e){this._bloomPass.radius=e,this.viewer.renderManager.render()}},{key:"getRadius",value:function(){return this._bloomPass.radius}},{key:"setThreshold",value:function(e){this._bloomPass.threshold=e,this.viewer.renderManager.render()}},{key:"getThreshold",value:function(){return this._bloomPass.threshold}},{key:"setExposure",value:function(e){this._bloomPass.exposure=e}},{key:"getExposure",value:function(){return this._bloomPass.exposure||1}},{key:"add",value:function(e){var t=this._objects;function n(e){t.includes(e)||(e.layers.mask=3,e.bloom=!0,t.push(e))}"Mesh"===e.type&&n(e),"Object3D"!==e.type&&"Group"!==e.type||e.traverse((function(e){"Mesh"===e.type&&n(e)}))}},{key:"remove",value:function(e){var t=this._objects;function n(e){t.includes(e)&&(e.layers.mask=1,delete e.bloom,t.splice(t.indexOf(e),1))}"Mesh"===e.type&&n(e),"Object3D"!==e.type&&"Group"!==e.type||e.traverse((function(e){"Mesh"===e.type&&n(e)}))}},{key:"clear",value:function(){this._objects.map((function(e){e.layers.mask=1,delete e.bloom})),this._objects=[]}},{key:"render",value:function(){var e,t,n=this;this.viewer.scene.traverse((function(i){"_shadow.mesh"==i.name&&(e=i),i.constructor===Mu&&i.enabled&&(t=i),n._darkenNonBloomed(i)}));var i=this.viewer.scene.background;this.viewer.scene.background=null,e&&(e.visible=!1),t&&(t.visible=!1),this._composer.render(),this.viewer.scene.background=i,e&&(e.visible=!0),t&&(t.visible=!0),this.viewer.scene.traverse((function(e){n._restoreMaterial(e)}))}},{key:"_darkenNonBloomed",value:function(e){(e.isMesh||e.isSprite)&&!1===this._bloomLayer.test(e.layers)&&(this._materials[e.uuid]=e.material,e.material=this._darkMaterial)}},{key:"_restoreMaterial",value:function(e){this._materials[e.uuid]&&(e.material=this._materials[e.uuid],delete this._materials[e.uuid])}}]),n}(gu),Tu={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","\tvec2 aspectcorrect = vec2( 1.0, aspect );","\tfloat viewZ = getViewZ( getDepth( vUv ) );","\tfloat factor = ( focus + viewZ );","\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","\tvec2 dofblur9 = dofblur * 0.9;","\tvec2 dofblur7 = dofblur * 0.7;","\tvec2 dofblur4 = dofblur * 0.4;","\tvec4 col = vec4( 0.0 );","\tcol += texture2D( tColor, vUv.xy );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","\tgl_FragColor = col / 41.0;","\tgl_FragColor.a = 1.0;","}"].join("\n")},Lu=function(e,t,n){iu.call(this),this.scene=e,this.camera=t,this.apertureScale=1,this.focus=void 0!==n.focus?n.focus:1,this.aspect=void 0!==n.aspect?n.aspect:t.aspect,this.aperture=void 0!==n.aperture?n.aperture:.025,this.maxblur=void 0!==n.maxblur?n.maxblur:1;var i=n.width||window.innerWidth||1,r=n.height||window.innerHeight||1;this.renderTargetDepth=new lt(i,r,{minFilter:z,magFilter:z}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new Pa,this.materialDepth.depthPacking=Qe,this.materialDepth.blending=0,void 0===Tu&&console.error("BokehPass relies on BokehShader");var a=Tu,o=Ui.clone(a.uniforms);o.tDepth.value=this.renderTargetDepth.texture,o.focus.value=this.focus,o.aspect.value=this.aspect,o.aperture.value=this.aperture,o.maxblur.value=this.maxblur,o.nearClip.value=t.near,o.farClip.value=t.far,this.materialBokeh=new Pi({defines:Object.assign({},a.defines),uniforms:o,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.uniforms=o,this.needsSwap=!1,this.fsQuad=new iu.FullScreenQuad(this.materialBokeh),this.oldClearColor=new Sn};Lu.prototype=Object.assign(Object.create(iu.prototype),{constructor:Lu,render:function(e,t,n){this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor());var i=e.getClearAlpha(),r=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.focus.value=this.focus,this.focus>.1?this.apertureScale=.1/this.focus:this.apertureScale=1,this.uniforms.aspect.value=this.aspect,this.uniforms.aperture.value=this.aperture*this.apertureScale,this.uniforms.maxblur.value=this.maxblur,this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(i),e.autoClear=r}});var Fu=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),(e=t.call(this)).antiAliasing=null,e.focus=i.focus||500,e.aperture=i.aperture||1,e.maxblur=i.maxblur||.01,e.apertureScale=1,e}return o(n,[{key:"init",value:function(e){Eu||(Eu=new Lu(e.scene,e.camera,{focus:this.focus,aperture:this.aperture,maxblur:this.maxblur}),this.pass=Eu),g(l(n.prototype),"init",this).call(this)}},{key:"setFocus",value:function(e){this.focus=e,this.pass.focus=e}},{key:"setAperture",value:function(e){this.aperture=e,this.pass.aperture=e}},{key:"setMaxblur",value:function(e){this.maxblur=e,this.pass.maxblur=.001*e}},{key:"setAspect",value:function(e){this.pass.uniforms.aspect.value=e}}]),n}(gu),_u=function(e,t,n){iu.call(this),this.h=e,this.s=t,this.v=n,this.uniform={h:{value:0},s:{value:0},v:{value:0},t2D:{value:null}},this.material=new Pi({uniforms:this.uniform,vertexShader:"\nvarying vec2 vUv;\n//uniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = uv;\n\t//vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n\n",fragmentShader:"\n\n    float lerpFloat(float a,float b,float f){\n        return a * (1.0 - f) + b * f;\n    }\n\n    vec3 lerp(vec3 a,vec3 b,float f){\n        vec3 final = vec3(0.0,0.0,0.0);\n        final.x = lerpFloat(a.x,b.x,f);\n        final.y = lerpFloat(a.y,b.y,f);\n        final.z = lerpFloat(a.z,b.z,f);\n        return final;\n    }\n\n    vec4 lerp4(vec4 a,vec4 b,float f){\n        vec4 final = vec4(0.0,0.0,0.0,0.0);\n        final.x = lerpFloat(a.x,b.x,f);\n        final.y = lerpFloat(a.y,b.y,f);\n        final.z = lerpFloat(a.z,b.z,f);\n        final.w = lerpFloat(a.w,b.w,f);\n        return final;\n    }\n\n    vec3 HSV2RGB(vec3 c)\n    {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * lerp(K.xxx, saturate(p - K.xxx), c.y);\n    }\n\n    vec3 RgbToHsv(vec3 c)\n    {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = lerp4(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n        vec4 q = lerp4(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    float RotateHue(float value, float low, float hi)\n    {\n        return (value < low)? value + hi : (value > hi)? value - hi : value;\n    }\n\n    float Luminance(vec3 linearRgb)\n    {\n        return dot(linearRgb, vec3(0.2126729, 0.7151522, 0.0721750));\n    } \n\n    vec3 Saturation(vec3 c, float sat)\n    {\n        vec3 satV = vec3(sat,sat,sat);\n        float luma = Luminance(c);\n        vec3 lumaV = vec3(luma,luma,luma);\n        return lumaV.xxx + satV.xxx * (c - lumaV.xxx);\n    }\n\n    uniform sampler2D t2D;\n\n    uniform float h;\n    uniform float s;\n    uniform float v;\n\n    varying vec2 vUv;\n\n\n    void main() {\n\n        vec4 texColor = texture2D( t2D, vUv );\n\n        vec3 hsv = RgbToHsv(texColor.rgb);\n        float hue = hsv.x + h;\n        hsv.x = RotateHue(hue, 0.0, 1.0);\n        //hsv.y+=s;\n        hsv.z+=v;\n        texColor.rgb = HSV2RGB(hsv);\n        texColor.rgb = Saturation(texColor.rgb, 1.0 + s);\n\n        gl_FragColor = mapTexelToLinear( texColor );\n\n        #include <tonemapping_fragment>\n        #include <encodings_fragment>\n\n    }\n\n"}),this.fsQuad=new iu.FullScreenQuad(this.material)};_u.prototype=Object.assign(Object.create(iu.prototype),{constructor:_u,render:function(e,t,n,i){this.uniform.h.value=this.h,this.uniform.s.value=this.s,this.uniform.v.value=this.v,this.uniform.t2D.value=n.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}});var Uu=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).h=0,i.s=0,i.v=0,i.pass=new _u(i.h,i.s,i.v),i}return o(n,[{key:"getHue",value:function(){return this.pass.h}},{key:"setHue",value:function(e){this.pass.h=e}},{key:"getContrast",value:function(){return this.pass.s}},{key:"setContrast",value:function(e){this.pass.s=e}},{key:"getVibrance",value:function(){return this.pass.v}},{key:"setVibrance",value:function(e){this.pass.v=e}}]),n}(gu),Pu=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};Pu.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},Pu.prototype.dot3=function(e,t,n,i){return e[0]*t+e[1]*n+e[2]*i},Pu.prototype.dot4=function(e,t,n,i,r){return e[0]*t+e[1]*n+e[2]*i+e[3]*r},Pu.prototype.noise=function(e,t){var n,i,r=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+r),o=Math.floor(t+r),s=(3-Math.sqrt(3))/6,A=(a+o)*s,l=e-(a-A),c=t-(o-A);l>c?(n=1,i=0):(n=0,i=1);var h=l-n+s,u=c-i+s,d=l-1+2*s,f=c-1+2*s,p=255&a,m=255&o,g=this.perm[p+this.perm[m]]%12,v=this.perm[p+n+this.perm[m+i]]%12,y=this.perm[p+1+this.perm[m+1]]%12,w=.5-l*l-c*c,x=.5-h*h-u*u,b=.5-d*d-f*f;return 70*((w<0?0:(w*=w)*w*this.dot(this.grad3[g],l,c))+(x<0?0:(x*=x)*x*this.dot(this.grad3[v],h,u))+(b<0?0:(b*=b)*b*this.dot(this.grad3[y],d,f)))},Pu.prototype.noise3d=function(e,t,n){var i,r,a,o,s,A,l=(e+t+n)*(1/3),c=Math.floor(e+l),h=Math.floor(t+l),u=Math.floor(n+l),d=1/6,f=(c+h+u)*d,p=e-(c-f),m=t-(h-f),g=n-(u-f);p>=m?m>=g?(i=1,r=0,a=0,o=1,s=1,A=0):p>=g?(i=1,r=0,a=0,o=1,s=0,A=1):(i=0,r=0,a=1,o=1,s=0,A=1):m<g?(i=0,r=0,a=1,o=0,s=1,A=1):p<g?(i=0,r=1,a=0,o=0,s=1,A=1):(i=0,r=1,a=0,o=1,s=1,A=0);var v=p-i+d,y=m-r+d,w=g-a+d,x=p-o+2*d,b=m-s+2*d,C=g-A+2*d,M=p-1+.5,B=m-1+.5,I=g-1+.5,E=255&c,S=255&h,T=255&u,L=this.perm[E+this.perm[S+this.perm[T]]]%12,F=this.perm[E+i+this.perm[S+r+this.perm[T+a]]]%12,_=this.perm[E+o+this.perm[S+s+this.perm[T+A]]]%12,U=this.perm[E+1+this.perm[S+1+this.perm[T+1]]]%12,P=.6-p*p-m*m-g*g,k=.6-v*v-y*y-w*w,D=.6-x*x-b*b-C*C,R=.6-M*M-B*B-I*I;return 32*((P<0?0:(P*=P)*P*this.dot3(this.grad3[L],p,m,g))+(k<0?0:(k*=k)*k*this.dot3(this.grad3[F],v,y,w))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[_],x,b,C))+(R<0?0:(R*=R)*R*this.dot3(this.grad3[U],M,B,I)))},Pu.prototype.noise4d=function(e,t,n,i){var r,a,o,s,A,l,c,h,u,d,f,p,m=this.grad4,g=this.simplex,v=this.perm,y=(Math.sqrt(5)-1)/4,w=(5-Math.sqrt(5))/20,x=(e+t+n+i)*y,b=Math.floor(e+x),C=Math.floor(t+x),M=Math.floor(n+x),B=Math.floor(i+x),I=(b+C+M+B)*w,E=e-(b-I),S=t-(C-I),T=n-(M-I),L=i-(B-I),F=(E>S?32:0)+(E>T?16:0)+(S>T?8:0)+(E>L?4:0)+(S>L?2:0)+(T>L?1:0),_=E-(r=g[F][0]>=3?1:0)+w,U=S-(a=g[F][1]>=3?1:0)+w,P=T-(o=g[F][2]>=3?1:0)+w,k=L-(s=g[F][3]>=3?1:0)+w,D=E-(A=g[F][0]>=2?1:0)+2*w,R=S-(l=g[F][1]>=2?1:0)+2*w,O=T-(c=g[F][2]>=2?1:0)+2*w,N=L-(h=g[F][3]>=2?1:0)+2*w,G=E-(u=g[F][0]>=1?1:0)+3*w,Q=S-(d=g[F][1]>=1?1:0)+3*w,H=T-(f=g[F][2]>=1?1:0)+3*w,z=L-(p=g[F][3]>=1?1:0)+3*w,V=E-1+4*w,j=S-1+4*w,W=T-1+4*w,X=L-1+4*w,Z=255&b,Y=255&C,K=255&M,J=255&B,q=v[Z+v[Y+v[K+v[J]]]]%32,$=v[Z+r+v[Y+a+v[K+o+v[J+s]]]]%32,ee=v[Z+A+v[Y+l+v[K+c+v[J+h]]]]%32,te=v[Z+u+v[Y+d+v[K+f+v[J+p]]]]%32,ne=v[Z+1+v[Y+1+v[K+1+v[J+1]]]]%32,ie=.6-E*E-S*S-T*T-L*L,re=.6-_*_-U*U-P*P-k*k,ae=.6-D*D-R*R-O*O-N*N,oe=.6-G*G-Q*Q-H*H-z*z,se=.6-V*V-j*j-W*W-X*X;return 27*((ie<0?0:(ie*=ie)*ie*this.dot4(m[q],E,S,T,L))+(re<0?0:(re*=re)*re*this.dot4(m[$],_,U,P,k))+(ae<0?0:(ae*=ae)*ae*this.dot4(m[ee],D,R,O,N))+(oe<0?0:(oe*=oe)*oe*this.dot4(m[te],G,Q,H,z))+(se<0?0:(se*=se)*se*this.dot4(m[ne],V,j,W,X)))};var ku={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Je},cameraProjectionMatrix:{value:new vt},cameraInverseProjectionMatrix:{value:new vt},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},Du={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},Ru={uniforms:{tDiffuse:{value:null},resolution:{value:new Je}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")},Ou=function(e,t,n,i){iu.call(this),this.width=void 0!==n?n:512,this.height=void 0!==i?i:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var r=new Jo;r.type=K,r.minFilter=z,r.maxFilter=z,this.beautyRenderTarget=new lt(this.width,this.height,{minFilter:W,magFilter:W,format:oe,depthTexture:r,depthBuffer:!0,stencilBuffer:!0}),this.normalRenderTarget=new lt(this.width,this.height,{minFilter:z,magFilter:z,format:oe,stencilBuffer:!0}),this.ssaoRenderTarget=new lt(this.width,this.height,{minFilter:W,magFilter:W,format:oe,stencilBuffer:!0}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new Pi({defines:Object.assign({},ku.defines),uniforms:Ui.clone(ku.uniforms),vertexShader:ku.vertexShader,fragmentShader:ku.fragmentShader,blending:0,stencilWrite:!0}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new gA,this.normalMaterial.blending=0,this.normalMaterial.stencilWrite=!0,this.blurMaterial=new Pi({defines:Object.assign({},Ru.defines),uniforms:Ui.clone(Ru.uniforms),vertexShader:Ru.vertexShader,fragmentShader:Ru.fragmentShader,stencilWrite:!0}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new Pi({defines:Object.assign({},Du.defines),uniforms:Ui.clone(Du.uniforms),vertexShader:Du.vertexShader,fragmentShader:Du.fragmentShader,blending:0,stencilWrite:!0}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new Pi({uniforms:Ui.clone(au.uniforms),vertexShader:au.vertexShader,fragmentShader:au.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:U,blendDst:E,blendEquation:I,blendSrcAlpha:_,blendDstAlpha:E,blendEquationAlpha:I,stencilWrite:!0}),this.fsQuad=new iu.FullScreenQuad(null),this.originalClearColor=new Sn};Ou.prototype=Object.assign(Object.create(iu.prototype),{constructor:Ou,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.quad.geometry.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose()},toggleBackgroundVisible:function(e){e?(this.scene.background=this.scene._background,this.scene._shadow&&(this.scene._shadow.visible=!0),delete this.scene._background,delete this.scene._shadow):(this.scene._background=this.scene.background,this.scene.background=null,this.scene._shadow&&(this.scene._shadow.visible=!1))},render:function(e,t,n,i,r){switch(this.beautyRenderTarget=n,this.toggleBackgroundVisible(!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.toggleBackgroundVisible(!0),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case Ou.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Ou.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Ou.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Ou.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case Ou.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Ou.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=5,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("SSAOPass: Unknown output type.")}},renderPass:function(e,t,n,i,r){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(r||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},renderOverride:function(e,t,n,i,r){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,i=t.clearColor||i,r=t.clearAlpha||r,null!=i&&(e.setClearColor(i),e.setClearAlpha(r||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,n=0;n<e;n++){var i=new tt;i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=Math.random(),i.normalize();var r=n/e;r=Ke.lerp(.1,1,r*r),i.multiplyScalar(r),t.push(i)}},generateRandomKernelRotations:function(){for(var e=new Pu,t=new Float32Array(64),n=0;n<16;n++){var i=4*n,r=2*Math.random()-1,a=2*Math.random()-1,o=e.noise3d(r,a,0);t[i]=o,t[i+1]=o,t[i+2]=o,t[i+3]=1}this.noiseTexture=new Gi(t,4,4,oe,q),this.noiseTexture.wrapS=G,this.noiseTexture.wrapT=G}}),Ou.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};var Nu=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).antiAliasing=mu.SMAA,e.radius=8,e.size=32,e.minDistance=1e-4,e.maxDistance=.001,e}return o(n,[{key:"init",value:function(e){this.scene=e.scene,this.pass=new Ou(e.scene,e.camera,e.width,e.height),this.pass.kernelRadius=this.radius,this.pass.kernelSize=this.size,this.pass.minDistance=this.minDistance,this.pass.maxDistance=this.maxDistance,g(l(n.prototype),"init",this).call(this)}},{key:"setMaxDistance",value:function(e){this.pass.maxDistance=e}},{key:"setMinDistance",value:function(e){this.pass.minDistance=e}},{key:"setRadius",value:function(e){this.pass.kernelRadius=e}},{key:"getRadius",value:function(){return this.pass.kernelRadius}},{key:"setStrength",value:function(e){this.pass.maxDistance=1e-4*e+1e-4}},{key:"getStrength",value:function(){return(this.pass.maxDistance-1e-4)/1e-4}}]),n}(gu),Gu=function(e,t){iu.call(this),this.oldClearColor=new Sn,this.oldClearAlpha=1,this.textureID=void 0!==t?t:"tDiffuse",e instanceof Pi?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Ui.clone(e.uniforms),this.material=new Pi({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new iu.FullScreenQuad(this.material)};Gu.prototype=Object.assign(Object.create(iu.prototype),{constructor:Gu,render:function(e,t,n,i,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e),e.setRenderTarget(null)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a,r&&e.state.buffers.stencil.setTest(!0)}});var Qu={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tfloat dist = distance( vUv, vec2( 0.5 ) );","\tfloat darkness2 = darkness*1.5;","\tfloat offset2 = pow(offset,2.0);","\tcolor.rgb *= smoothstep( 0.8, offset2 * 0.799, dist *( darkness2 + offset2 ) );","\tgl_FragColor = color;","}"].join("\n")},Hu=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this,i),null==i.darkness&&(i.darkness=.5),null==i.offset&&(i.offset=.5),e}return o(n,[{key:"init",value:function(e){this.pass=new Gu(Qu),this.pass.enabled=!0,this.pass.uniforms.darkness.value=this.options.darkness,this.pass.uniforms.offset.value=this.options.offset,g(l(n.prototype),"init",this).call(this)}},{key:"getDarkness",value:function(){return this.pass.uniforms.darkness.value}},{key:"setDarkness",value:function(e){this.pass.uniforms.darkness.value=e}},{key:"getOffset",value:function(){return this.pass.uniforms.offset.value}},{key:"setOffset",value:function(e){this.pass.uniforms.offset.value=e}}]),n}(gu),zu=function(e,t,n,i){iu.call(this),this.renderScene=e,this.renderCamera=t,this.oldClearColor=new Sn,this.oldClearAlpha=1,i=i||{},this.center=i.center?(new tt).copy(i.center):new tt(0,0,0),this.maxRange=i.maxRange?i.maxRange:50;var r=i.speed?i.speed:30;this.frameSpeed=r/60,this.radius=i.radius?i.radius:5,this.innerRadius=-this.radius,this.outerRadius=0,this.fillType=0==i.fillType?0:1,this.fillColor=i.fillColor?i.fillColor:new Sn("#ffff00");var a={minFilter:W,magFilter:W,format:oe,stencilBuffer:!0},o=n.getSize(new Je),s=n.getPixelRatio(),A=o.width,l=o.height;this.depthTarget=new lt(A*s,l*s,a),this.depthTarget.depthBuffer=!0,this.depthTarget.depthTexture=new Jo;var c=this.getShaderOptions();this.depthMaterial=new Pi(c),this.fsQuad=new iu.FullScreenQuad(this.depthMaterial)};zu.prototype=Object.assign(Object.create(iu.prototype),{constructor:zu,render:function(e,t,n,i,r){this.updateUniforms(n);var a=e.autoClear;e.autoClear=!1,e.setRenderTarget(t),this.fsQuad.render(e),e.setRenderTarget(this.depthTarget),e.render(this.renderScene,this.renderCamera),e.setRenderTarget(null),e.autoClear=a},calCameraVectors:function(){var e=this.renderCamera,t=e.near,n=e.fov,i=e.aspect,r=Math.tan(this.ang2rad(n/2))*t,a=r*i,o=new tt(0,0,1).applyMatrix4(e.matrixWorld.clone());o.sub(e.position.clone()),o.normalize();var s=new tt(-1,0,0).applyMatrix4(e.matrixWorld.clone());s.sub(e.position.clone()),s.normalize();var A=new tt(0,-1,0).applyMatrix4(e.matrixWorld.clone());A.sub(e.position.clone()),A.normalize();var l=s.multiplyScalar(a),c=A.multiplyScalar(r),h=o.clone().multiplyScalar(t).add(c.clone()).sub(l.clone()),u=h.length()/t;h.normalize(),h.multiplyScalar(-u);var d=o.clone().multiplyScalar(t).add(l.clone()).add(c.clone());d.normalize(),d.multiplyScalar(-u);var f=o.clone().multiplyScalar(t).sub(c.clone()).sub(l.clone());f.normalize(),f.multiplyScalar(-u);var p=o.clone().multiplyScalar(t).add(l.clone()).sub(c.clone());p.normalize(),p.multiplyScalar(-u),this.topLeftVec=h,this.topRightVec=d,this.bottomLeftVec=f,this.bottomRightVec=p},updateUniforms:function(e){this.calCameraVectors(),this.depthMaterial.uniforms.colorTexture.value=e.texture,this.depthMaterial.uniforms.cameraPos.value=this.renderCamera.position,this.depthMaterial.uniforms.topLeftVec.value=this.topLeftVec,this.depthMaterial.uniforms.topRightVec.value=this.topRightVec,this.depthMaterial.uniforms.bottomLeftVec.value=this.bottomLeftVec,this.depthMaterial.uniforms.bottomRightVec.value=this.bottomRightVec,this.depthMaterial.uniforms.center.value=this.center,this.depthMaterial.uniforms.fillType.value=this.fillType,this.depthMaterial.uniforms.fillColor.value=this.fillColor,this.depthMaterial.uniforms.innerRadius.value>this.maxRange&&(this.depthMaterial.uniforms.innerRadius.value=-this.radius,this.depthMaterial.uniforms.outerRadius.value=0),this.depthMaterial.uniforms.innerRadius.value+=this.frameSpeed,this.depthMaterial.uniforms.outerRadius.value=this.depthMaterial.uniforms.innerRadius.value+this.radius},ang2rad:function(e){return e*Math.PI/180},getShaderOptions:function(){var e={transparent:!0};return e.uniforms={colorTexture:{value:null},depthTexture:{value:this.depthTarget.depthTexture},cameraFar:{value:this.renderCamera.far},cameraNear:{value:this.renderCamera.near},cameraPos:{value:this.renderCamera.position.clone()},topLeftVec:{value:this.topLeftVec},topRightVec:{value:this.topRightVec},bottomLeftVec:{value:this.bottomLeftVec},bottomRightVec:{value:this.bottomRightVec},center:{value:this.center.clone()},innerRadius:{value:this.innerRadius},outerRadius:{value:this.outerRadius},fillType:{value:this.fillType},fillColor:{value:this.fillColor}},e.vertexShader="\n            precision highp float;\n            uniform vec3 topLeftVec;\n            uniform vec3 topRightVec;\n            uniform vec3 bottomLeftVec;\n            uniform vec3 bottomRightVec;\n            \n            varying vec2 vUv;\n            varying vec3 cameraVec;\n            \n            void main() {\n                vUv = uv;\n                if(uv.x < 0.5 && uv.y < 0.5) { // bottom left \n                    cameraVec = bottomLeftVec;\n                }else if(uv.x < 0.5 && uv.y > 0.5) { // top left\n                    cameraVec = topLeftVec;\n                }else if(uv.x > 0.5 && uv.y > 0.5) { // top right\n                    cameraVec = topRightVec;\n                }else { // bottom right \n                    cameraVec = bottomRightVec;\n                }\n    \n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",e.fragmentShader="\n            #include <packing>\n            varying vec2 vUv;\n            varying vec3 cameraVec;\n    \n            uniform float cameraFar;\n            uniform float cameraNear;\n            uniform vec3 cameraPos;\n            uniform sampler2D colorTexture;\n            uniform sampler2D depthTexture;\n    \n            uniform vec3 center;\n            uniform float innerRadius;\n            uniform float outerRadius;\n            uniform int fillType;\n            uniform vec3 fillColor;\n    \n            float readClipZ( sampler2D depthSampler, vec2 coord ) {\n                float fragCoordZ = texture2D( depthSampler, coord ).x;\n                return perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar ); //  viewZz\n            }\n    \n            void main() {\n                // gl_FragColor = vec4(1.0,0.0,0.0,1.0);\n                // return;\n                float clipZ = readClipZ( depthTexture, vUv );\n    \n                vec4 diff = texture2D( colorTexture, vUv);\n                vec3 wP = cameraPos + (cameraVec)*abs(clipZ);\n        \n                float dis = distance(wP, center);\n                float circleWidth = outerRadius - innerRadius;\n                if(dis < outerRadius && dis > innerRadius) {\n                    if(fillType == 1) { // pure: 0 - linear: 1\n                        gl_FragColor = vec4(mix(diff.xyz, fillColor, (dis - innerRadius)/circleWidth), 1.0);\n                    }else {\n                        gl_FragColor = vec4(mix(diff.xyz, fillColor, 0.5), 1.0);\n                    }\n                }else {\n                    gl_FragColor = diff;\n                }\n        }",e}});var Vu=function(e){A(n,e);var t=p(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),t.call(this,e)}return o(n,[{key:"init",value:function(e){this.pass=new zu(e.scene,e.camera,e.renderer,this.options),this.pass.enabled=!0,g(l(n.prototype),"init",this).call(this)}},{key:"getSpeed",value:function(){return this.pass.frameSpeed}},{key:"setSpeed",value:function(e){if(e){var t=e/60;this.pass.frameSpeed=t}}},{key:"getRadius",value:function(){return this.pass.radius}},{key:"setRadius",value:function(e){e&&(this.pass.radius=e)}},{key:"getMaxRange",value:function(){return this.pass.maxRange}},{key:"setMaxRange",value:function(e){e&&(this.pass.maxRange=e)}},{key:"getCenter",value:function(){return this.pass.radius}},{key:"setCenter",value:function(e){e&&(this.pass.center=(new tt).copy(e))}},{key:"getFillType",value:function(){return this.pass.fillType}},{key:"setFillType",value:function(e){this.pass.fillType=0==e?0:1}},{key:"getFillColor",value:function(){return this.pass.fillColor}},{key:"setFillColor",value:function(e){e&&(this.pass.fillColor=new Sn(e))}}]),n}(gu),ju=function(){function e(t){r(this,e),this._enableUnrealBloom=!1,this._enableDof=!1,this._enableOutline=!1,this._enableColorAdjustment=!1,this._enableSSAO=!1,this.renderPass=null,this.isPostProcessingManager=!0,this.composer=null,this.processArray=[],this.outline=null,this.unrealBloom=null,this.dof=null,this.colorAdjustment=null,this.ssao=null,this.vignette=null,this._enableVignette=!1,this.circleSweep=null,this._enableCircleSweep=!1,this.viewer=t,this.scene=t.scene,this.camera=t.camera,this.renderer=t.renderer,this.width=this.renderer.domElement.width,this.height=this.renderer.domElement.height,this.outline=new wu({color:"#fff709"}),this.unrealBloom=new Su({},t),this.dof=new Fu,this.colorAdjustment=new Uu,this.ssao=new Nu,this.vignette=new Hu,this.circleSweep=new Vu}return o(e,[{key:"enabled",get:function(){return this.processArray.length>0}},{key:"domElement",get:function(){return this.composer.renderer.domElement}},{key:"enableOutline",get:function(){return this._enableOutline},set:function(e){this.enableDof||this._enableOutline!=Boolean(e)&&(e?(this.add(this.outline),this.outline.clear()):this.remove(this.outline),this._enableOutline=e)}},{key:"enableUnrealBloom",get:function(){return this._enableUnrealBloom},set:function(e){this._enableUnrealBloom!=Boolean(e)&&(e?(this.add(this.unrealBloom),this.unrealBloom.clear()):this.remove(this.unrealBloom),this._enableUnrealBloom=e)}},{key:"enableDof",get:function(){return this._enableDof},set:function(e){this._enableDof!=Boolean(e)&&(e?this.add(this.dof):this.remove(this.dof),this._enableDof=e)}},{key:"enableColorAdjustment",get:function(){return this._enableColorAdjustment},set:function(e){this._enableColorAdjustment!==Boolean(e)&&(e?this.add(this.colorAdjustment):this.remove(this.colorAdjustment),this._enableColorAdjustment=Boolean(e))}},{key:"enableSSAO",get:function(){return this._enableSSAO},set:function(e){this._enableSSAO!==Boolean(e)&&(this.ssao.setMaxDistance(.001),this.ssao.setMinDistance(1e-4),this.ssao.setRadius(16),e?this.add(this.ssao):this.remove(this.ssao),this._enableSSAO=Boolean(e))}},{key:"enableVignette",get:function(){return this._enableVignette},set:function(e){this._enableVignette!=Boolean(e)&&(e?this.add(this.vignette):this.remove(this.vignette),this._enableVignette=e)}},{key:"enableCircleSweep",get:function(){return this._enableCircleSweep},set:function(e){this._enableCircleSweep!=Boolean(e)&&(e?this.add(this.circleSweep):this.remove(this.circleSweep),this._enableCircleSweep=e)}},{key:"_initComposer",value:function(){this.renderPass=new ru(this.scene,this.camera),this.composer=new lu(this.renderer),this.FXAA=new ou(hu),this.FXAA.uniforms.resolution.value.set(1/this.width,1/this.height);var e=this.renderer.getPixelRatio();this.SMAA=new pu(this.width*e,this.height*e)}},{key:"add",value:function(e){var t;e&&this.processArray.indexOf(e)<0&&(this.composer||this._initComposer(),e.inited||(e.init({camera:this.camera,renderer:this.renderer,scene:this.scene,width:this.width,height:this.height,viewer:this.viewer}),e.inited=!0),this.composer.passes.length=0,this.composer.addPass(this.renderPass),(this.processArray.includes(this.ssao)||e===this.ssao)&&this.composer.addPass(this.ssao.pass),(this.processArray.includes(this.colorAdjustment)||e===this.colorAdjustment)&&this.composer.addPass(this.colorAdjustment.pass),(this.processArray.includes(this.colorGradient)||e===this.colorGradient)&&this.composer.addPass(this.colorGradient.pass),(this.processArray.includes(this.outline)||e===this.outline)&&this.composer.addPass(this.outline.pass),(this.processArray.includes(this.unrealBloom)||e===this.unrealBloom)&&this.composer.addPass(this.unrealBloom.pass),(this.processArray.includes(this.vignette)||e===this.vignette)&&this.composer.addPass(this.vignette.pass),(this.processArray.includes(this.circleSweep)||e===this.circleSweep)&&this.composer.addPass(this.circleSweep.pass),(this.processArray.includes(this.dof)||e===this.dof)&&(this.composer.addPass(this.dof.pass),t=!0),t||this.composer.addPass(this.SMAA),this.processArray.push(e));this.enabled&&this.viewer.renderManager.setRenderer(this),setTimeout(this.viewer.renderManager.render,20)}},{key:"remove",value:function(e){e&&this.processArray.includes(e)&&(this.composer.passes.remove(e.pass),this.processArray.remove(e)),this.enabled||this.viewer.renderManager.setRenderer(),this.viewer.renderManager.render()}},{key:"render",value:function(){this.onBeforeRender(),this.processArray.forEach((function(e){e.render()})),this.composer.render(),this.onAfterRender()}},{key:"onBeforeRender",value:function(){this.processArray.includes(this.ssao)&&(this.shadow=!1)}},{key:"onAfterRender",value:function(){this.processArray.includes(this.ssao)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.processArray.forEach((function(n){n.setSize(e,t)}))}},{key:"dispose",value:function(){this.processArray.length=0,this.composer=null}}]),e}();function Wu(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)}var Xu={UPDATE:"update",CHANGE:"change",ENDED:"ended",LOOP:"loop",MAP_INIT:"map_init",MAP_LOADED:"map_loaded",MESH_LOADED:"mesh_loaded",MESH_LOAD_ERROR:"mesh_load_error"};Xu.MESH_LOAD_ERROR="mesh_load_error",Xu.MATERIAL_LOADED="material_loaded",Xu.MATERIAL_LOAD_ERROR="material_load_error",Xu.ANIMATION_LOADED="animation_loaded",Xu.ANIMATION_LOAD_ERROR="animation_load_error",Xu.MODEL_UPDATE="model_update",Xu.START=Wu()?"touchstart":"mousedown",Xu.MOVE=Wu()?"touchmove":"mousemove",Xu.END=Wu()?"touchend":"mouseup",Xu.MESSAGE="message",Xu.TEXTURE_LOADED="texture_loaded",Xu.CLICK="click",Xu.CAMERA_MOVED="camera-moved";var Zu=function(){this._tweens={},this._tweensAddedDuringUpdate={},this._tweens={},this._tweensAddedDuringUpdate={}};Zu.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:Ku.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]];r&&!1===r.update(e)&&(r._isPlaying=!1,t||delete this._tweens[n[i]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var Yu,Ku=new Zu;Ku.Group=Zu,Ku._nextId=0,Ku.nextId=function(){return Ku._nextId++},"undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?Ku.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?Ku.now=self.performance.now.bind(self.performance):void 0!==Date.now?Ku.now=Date.now:Ku.now=function(){return(new Date).getTime()},Ku.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Ku.Easing.Linear.None,this._interpolationFunction=Ku.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||Ku,this._id=Ku.nextId()},Ku.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?Ku.now()+parseFloat(e):e:Ku.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,i;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,i=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var r=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,i):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?r+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=r+(a-r)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,A=this._chainedTweens.length;s<A;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},Ku.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Ku.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Ku.Easing.Bounce.In(2*e):.5*Ku.Easing.Bounce.Out(2*e-1)+.5}}},Ku.Interpolation={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),a=Ku.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],i):t>1?a(e[n],e[n-1],n-i):a(e[r],e[r+1>n?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,a=Ku.Interpolation.Utils.Bernstein,o=0;o<=i;o++)n+=r(1-t,i-o)*r(t,o)*e[o]*a(i,o);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),a=Ku.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),a(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):a(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=Ku.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(Yu=[1],function(e){var t=1;if(Yu[e])return Yu[e];for(var n=e;n>1;n--)t*=n;return Yu[e]=t,t}),CatmullRom:function(e,t,n,i,r){var a=.5*(n-e),o=.5*(i-t),s=r*r;return(2*t-2*n+a+o)*(r*s)+(-3*t+3*n-2*a-o)*s+a*r+t}}};var Ju=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,n),(i=t.call(this)).clock=new ic,i._renderer=null,i._defaultRenderer=null,i.container=null,i.containerRect=null,i.renderEnabled=!1,i.scene=null,i.camera=null,i.defaultCamera=null,i.animationFrameHandler=null,i.beforeRenderQueue=[],i.afterRenderQueue=[],i.needsUpdate=!0,i.loop=!0,i.viewer=e,i.needsUpdate=!0,i.loop=!0,i.container=e.container,i.containerRect=i.container.getBoundingClientRect();var o={antialias:!0,alpha:!0,logarithmicDepthBuffer:Boolean(a.logarithmicDepthBuffer)};return(i.container.nodeName&&"CANVAS"===i.container.nodeName.toUpperCase()||i.container.tagName&&"CANVAS"===i.container.tagName.toUpperCase())&&(o.canvas=i.container),i._renderer=new Ka(o),i._renderer.setClearAlpha(0),i._renderer.setPixelRatio(window.devicePixelRatio),i._renderer.setSize(i.containerRect.width,i.containerRect.height),i._defaultRenderer=i._renderer,i.domElement.style.backgroundColor="#000",void 0===o.canvas&&i.container.appendChild(i.domElement),i}return o(n,[{key:"domElement",get:function(){return this.getRenderer().domElement}},{key:"defaultRenderer",get:function(){return this._defaultRenderer}},{key:"renderer",get:function(){return this._renderer}},{key:"setRenderer",value:function(e){this._renderer=void 0!==e?e:this._defaultRenderer}},{key:"getRenderer",value:function(){return this._renderer.isPostProcessingManager?this._renderer.composer.renderer:this._renderer}},{key:"setCamera",value:function(e){this.camera=void 0!==e?e:this.defaultCamera}},{key:"setLoop",value:function(e){this.loop=e,this.animate()}},{key:"render",value:function(e){this.renderEnabled=!0,e&&this.animate()}},{key:"animate",value:function(){var e=this;if(this.renderEnabled&&this.needsUpdate){var t=this.clock.getDelta();this.moduleManager.update(t),this._onBeforeRender(t),this.beforeRenderQueue.map((function(n){"function"==typeof n&&n(e._renderer,e.scene,e.camera,t)})),this._renderer.render(this.scene,this.camera),this.afterRenderQueue.map((function(n){"function"==typeof n&&n(e._renderer,e.scene,e.camera,t)})),Ku.update(),this._onAfterRender(t),this.animationFrameHandler&&cancelAnimationFrame(this.animationFrameHandler),this.loop&&(this.animationFrameHandler=requestAnimationFrame((function(){e.animate()}))),this.dispatchEvent({type:Xu.UPDATE})}}},{key:"addBeforeRenderTask",value:function(e){this.beforeRenderQueue.includes(e)||this.beforeRenderQueue.push(e)}},{key:"removeBeforeRenderTask",value:function(e){this.beforeRenderQueue.includes(e)&&this.beforeRenderQueue.remove(e)}},{key:"addAfterRenderTask",value:function(e){this.afterRenderQueue.includes(e)||this.afterRenderQueue.push(e)}},{key:"removeAfterRenderTask",value:function(e){this.afterRenderQueue.includes(e)&&this.afterRenderQueue.remove(e)}},{key:"_onBeforeRender",value:function(e){var t=this,n=this.getRenderer();this.scene.getObjectByName("root").traverse((function(i){i.onBeforeRender&&i.onBeforeRender(n,t.scene,t.camera,e)}))}},{key:"_onAfterRender",value:function(e){var t=this,n=this.getRenderer();this.scene.getObjectByName("root").traverse((function(i){i.update&&i.update(e),i.onAfterRender&&i.onAfterRender(n,t.scene,t.camera,e)}))}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=this.container.getBoundingClientRect(),this.containerRect=e,this.getRenderer().setSize(e.width,e.height),this._renderer.composer&&this._renderer.composer.setSize(e.width,e.height),this.render()}},{key:"disabled",value:function(){this.needsUpdate=!1}},{key:"dispose",value:function(){cancelAnimationFrame(this.animationFrameHandler),this.setRenderer(),this._renderer.dispose(),this._renderer.forceContextLoss(),this._renderer=null,this.disabled()}}]),n}(Xe),qu=function(){function e(){r(this,e)}return o(e,null,[{key:"create",value:function(t,n){var i=new Ju(t,n);return e.RenderManagerArray.push(i),i}},{key:"render",value:function(t){for(var n=0;n<e.RenderManagerArray.length;n++)e.RenderManagerArray[n].render(t)}},{key:"getDefaultRenderer",value:function(){return e.RenderManagerArray[0].defaultRenderer}}]),e}();qu.RenderManagerArray=[];var $u=function(e){var t=e.index,n=e.attributes;if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var i=t.array,r=n.position.array,a=n.normal.array,o=n.uv.array,s=r.length/3;void 0===n.tangent&&e.setAttribute("tangent",new Dn(new Float32Array(4*s),4));for(var A=n.tangent.array,l=[],c=[],h=0;h<s;h++)l[h]=new tt,c[h]=new tt;var u=new tt,d=new tt,f=new tt,p=new Je,m=new Je,g=new Je,v=new tt,y=new tt,w=e.groups;0===w.length&&(w=[{start:0,count:i.length}]);h=0;for(var x=w.length;h<x;++h)for(var b=_=(F=w[h]).start,C=_+F.count;b<C;b+=3)U(i[b+0],i[b+1],i[b+2]);var M,B,I,E=new tt,S=new tt,T=new tt,L=new tt;for(h=0,x=w.length;h<x;++h){var F,_;for(b=_=(F=w[h]).start,C=_+F.count;b<C;b+=3)P(i[b+0]),P(i[b+1]),P(i[b+2])}}else console.warn("BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function U(e,t,n){u.fromArray(r,3*e),d.fromArray(r,3*t),f.fromArray(r,3*n),p.fromArray(o,2*e),m.fromArray(o,2*t),g.fromArray(o,2*n);var i=d.x-u.x,a=f.x-u.x,s=d.y-u.y,A=f.y-u.y,h=d.z-u.z,w=f.z-u.z,x=m.x-p.x,b=g.x-p.x,C=m.y-p.y,M=g.y-p.y,B=x*M-b*C,I=1;0!=B&&(I=1/B),0==C&&0==M?v.set(i-a,s-A,h-w):v.set((M*i-C*a)*I,(M*s-C*A)*I,(M*h-C*w)*I),0==x&&0==b?y.set((a-i)*I,(A-s)*I,(w-h)*I):y.set((x*a-b*i)*I,(x*A-b*s)*I,(x*w-b*h)*I),l[e].add(v),l[t].add(v),l[n].add(v),c[e].add(y),c[t].add(y),c[n].add(y)}function P(e){T.fromArray(a,3*e),L.copy(T),B=l[e],E.copy(B),E.sub(T.multiplyScalar(T.dot(B))).normalize(),S.crossVectors(L,B),I=S.dot(c[e]),M=I<0?-1:1,A[4*e]=E.x,A[4*e+1]=E.y,A[4*e+2]=E.z,A[4*e+3]=M}},ed=null;try{var td="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");ed=td.Worker}catch(GT){}function nd(e,t,n){var i=void 0===t?null:t,r=function(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}(e,void 0!==n&&n),a=r.indexOf("\n",10)+1,o=r.substring(a)+(i?"//# sourceMappingURL="+i:"");return function(e){return new ed(o,Object.assign({},e,{eval:!0}))}}function id(e,t,n){var i=void 0===t?null:t,r=function(e,t){var n=atob(e);if(t){for(var i=new Uint8Array(n.length),r=0,a=n.length;r<a;++r)i[r]=n.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(e,void 0!==n&&n),a=r.indexOf("\n",10)+1,o=r.substring(a)+(i?"//# sourceMappingURL="+i:""),s=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(s)}var rd="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);function ad(e,t,n){return rd?nd(e,t,n):function(e,t,n){var i;return function(r){return i=i||id(e,t,n),new Worker(i,r)}}(e,t,n)}var od=ad("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qKioNCiAgICAgKiDlpITnkIbmlofku7bliqDovb3lj4rop6PmnpANCiAgICAgKi8KCiAgICAvKirnirbmgIEqLwogICAgdmFyIFNUQVRVUyA9IHsKICAgICAgQ29tcGxldGU6ICdjb21wbGV0ZScsCiAgICAgIFByb2dyZXNzOiAncHJvZ3Jlc3MnLAogICAgICBFcnJvcjogJ2Vycm9yJwogICAgfTsKICAgIC8qKuaOpeaUtua2iOaBryovCgogICAgc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICBzd2l0Y2ggKGUuZGF0YS5jbWQpIHsKICAgICAgICBjYXNlICdtZXNoJzoKICAgICAgICAgIGxvYWRNZXNoKGUuZGF0YS5kYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdpbWcnOgogICAgICAgICAgcHJlbG9hZEltYWdlKGUuZGF0YS5kYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9OwogICAgLyoqDQogICAgICog5Y+R6YCB5raI5oGvDQogICAgICogQHBhcmFtIHN0YXR1cyDnirbmgIENCiAgICAgKiBAcGFyYW0gZGF0YSDopoHlj5HpgIHnmoTmlbDmja4NCiAgICAgKi8KCgogICAgZnVuY3Rpb24gcG9zdE1zZyhzdGF0dXMsIHRhc2ssIGRhdGEpIHsKICAgICAgcG9zdE1lc3NhZ2UoewogICAgICAgIHN0YXR1czogc3RhdHVzLAogICAgICAgIHRhc2s6IHRhc2ssCiAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgIH0pOwogICAgfQogICAgLyoq5Yqg6L29572R5qC85paH5Lu2Ki8KCiAgICBmdW5jdGlvbiBsb2FkTWVzaCh1cmwpIHsKICAgICAgLy8gY29uc29sZS50aW1lKCd3b3JrZXLliqDovb3mqKHlnovogJfml7bvvJonKTsKICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsgLy8gcmVxdWVzdC5yZXNwb25zZVR5cGUgPSAnanNvbic7CgogICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciByZXNwb25zZSA9IHRoaXMucmVzcG9uc2U7IC8v5Yqg6L295oiQ5YqfCgogICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gMjAwIHx8IHRoaXMuc3RhdHVzID09PSAwKSB7CiAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IDApIGNvbnNvbGUud2FybignSFRUUCBTdGF0dXMgMCByZWNlaXZlZC4nKTsgLy8gY29uc29sZS50aW1lRW5kKCd3b3JrZXLliqDovb3mqKHlnovogJfml7bvvJonKTsKICAgICAgICAgIC8vIGNvbnNvbGUudGltZSggJ3dvcmtlcuino+aekOaooeWei+iAl+aXtu+8micgKTsKCiAgICAgICAgICBwYXJzZUdlb21ldHJ5KEpTT04ucGFyc2UocmVzcG9uc2UpKTsgLy8gY29uc29sZS50aW1lRW5kKCAnd29ya2Vy6Kej5p6Q5qih5Z6L6ICX5pe277yaJyApOwogICAgICAgICAgLy8gcGFyc2VHZW9tZXRyeSggcmVzcG9uc2UgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcG9zdE1zZyhTVEFUVVMuRXJyb3IsICdtZXNoJywgJ0xvYWRpbmcgRXJyb3IgJyArIHRoaXMuc3RhdHVzICsgJyBVUkw6JyArIHVybCk7CiAgICAgICAgfQogICAgICB9LCBmYWxzZSk7IC8v5Yqg6L296L+b5bqmCgogICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgcG9zdE1zZyhTVEFUVVMuUHJvZ3Jlc3MsICdtZXNoJywgewogICAgICAgICAgbG9hZGVkOiBldmVudC5sb2FkZWQsCiAgICAgICAgICB0b3RhbDogZXZlbnQudG90YWwKICAgICAgICB9KTsKICAgICAgfSwgZmFsc2UpOyAvL+WKoOi9veWHuumUmQoKICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHBvc3RNc2coU1RBVFVTLkVycm9yLCAnbWVzaCcsIGV2ZW50Lm1lc3NhZ2UpOwogICAgICB9LCBmYWxzZSk7CiAgICAgIHJlcXVlc3Quc2VuZChudWxsKTsKICAgIH0KICAgIC8qKg0KICAgICAqIOmihOWKoOi9veWbvueJhw0KICAgICAqLwoKICAgIGZ1bmN0aW9uIHByZWxvYWRJbWFnZSh1cmwpIHsKICAgICAgdmFyIHBhdGhzOwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXJsKSkgewogICAgICAgIHBhdGhzID0gdXJsOwogICAgICB9IGVsc2UgewogICAgICAgIHBhdGhzID0gW3VybF07CiAgICAgIH0KCiAgICAgIHBhdGhzLmZvckVhY2goZnVuY3Rpb24gKHVybCkgewogICAgICAgIGlmICh1cmwuaW5kZXhPZignaHR0cCcpID09IC0xKSB1cmwgPSBsb2NhdGlvbi5vcmlnaW4gKyAnLycgKyB1cmw7CiAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICB0aGlzLnJlc3BvbnNlOyAvL+WKoOi9veaIkOWKnwoKICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gMjAwIHx8IHRoaXMuc3RhdHVzID09PSAwKSB7CiAgICAgICAgICAgIHBvc3RNc2coU1RBVFVTLkNvbXBsZXRlLCAnaW1nJywgdXJsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBvc3RNc2coU1RBVFVTLkVycm9yLCAnaW1nJywgJ0xvYWRpbmcgRXJyb3IgJyArIHRoaXMuc3RhdHVzICsgJyBVUkw6JyArIHVybCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZmFsc2UpOwogICAgICAgIHJlcXVlc3Quc2VuZChudWxsKTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiDop6PmnpBnZW9tZXRyeQ0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICovCgogICAgZnVuY3Rpb24gcGFyc2VHZW9tZXRyeShkYXRhKSB7CiAgICAgIHZhciBtZXNoZXMgPSBkYXRhOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG1lc2hlcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIHZhciBnZW9EYXRhID0gbWVzaGVzW2ldOwoKICAgICAgICBpZiAoZ2VvRGF0YS5oICYmIGdlb0RhdGEuaC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAvL3Bvc2l0aW9uCiAgICAgICAgICBpZiAoZ2VvRGF0YS5oICYmIGdlb0RhdGEuaC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGdlb0RhdGEuaCA9IG5ldyBGbG9hdDMyQXJyYXkoZ2VvRGF0YS5oKTsKICAgICAgICAgIH0gLy9ub3JtYWwKCgogICAgICAgICAgaWYgKGdlb0RhdGEuaiAmJiBnZW9EYXRhLmoubGVuZ3RoID4gMCkgewogICAgICAgICAgICBnZW9EYXRhLmogPSBuZXcgRmxvYXQzMkFycmF5KGdlb0RhdGEuaik7CiAgICAgICAgICB9IC8vdXYKCgogICAgICAgICAgaWYgKGdlb0RhdGEuayAmJiBnZW9EYXRhLmsubGVuZ3RoID4gMCkgewogICAgICAgICAgICBnZW9EYXRhLmsgPSBuZXcgRmxvYXQzMkFycmF5KGdlb0RhdGEuayk7CiAgICAgICAgICB9IC8vdXYyCgoKICAgICAgICAgIGlmIChnZW9EYXRhLmwgJiYgZ2VvRGF0YS5sLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZ2VvRGF0YS5sID0gbmV3IEZsb2F0MzJBcnJheShnZW9EYXRhLmwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcG9zdE1zZyhTVEFUVVMuQ29tcGxldGUsICdtZXNoJywgZGF0YSk7CiAgICB9Cgp9KCkpOwoK",null,!1),sd=function(){function e(){r(this,e),this._worker=void 0}return o(e,[{key:"loadMesh",value:function(e,t,n,i){var r=this;this._load("mesh",e,(function(e){t(e),r.closeWorker()}),n,i)}},{key:"preloadMap",value:function(e,t,n){this._load("img",e,t,void 0,n)}},{key:"closeWorker",value:function(){this._worker.terminate()}},{key:"_load",value:function(e,t,n,i,r){"undefined"!=typeof Worker?(this._worker||(this._worker=new od),this._worker.onmessage=function(t){if(t.data.task==e)switch(t.data.status){case"complete":n&&n(t.data.data);break;case"progress":i&&i(t.data.data);break;case"error":r&&r(t.data.data)}},this._worker.postMessage({cmd:e,data:t})):console.log("worker")}}]),e}(),Ad=function(e){A(n,e);var t=p(n);function n(){return r(this,n),t.call(this)}return o(n,[{key:"dispatchEvent",value:function(e,t){g(l(n.prototype),"dispatchEvent",this).call(this,{type:e,data:t})}}]),n}(Xe),ld="playing",cd="pause",hd="stop",ud=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this))._rootModel=e,i._speed=1,i._clock=new ic,i._mixer=null,i._animNameList=[],i._currentAnimName="",i._animStatus=hd,i._isKeepByFinish=!0,i._isUpdate=!1,i._clipMap=new Map,i._currentAction=null,i._completeAction=null,i._lastAction=null,i._loop=!0,i}return o(n,[{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e,this._currentAction&&this._currentAction.setEffectiveTimeScale(this._speed)}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e,this._currentAction&&this._currentAction.setLoop(this._loop?Ee:Ie)}},{key:"isKeepByFinish",get:function(){return this._isKeepByFinish},set:function(e){this._isKeepByFinish=e,this._currentAction&&(this._currentAction.clampWhenFinished=this._isKeepByFinish)}},{key:"setLoop",value:function(e){this.loop=e}},{key:"setAnimationList",value:function(e){this._animNameList=e}},{key:"getMixer",value:function(){var e=this;return this._mixer||(this._mixer=new Fc(this._rootModel),this._mixer.addEventListener("finished",(function(){e.onEnded&&e.onEnded(),e.dispatchEvent(Xu.ENDED),e._loop||(e._animStatus=hd,e.isKeepByFinish||(e._currentAction=null),e._lastAction=null,e._completeAction&&e._completeAction())}))),this._mixer}},{key:"addClip",value:function(e){var t=this.getMixer().clipAction(e);this._clipMap.set(e.name,t)}},{key:"setUpdateStatus",value:function(e){if(e){if(this._isUpdate)return;this._isUpdate=e,this._clock.start(),this._update=this.update.bind(this),this._rootModel.viewer.renderManager.addAfterRenderTask(this._update)}else{if(!this._isUpdate)return;this._isUpdate=e,this._rootModel.viewer.renderManager.removeAfterRenderTask(this._update),this._update=null}}},{key:"getList",value:function(){return this._animNameList}},{key:"getStatus",value:function(){return this._animStatus}},{key:"getLengthByName",value:function(e){var t=this._clipMap.get(e);return t?t._clip.duration:(console.warn("getLengthByName: ",e),0)}},{key:"getCurrentClipName",value:function(){return this._currentAction?this._currentAction._clip.name:""}},{key:"setCompleteAction",value:function(e){this._completeAction=e}},{key:"getClip",value:function(e){if(0!==this._animNameList.length){e||(e=this._animNameList[0]);var t=this._clipMap.get(e);if(t)return t;console.warn("play:  "+e+" ")}}},{key:"_play",value:function(e,t,n){var i=this.getClip(e);i&&(this._currentAction?(this._currentAction.pause=!0,this._currentAction=i):this._currentAction=i,this._animStatus=ld,this._currentAction.setEffectiveTimeScale(n),this._currentAction.clampWhenFinished=this._isKeepByFinish,this._currentAction.setLoop(t?Ee:Ie),this._currentAction.reset(),this._currentAction.play(),this.setUpdateStatus(!0))}},{key:"_playByCrossFade",value:function(e,t,n,i){if(t<=0||!this._currentAction)this._play(e,n,i);else{var r=this.getClip(e,n,i);if(r){if(this._currentAction==r)return this._lastAction=null,void this._play(e,n,i);this._lastAction=this._currentAction,this._currentAction=r,this._animStatus=ld,this._currentAction.setEffectiveTimeScale(i),this._currentAction.clampWhenFinished=this._isKeepByFinish,this._currentAction.setLoop(n?Ee:Ie),this._lastAction.crossFadeTo(this._currentAction,t,!0),this.setUpdateStatus(!0)}}}},{key:"play",value:function(e,t,n){null==t&&null==t||(this._loop=t),null!=n&&null!=n&&(this._speed=n),this._play(e,this._loop,this._speed)}},{key:"playByCrossFade",value:function(e,t,n,i){null==n&&null==n||(this._loop=n),null!=i&&null!=i&&(this._speed=i),this._playByCrossFade(e,t,this._loop,this._speed)}},{key:"pause",value:function(){this._currentAction&&this._currentAction.isRunning()&&(this._currentAction.paused=!0,this._animStatus=cd),this._lastAction&&(this._lastAction.pause=!0)}},{key:"resume",value:function(){this._currentAction&&(this._currentAction.paused=!1,this._currentAction.isRunning()&&(this._animStatus=ld)),this._lastAction&&(this._lastAction.pause=!1)}},{key:"stop",value:function(){this._currentAction&&this._currentAction.stop(),this._lastAction&&(this._lastAction=null),this._animStatus=hd,this._currentAction=null,this.setUpdateStatus(!1)}},{key:"setCurrentTime",value:function(e){null!=e&&null!=e?this._currentAction&&(this._currentAction.time=e):console.warn("setCurrentTime: ",e)}},{key:"getCurrentTime",value:function(){return this._currentAction?this._currentAction.time:0}},{key:"update",value:function(){if(this._mixer){var e=this._clock.getDelta();this._mixer.update(e)}}},{key:"hasAnimation",value:function(){return this._animNameList.length>0}},{key:"list",value:function(){return this._animNameList}}]),n}(Ad),dd=function(){function e(t){var n=this;r(this,e),this.renderManager=t.viewer.renderManager,this.objects=[],t.traverse((function(e){e.isMesh&&(n.objects.push(e),e.defaultMat=e.material)})),this.normalMaterial=new gA}return o(e,[{key:"applyUV",value:function(e){var t=(new KA).load(e);this.objects.forEach((function(e){if(Array.isArray(e.material))for(var n=0;n<e.material.length;n++)e.material[n]=new xA({albedo:t});else e.material=new xA({albedo:t})})),this.renderManager.render()}},{key:"applyNormal",value:function(){var e=this;this.objects.forEach((function(t){t.material=e.normalMaterial})),this.renderManager.render()}},{key:"applyWireFrame",value:function(){this.resetMaterial(),this.objects.forEach((function(e){Array.isArray(e.material)?e.material.forEach((function(e){e.wireframe=!0})):e.material.wireframe=!0})),this.renderManager.render()}},{key:"resetMaterial",value:function(){this.objects.forEach((function(e){e.material=e.defaultMat,Array.isArray(e.material)?e.material.forEach((function(e){e.wireframe=!1})):e.material.wireframe=!1})),this.renderManager.render()}}]),e}(),fd=function(e){A(n,e);var t=p(n);function n(e,i,a,o){var s;return r(this,n),s=t.call(this),e&&(s.object=e,s._draw(i,a,o)),s}return o(n,[{key:"_draw",value:function(e,t,n){var i;i=this.object.isBox3?this.object:(new Jt).setFromObject(this.object);var r=new tt;i.getSize(r),this.maxLength=Math.max(r.x,r.y,r.z),this.textScale=2,this.textMeshScale=.002*this.maxLength,this.fontSize=20*this.textScale,console.log("",r);var a=new tt;i.getCenter(a);var o=.03*this.maxLength,s=.2*this.maxLength,A=.5*this.fontSize*this.textMeshScale/this.textScale,l=new tt(i.min.x,i.max.y+s,a.z),c=new tt(i.max.x,i.max.y+s,a.z);void 0!==e&&""!==e||(e=l.distanceTo(c).toFixed(4));var h=this._drawLine(l,c);h.rotation.z=Math.PI/2;var u=new tt(l.x,l.y+A,l.z),d=new tt(l.x,l.y-A,l.z);h=this._drawLine(u,d),u.set(c.x,c.y+A,c.z),d.set(c.x,c.y-A,c.z),h=this._drawLine(u,d);var f=this._drawText(e,new tt(a.x,i.max.y+o+s,a.z)),p=f.clone();this.add(p),p.rotation.y=Math.PI,this.lengthMesh=f,this.lengthMesh.back=p,l.set(i.min.x-s,i.min.y,(i.max.z+i.min.z)/2),c.set(i.min.x-s,i.max.y,(i.max.z+i.min.z)/2),h=this._drawLine(l,c),void 0!==n&&""!==n||(n=l.distanceTo(c).toFixed(4)),u.set(l.x+A,l.y,l.z),d.set(l.x-A,l.y,l.z),(h=this._drawLine(u,d)).rotation.z=Math.PI/2,u.set(c.x+A,c.y,c.z),d.set(c.x-A,c.y,c.z),(h=this._drawLine(u,d)).rotation.z=Math.PI/2,p=(f=this._drawText(n,new tt(i.min.x-o-s,a.y,a.z))).clone(),this.add(p),p.position.x-=o/2,f.rotation.z=p.rotation.z=Math.PI/2,p.rotation.y=Math.PI,this.heightMesh=f,this.heightMesh.back=p,l.set(i.max.x+s,a.y,i.min.z),c.set(i.max.x+s,a.y,i.max.z),(h=this._drawLine(l,c)).rotation.x=Math.PI/2,void 0!==t&&""!==t||(t=l.distanceTo(c).toFixed(4)),u.set(l.x,l.y+A,l.z),d.set(l.x,l.y-A,l.z),h=this._drawLine(u,d),u.set(c.x,c.y+A,c.z),d.set(c.x,c.y-A,c.z),h=this._drawLine(u,d),p=(f=this._drawText(t,new tt(i.max.x+s,a.y+o,a.z))).clone(),this.add(p),f.rotation.y=p.rotation.y=Math.PI/2,p.rotation.y=-Math.PI/2,this.widthMesh=f,this.widthMesh.back=p}},{key:"updateSize",value:function(e,t,n){this.lengthMesh&&void 0!==e&&""!==e&&this._updateTextMesh(this.lengthMesh,e),this.widthMesh&&void 0!==t&&""!==t&&this._updateTextMesh(this.widthMesh,t),this.heightMesh&&void 0!==n&&""!==n&&this._updateTextMesh(this.heightMesh,n)}},{key:"_updateTextMesh",value:function(e,t){var n=e.material,i=n.map.image;this._fillText(n.map.image,t),n.map.needsUpdate=!0,n.needsUpdate=!0,e.back.material.map.needsUpdate=!0,e.back.material.needsUpdate=!0,e.back.geometry.dispose(),e.geometry.dispose(),e.back.geometry=e.geometry=new Ki(i.width*this.textMeshScale/this.textScale,i.height*this.textMeshScale/this.textScale)}},{key:"_drawLine",value:function(e,t){var n=.005*this.maxLength*.5,i=new xi(new Li(n,e.distanceTo(t),n),new kn({color:"#ffffff",side:2}));return i.position.copy(e.clone().add(t).multiplyScalar(.5)),i.renderOrder=5e3,this.add(i),i}},{key:"_drawText",value:function(e,t){var n=document.createElement("canvas");n.height=this.fontSize,this._fillText(n,e);var i=new Ki(n.width*this.textMeshScale/this.textScale,n.height*this.textMeshScale/this.textScale),r=new Ko(n);r.anisotropy=16;var a=new kn({map:r,transparent:!0});a.depthTest=!1;var o=new xi(i,a);return o.position.copy(t),this.add(o),o}},{key:"_fillText",value:function(e,t){var n=this.fontSize+"px ";e.width=this._measureTextWidth(n,t);var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),i.font=n,i.fillStyle="#ffffff",i.textAlign="left",i.textBaseline="top",i.fillText(t,0,0)}},{key:"_measureTextWidth",value:function(e,t){this._measureCanvas||(this._measureCanvas=document.createElement("canvas"),this._measureCanvas.height=100,this._measureCanvas.width=100);var n=this._measureCanvas.getContext("2d");return n.font=e,n.measureText(t).width}},{key:"show",value:function(e,t,n,i){e&&this.object!==e&&(this.object=e),this.object&&this._draw(t,n,i),this.object.viewer.renderManager.render(!0)}},{key:"dispose",value:function(){}}]),n}(Dt),pd=function(e){A(n,e);var t=p(n);function n(e,i){var a;r(this,n),(a=t.call(this)).object=e,a.options=i||{},void 0===a.options.exposeFactor&&(a.options.exposeFactor=2),void 0===a.options.exposeByPart&&(a.options.exposeByPart=!1),void 0===a.options.exposeType&&(a.options.exposeType="NORMAL"),a.digits=10,a.prePercent=0,a.allModels=[];var o=a.object.getObjectByName("shadow");return a.options.exposeByPart?o.parent.children.forEach((function(e){e===o||e.isHotSpotEntity||e.children.forEach((function(e){a.allModels.push(e)}))})):a.object.traverse((function(e){e.geometry&&"shadow"!==e.name&&!e.isHotSpotEntity&&a.allModels.push(e)})),a.setMode(a.options.exposeType),a.object.viewer.renderManager.render(),a}return o(n,[{key:"setMode",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NORMAL";switch(t){case"SPHERE":var n=this.allModels.length,i=Math.ceil(Math.sqrt(n)),r=this._genSphereGeo(i,n),a=r.length,o=[],s=(new Jt).setFromObject(this.object),A=s.getSize(new tt),l=Math.max(A.x,A.y,A.z);this.allModels.forEach((function(t){var n=e._getRandom(a,o);o.push(n);var i=r[n].clone().normalize();t.direct=i.clone().multiplyScalar(l*e.options.exposeFactor)}));break;default:var c=(new Jt).setFromObject(this.object),h=c.getCenter(new tt);this.allModels.forEach((function(t){var n=(new Jt).setFromObject(t);n&&n.getCenter&&(t.direct=n.getCenter(new tt).sub(h).clone().multiplyScalar(e.options.exposeFactor))}))}}},{key:"applyScalar",value:function(e){var t=e-this.prePercent;this.prePercent=e,this.allModels.forEach((function(e){if(e.parent&&e.direct&&!e.isAmrtAlphaHotSpotEntity){var n=e.getWorldPosition(new tt);n.add(e.direct.clone().multiplyScalar(t));var i=e.parent.worldToLocal(n);e.position.copy(i)}})),this.object.viewer.renderManager.render(),this.dispatchEvent(Xu.CHANGE,e)}},{key:"_getRandom",value:function(e,t){var n=Math.floor(Math.random()*e);return t.indexOf(n)>-1?this._getRandom(e,t):n}},{key:"_genSphereGeo",value:function(e,t){var n=new Zs(1,e,e),i=this._removeRepeat(n.vertices);return i.length<t?this._genSphereGeo(e+1,t):i}},{key:"_removeRepeat",value:function(e){var t=[],n=this;return e.forEach((function(e){t.find((function(t){return n._equalV(e,t)}))||t.push(e)})),t}},{key:"_equalF",value:function(e,t){return parseFloat(Number(e).toFixed(10))===parseFloat(Number(t).toFixed(10))}},{key:"_equalV",value:function(e,t){return this._equalF(e.x,t.x)&&this._equalF(e.y,t.y)&&this._equalF(e.z,t.z)}}]),n}(Ad),md=function(){function e(t){r(this,e),this.model=t,this._visible=!1,this.time=0,this._isInit=!1,this.objects=t.objects}return o(e,[{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this._visible&&!this._isInit&&(this.init(),this._isInit=!0),this._isInit&&(this._visible?this.start():this.disable()),this.setVisible(this._visible))}},{key:"IsInit",get:function(){return this._isInit}},{key:"setVisible",value:function(e){}},{key:"init",value:function(){}},{key:"start",value:function(){}},{key:"disable",value:function(){}},{key:"destory",value:function(){this.time=0,this._isInit=!1}},{key:"setObjects",value:function(e){this.objects=e}}]),e}(),gd=function(){function e(t,n){if(r(this,e),this.mesh=n,this.root=t,this.triangleMap=new Map,this.root){var i=new vt;this.root.matrixWorld.getInverse(i),this.rootLocalMatrix=this.mesh.matrixWorld.clone().premultiply(i)}}return o(e,[{key:"calculation",value:function(){for(var e=this.mesh.geometry.index.array,t=this.mesh.geometry.getAttribute("position").array,n=0;n<e.length;n+=3){var i=new tt(t[3*e[n]],t[3*e[n]+1],t[3*e[n]+2]);this.root&&i.applyMatrix4(this.rootLocalMatrix);var r=new tt(t[3*e[n+1]],t[3*e[n+1]+1],t[3*e[n+1]+2]);this.root&&r.applyMatrix4(this.rootLocalMatrix);var a=new tt(t[3*e[n+2]],t[3*e[n+2]+1],t[3*e[n+2]+2]);this.root&&a.applyMatrix4(this.rootLocalMatrix),this.calculationFace(i,r,a)}for(var o=[],s=this.getPenEdge(),A=0;A<s.length;A++)o.push.apply(o,y(s[A].p));return o}},{key:"calculationFace",value:function(e,t,n){var i=e.clone().sub(t),r=n.clone().sub(t),a=i.cross(r);this.calculationEdge(e,t,a),this.calculationEdge(t,n,a),this.calculationEdge(n,e,a)}},{key:"calculationEdge",value:function(e,t,n){var i=this.getEdgeKey(e,t),r=this.triangleMap.get(i);if(r){if(r.isRecommend++,!r.isPen)if(0!==r.normal.lengthSq()&&0!==n.lengthSq())r.normal.angleTo(n)>=45*Ke.DEG2RAD&&(r.isPen=!0)}else{var a=this.getEdgeKey(t,e),o={normal:n,startPoint:e,endPoint:t,isRecommend:1};this.triangleMap.set(i,o),this.triangleMap.set(a,o)}}},{key:"getEdgeKey",value:function(e,t){return e.x+"_"+e.y+"_"+e.z+"_"+t.x+"_"+t.y+"_"+t.z}},{key:"getPenEdge",value:function(){var e=[];return this.triangleMap.forEach((function(t){if(!t.isResolve&&(t.isPen||1===t.isRecommend)){t.isResolve=!0;e.push({s:t.startPoint,p:[t.startPoint.x,t.startPoint.y,t.startPoint.z,t.endPoint.x,t.endPoint.y,t.endPoint.z],e:t.endPoint})}})),e}}]),e}(),vd=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e))._isCombine=!0,i.lineRoots=[],i._color=null,i._isHideModel=!1,i}return o(n,[{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.lineMat=new Fo({color:this._color||255}),this.setFromObject()}},{key:"isCombine",set:function(e){this._isCombine=e,this._isInit&&this.setFromObject()}},{key:"isHideModel",set:function(e){this._isHideModel=e,this._isInit&&this.visible&&this.setModelActive(this._isHideModel)}},{key:"color",set:function(e){this._color=e,this._isInit&&(this.lineMat.color.set(this._color),this.lineMat.needsUpdate=!0)}},{key:"setFromObject",value:function(){this.destory();for(var e=[],t=0;t<this.objects.length;t++){var n=this.objects[t];if(n.visible)if(this._isCombine)for(var i=new gd(this.model,n).calculation(),r=0;r<i.length;r++)e.push(i[r]);else{var a=new gd(n,n).calculation(),o=this.createLine(a);o.tag="effect",n.add(o),this.lineRoots.push(o)}}if(this._isCombine){var s=this.createLine(e);s.tag="effect",this.model.add(s),this.lineRoots.push(s)}}},{key:"createLine",value:function(e){var t=new ni;t.setAttribute("position",new Vn(e,3));var n=new Go(t,this.lineMat);return n.name="penLine",n}},{key:"setVisible",value:function(e){for(var t=0;t<this.lineRoots.length;t++)this.lineRoots[t].visible=this._visible}},{key:"setModelActive",value:function(e){for(var t=0;t<this.model.children.length;t++)"effect"!==this.model.children[t].tag&&(e?(this.model.children[t].visible1=this.model.children[t].visible,this.model.children[t].visible=!1):this.model.children[t].visible=this.model.children[t].visible1)}},{key:"start",value:function(){this._isHideModel&&this.setModelActive(!0)}},{key:"disable",value:function(){this._isHideModel&&this.setModelActive(!1)}},{key:"destory",value:function(){if(g(l(n.prototype),"destory",this).call(this),this._isInit){for(var e=0;e<this.lineRoots.length;e++)this.lineRoots[e].parent.remove(this.lineRoots[e]),this.lineRoots[e].geometry.dispose();this.lineRoots.splice(0,this.lineRoots.length)}}}]),n}(md),yd=0,wd=1,xd=null;var bd=function(e){A(n,e);var t=p(n);function n(){return r(this,n),t.call(this)}return o(n,[{key:"initParams",value:function(){this.t2D=null,this.color=new Sn(1,1,1),this.alpha=1}},{key:"initMaterial",value:function(){var e={};e.t2D={value:this.t2D},e.color={value:this.color},e.alpha={value:this.alpha},this.material.uniforms=e,this.material.vertexShader="\n\n    varying vec2 vUv;\n\n    void main() {\n\n        vUv = uv;\n\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n         gl_Position = projectionMatrix * mvPosition;\n\n    }\n\n",this.material.fragmentShader="\n    uniform sampler2D t2D;\n    uniform vec3 color;\n    uniform float alpha;\n    varying vec2 vUv;\n\n    void main() {\n\n        vec4 texColor = texture2D( t2D, vUv );\n        gl_FragColor = vec4(texColor.rgb * color,alpha * texColor.a);\n\n    }\n\n"}},{key:"updateMaterial",value:function(){g(l(n.prototype),"updateMaterial",this).call(this),this.t2D?this.material.uniforms.t2D.value=this.t2D:this.material.uniforms.t2D.value=xd||(xd=(new KA).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE6WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMi0wOC0xMFQxNzo0NDozOSswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMi0wOC0xMFQxNzo0NDozOSswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjItMDgtMTBUMTc6NDQ6MzkrMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRmYWM2NzA4LWI3YjYtMzI0Ny05NzIxLTAwZGI4NjY5MTI4OSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0ZmFjNjcwOC1iN2I2LTMyNDctOTcyMS0wMGRiODY2OTEyODkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo0ZmFjNjcwOC1iN2I2LTMyNDctOTcyMS0wMGRiODY2OTEyODkiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjRmYWM2NzA4LWI3YjYtMzI0Ny05NzIxLTAwZGI4NjY5MTI4OSIgc3RFdnQ6d2hlbj0iMjAyMi0wOC0xMFQxNzo0NDozOSswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4LrjbLAAAAEklEQVQI12P8//8/AwwwEscBAG1XC/mlMMwsAAAAAElFTkSuQmCC")),this.material.uniforms.color.value=this.color,this.material.uniforms.alpha.value=this.alpha,this.material.needsUpdate=!0}}]),n}(function(){function e(){r(this,e),this.material=new Pi,this.material.data=this,this.initParams(),this.initMaterial()}return o(e,[{key:"transparent",set:function(e){this.material.transparent=e,this.material.depthWrite=!e}},{key:"initParams",value:function(){}},{key:"initMaterial",value:function(){}},{key:"updateMaterial",value:function(){}}]),e}()),Cd=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).edgeEffect=new vd(i.model),i._lineColor=5371391,i._color=5422335,i._alpha=.3,i._texture=null,i}return o(n,[{key:"setObjects",value:function(e){g(l(n.prototype),"setObjects",this).call(this,e),this.edgeEffect.setObjects(this.objects)}},{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.material=new bd,this.material.transparent=!0,this.edgeEffect.color=this._lineColor,this.material.color.set(this._color),this.material.alpha=this._alpha,this.material.t2D=this._texture,this.material.updateMaterial()}},{key:"start",value:function(){g(l(n.prototype),"start",this).call(this),this.replaceMaterial(!1)}},{key:"disable",value:function(){g(l(n.prototype),"disable",this).call(this),this.replaceMaterial(!0)}},{key:"destory",value:function(){g(l(n.prototype),"destory",this).call(this),this.edgeEffect.destory(),this.replaceMaterial(!0),this.material=null}},{key:"setVisible",value:function(e){this.edgeEffect.visible=this._visible}},{key:"replaceMaterial",value:function(e){for(var t=0;t<this.objects.length;t++){var n=this.objects[t];if(e){if(n.srcMaterials&&n.srcMaterials.length>0){n.material=[];for(var i=0;i<n.srcMaterials.length;i++)n.material.push(n.srcMaterials[i]);n.srcMaterials=[]}}else{n.srcMaterials=[];for(var r=0;r<n.material.length;r++)n.srcMaterials.push(n.material[r]),n.material[r]=this.material.material}}}},{key:"lineColor",set:function(e){this._lineColor=e,this._isInit&&(this.edgeEffect.color=this._lineColor)}},{key:"color",set:function(e){this._color=e,this._isInit&&(this.material.color.set(this._color),this.material.updateMaterial())}},{key:"alpha",set:function(e){this._alpha=e,this._isInit&&(this.material.alpha=this._alpha,this.material.updateMaterial())}},{key:"texture",set:function(e){this._texture=e,this._isInit&&(this.material.t2D=this._texture,this.material.updateMaterial())}}]),n}(md),Md=function(){function e(t){r(this,e),this.model=t,this.effectMap=new Map,this.effectNodeArray=[],this.effectLifeTime=10}return o(e,[{key:"tick",value:function(e){var t=this;this.effectMap.forEach((function(n,i){!n.visible&&n.IsInit&&(n.time+=e,n.time>=t.effectLifeTime&&n.destory())}));for(var n=0;n<this.effectNodeArray.length;n++){var i=this.effectNodeArray[n];!i.visible&&i.IsInit&&(i.time+=e,i.time>=this.effectLifeTime&&(i.destory(),this.effectNodeArray.splice(n,1),n--))}}},{key:"getEffect",value:function(e){var t=this.effectMap.get(e);return t||(t=this.createEffect(e),this.effectMap.set(e,t)),t}},{key:"createEffect",value:function(e){return e===yd?new vd(this.model):e===wd?new Cd(this.model):void 0}},{key:"getMeshByNames",value:function(e){var t=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=this.model.getObjectByName(e[n]);i&&i.isMesh&&t.push(i)}else{var r=this.model.getObjectByName(e);r&&r.isMesh&&t.push(r)}return t}},{key:"createEffectByNames",value:function(e,t){var n=this.getMeshByNames(e),i=this.createEffect(t);return i.setObjects(n),this.effectNodeArray.push(i),i}},{key:"edgeDetection",get:function(){return this.getEffect(yd)}},{key:"addDetection",value:function(e){return this.createEffectByNames(e,yd)}},{key:"technology",get:function(){return this.getEffect(wd)}},{key:"addTechnology",value:function(e){return this.createEffectByNames(e,wd)}}]),e}(),Bd={Perlin:(new KA).load("https://laozicloud-sdk.obs.cn-east-2.myhuaweicloud.com:443/assets/noise/perlin.jpg"),Radial:(new KA).load("https://laozicloud-sdk.obs.cn-east-2.myhuaweicloud.com:443/assets/noise/radial.jpg"),Linner:(new KA).load("https://laozicloud-sdk.obs.cn-east-2.myhuaweicloud.com:443/assets/noise/linear.jpg")};Dt.prototype.startMove=function(e){var t=this;if(e.path){this.tween&&this.tween.stop();var n=[];e.path.forEach((function(e){n.push((new tt).copy(e))}));var i=new al(n);i.curveType="catmullrom",i.tension=0;var r,a={t:0},o=new tt;this.tween=new Ku.Tween(a).to({t:1},e.time||3e3).onUpdate((function(){var e=new tt;i.getPoint(a.t,e),o.copy(e),r&&i.getPoint(a.t+.01,o),r=a.t,t.position.copy(e.clone())})).onComplete((function(){e.onComplete&&e.onComplete()})).repeat(void 0!==e.loop&&null!==e.loop?e.loop-1:0).start()}else console.error("startMovepath")},Dt.prototype.stopMove=function(){this.tween&&this.tween.stop()};var Id=function(e){A(i,e);var t=p(i);function i(){var e;return r(this,i),(e=t.call(this))._cacheMaterials={},e._cache=new WeakMap,e.viewer=null,e.isModel=!0,e.name="",e.objects=[],e.materials=[],e.animation=new ud(d(e)),e.envMap=null,e.boundingBox=new Jt,e.boundingSphere=new en,e.clickCallback=[],e.dblclickCallback=[],e.mousedownCallback=[],e.mousemoveCallback=[],e.effect=new Md(d(e)),e.clock=new ic(!0),e}return o(i,[{key:"mapLoader",get:function(){return this.viewer.sceneManager.mapLoader}},{key:"materialViewer",get:function(){return this._materialViewer||(this._materialViewer=new dd(this)),this._materialViewer}},{key:"shadowMaterial",get:function(){return this._shadowMaterial||null},set:function(e){e?this.traverse((function(t){if(t.isMesh&&Array.isArray(t.material)&&(void 0===t.materialNum||t.materialNum!=t.material.length)){for(var i=t.material.length,r=0;r<i;r++){var a=n({},t.geometry.groups[r]);a.materialIndex=r+i,t.geometry.groups.push(a),t.material.push(e),e.skinning=t.material[r].skinning,e.morphTargets=t.material[r].morphTargets}t.materialNum=i}})):this.traverse((function(e){e.isMesh&&Array.isArray(e.material)&&e.materialNum&&e.materialNum!=e.material.length&&(e.geometry.groups.length=e.materialNum,e.material.length=e.materialNum,delete e.materialNum)})),this._shadowMaterial=e}},{key:"getObjectByID",value:function(e){var t=null;return this.traverse((function(n){n.ID===e&&(t=n)})),t}},{key:"getMaterials",value:function(){return this.materials.filter((function(e){return void 0===e.re}))}},{key:"applyWireFrame",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this.materialViewer.applyWireFrame.bind(this._materialViewer)():this.materialViewer.resetMaterial.bind(this._materialViewer)()}},{key:"update",value:function(){this.boundingBox.setFromObject(this),this.boundingBox.getBoundingSphere(this.boundingSphere),this.effect.tick(this.clock.getDelta())}},{key:"add",value:function(e){g(l(i.prototype),"add",this).call(this,e)}},{key:"remove",value:function(e){g(l(i.prototype),"remove",this).call(this,e)}},{key:"replace",value:function(e,t){e.position.copy(t.localToWorld(t.position.clone())),e.rotation.copy(t.rotation),t.parent.add(e),t.parent.remove(t)}},{key:"setPosition",value:function(e,t,n){this.position.set(e,t,n)}},{key:"setRotation",value:function(e,t,n){this.rotation.set(e,t,n)}},{key:"setScale",value:function(e,t,n){this.scale.set(e,t,n)}},{key:"setEnvMap",value:function(e,t,n){var i=this;return e?e.isTexture?(this.envMap=e,this.materials.forEach((function(t){t.envMap=e,t.needsUpdate=!0})),t&&t(),e):this.mapLoader.loadEnvMap(e,(function(e){i.envMap=e,i.materials.forEach((function(t){t.envMap=e,t.needsUpdate=!0})),t&&t()}),n):(this.envMap=null,this.materials.forEach((function(e){e.envMap=null,e.needsUpdate=!0})),null)}},{key:"getEnvMap",value:function(){if(this.envMap)return this.envMap.image.src}},{key:"setEnvMapRotation",value:function(e){this.envMapRotation=e,this.materials.forEach((function(t){t.envMap&&(t.envRotateY=Math.PI/180*e,t.needsUpdate=!0)}))}},{key:"getEnvMapRotation",value:function(){return this.envMapRotation||0}},{key:"setEnvMapIntensity",value:function(e){this.envMapIntensity=e,this.materials.forEach((function(t){t.envMapIntensity=e,t.needsUpdate=!0}))}},{key:"getEnvMapIntensity",value:function(){return this.envMapIntensity||.7}},{key:"clearEnvMap",value:function(){this.envMap=null,this.materials.forEach((function(e){e.envMap=null,e.needsUpdate=!0}))}},{key:"hasAnimation",value:function(){return this.animation.hasAnimation()}},{key:"adapt",value:function(){this.update(),this.updateWorldMatrix(!1,!0);var e=(new tt).subVectors(this.boundingBox.getCenter(),this.position);this.children.forEach((function(t){t.position.x-=e.x,t.position.y-=e.y,t.position.z-=e.z})),this.update(),this.viewer.sceneManager.fitCamera(this,this.boundingBox)}},{key:"getSize",value:function(){return this.boundingBox.getSize()}},{key:"showDimension",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.dimension&&this.viewer.sceneManager.root.remove(this.dimension),this.dimension=new fd(this,e,t,n),this.viewer.sceneManager.root.add(this.dimension)}},{key:"hideDimension",value:function(){this.dimension&&(this.viewer.sceneManager.root.remove(this.dimension),this.dimension=null)}},{key:"setExploding",value:function(e){this.exploding||(this.exploding=new pd(this)),this.exploding.applyScalar(parseFloat(e))}},{key:"setExplodingMode",value:function(e){this.exploding||(this.exploding=new pd(this)),this.exploding.applyScalar(0),this.exploding.setMode(e)}},{key:"onBeforeRender",value:function(e,t,n){}},{key:"onAfterRender",value:function(e,t,n){}},{key:"on",value:function(e,t){"click"==e&&(this.clickCallback.push(t),this.viewer.modelManager.intersectObjects.click.includes(this)||this.viewer.modelManager.intersectObjects.click.push(this)),"dblclick"==e&&(this.dblclickCallback.push(t),this.viewer.modelManager.intersectObjects.dblclick.includes(this)||this.viewer.modelManager.intersectObjects.dblclick.push(this)),"mousedown"==e&&(this.mousedownCallback.push(t),this.viewer.modelManager.intersectObjects.mousedown.includes(this)||this.viewer.modelManager.intersectObjects.mousedown.push(this)),"mousemove"==e&&(this.mousemoveCallback.push(t),this.viewer.modelManager.intersectObjects.mousemove.includes(this)||this.viewer.modelManager.intersectObjects.mousemove.push(this))}},{key:"off",value:function(e,t){"click"==e&&(this.clickCallback.includes(t)&&this.clickCallback.remove(t),0==this.clickCallback.length&&this.viewer.modelManager.intersectObjects.click.includes(this)&&this.viewer.modelManager.intersectObjects.click.remove(this)),"dblclick"==e&&(this.dblclickCallback.includes(t)&&this.dblclickCallback.remove(t),0==this.dblclickCallback.length&&this.viewer.modelManager.intersectObjects.dblclick.includes(this)&&this.viewer.modelManager.intersectObjects.dblclick.remove(this)),"mousedown"==e&&(this.mousedownCallback.includes(t)&&this.mousedownCallback.remove(t),0==this.mousedownCallback.length&&this.viewer.modelManager.intersectObjects.mousedown.includes(this)&&this.viewer.modelManager.intersectObjects.mousedown.remove(this)),"mousemove"==e&&(this.mousemoveCallback.includes(t)&&this.mousemoveCallback.remove(t),0==this.mousemoveCallback.length&&this.viewer.modelManager.intersectObjects.mousemove.includes(this)&&this.viewer.modelManager.intersectObjects.mousemove.remove(this))}},{key:"clear",value:function(){var e=this;this.clickCallback.map((function(t){e.viewer.modelManager.intersectObjects.click.remove(t)})),this.dblclickCallback.map((function(t){e.viewer.modelManager.intersectObjects.dblclick.remove(t)})),this.mousemoveCallback.map((function(t){e.viewer.modelManager.intersectObjects.mousemove.remove(t)})),this.mousedownCallback.map((function(t){e.viewer.modelManager.intersectObjects.mousedown.remove(t)})),this.clickCallback=[],this.dblclickCallback=[],this.mousemoveCallback=[],this.mousedownCallback=[]}},{key:"dispose",value:function(){this.traverse((function(e){e.isMesh&&(e.geometry&&e.geometry.dispose(),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map&&e.map.dispose(),e.dispose()})))}))}},{key:"setColor",value:function(e,t){this.selectedMaterial=this._getMaterialByName(e),this._applyParams("color",t,"color")}},{key:"setOpacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.selectedMaterial=this._getMaterialByName(e),this._applyParams("opacity",t),this._updateTransparent()}},{key:"setAlbedoMap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.selectedMaterial=this._getMaterialByName(e),this._applyParams("albedo",t,"map"),this.selectedMaterial.albedo&&(this.selectedMaterial.albedo.repeat.set(i,i),this.selectedMaterial.albedo.offset.set(n,n),this.selectedMaterial.needsUpdate=!0)}},{key:"setNormalMap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.selectedMaterial=this._getMaterialByName(e),this._applyParams("normalMap",t,"map"),this._applyParams("normalScale",n),this.selectedMaterial.normalMap&&(this.selectedMaterial.normalMap.repeat.set(r,r),this.selectedMaterial.normalMap.offset.set(i,i),this.selectedMaterial.needsUpdate=!0)}},{key:"_updateTransparent",value:function(){this.selectedMaterial&&(this.selectedMaterial.opacity<1||this.selectedMaterial.transparency>0?this.selectedMaterial.transparent=!0:1==this.selectedMaterial.opacity&&0==this.selectedMaterial.transparency&&(this.selectedMaterial.transparent=!1))}},{key:"_getMaterialByName",value:function(e){var t=this.materials.find((function(t){return t.sname==e}));if(!t)throw new Error("");return t}},{key:"_applyParams",value:function(e,t,n){var i=this;if(this._cacheMaterials[this.selectedMaterial.name]||(this._cacheMaterials[this.selectedMaterial.name]=this.selectedMaterial.clone()),"map"===n){var r=this.selectedMaterial[e];if(void 0===this.selectedMaterial[e+"0"]&&(this.selectedMaterial[e+"0"]=r||null),t){var a=t;t=this.mapLoader.load(t,(function(t){"reflectMap"!==e&&"envMap"!==e||((t=i.mapLoader.convertTexture(t)).image.src=a,i.selectedMaterial[e]=t,i.selectedMaterial.needsUpdate=!0)})),"envMap"===e?t.custom=!0:t.wrapS=t.wrapT=1e3}else t=null;this.selectedMaterial[e]=t}else"color"===n?this.selectedMaterial[e].setStyle(t):this.selectedMaterial[e]=t;this.selectedMaterial.needsUpdate=!0}},{key:"applyMaterialFile",value:function(e){var t=this,n=e.url,i=e.onTextureLoad,r=e.env,a=e.fromOthers,o=e.localPath;this.loader&&(this.splitCache&&(this.splitCache.map((function(e){var n=t.objects.find((function(t){return t.id===e.a})),i=t.materials.find((function(t){return t.name===e.c}));i&&(n.material[e.b]=i)})),this.splitCache=[]),this.loader.loader.extraMaterial={},o&&this.mapLoader.setBaseUrl(o),this.loader.loader.replaceMaterials({url:n,fromOthers:a,onTextureLoad:i,onLoad:function(){t.mapLoader.setBaseUrl(!1),r&&t.setEnvMap(t.envMap)}}))}},{key:"dissolve",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,n=this.viewer,i=e.target,r=e.speed,a=e.type,o=e.color,s=e.onComplete,A=e.start,l=e.end;if(void 0===i&&(i=this.objects),!Array.isArray(i))return new Error("param.target /, Model");void 0===a&&(a="Perlin");var c=["Perlin","Radial","Linner"].includes(a)?Bd[a]:a;if(!c.isTexture)return new Error("param.type 'Perlin', 'Radial', 'Linner', Texture");r=r||1,A=A||0,l=l||1,o=new Sn(o||16774921);var h=[],u=new WeakMap,d=[];Array.isArray(i)&&i.map((function(e){e.isMesh&&!h.includes(e)&&h.push(e),e.isObject3D&&e.traverse((function(e){e.isMesh&&!h.includes(e)&&h.push(e)}))})),h.map((function(e){return m(e)})),n.addEventListener(Xu.UPDATE,p);var f=A;function p(){f>=l&&(n.removeEventListener(Xu.UPDATE,p),s&&s(),p=null),f+=.005*r,d.map((function(e){u.get(e).dissolveRatio=f}))}function m(e){e.material=e.material.map((function(e){if(e.isAMRTShadowMaterial)return e;if(e.dissolveMap&&(e=t._cache.get(e)),u.has(e))return u.get(e);var n=(new xA).copy(e);return n.dissolveMap=c,n.dissolveRatio=A,n.dissolveColor=o,t._cache.set(n,e),u.set(e,n),d.push(e),n}))}}},{key:"clearDissolve",value:function(){var e=this;this.objects.map((function(t){t.material=t.material.map((function(t){return e._cache.has(t)?e._cache.get(t):t}))})),this._cache=new WeakMap}},{key:"showSkeleton",value:function(){this.skeleton?this.skeleton.visible=!0:(this.skeleton=new nh(this),this.skeleton.visible=!0,this.add(this.skeleton))}},{key:"hideSkeleton",value:function(){this.skeleton&&(this.skeleton.visible=!1),this.skeleton=null}}]),i}(Dt),Ed={};function Sd(){}Sd.prototype=Object.assign(Sd.prototype,{constructor:Sd,load:function(e,t,n,i){if(void 0===Ed[e]){Ed[e]=[],Ed[e].push({onLoad:t,onProgress:n,onError:i});var r=new XMLHttpRequest;return r.open("GET",e,!0),r.addEventListener("load",(function(t){var n=this.response,i=Ed[e];if(delete Ed[e],200===this.status||0===this.status)for(var a=0,o=i.length;a<o;a++){(s=i[a]).onLoad&&s.onLoad(n)}else for(a=0,o=i.length;a<o;a++){var s;(s=i[a]).onError&&s.onError(t)}r.end=!0}),!1),r.addEventListener("progress",(function(t){for(var n=Ed[e],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(t)}}),!1),r.addEventListener("error",(function(t){var n=Ed[e];delete Ed[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.end=!0}),!1),r.addEventListener("abort",(function(t){var n=Ed[e];delete Ed[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.end=!0}),!1),void 0!==this.responseType&&(r.responseType=this.responseType),r.send(null),r}Ed[e].push({onLoad:t,onProgress:n,onError:i})},setResponseType:function(e){return this.responseType=e,this}});var Td=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).isBIM=!0,i.bimConfig=null,i.structureTree=null,i.basePath="",i.extension="",i.nodeTree=null,i.nodeArray=[],i.faceMap=null,i.hideNodes={},i}return o(n,[{key:"getComponentInfo",value:function(e,t){if(void 0!==e.faceIndex){var n=this.getComponentInfoByFace(e);if(n){var i=this._findNodeParent(n);n.bim||i.bim?t(n.bim||i.bim):this.getComponentFileByCID(n.CID||i.CID,(function(){t(n.bim||i.bim)}))}}else e.userData.bim||e.parent.userData.bim?t(e.userData.bim||e.parent.userData.bim):this.getComponentFileByCID(e.CID||e.parent.CID,(function(){t(e.userData.bim||e.parent.userData.bim)}))}},{key:"getObjectByCID",value:function(e){return this.getObjectByProperty("CID",parseInt(e))}},{key:"getComponentInfoByCID",value:function(e){var t=this.getObjectByProperty("CID",parseInt(e));if(t)return this.getComponentInfo(t)}},{key:"getComponentFileByCID",value:function(e,t){for(var n=0;n<this.bimConfig.length;n++){var i=this.bimConfig[n];!i.loaded&&i.b.indexOf(e)>-1&&this.loadComponentFile(i,t)}}},{key:"loadComponentFile",value:function(e,t){var n=this,i="gz"===this.extension?e.a+"."+this.extension:e.a;(new Sd).load(this.basePath+i,(function(e){n.parseComponentFile(JSON.parse(e)),t()})),e.loaded=!0}},{key:"parseComponentFile",value:function(e,t){var n=this;e.forEach((function(e){var t={id:e.a,pid:e.b,name:e.c,data:e.d};if(n.nodeTree){var i=n.nodeArray.find((function(t){return t.CID==e.a}));i&&(i.bim=t)}else{var r=n.getObjectByProperty("CID",e.a);r&&(r.userData.bim=t)}}))}},{key:"onComplete",value:function(){var e=this;this.objects=[],this.traverse((function(t){if(t.isMesh&&e.objects.push(t),t.name.indexOf("##")>-1){var n=t.name.split("##");t.name=n[0],t.CID=parseInt(n[1])}}))}},{key:"getNodeByFace",value:function(e){return this.nodeArray.find((function(t){return e>=t.face[0]&&e<=t.face[1]}))}},{key:"getComponentInfoByFace",value:function(e,t){var n=this.faceMap.find((function(t){return t.a==e.object.ID}));if(n){for(var i=null,r=0,a=n.b.length;r<a;r+=3)if(e.faceIndex>=n.b[r]&&e.faceIndex<=n.b[r+1]){i=n.b[r+2];break}if(null!==i)return this.nodeArray.find((function(e){return e.a==i}))}}},{key:"getFaceRange",value:function(e){var t=this.faceMap.find((function(t){return t.a==e.object.ID}));if(t){for(var n=0,i=t.b.length;n<i;n+=3)if(e.faceIndex>=t.b[n]&&e.faceIndex<=t.b[n+1])return{face:[t.b[n],t.b[n+1]],id:t.b[n+2],node:this.nodeTree[t.b[n+2]]};return null}}},{key:"setMaterialByFace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#00f9ff",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=this.getFaceRange(e),r=e.object,a=r.material[0].clone();a.color.setStyle(t),a.opacity=n,r.changeNodes[i.id]={node:i,mat:a},this._resetMaterial(r)}},{key:"_resetMaterial",value:function(e){var t=e.geometry.index.count,n=[],i=[];e.geometry.index.array=[],e.material=[e.material[0]];var r=Object.values(e.changeNodes),a=r.length;r.forEach((function(e){n.push([]),n[n.length-1].mat=e.mat}));for(var o=0;o<t;o++){for(var s=!0,A=0;A<a;A++){var l=r[A],c=3*l.node.face[0],h=3*l.node.face[1];o>=c&&o<h&&(n[A].push(e.originIndex[o]),s=!1)}s&&i.push(e.originIndex[o])}var u=[];n.forEach((function(e){u=u.concat(e)})),e.geometry.setIndex(i.concat(u)),e.geometry.clearGroups(),e.geometry.addGroup(0,i.length,0);var d=i.length;n.forEach((function(t,n){e.geometry.addGroup(d,t.length,n+1),e.material.push(t.mat),d+=t.length})),AMRT.render()}},{key:"clearMaterialByFace",value:function(e){var t=this.getFaceRange(e),n=e.object;n.changeNodes[t.id]&&(delete n.changeNodes[t.id],this._resetMaterial(n))}},{key:"setNodeVisible",value:function(e,t,n){t.forEach((function(t){n?e.hideNodes[t.id]&&delete e.hideNodes[t.id]:e.hideNodes[t.id]=t.face}));var i=e.originIndex.length;e.geometry.index.array=[];for(var r=[],a=Object.values(e.hideNodes),o=a.length,s=0;s<i;s++){for(var A=!0,l=0;l<o;l++){var c=a[l],h=3*c[0],u=3*c[1];if(s>=h&&s<u){A=!1;break}}A&&r.push(e.originIndex[s])}e.geometry.setIndex(r),e.geometry.clearGroups(),e.geometry.addGroup(0,r.length,0),AMRT.render()}},{key:"showComponentByCID",value:function(e){if(this.nodeTree)this._setComponentVisible(e,!0);else{var t=this.getObjectByProperty("CID",e);t&&(t.visible=!1)}}},{key:"hideComponentByCID",value:function(e){if(this.nodeTree)this._setComponentVisible(e,!1);else{var t=this.getObjectByProperty("CID",e);t&&(t.visible=!0)}}},{key:"_setComponentVisible",value:function(e,t){var n=this;if(this.hideNodes[e])console.time("setFace"),this.hideNodes[e].forEach((function(e){n.setNodeVisible(e.mesh,e.nodes,t)})),console.timeEnd("setFace");else{console.time(""),console.time("findChildren");var i=this._findNodeByCID(e),r=this._getNodeChild(i);console.timeEnd("findChildren"),console.time("findMesh");for(var a={},o=0,s=r.length;o<s;o++){var A=this._findMeshByNode(r[o]);A&&(a[A.mesh.ID]?a[A.mesh.ID].nodes.push(A):a[A.mesh.ID]={mesh:A.mesh,nodes:[A]})}console.log(a),console.timeEnd("findMesh"),console.time("setFace"),t||this.hideNodes[e]||(this.hideNodes[e]=[]),Object.values(a).forEach((function(i){if(i.nodes.length>1){var r=n._findNodeParent(i.nodes[0].node);i.nodes=[{mesh:i.mesh,id:r.a,node:r,face:[i.nodes[0].face[0],i.nodes[i.nodes.length-1].face[1]]}]}n.setNodeVisible(i.mesh,i.nodes,t),t||n.hideNodes[e].push(i)})),console.timeEnd("setFace"),console.timeEnd("")}}},{key:"_findNodeByCID",value:function(e){return this.nodeArray.find((function(t){return t.CID==e}))}},{key:"_findMeshByCID",value:function(e){var t=this._findNodeByCID(e);return t?this._findMeshByNode(t):null}},{key:"_findMeshByNode",value:function(e){var t=e.target||this._findMeshByNodeID(e.a);if(t)return e.target=t,t.node=e,t;e.children||this._findNodeChildren(e);for(var n=0,i=e.children.length;n<i;n++){var r=e.children[n].target||this._findMeshByNodeID(e.children[n].a);if(r)return e.children[n].target=r,r.node=e,r}return null}},{key:"_findMeshByNodeID",value:function(e){for(var t=0,n=this.faceMap.length;t<n;t++)for(var i=this.faceMap[t],r=0,a=i.b.length;r<a;r+=3)if(e==i.b[r+2]){var o=this.getObjectByProperty("ID",i.a);if(o)return{mesh:o,face:[i.b[r],i.b[r+1]],id:e}}return null}},{key:"_getNodeChild",value:function(e){var t=[];return function e(n){if(t.push(n),n.children&&n.children.length>0)for(var i=0,r=n.children.length;i<r;i++)e(n.children[i])}(e),t}},{key:"_findNodeChildren",value:function(e){e.children=[],this.nodeArray.forEach((function(t){t.c==e.a&&e.children.push(t)}))}},{key:"_findNodeParent",value:function(e){if(e.parent)return e.parent;for(var t=0;t<this.nodeArray.length;t++)if(e.c==this.nodeArray[t].a)return e.parent=this.nodeArray[t],e.parent}}]),n}(Id);function Ld(e){var t=new xA;return t.name=e,t.ID=e,t.color=new Sn("#cccccc"),t}var Fd={},_d=function(){function e(){r(this,e)}return o(e,null,[{key:"parseAmrtMaterial",value:function(e,t,n,i,r,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];n||(n=Ld(matName)),void 0!==e.a&&(n.name=e.a,n.ID=e.a,n.sname=e.ee);var s=0,A=0;function l(){++s===A&&(n.needsUpdate=!0,r&&r instanceof Function&&r())}if(!o)if(void 0!==e.b?n.color=(new Sn).fromArray(e.b):n.color.set(16777215),void 0!==e.c&&t[e.c]){A++;var c=t[e.c];a.load(c,(function(t){null!=e.t&&t.repeat.set(e.t[0],e.t[1]),null!=e.x&&t.offset.set(e.x[0],e.x[1]),null!=e.ff&&(t.rotation=e.ff),null!=e.ad&&(n.albedoUV=e.ad),n.albedo=t,void 0!==e.c?n.useDefault=e.useDefault:n.useDefault=!0,l()}),null,(function(e){console.error(""),l()}))}else n.albedo=null,n.albedoUV=null,n.needsUpdate=!0;if(e.d){var h=(new Sn).fromArray(e.d);n.emissive=h}if(void 0!==e.e&&(n.aoScale=parseFloat(e.e)),void 0!==e.f&&n.color.multiplyScalar(parseFloat(e.f)),void 0!==e.g&&(n.smoothness=parseFloat(e.g)),void 0!==e.h&&(n.metallic=parseFloat(e.h)),void 0!==e.i&&(n.normalScale=parseFloat(e.i)),void 0!==e.j&&(n.opacity=parseFloat(e.j)),void 0!==e.gg&&(n.transparency=parseFloat(e.gg)),(n.opacity<1||n.transparency>0)&&(n.transparent=!0),void 0!==e.hh&&(n.alphaTest=parseFloat(e.hh)),void 0!==e.ii&&(n.reflectIntensity=parseFloat(e.ii)),void 0!==e.si&&(n.side=e.si),void 0!==e.q&&t[e.q]?(A++,a.load(t[e.q],(function(t){void 0!==e.u?t.repeat.set(e.u[0],e.u[1]):t.repeat.set(1,1),void 0!==e.mm&&t.offset.set(e.mm[0],e.mm[1]),void 0!==e.nn&&(t.rotation=e.nn),n.normalMap=t,l()}),null,(function(e){console.error(""),l()}))):(n.normalMap=null,n.needsUpdate=!0),void 0!==e.cf&&t[e.cf]?(A++,a.load(t[e.cf],(function(t){void 0!==e.cb?t.repeat.set(e.cb[0],e.cb[1]):t.repeat.set(1,1),void 0!==e.cg&&t.offset.set(e.cg[0],e.cg[1]),void 0!==e.cn&&(t.rotation=e.cn),void 0!==e.ca&&(n.normalScale2=parseFloat(e.ca)),n.normalMap2=t,l()}),null,(function(e){console.error(""),l()}))):(n.normalMap2=null,n.needsUpdate=!0),void 0!==e.r&&t[e.r]&&void 0!==e.fd){A++;var u=t[e.r];Fd[u]?(n.aoMap=Fd[u],n.aoUV=e.fd,Fd[u+"_mats"].push(n),l()):(n.aoMap=Fd[u]=a.load(t[e.r],(function(t){void 0!==e.v?t.repeat.set(e.v[0],e.v[1]):t.repeat.set(1,1),void 0!==e.oo&&t.offset.set(e.oo[0],e.oo[1]),void 0!==e.ss&&(t.rotation=e.ss),n.aoUV=e.fd,Fd[u+"_mats"]&&Fd[u+"_mats"].map((function(e){return e.needsUpdate=!0})),l()}),null,(function(e){console.error(""),l()})),Fd[u+"_mats"]=[n])}else n.aoMap=null,n.needsUpdate=!0;if(void 0!==e.y&&t[e.y]?(A++,a.load(t[e.y],(function(t){void 0!==e.bb?t.repeat.set(e.bb[0],e.bb[1]):t.repeat.set(1,1),void 0!==e.pp&&t.offset.set(e.pp[0],e.pp[1]),void 0!==e.tt&&(t.rotation=e.tt),n.metallicMap=t,l()}),null,(function(e){console.error(""),l()}))):(n.metallicMap=null,n.needsUpdate=!0),void 0!==e.z&&t[e.z]?(A++,a.load(t[e.z],(function(t){void 0!==e.cc?t.repeat.set(e.cc[0],e.cc[1]):t.repeat.set(1,1),void 0!==e.qq&&t.offset.set(e.qq[0],e.qq[1]),void 0!==e.uu&&(t.rotation=e.uu),n.roughnessMap=t,l()}),null,(function(e){console.error(""),l()}))):(n.roughnessMap=null,n.needsUpdate=!0),void 0!==e.aa&&t[e.aa]?(A++,a.load(t[e.aa],(function(t){void 0!==e.dd?t.repeat.set(e.dd[0],e.dd[1]):t.repeat.set(1,1),void 0!==e.rr&&t.offset.set(e.rr[0],e.rr[1]),void 0!==e.vv&&(t.rotation=e.vv),void 0!==e.gd&&(n.emissiveUV=e.gd),n.emissiveMap=t,l()}),null,(function(e){console.error(""),l()}))):(n.emissiveMap=null,n.needsUpdate=!0),void 0!==e.ll&&t[e.ll]){A++;var d=t[e.ll];void 0!==e.yy&&(n.reflectRotateY=e.yy),a.load(d,(function(e){var t=e.image;(e=a.convertTexture(e)).wrapS=e.wrapT=1e3,n.reflectMap=e,e.image=t,l()}),null,(function(e){console.error(""),l()}))}else n.reflectMap=null,n.needsUpdate=!0;if(void 0!==e.zz&&t[e.zz]){A++;var f=t[e.zz];a.load(f,(function(t){void 0!==e.bb?t.repeat.set(e.zx[0],e.zx[1]):t.repeat.set(1,1),void 0!==e.pp&&t.offset.set(e.zc[0],e.zc[1]),void 0!==e.zv&&(t.rotation=e.zv),n.alphaMap=t,l()}),null,(function(e){console.error(""),l()}))}else n.reflectMap=null,n.needsUpdate=!0;return n.retainMap=!0,void 0!==e.jj&&(n.retainMap=Boolean(e.ii)),void 0!==e.kk&&!0!==e.kk?n.renderOrder=Number(e.kk):n.renderOrder=n.opacity<1?je:We,null!=e.jr&&(n.reflectivity=e.jr),null!=e.l&&(n.wireframe=e.l),null!=e.o&&(n.skinning=e.o),null!=e.p&&(n.vertexTangents=e.p),null!=e.qn&&(n.normalMapType=e.qn),null!=e.rm&&(n.morphTargets=e.rm),null!=e.transparent&&(n.transparent=e.transparent),void 0!==e.re&&(n.re=e.re),n.needsUpdate=!0,i&&i instanceof Function&&i(n),0===A&&r&&r instanceof Function&&r(n),n}},{key:"export",value:function(e,t){if(void 0!==e.re)return{a:e.ID||e.name,re:e.re};var n=Object.keys(t).length,i={a:e.ID||e.name,b:e.color.toArray(),d:e.emissive.toArray(),e:e.aoScale,g:e.smoothness,h:e.metallic,i:e.normalScale,j:e.opacity,gg:e.transparency,hh:e.alphaTest,ii:e.reflectIntensity,jj:e.retainMap,kk:e.renderOrder,ee:e.sname,useDefault:e.useDefault,transparent:e.transparent,si:e.side,jr:e.reflectivity,lw:e.wireframe,os:e.skinning,pv:e.vertexTangents,qn:e.normalMapType,rm:e.morphTargets};return e.albedo&&(i.t=e.albedo.repeat.toArray(),i.x=e.albedo.offset.toArray(),i.ff=e.albedo.rotation,i.ad=e.albedoUV,e.albedo.image&&(i.c=n,t[n]=e.albedo.image.src,n++)),e.normalMap&&(i.u=e.normalMap.repeat.toArray(),i.mm=e.normalMap.offset.toArray(),i.nn=e.normalMap.rotation,e.normalMap.image&&(i.q=n,t[n]=e.normalMap.image.src,n++)),e.normalMap2&&(i.cb=e.normalMap2.repeat.toArray(),i.cg=e.normalMap2.offset.toArray(),i.cn=e.normalMap2.rotation,i.ca=e.normalMap2.normalScale2,e.normalMap2.image&&(i.cf=n,t[n]=e.normalMap2.image.src,n++)),e.aoMap&&(i.v=e.aoMap.repeat.toArray(),i.oo=e.aoMap.offset.toArray(),i.ss=e.aoMap.rotation,i.fd=e.aoUV,e.aoMap.image&&(i.r=n,t[n]=e.aoMap.image.src,n++)),e.metallicMap&&(i.bb=e.metallicMap.repeat.toArray(),i.pp=e.metallicMap.offset.toArray(),i.tt=e.metallicMap.rotation,e.metallicMap.image&&(i.y=n,t[n]=e.metallicMap.image.src,n++)),e.roughnessMap&&(i.cc=e.roughnessMap.repeat.toArray(),i.qq=e.roughnessMap.offset.toArray(),i.uu=e.roughnessMap.rotation,e.roughnessMap.image&&(i.z=n,t[n]=e.roughnessMap.image.src,n++)),e.emissiveMap&&(i.dd=e.emissiveMap.repeat.toArray(),i.rr=e.emissiveMap.offset.toArray(),i.vv=e.emissiveMap.rotation,i.gd=e.emissiveUV,e.emissiveMap.image&&(i.aa=n,t[n]=e.emissiveMap.image.src,n++)),e.reflectMap&&e.reflectMap.image&&(i.yy=e.reflectRotateY,i.ll=n,t[n]=e.reflectMap.image.src,n++),e.alphaMap&&(i.zx=e.alphaMap.repeat.toArray(),i.zc=e.alphaMap.offset.toArray(),i.zv=e.alphaMap.rotation,e.alphaMap.image&&(i.zz=n,t[n]=e.alphaMap.image.src,n++)),i}},{key:"merge",value:function(e,t){var n=0;if(e.b&&(n=Object.keys(e.b).length,t.b))for(var i in t.b)i=parseInt(i),e.b[i+n]=t.b[i];Array.isArray(t.a)&&(t.a=t.a.filter((function(e){return void 0===e.re})),e.a.map((function(i,r){if(i.ee){var a=t.a.find((function(e){return e.ee===i.ee}));for(var o in a)["c","q","cf","r","y","z","aa","ll","zz"].includes(o)&&(a[o]=a[o]+n);a&&(a.a=i.a,e.a[r]=Object.assign({},a))}})))}}]),e}(),Ud=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.cacheMats=[],this.queryMats={},this.cacheMeshes=[],this.cacheMesheIds=[],this.cacheAnimations=[],this.cacheActions=[],this.cacheSkyboxs={},this.cacheSkinnedMeshs=[],this.cacheSkinnedMeshIds=[],this.cacheEnvMap={},this.cacheAoMap={},this.instances=null,this.extraMaterial={},this.cacheExtraMat=[],this.scene=null,this.hasSkinnedAnimation=!1,this.model=t.isBIM?new Td:new Id,this.model.objects=this.cacheMeshes,this.model.materials=this.cacheMats,this.animNameMap=new Map}return o(e,[{key:"load",value:function(e,t,n,i){var r=this;"undefined"!=typeof Worker?(this.workerLoader=new sd,this.workerLoader.loadMesh(e,(function(e){t(r.parse(e))}),n,(function(e){console.error(""),i&&i(e)}))):(new VA).load(e,(function(e){try{r.parse(JSON.parse(e))}catch(e){console.error("",e),i&&i(e)}t(r.model)}),n,i)}},{key:"loadNodes",value:function(e,t,n){var i=this;(new VA).load(e,(function(e){i.generateNodes(JSON.parse(e)),t()}),void 0,(function(t){console.error(":"+e,t)}))}},{key:"generateNodes",value:function(e){var t=this;e.forEach((function(e){var n=new Ha;if(n.ID=e.a,n.name=e.b,-1==e.c)t.model.add(n);else{var i=t.model.getObjectByProperty("ID",e.c);i&&i.add(n)}n.applyMatrix((new vt).fromArray(e.d)),t.addToCache(n)}))}},{key:"bindSkeleton",value:function(){}},{key:"initSkeletonTransform",value:function(){}},{key:"parse",value:function(e){var t=this.model;Array.isArray(e)||(e=[e]);for(var n=[],i=function(t){e.find((function(n,i){return n.a===e[t].a&&t!=i}))&&(e[t].a+=e[t].b)},r=0;r<e.length;r++)i(r);for(var a=0;a<e.length;a++){var o=void 0,s=e[a];if(6==s.at&&this.instances){var A=this._getInstanceMatrix(s.a);A&&(s.iid=s.a,s.a=A.b,s.b=A.a,s.d=A.d)}if(null==s.at||0==s.at||2==s.at||6==s.at||s.h&&s.ff&&0==s.ff.length)if(o=this.generateMesh(s),void 0!==s.iid&&(o.iid=s.iid),this.addToCache(o),-1===o.parentID)t.add(o);else{var l=this.cacheMesheIds.indexOf(o.parentID);-1!==l?this.cacheMeshes[l].add(o):t.add(o)}else if(1==s.at||3==s.at)if(o=this.generateSkinnedMesh(s),this.hasSkinnedAnimation=!0,this.cacheMesheIds.push(o.ID),-1===o.parentID)t.add(o);else{var c=this.cacheSkinnedMeshIds.indexOf(o.parentID);-1!==c?this.cacheSkinnedMeshs[c].add(o):t.add(o)}n.push(o)}if(this.hasSkinnedAnimation)for(var h=0;h<this.cacheSkinnedMeshs.length;h++){var u=this.cacheSkinnedMeshs[h];if(null!=u&&null!=u.xIDs){for(var d=[],f=0;f<u.xIDs.length;f++)d[f]=this.cacheSkinnedMeshs[u.xIDs[f]];var p=new Co(d);u.bind(p)}}return this._initMaterial(),n}},{key:"generateMesh",value:function(e){var t;if(e.h&&e.h.length>0){var n=this.generateGeometry(e);t=new xi(n,this.generateMaterial(n))}else t=new Dt;return t.name=e.a,t.ID=e.b,t.parentID=e.c,t.applyMatrix((new vt).fromArray(e.d)),t}},{key:"generateSkinnedMesh",value:function(e){var t;if(e.h){var n=this.generateGeometry(e),i=this.generateMaterial(n,!0);e.ff&&e.ff.length>0?(i.skinning=!0,n.setAttribute("skinIndex",new Qn(e.ff,4)),n.setAttribute("skinWeight",new Vn(e.gg,4)),(t=new wo(n,i)).xIDs=e.hh):t=new xi(n,i)}else t=new Mo;return t.name=e.a,t.ID=e.b,t.applyMatrix((new vt).fromArray(e.d)),this.cacheSkinnedMeshs[e.b]=t,this.model.add(t),this.model.updateMatrixWorld(!0),t}},{key:"generateGeometry",value:function(e){var t=new ni;t.name=e.a;var n=new vt;if(e.e&&n.fromArray(e.e),!(e.h&&e.h.length>0))return null;var i=new Vn(e.h,3);if(n.applyToBufferAttribute(i),t.setAttribute("position",i),e.j&&e.j.length>0){var r=new Vn(e.j,3);(new rt).getNormalMatrix(n).applyToBufferAttribute(r),t.setAttribute("normal",r)}else console.warn("");e.k&&e.k.length>0?t.setAttribute("uv",new Vn(e.k,2)):console.warn("UV"),e.l&&e.l.length>0&&t.setAttribute("uv2",new Vn(e.l,2)),t.setIndex(e.i),e.j&&0!=e.j.length||t.computeVertexNormals(),t.clearGroups(),e.k&&e.k.length>0&&$u(t);for(var a=[],o=0;o<e.m.length/3;o++)-1===a.indexOf(e.m[3*o+2])&&a.push(e.m[3*o+2]);for(var s=0;s<e.m.length/3;s++)t.addGroup(3*e.m[3*s],3*(e.m[3*s+1]-e.m[3*s]),a.indexOf(e.m[3*s+2]));return t.m=a,t}},{key:"preloadMap",value:function(e,t,n){this.workerLoader||(this.workerLoader=new sd),this.workerLoader.preloadMap(e,t,void 0,n)}},{key:"loadMaterials",value:function(e){var t=this,n=e.url,i=e.onLoad,r=e.onTextureLoad,a=e.onError;(new VA).load(n,(function(e){e=JSON.parse(e),t.SnameTable&&Array.isArray(e.a)&&e.a.map((function(e){e.ee&&t.SnameTable[e.ee]&&(e.a=t.SnameTable[e.ee])})),t.parseMaterials(e,i,r,a)}))}},{key:"loadAOMap",value:function(e,t){var n=this;this.mapLoader.BASE_URL="",this.mapLoader.load(e,(function(e){e.wrapS=e.wrapT=1e3,n.cacheMats.forEach((function(t){t.aoMap=e,t.needsUpdate=!0})),t&&t instanceof Function&&t()}),null,t)}},{key:"generateMaterial",value:function(e,t){for(var n=[],i=0;i<e.m.length;i++){var r=e.m[i];if(void 0!==this.queryMats[r])n.push(this.cacheMats[this.queryMats[r]]);else{var a=this._createBaseMaterial(r);n.push(a),t&&(a.skinning=!0),this.cacheMats.push(a),this.queryMats[r]=this.cacheMats.length-1}}return delete e.m,n}},{key:"_createBaseMaterial",value:function(e){var t=new xA;return t.ID=e,t.name=e,t.color=new Sn("#cccccc"),t}},{key:"parseMaterials",value:function(e,t,n,i){var r=this;if(Array.isArray(e)&&(e={a:e,b:[]}),this.extraMaterial=e.c||{},e.a.length>0){var a=0,o=0,s=e.a.length;e.a.forEach((function(A){r.parseMaterial({config:A,maps:e.b,onLoad:function(){++a===s&&(r._initMaterial(),t&&t instanceof Function&&t())},onTextureLoad:function(){++o===s&&n&&n instanceof Function&&n()},onError:i,edited:!1})}))}else t&&t instanceof Function&&t()}},{key:"parseMaterial",value:function(e){var t=e.config,n=e.maps,i=e.onLoad,r=e.onTextureLoad;e.onError;var a=e.edited,o=t.a,s=this.queryMats[o];if(void 0===s&&o&&o.toString().indexOf("_")>-1){var A=o.split("_")[0],l=this.queryMats[A],c=this.cacheMats[l],h=this.cacheMeshes.find((function(e){return e.name===t.mn})),u=c.clone();u.name=t.ee||o,u.sname=c.sname,u.ID=o,this.cacheMats.push(u),s=this.cacheMats.length-1,this.queryMats[o]=s,h.material[h.material.indexOf(c)]=u}var d=this.cacheMats[s];d||(d=this._createBaseMaterial(o),this.cacheMats.push(d),this.queryMats[o]=this.cacheMats.length-1),_d.parseAmrtMaterial(t,n,d,i,r,this.mapLoader,a)}},{key:"loadAnimationComplete",value:function(e){this.model.animation.setAnimationList(["take 01"])}},{key:"loadAnimation",value:function(e,t){var n=this;(new VA).load(e,(function(e){try{n.hasSkinnedAnimation?n.parseSkinnedAnimation(JSON.parse(e)):n.parseAnimation(JSON.parse(e))}catch(e){console.error("",e)}t&&t()}))}},{key:"parseAnimation",value:function(e){for(var t=0,n=[],i=0;i<e.length;i++){var r=e[i],a=this.cacheMeshes[this.cacheMesheIds.indexOf(r.a)];switch(r.b){case"a":n.push(new DA(a.name+".position",r.c,r.d));break;case"b":n.push(new PA(a.name+".quaternion",r.c,r.d));break;case"c":n.push(new DA(a.name+".scale",r.c,r.d))}var o=r.c[r.c.length-1];o>t&&(t=o)}var s=new RA("take 01",t,n);this.model.animation.addClip(s)}},{key:"parseSkinnedAnimation",value:function(e){for(var t=[],n=0,i=0;i<e.length;i++){var r=e[i],a=this.cacheSkinnedMeshs[r.a].name,o=[],s=[],A=[],l=[];r.d>n&&(n=r.d);for(var c=0;c<r.b.length;c++){o.push(r.b[c].a);var h=(new vt).fromArray(r.b[c].b),u=new tt,d=new qe,f=new tt;h.decompose(u,d,f),s.push(u.x),s.push(u.y),s.push(u.z),A.push(d.x),A.push(d.y),A.push(d.z),A.push(d.w),l.push(f.x),l.push(f.y),l.push(f.z)}t.push(new DA(a+".position",o,s)),t.push(new PA(a+".quaternion",o,A)),t.push(new DA(a+".scale",o,l))}var p=new RA("take 01",n,t);this.model.animation.addClip(p)}},{key:"_getInstanceMatrix",value:function(e){for(var t=0,n=this.instances.length;t<n;t++)if(this.instances[t].c==e)return this.instances[t]}},{key:"addToCache",value:function(e){this.cacheMeshes.push(e),this.cacheMesheIds.push(e.ID)}},{key:"_initMaterial",value:function(){var e=this;this.cacheMeshes.forEach((function(t){if(t.isMesh&&!t.isHotSpotEntity){t.renderOrder=(Array.isArray(t.material)?t.material[0]:t.material).renderOrder;var n=Array.isArray(t.material)?t.material:[t.material];t.geometry.attributes&&!t.geometry.attributes.uv&&n.forEach((function(e){e.vertexTangents=!1})),t.geometry.attributes&&t.geometry.attributes.uv2&&n.forEach((function(e){void 0===e.aoUV&&(e.aoUV=1)}));var i=function(n){var i=e.extraMaterial[n],r=e.cacheMats.find((function(e){return e.name==n}));if(!r)return"continue";i.map((function(n){n.a==t.ID&&(e.cacheExtraMat.push({a:t.ID,b:n.b,c:t.material[n.b].name}),r.skinning=t.material[n.b].skinning,t.material[n.b]=r,t.overMaterial=[n.b].concat(y(t.overMaterial||[])))}))};for(var r in e.extraMaterial)i(r)}}))}},{key:"replaceMaterials",value:function(e){var t=this,n=e.url,i=e.onload,r=e.fromOthers,a=e.onTextureLoad;this.cacheExtraMat.map((function(e){var n=t.cacheMeshes.find((function(t){return t.ID==e.a})),i=t.cacheMats[t.queryMats[e.c]];n.material[e.b]=i})),this.extraMaterial={},r&&(this.SnameTable={},this.cacheMats.map((function(e){e.sname&&(t.SnameTable[e.sname]=e.ID)}))),this.loadMaterials({url:n,onload:i,onTextureLoad:a})}}]),e}(),Pd=function(){function e(e){QA.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this._geometryList=[],this.loadedFileNum=0,this.taskId2Worker={},this.workerStateById={},this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}return e.prototype=Object.assign(Object.create(QA.prototype),{constructor:e,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,i,r,a){var o=this,s=new VA(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&s.setWithCredentials(!0),this.onLoad=t,this.onComplete=n;var A=this;s.load(e,(function(e){var t={attributeIDs:A.defaultAttributeIDs,attributeTypes:A.defaultAttributeTypes,useUniqueIDs:!1};o.decodeGeometry(e,t,a).catch(r)}),i,r)},decodeDracoFile:function(e,t,n,i,r){},decodeWholeFile:function(e,t){if("MBIN"===convertArrayBufferToString(e,0,4))return this.parseModelFile(e,t)},readPaddingBytes:function(e){var t=e.getUint8();e.getString(t)},decodeGeometry:function(e,t,n){var i,r=this;for(var a in t.attributeTypes){var o=t.attributeTypes[a];void 0!==o.BYTES_PER_ELEMENT&&(t.attributeTypes[a]=o.name)}if(0===e.byteLength)throw new Error("DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.");var s=this.workerNextTaskID++,A=e.byteLength;return this._getWorker(s,A).then((function(n){return i=n,r.workerStateById[s]=0,new Promise((function(n,a){i._callbacks[s]={resolve:n,reject:a},r.taskId2Worker[s]=i;try{i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}catch(e){console.log(i)}}))}))},onReceiveMessageFromWebworker:function(e,t){var n=this.taskId2Worker[e];this._createGeometry(n,e,t),n&&e&&1==this.workerStateById[e]&&(this._releaseTask(n,e),this.workerStateById[e]=2,this.taskId2Worker[e]=null,this.onComplete())},arrayMax:function(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t},_createGeometry:function(e,t,n){if("mbin"===n.fileType){if(n.bComplete&&(this.workerStateById[t]=1),null===(c=n.geometry)||null==c)return;if(c.chunkType,2===c.chunkType){var i=new ni;if(i.custom_data={},i.custom_data.id=c.id,i.custom_data.parentId=c.parentId,i.custom_data.matrix=c.matrix,i.custom_data.bIsNodel=c.bIsNodel,i.custom_data.nodeType=c.nodeType,i.custom_data.version=c.version,void 0!==c.materialIndex){i.clearGroups(),i.custom_data.materialIndex=[];for(var r=c.materialIndex.length/3,a=0;a<r;a++)i.custom_data.materialIndex.push(c.materialIndex[3*a+2]),i.addGroup(3*c.materialIndex[3*a],3*c.materialIndex[3*a+1],a)}i.name=Ul.decodeText(new Uint8Array(c.name)),c.index&&(i.index=new(this.arrayMax(c.index.array)>65535?zn:Qn)(c.index.array,1),delete c.index.array,c.index=null);for(a=0;a<c.attributes.length;a++){var o=c.attributes[a],s=o.name,A=o.itemSize,l=new Dn(c.attributes[a].array,A);i.setAttribute(s,l),delete c.attributes[a].array,c.attributes[a]=null}c=null,this.onLoad(i)}}else if("bbin"===n.fileType||"bmbin"===n.fileType){if(n.bComplete&&(this.workerStateById[t]=1),null===n.geometry)return;this.onLoad(n.geometry)}else if("kmbin"===n.fileType){if(n.bComplete&&(this.workerStateById[t]=1),null===n.geometry)return;n.geometry.insts.forEach((function(e){e.name=Ul.decodeText(new Uint8Array(e.name))})),this.onLoad(n.geometry)}else if("abin"===n.fileType){if(n.bComplete&&(this.workerStateById[t]=1),null===n.geometry)return void this.onLoad(!1);n.geometry.name=Ul.decodeText(new Uint8Array(n.geometry.name)),this.onLoad(n.geometry)}else if("addbin"===n.fileType){var c;if(n.bComplete&&(this.workerStateById[t]=1),null===(c=n.geometry))return;c.type="meshGroup",this.onLoad(c)}},_loadLibrary:function(e,t){var n=new VA(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),new Promise((function(t,i){n.load(e,t,void 0,i)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var t=this;if(this.decoderPending)return this.decoderPending;var n="object"!==("undefined"==typeof WebAssembly?"undefined":i(WebAssembly))||"js"===this.decoderConfig.type,r=[];return n?r.push(this._loadLibrary("amrt_decoder.js","text")):(r.push(this._loadLibrary("amrt_wasm_wrapper.js","text")),r.push(this._loadLibrary("amrt_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((function(i){var r=i[0];n||(t.decoderConfig.wasmBinary=i[1]);var a=e.DRACOWorker.toString(),o=["/* draco decoder */",r,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");t.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending},_getWorker:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var i;(i=new Worker(n.workerSourceURL))._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig});var r=n;i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r.onReceiveMessageFromWebworker(t.id,t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(i=n.workerPool[n.workerPool.length-1])._taskCosts[e]=t,i._taskLoad+=t,i})).catch((function(e){console.log(e)}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),e.DRACOWorker=function(){var e,t,n=0;function i(e,t,n,i,s){var A={},l=0;e.getUint32();var c=e.getUint8();A.name=e.getString(c),A.ticksPerSecond=e.getFloat32(),A.Duration=e.getFloat32();var h=32&e.getUint32();A.isBoneAnim=!1,A.animType2Anim={},A.animType2Anim.transAnim=[],A.animType2Anim.rotAnim=[],A.animType2Anim.scaleAnim=[];for(var d=0;d<4;d++){var f=e.getUint32();if(4==f){A.isBoneAnim=!0,A.boneId2Anim=[];var m=e.getUint32();if(e.getUint32(),h){var g=e.getUint32();if(g>0){var v;this.dracoLoadCount++;var y=e.getArrayBuffer(g);s.Init(new Int8Array(y),y.byteLength),t.decodeType=4;for(var w,x=p(n,i,s,t),b=x.attributes.length,C=0;C<b;C++)if("time"!==(v=x.attributes[C]).name){var M={};M.boneId=parseInt(v.name),M.frameNum=w.length,M.frameTimes=w,M.frameVals=[];for(var B=0;B<M.frameNum;B++){for(var I=[],E=0;E<16;E++)I[E]=v.array[16*B+E];M.frameVals[B]=I}A.boneId2Anim.push(M)}else w=v.array;w.length>l&&(l=w.length)}}else for(var S=0;S<m;S++){var T=r(e);T.frameNum>l&&(l=T.frameNum),null!==T&&A.boneId2Anim.push(T)}u(e)}else{var L=e.getUint32();e.getUint32();for(var F=0;F<L;F++){A.meshNum=e.getUint32();var _=e.getUint32Array(A.meshNum);if(5==f||7==f)(U=a(e,h,t,n,i,s)).frameNum>l&&(l=U.frameNum),U.meshId=_,null!==U&&(5==f?A.animType2Anim.transAnim.push(U):7==f&&A.animType2Anim.scaleAnim.push(U));else if(6==f){var U;(U=o(e,h,t,n,i,s)).frameNum>l&&(l=U.frameNum),U.meshId=_,null!==U&&A.animType2Anim.rotAnim.push(U)}else console.log("Error: chunkType errror!!!!")}u(e)}}return u(e),l<2?null:A}function r(e){var t={};t.boneId=e.getUint32(),t.frameNum=e.getUint32(),t.frameTimes=e.getFloat32Array(t.frameNum),t.frameVals=new Array(t.frameNum);for(var n=0;n<t.frameNum;n++)t.frameVals[n]=e.getMatrix4();return t}function a(e,t,n,i,r,a){var o={};if(o.frameNum=e.getUint32(),t&&o.frameNum>=5){var s=e.getUint32();if(s>0){var A=e.getArrayBuffer(s);a.Init(new Int8Array(A),A.byteLength),n.decodeType=5;var l=p(i,r,a,n);o.frameTimes=l.attributes[0].array,o.frameVals=l.attributes[1].array}}else o.frameTimes=e.getFloat32Array(o.frameNum),o.frameVals=e.getFloat32Array(3*o.frameNum);return o}function o(e,t,n,i,r,a){var o={};if(o.frameNum=e.getUint32(),t&&o.frameNum>=5){var s=e.getUint32(),A=e.getArrayBuffer(s);a.Init(new Int8Array(A),A.byteLength),n.decodeType=5;var l=p(i,r,a,n);o.frameTimes=l.attributes[0].array,o.frameVals=l.attributes[1].array}else o.frameTimes=e.getFloat32Array(o.frameNum),o.frameVals=e.getFloat32Array(4*o.frameNum);return o}function s(e,t,n,i,r,a){var o={meshId:0,boneIds:[],boneIndices:[],boneWeights:[]};e.getUint32(),o.meshId=e.getUint32();for(var s=e.getUint32(),A=[],l=0;l<s;l++){var c=e.getUint32();A.push(c)}o.boneIds=A;var h=e.getUint32(),d=e.getUint8Array(h),f=0,m=0,g=0,v=0,y=[],w=[],x=e.getUint8(),b=4*(Math.round(x%4)>0?parseInt(x/4)+1:parseInt(x/4));if(t){var C=e.getUint32();if(C>0){var M=e.getArrayBuffer(C);a.Init(new Int8Array(M),M.byteLength),n.decodeType=3;var B=p(i,r,a,n),I=B.attributes[0].array,E=B.attributes[1].array;I.length;for(var S=0;S<h;S++){f=d[S];for(var T=0,L=0;L<f;L++){var F=I[m+L],_=E[m+L];y[T=parseInt(L/4)]||(y[T]=[]),w[T]||(w[T]=[]),y[T].push(F),w[T].push(_)}for(var U=f;U<b;U++)y[T=parseInt(U/4)]||(y[T]=[]),w[T]||(w[T]=[]),y[T].push(0),w[T].push(0);m+=f}o.boneIndices=y,o.boneWeights=w}}else{e.getUint32();for(var P=0;P<h;P++){f=d[P];for(var k=0,D=0;D<f;D++)g=e.getUint16(),v=e.getFloat32(),y[k=parseInt(D/4)]||(y[k]=[]),w[k]||(w[k]=[]),y[k].push(g),w[k].push(v);for(var R=f;R<b;R++)y[k=parseInt(R/4)]||(y[k]=[]),w[k]||(w[k]=[]),y[k].push(0),w[k].push(0);m+=f}}return u(e),o}function A(e){var t={};return t.id=e.getUint32(),t.ref_id=e.getUint32(),t.parent_Id=e.getUint32(),t.offsetMatrix=e.getMatrix4(),t}function l(e){var t={};t.id=e.getUint32(),t.nodeId=e.getUint32(),t.offsetMatrix=e.getMatrix4();var n=e.getUint8();return t.name=e.getString(n),t}function c(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),d.decodeText(new Uint8Array(e,t,n))}function h(e,t,n,i,r){var a=this,o={index:null,attributes:[]};o.id=e.getUint32(),o.parentId=e.getInt32(),o.matrix=e.getMatrix4(),o.loadedState={};var s=e.getUint32();if(o.bIsNodel=1&s,o.bIsNodel){var A=64==(64&s);o.nodeType=A?4:3}else{o.bUseCompose=2&s,o.bHaveNormal=4&s,o.bHaveUVData=8&s,o.bHaveUV2Data=16&s,o.bUseDraco=32&s;var l,c,h=64==(64&s);if(o.nodeType=h?2:1,o.bUseDraco){if((g=e.getUint32())>0){o.loadedState[0]=0;var d=e.getArrayBuffer(g);r.Init(new Int8Array(d),d.byteLength),t.decodeType=1,(f=p(n,i,r,t)).attributes[0].name="position",o.attributes.push(f.attributes[0])}else o.vertexNum=0,o.loadedState[0]=1;if((g=e.getUint32())>0){o.loadedState[1]=0;d=e.getArrayBuffer(g);r.Init(new Int8Array(d),d.byteLength),t.decodeType=2;var f=p(n,i,r,t);o.index={array:f.attributes[0].array},o.faceNum=f.attributes[0].array.length/3}else o.faceNum=0,o.loadedState[1]=1}else o.vertexNum=e.getUint32(),o.vertexs=e.getFloat32Array(3*o.vertexNum),o.attributes.push({name:"position",array:o.vertexs,itemSize:3}),o.faceNum=e.getUint32(),o.faceVerIndexs=e.getUint32Array(3*o.faceNum),o.index={array:o.faceVerIndexs};if(o.bHaveUVData)if(o.bUseDraco){if((g=e.getUint32())>0){o.loadedState[2]=0;d=e.getArrayBuffer(g);r.Init(new Int8Array(d),d.byteLength),t.decodeType=1,(f=p(n,i,r,t)).attributes[0].name="uv",o.attributes.push(f.attributes[0])}else o.UVNum=0,o.loadedState[2]=1;if(o.bUseCompose)if((g=e.getUint32())>0){o.loadedState[3]=0;d=e.getArrayBuffer(g);this.dracoLoadCount++,dracoLoader.decodeDracoFile(d,(function(e){o.faceComposedUVIndexs=e.attributes[0].array,o.loadedState[3]=1,a.dracoOnLoad()}),null,null,2)}else o.loadedState[3]=1;else o.loadedState[3]=1}else o.UVNum=e.getUint32(),o.uvData=e.getFloat32Array(2*o.UVNum),o.attributes.push({name:"uv",array:o.uvData,itemSize:2}),o.bUseCompose&&(o.faceComposedUVIndexs=e.getUint32Array(3*o.faceNum)),o.loadedState[3]=1;else o.loadedState[2]=1,o.loadedState[3]=1;if(o.bHaveUV2Data)if(o.bUseDraco){if((g=e.getUint32())>0){o.loadedState[4]=0;d=e.getArrayBuffer(g);r.Init(new Int8Array(d),d.byteLength),t.decodeType=1,(f=p(n,i,r,t)).attributes[0].name="uv2",o.attributes.push(f.attributes[0])}else o.UV2Num=0,o.loadedState[4]=1;if(o.bUseCompose)if((g=e.getUint32())>0){o.loadedState[5]=0;d=e.getArrayBuffer(g);this.dracoLoadCount++,dracoLoader.decodeDracoFile(d,(function(e){o.faceComposedUV2Indexs=e.attributes[0].array,o.loadedState[5]=1,a.dracoOnLoad()}),null,null,2)}else o.loadedState[5]=1;else o.loadedState[5]=1}else o.UV2Num=e.getUint32(),o.uv2Data=e.getFloat32Array(2*o.UV2Num),o.loadedState[4]=1,o.attributes.push({name:"uv2",array:o.uv2Data,itemSize:2}),o.bUseCompose&&(o.faceComposedUV2Indexs=e.getUint32Array(3*o.faceNum)),o.loadedState[5]=1;else o.loadedState[4]=1,o.loadedState[5]=1;o.materialNum=e.getUint32(),o.materialIndex=new Array(o.materialNum);for(var m=0;m<o.materialNum;m++)l=e.getUint32(),o.materialIndex[3*m]=l,c=e.getUint32(),o.materialIndex[3*m+1]=c,o.materialIndex[3*m+2]=e.getUint32();if(1===o.materialNum&&(o.materialIndex[0]=0,o.materialIndex[1]=o.faceNum),o.bHaveNormal)if(o.bUseDraco){var g;if((g=e.getUint32())>0){o.loadedState[6]=0;d=e.getArrayBuffer(g);r.Init(new Int8Array(d),d.byteLength),t.decodeType=1,(f=p(n,i,r,t)).attributes[0].name="normal",o.attributes.push(f.attributes[0])}else o.normalNum=0,o.loadedState[6]=1;if(o.bUseCompose)if((g=e.getUint32())>0){o.loadedState[7]=0;d=e.getArrayBuffer(g);this.dracoLoadCount++,dracoLoader.decodeDracoFile(d,(function(e){o.faceComposedNormalIndexs=e.attributes[0].array,o.loadedState[7]=1,a.dracoOnLoad()}),null,null,2)}else o.loadedState[7]=1;else o.loadedState[7]=1}else o.normalNum=e.getUint32(),o.normals=e.getFloat32Array(3*o.normalNum),o.loadedState[6]=1,o.attributes.push({name:"normal",array:o.normals,itemSize:3}),o.bUseCompose&&(o.faceComposedNormalIndexs=e.getUint32Array(3*o.faceNum)),o.loadedState[7]=1;else o.loadedState[6]=1,o.loadedState[7]=1}var v=e.getUint8();return o.name=e.getString(v),u(e),o}function u(e){var t=e.getUint8();e.getString(t)}onmessage=function(r){var a=r.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"clear_data":console.log("clear_data");break;case"decode":var o=a.buffer,d=a.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,m=new t.DecoderBuffer;try{var g=c(o,0,4);if("MBIN"===g)(function(e,t,i,r,a,o){if(function(e){var t="MBIN",n=4,i=c(e,0,n);return e.byteLength>=n&&t===i}(t)){var d=new f(t);for(d.skip(4),n=d.getUint32();d.offset<d.size();){var m=d.getUint32();if(2===m){var g=d.getUint32(),v=d.getUint32();if(0==g)return void self.postMessage({type:"decode",id:e.id,fileType:"mbin",bComplete:!0,geometry:null});this.totalMeshNum=g,this.completedMeshNum=0;for(var y=0;y<g;y++){if(d.getUint32(),null!==(C=h(d,i,r,a,o))){C.chunkType=2;for(var w=[],x=0;x<C.attributes.length;x++)C.attributes[x].array.buffer&&w.push(C.attributes[x].array.buffer);C.index&&w.push(C.index.array.buffer)}var b=y==g-1;C.version=n,self.postMessage({type:"decode",id:e.id,fileType:"mbin",bComplete:b,geometry:C},w)}u(d)}else if(1===m){var C={},M=d.getUint32(),B=(v=d.getUint32(),[]);for(y=0;y<M;y++){var I=l(d);null!==I&&(I.chunkType=1,B.push(I))}C.bones=B,u(d);var E=[];for(g=d.getUint32(),y=0;y<g;y++){var S=d.getUint32(),T=d.getUint8(),L=(M=d.getUint32(),{});L.meshId=S,L.maxBoneCount=T,L.boneList=d.getUint32Array(M),E.push(L)}C.boneMeshList=E,C.version=n,self.postMessage({type:"decode",id:e.id,fileType:"bbin",bComplete:!0,geometry:C})}else if(9===m){C={};var F=d.getUint32(),_=d.getUint32(),U=(v=d.getUint32(),[]);if(_&&F>=5){var P=d.getUint32();if(P>0){var k=d.getArrayBuffer(P);o.Init(new Int8Array(k),k.byteLength),i.decodeType=6;var D=(C=p(r,a,o,i)).attributes[0].array;for(y=0;y<F;y++){(H={}).id=D[3*y],H.ref_id=D[3*y+1],H.parent_Id=D[3*y+2],H.offsetMatrix=[],H.chunkType=9,U.push(H)}var R=C.attributes[1].array,O=C.attributes[2].array,N=0,G=0;for(y=0;y<F;y++){for(var Q=0;Q<3;Q++)U[y].offsetMatrix.push(R[N++]),U[y].offsetMatrix.push(R[N++]),U[y].offsetMatrix.push(R[N++]),U[y].offsetMatrix.push(0);U[y].offsetMatrix.push(O[G++]),U[y].offsetMatrix.push(O[G++]),U[y].offsetMatrix.push(O[G++]),U[y].offsetMatrix.push(1)}}}else for(y=0;y<F;y++){var H;null!==(H=A(d))&&(H.chunkType=9,U.push(H))}for(y=0;y<F;y++){var z=d.getUint8();U[y].name=d.getString(z)}C.insts=U,u(d),self.postMessage({type:"decode",id:e.id,fileType:"kmbin",bComplete:!0,geometry:C})}else if(3===m){var V=d.getUint32();if(0==V)return void self.postMessage({type:"decode",id:e.id,fileType:"bmbin",bComplete:!0,geometry:null});for(_=d.getUint32(),v=d.getUint32(),y=0;y<V;y++){console.log("bone data:_bonedMeshNum:"+V),null!==(C=s(d,_,i,r,a,o))&&(C.chunkType=3),C.version=n;b=y==V-1;self.postMessage({type:"decode",id:e.id,fileType:"bmbin",bComplete:b,geometry:C})}u(d)}else{v=d.getUint32();if(10===m){var j=d.getUint32();(C={}).meshIds=d.getInt32Array(j),C.groupIds=d.getUint32Array(j),self.postMessage({type:"decode",id:e.id,fileType:"addbin",bComplete:!0,geometry:C})}else d.skip(v)}}d=null}else console.log("mbin file format error!!!!!!!!")})(a,o,d,t,r,m);else if("ABIN"===g)(function(e,t,n,r,a,o){if(function(e){var t="ABIN",n=4,i=c(e,0,n);return e.byteLength>=n&&t===i}(t)){var s=new f(t);if(s.skip(4),s.getUint32(),8===s.getUint32()){var A=s.getUint32();if(s.getUint32(),0==A)return void self.postMessage({type:"decode",id:e.id,fileType:"abin",bComplete:!0,geometry:null});for(var l=0;l<A;l++){var h=i(s,n,r,a,o);if(null!==h)var d=[];var p=l==A-1;self.postMessage({type:"decode",id:e.id,bComplete:p,fileType:"abin",geometry:h},d)}u(s)}}else console.log("abin file format error!!!!!!!!")})(a,o,d,t,r,m)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}finally{t.destroy(m),t.destroy(r)}a.buffer=null}))}};var d={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function f(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function p(e,t,n,i){i.attributeIDs;i.attributeTypes;var r,a,o=i.decodeType,s=t.GetEncodedGeometryType(n);if(s===e.TRIANGULAR_MESH)r=new e.Mesh,a=t.DecodeBufferToMesh(n,r);else{if(s!==e.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");r=new e.PointCloud,a=t.DecodeBufferToPointCloud(n,r)}if(!a.ok()||0===r.ptr)throw new Error("DRACOLoader: Decoding failed: "+a.error_msg());var A,l={index:null,attributes:[]};if(1===o)A=t.GetAttribute(r,0),l.attributes.push(m(e,t,r,"position",Float32Array,A));else if(2===o)A=t.GetAttribute(r,0),l.attributes.push(m(e,t,r,"index",Uint32Array,A));else if(3===o)A=t.GetAttribute(r,0),l.attributes.push(m(e,t,r,"boneIndex",Uint16Array,A)),A=t.GetAttribute(r,1),l.attributes.push(m(e,t,r,"boneWeight",Float32Array,A));else if(6===o)A=t.GetAttribute(r,0),l.attributes.push(m(e,t,r,"ididids",Int32Array,A)),A=t.GetAttribute(r,1),l.attributes.push(m(e,t,r,"offsetMat",Float32Array,A)),A=t.GetAttribute(r,2),l.attributes.push(m(e,t,r,"trans",Float32Array,A));else if(5===o)A=t.GetAttribute(r,0),l.attributes.push(m(e,t,r,"time",Float32Array,A)),A=t.GetAttribute(r,1),l.attributes.push(m(e,t,r,"frameVal",Float32Array,A));else{if(4!==o)throw new Error("DRACOLoader: Unexpected Draco_Data_Type.");A=t.GetAttribute(r,0),l.attributes.push(m(e,t,r,"time",Float32Array,A));for(var c,h,u,d=t.GetAttributeMetadata(r,0),f=new e.MetadataQuerier,p=f.NumEntries(d),g=0;g<p;g++)"name"===(c=f.GetEntryName(d,g))?console.log(f.GetStringEntry(d,c)):(h=f.GetIntEntry(d,c),u=parseInt(c),A=t.GetAttribute(r,u),l.attributes.push(m(e,t,r,h+"",Float32Array,A)))}return e.destroy(r),l}function m(e,t,n,i,r,a){var o,s,A=a.num_components(),l=n.num_points()*A;switch(r){case Float32Array:var c=4*l;o=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_FLOAT32,c,o),s=new Float32Array(e.HEAPF32.buffer,o,l).slice(),e._free(o);break;case Int8Array:o=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_INT8,l,o),s=new Int8Array(e.HEAP8.buffer,o,l).slice(),e._free(o);break;case Int16Array:c=2*l;o=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_INT16,c,o),s=new Int16Array(e.HEAP16.buffer,o,l).slice(),e._free(o);break;case Int32Array:c=4*l;o=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_INT32,c,o),s=new Int32Array(e.HEAP32.buffer,o,l).slice(),e._free(o);break;case Uint8Array:o=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_UINT8,l,o),s=new Uint8Array(e.HEAPU8.buffer,o,l).slice(),e._free(o);break;case Uint16Array:c=2*l;o=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_UINT16,c,o),s=new Uint16Array(e.HEAPU16.buffer,o,l).slice(),e._free(o);break;case Uint32Array:c=4*l;o=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,a,e.DT_UINT32,c,o),s=new Uint32Array(e.HEAPU32.buffer,o,l).slice(),e._free(o);break;default:throw new Error("DRACOLoader: Unexpected attribute type.")}return{name:i,array:s,itemSize:A}}f.prototype={constructor:f,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint8Array:function(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.getUint8();return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getUint16:function(e){if(null!=e)return t=this.dv.getUint16(e,this.littleEndian);var t=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=new Int32Array(e),n=0;n<e;n++)t[n]=this.getInt32();return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getUint32Array:function(e){for(var t=new Uint32Array(e),n=0;n<e;n++)t[n]=this.getUint32();return t},getMatrix4:function(){for(var e=[],t=0;t<16;t++)e.push(this.getFloat32());return e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=new Int64Array(e),n=0;n<e;n++)t[n]=this.getUint8();return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(e){if(null!=e)return t=this.dv.getFloat32(e,this.littleEndian);var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=this.getFloat32();return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=new Float64Array(e),n=0;n<e;n++)t[n]=this.getFloat64();return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),t}}},e.taskCache=new WeakMap,e.setDecoderPath=function(){console.warn("DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},e.setDecoderConfig=function(){console.warn("DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},e.releaseDecoderModule=function(){console.warn("DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},e.getDecoderModule=function(){console.warn("DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")},e}();function kd(e,t,n){this.objects=[],this.tmpGeometry=e.clone(),Lo.call(this,e,t,n),this.frustumCulled=!1}function Dd(e){Pn.call(this),this.defines={STANDARD:""},this.type="AMRTBasicMaterial",this.color=new Sn(16777215),this.albedo=null,this.albedoUV=0,this.normalMap=null,this.normalScale=1,this.normalMap2=null,this.normalScale2=1,this.metallicMap=null,this.metallic=0,this.roughnessMap=null,this.smoothness=0,this.aoMap=null,this.aoScale=1,this.aoUV=0,this.emissive=new Sn(0),this.emissiveMap=null,this.emissiveUV=0,this.reflectMap=null,this.reflectIntensity=0,this.cutout=.5,this.reflectivity=1,this.transparency=0,this.opacity=1,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.vertexTangents=!0,this.normalMapType=0,this.envRotateY=0,this.envYMatrix=new rt,this.reflectRotateY=0,this.reflecYMatrix=new rt,this.dissolveMap=null,this.dissolveRatio=0,this.dissolveColor=new Sn(16774921),this.setValues(e),this.__defineSetter__("envRotateY",(function(e){this.envYMatrix=(new rt).rotateY(e)})),this.__defineSetter__("reflectRotateY",(function(e){this.reflecYMatrix=(new rt).rotateY(e)}))}kd.prototype=Object.assign(Object.create(Lo.prototype),{constructor:kd,isInstancedMesh:!0,deleteItem:function(e){if(e&&0!=e.length){var t=new Float32Array(16*(this.count-e.length));e.push(this.count);for(var n=0,i=0,r=0;r<e.length;r++){this.objects.splice(e[r]-r,1);var a=16*e[r];if(n<a){var o=this.bufferArray.slice(n,a);t.set(o,i),i+=o.length}n=a+16}for(var s=0;s<this.objects.length;s++)this.objects[s].instanceIndex=s;this.bufferArray=t,this.instanceMatrix=new Dn(this.bufferArray,16),this.count=this.count-e.length+1}},addItem:function(e){this.count+=e.length;var t=new Float32Array(16*this.count);t.set(this.bufferArray,0),this.bufferArray=t;for(var n=0;n<e.length;n++)e[n].refreshInstanceMesh(),this.objects.push(e[n])}}),Dd.prototype=Object.create(Pn.prototype),Dd.prototype.constructor=Dd,Dd.prototype.isAMRTBasicMaterial=!0,Dd.prototype.copy=function(e){return Pn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.albedo=e.albedo,this.albedoUV=e.albedoUV,this.normalMap=e.normalMap,this.normalScale=e.normalScale,this.normalMap2=e.normalMap2,this.normalScale2=e.normalScale2,this.metallicMap=e.metallicMap,this.metallic=e.metallic,this.roughnessMap=e.roughnessMap,this.smoothness=e.smoothness,this.aoMap=e.aoMap,this.aoScale=e.aoScale,this.aoUV=e.aoUV,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveUV=e.emissiveUV,this.reflectMap=e.reflectMap,this.reflectIntensity=e.reflectIntensity,this.cutout=e.cutout,this.reflectivity=e.reflectivity,this.transparency=e.transparency,this.opacity=e.opacity,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.vertexTangents=e.vertexTangents,this.normalMapType=e.normalMapType,this.envRotateY=e.envRotateY,this.envYMatrix=e.envYMatrix,this.reflectRotateY=e.reflectRotateY,this.reflecYMatrix=e.reflecYMatrix,this},Dd.prototype.dispose=function(){Pn.prototype.dispose.call(this),this.albedo&&this.albedo.dispose(),this.metallicMap&&this.metallicMap.dispose(),this.roughnessMap&&this.roughnessMap.dispose(),this.aoMap&&this.aoMap.dispose(),this.emissiveMap&&this.emissiveMap.dispose(),this.reflectMap&&this.reflectMap.dispose(),this.envMap&&this.envMap.dispose()},Object.defineProperty(Dd.prototype,"alphaMap",{get:function(){return this._alphaMap||null},set:function(e){this._alphaMap=e,e&&(this.transparent=!0)}});var Rd,Od=[];function Nd(){this.geometry=null,this._material=null,this.instanceIndex=0,this._instanceMesh=null,this.rootInverse=new vt,this.material0=null,this._mesh=null,Dt.call(this),Object.defineProperty(this,"instanceMesh",{get:function(){return this._instanceMesh},set:function(e){this._instanceMesh!=e&&(this._instanceMesh=e,this.geometry=this._instanceMesh.tmpGeometry,this._material=this._instanceMesh.material[0],this.material0=this._material,this._mesh=new xi(this.geometry,this._material),this._mesh.name=this.name)}}),Object.defineProperty(this,"material",{get:function(){return null==this._instanceMesh?null:(this._material===this._instanceMesh.material[0]&&this.createMesh(),this._material)},set:function(e){console.log("set"),this._material=e,this._mesh.material=this._material,this._mesh.material0=this._material,null==this._mesh.parent&&this.add(this._mesh)}})}Nd.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Nd,intanceObject:!0,setDirty:function(){this.refreshInstanceMesh()},refreshInstanceMesh:function(){null!=this._instanceMesh&&(this._instanceMesh.updateMatrixWorld(!0),this.rootInverse.getInverse(this._instanceMesh.matrixWorld),this._instanceMesh.setMatrixAt(this.instanceIndex,this.rootInverse.multiply(this.matrixWorld)),this._instanceMesh.instanceMatrix.needsUpdate=!0)},createMesh:function(){if(null==this._mesh.parent){var e=new Dd;e.copy(this._material),this._material=e,this.material0=this._material,this._mesh.material=this._material,this._mesh.material0=this._material,this._instanceMesh.deleteItem([this.instanceIndex]),this.add(this._mesh)}},raycast:function(e,t){null!=this._mesh&&(this._mesh.matrixWorld=this.matrixWorld,this._mesh.raycast(e,Od),Od.length>0&&(this.createMesh(),Od[0].object=this,t.push(Od[0])),Od.length=0)}});var Gd,Qd,Hd,zd,Vd=Math.pow(2,8),jd=[.125,.215,.35,.446,.526,.582],Wd=5+jd.length,Xd=(s(Rd={},Pe,0),s(Rd,ke,1),s(Rd,Re,2),s(Rd,Oe,3),s(Rd,Ne,4),s(Rd,Ge,5),s(Rd,De,6),Rd),Zd=new El,Yd=(Gd=8,Qd=new Float32Array(Gd),Hd=new tt(0,1,0),(zd=new uA({defines:{n:Gd},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:Qd},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:Hd},inputEncoding:{value:Xd[3e3]},outputEncoding:{value:Xd[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n".concat("\nuniform int inputEncoding;\nuniform int outputEncoding;\n#include <encodings_pars_fragment>\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t","\n#define ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\n\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n// These defines must match with PMREMGenerator\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",zd),Kd=null,Jd=null,qd=function(){for(var e=[],t=[],n=[],i=8,r=0;r<Wd;r++){var a=Math.pow(2,i);t.push(a);var o=1/a;r>4?o=jd[r-8+4-1]:0==r&&(o=0),n.push(o);for(var s=1/(a-1),A=-s/2,l=1+s/2,c=[A,A,l,A,l,l,A,A,l,l,A,l],h=new Float32Array(108),u=new Float32Array(72),d=new Float32Array(36),f=0;f<6;f++){var p=f%3*2/3-1,m=f>2?0:-1,g=[p,m,0,p+2/3,m,0,p+2/3,m+1,0,p,m,0,p+2/3,m+1,0,p,m+1,0];h.set(g,18*f),u.set(c,12*f);var v=[f,f,f,f,f,f];d.set(v,6*f)}var y=new ni;y.setAttribute("position",new Dn(h,3)),y.setAttribute("uv",new Dn(u,2)),y.setAttribute("faceIndex",new Dn(d,1)),e.push(y),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),$d=qd._lodPlanes,ef=qd._sizeLods,tf=qd._sigmas,nf=null,rf=null,af=null,of=(1+Math.sqrt(5))/2,sf=1/of,Af=[new tt(1,1,1),new tt(-1,1,1),new tt(1,1,-1),new tt(-1,1,-1),new tt(0,of,sf),new tt(0,of,-sf),new tt(sf,0,of),new tt(-sf,0,of),new tt(of,sf,0),new tt(-of,sf,0)];function lf(e){rf=e,df(Yd)}function cf(e){var t={magFilter:z,minFilter:z,generateMipmaps:!1,type:e?e.type:Y,format:e?e.format:le,encoding:e?e.encoding:Re,depthBuffer:!1,stencilBuffer:!1},n=ff(t);return n.depthBuffer=!e,nf=ff(t),n}function hf(e){nf.dispose(),rf.setRenderTarget(af),e.scissorTest=!1,e.setSize(e.width,e.height)}function uf(e,t,n,i){var r=new Di(90,1,t,n),a=[1,1,1,1,-1,1],o=[1,1,-1,-1,-1,1],s=rf.outputEncoding,A=rf.toneMapping,l=rf.toneMappingExposure,c=rf.getClearColor(),h=rf.getClearAlpha();rf.toneMapping=1,rf.toneMappingExposure=1,rf.outputEncoding=Pe,e.scale.z*=-1;var u=e.background;if(u&&u.isColor){u.convertSRGBToLinear();var d=Math.max(u.r,u.g,u.b),f=Math.min(Math.max(Math.ceil(Math.log2(d)),-128),127);u=u.multiplyScalar(Math.pow(2,-f));var p=(f+128)/255;rf.setClearColor(u,p),e.background=null}for(var m=0;m<6;m++){var g=m%3;0==g?(r.up.set(0,a[m],0),r.lookAt(o[m],0,0)):1==g?(r.up.set(0,0,a[m]),r.lookAt(0,o[m],0)):(r.up.set(0,a[m],0),r.lookAt(0,0,o[m])),pf(i,g*Vd,m>2?Vd:0,Vd,Vd),rf.setRenderTarget(i),rf.render(e,r)}rf.toneMapping=A,rf.toneMappingExposure=l,rf.outputEncoding=s,rf.setClearColor(c,h),e.scale.z*=-1}function df(e){var t=new Rt;t.add(new xi($d[0],e)),rf.compile(t,Zd)}function ff(e){var t=new lt(3*Vd,3*Vd,e);return t.texture.mapping=O,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function pf(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function mf(e){var t=rf.autoClear;rf.autoClear=!1;for(var n=1;n<Wd;n++){gf(e,n-1,n,Math.sqrt(tf[n]*tf[n]-tf[n-1]*tf[n-1]),Af[(n-1)%Af.length])}rf.autoClear=t}function gf(e,t,n,i,r){vf(e,nf,t,n,i,"latitudinal",r),vf(nf,e,n,n,i,"longitudinal",r)}function vf(e,t,n,i,r,a,o){"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new Rt;s.add(new xi($d[i],Yd));var A=Yd.uniforms,l=ef[n]-1,c=isFinite(r)?Math.PI/(2*l):2*Math.PI/15,h=r/c,u=isFinite(r)?1+Math.floor(3*h):8;u>8&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(u," samples when the maximum is set to ").concat(8));for(var d=[],f=0,p=0;p<8;++p){var m=p/h,g=Math.exp(-m*m/2);d.push(g),0==p?f+=g:p<u&&(f+=2*g)}for(p=0;p<d.length;p++)d[p]=d[p]/f;A.envMap.value=e.texture,A.samples.value=u,A.weights.value=d,A.latitudinal.value="latitudinal"===a,o&&(A.poleAxis.value=o),A.dTheta.value=c,A.mipInt.value=8-n,A.inputEncoding.value=Xd[e.texture.encoding],A.outputEncoding.value=Xd[e.texture.encoding];var v=ef[i];pf(t,m=3*Math.max(0,Vd-2*v),(0===i?0:2*Vd)+2*v*(i>4?i-8+4:0),3*v,2*v),rf.setRenderTarget(t),rf.render(s,Zd)}function yf(){var e=new uA({uniforms:{envMap:{value:null},texelSize:{value:new Je(1,1)},inputEncoding:{value:Xd[3e3]},outputEncoding:{value:Xd[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n".concat("\nuniform int inputEncoding;\nuniform int outputEncoding;\n#include <encodings_pars_fragment>\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t","\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function wf(){var e=new uA({uniforms:{envMap:{value:null},inputEncoding:{value:Xd[3e3]},outputEncoding:{value:Xd[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n".concat("\nuniform int inputEncoding;\nuniform int outputEncoding;\n#include <encodings_pars_fragment>\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t","\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}lf.prototype={constructor:lf,fromScene:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;af=rf.getRenderTarget();var r=cf();return uf(e,n,i,r),t>0&&gf(r,0,0,t),mf(r),hf(r),r},fromEquirectangular:function(e){return e.magFilter=z,e.minFilter=z,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){af=rf.getRenderTarget();var t=cf(e);return function(e,t){var n=new Rt;e.isCubeTexture?null==Jd&&(Jd=wf()):null==Kd&&(Kd=yf());var i=e.isCubeTexture?Jd:Kd;n.add(new xi($d[0],i));var r=i.uniforms;r.envMap.value=e,e.isCubeTexture||r.texelSize.value.set(1/e.image.width,1/e.image.height);r.inputEncoding.value=Xd[e.encoding],r.outputEncoding.value=Xd[e.encoding],pf(t,0,0,3*Vd,2*Vd),rf.setRenderTarget(t),rf.render(n,Zd)}(e,t),mf(t),hf(t),t},compileCubemapShader:function(){null==Jd&&df(Jd=wf())},compileEquirectangularShader:function(){null==Kd&&df(Kd=yf())},dispose:function(){Yd.dispose(),null!=Jd&&Jd.dispose(),null!=Kd&&Kd.dispose();for(var e=0;e<$d.length;e++)$d[e].dispose()}};var xf=function(){function e(){r(this,e)}return o(e,null,[{key:"getTouchByEvent",value:function(e){return e.touches&&e.touches.length>0?e.touches[0]:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0]:e}},{key:"isIOS",get:function(){return navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Adr")>-1}},{key:"isAndroid",get:function(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}},{key:"isMobile",get:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)}},{key:"stringToArrayBuffer",value:function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0,r=e.length;i<r;i++)n[i]=e.charCodeAt(i);return t}},{key:"arrayBufferToString",value:function(e){return String.fromCharCode.apply(null,new Uint16Array(e))}},{key:"setRaycasterByCamera",value:function(e,t,n){var i=(new vt).getInverse(n.projectionMatrix),r=(new tt).applyMatrix4(i),a=new tt(e.x,e.y,1).applyMatrix4(i).clone().sub(r).normalize();return t.set(r,a),a}},{key:"getDomMouse",value:function(t,n){var i={};return n instanceof HTMLElement&&(n=n.getBoundingClientRect()),t=e.getTouchByEvent(t),i.x=void 0===t.offsetX?(t.pageX-n.left)/n.width*2-1:t.offsetX/n.width*2-1,i.y=void 0===t.offsetY?-(t.pageY-n.top)/n.height*2+1:-t.offsetY/n.height*2+1,i}},{key:"getDomMouseForThreeBox",value:function(t,n){t=e.getTouchByEvent(t);var i={},r=n.getBoundingClientRect();return i.x=t.offsetX/r.width*2-1,i.y=1-t.offsetY/r.height*2,i}},{key:"bindAll",value:function(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}},{key:"getSize",value:function(e){var t=new Jt;return t.setFromObject(e),t.getSize(new tt)}},{key:"getModelRootNode",value:function(t){return"modelGroup"==t.parent.name?t:e.getModelRootNode(t.parent)}},{key:"assemblyPath",value:function(e,t){if(e.startsWith("#"))return e;var n=e.split(",");return n.map((function(e){e=e.split("?")[0],e=t+e.slice(e.lastIndexOf("/")+1)})),n.join(",")}},{key:"createCircleMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,n="rgba("+255*(e=new Sn(e)).r+","+255*e.g+","+255*e.b+",",i=document.createElement("canvas");i.width=i.height=t;var r=i.getContext("2d"),a=t/2;r.beginPath(),r.arc(a,a,a,0,2*Math.PI,!0),r.closePath();var o=r.createRadialGradient(a,a,1,a,a,a);o.addColorStop(0,n+"1)"),o.addColorStop(.2,n+"0)"),o.addColorStop(.4,n+"1)"),o.addColorStop(.6,n+"0)"),o.addColorStop(.8,n+"1)"),o.addColorStop(1,n+"0)"),r.fillStyle=o,r.fill();var s=new Ko(i);return s.minFilter=W,s.needsUpdate=!0,s}},{key:"segmentIntersection",value:function(e,t,n,i){e=new Je(e.x,e.z),t=new Je(t.x,t.z),n=new Je(n.x,n.z),i=new Je(i.x,i.z);var r=(t.y-e.y)/(t.x-e.x),a=t.y-r*t.x,o=(i.y-n.y)/(i.x-n.x),s=i.y-o*i.x;return{x:(s-a)/(r-o),y:r*((s-a)/(r-o))+a}}},{key:"convertTexture",value:function(e,t){if(!t)return e;var n=new lf(t),i=e.image.src;return e.constructor===Ar?(n.compileCubemapShader(),e=n.fromCubemap(e).texture):(n.compileEquirectangularShader(),e=n.fromEquirectangular(e).texture),n.dispose(),e.image.src=i,e}},{key:"getDecoderPath",value:function(){var e="js/";if(document.getElementById("AMRT")){var t=document.getElementById("AMRT").src;e=t.slice(0,t.lastIndexOf("/"))+"/"}else for(var n=0;n<document.scripts.length;n++){var i=document.scripts[n];i.src&&"app.js"===i.src.slice(i.src.lastIndexOf("/")+1)&&(e=i.src.slice(0,i.src.lastIndexOf("/"))+"/")}return e}},{key:"computeDistance",value:function(e,t){var n=v(e,2),i=n[0],r=n[1],a=v(t,2),o=a[0],s=a[1],A=Ke.degToRad(r),l=Ke.degToRad(s),c=A-l,h=Ke.degToRad(i)-Ke.degToRad(o),u=2*Math.asin(Math.sqrt(Math.pow(Math.sin(c/2),2)+Math.cos(A)*Math.cos(l)*Math.pow(Math.sin(h/2),2)));return u*=6378137,u=Math.round(1e4*u)/1e4}}]),e}(),bf=function(e){QA.call(this,e)};bf.prototype=Object.assign(Object.create(QA.prototype),{constructor:bf,load:function(e,t,n,i){var r=this,a=new st,o=new VA(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,(function(e){a.image=r.parse(e),a.needsUpdate=!0,void 0!==t&&t(a)}),n,i),a},parse:function(e){var t=0,n=1,i=2,r=3,a=9,o=10,s=11,A=48,l=4,c=0,h=1,u=2,d=3;e.length<19&&console.error("TGALoader: Not enough data to contain header.");var f=new Uint8Array(e),p=0,m={id_length:f[p++],colormap_type:f[p++],image_type:f[p++],colormap_index:f[p++]|f[p++]<<8,colormap_length:f[p++]|f[p++]<<8,colormap_size:f[p++],origin:[f[p++]|f[p++]<<8,f[p++]|f[p++]<<8],width:f[p++]|f[p++]<<8,height:f[p++]|f[p++]<<8,pixel_size:f[p++],flags:f[p++]};!function(e){switch(e.image_type){case n:case a:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case i:case r:case o:case s:e.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',e.pixel_size)}(m),m.id_length+p>e.length&&console.error("TGALoader: No data."),p+=m.id_length;var g=!1,v=!1,y=!1;switch(m.image_type){case a:g=!0,v=!0;break;case n:v=!0;break;case o:g=!0;break;case i:break;case s:g=!0,y=!0;break;case r:y=!0}var w=document.createElement("canvas");w.width=m.width,w.height=m.height;var x=w.getContext("2d"),b=x.createImageData(m.width,m.height),C=function(e,t,n,i,r){var a,o,s,A;if(o=n.pixel_size>>3,s=n.width*n.height*o,t&&(A=r.subarray(i,i+=n.colormap_length*(n.colormap_size>>3))),e){var l,c,h;a=new Uint8Array(s);for(var u=0,d=new Uint8Array(o);u<s;)if(c=1+(127&(l=r[i++])),128&l){for(h=0;h<o;++h)d[h]=r[i++];for(h=0;h<c;++h)a.set(d,u+h*o);u+=o*c}else{for(c*=o,h=0;h<c;++h)a[u+h]=r[i++];u+=c}}else a=r.subarray(i,i+=t?n.width*n.height:s);return{pixel_data:a,palettes:A}}(g,v,m,p,f);return function(e,t,n,i,r){var a,o,s,f,p,g;switch((m.flags&A)>>l){default:case u:a=0,s=1,p=t,o=0,f=1,g=n;break;case c:a=0,s=1,p=t,o=n-1,f=-1,g=-1;break;case d:a=t-1,s=-1,p=-1,o=0,f=1,g=n;break;case h:a=t-1,s=-1,p=-1,o=n-1,f=-1,g=-1}if(y)switch(m.pixel_size){case 8:!function(e,t,n,i,r,a,o,s){var A,l,c,h=0,u=m.width;for(c=t;c!==i;c+=n)for(l=r;l!==o;l+=a,h++)A=s[h],e[4*(l+u*c)+0]=A,e[4*(l+u*c)+1]=A,e[4*(l+u*c)+2]=A,e[4*(l+u*c)+3]=255}(e,o,f,g,a,s,p,i);break;case 16:!function(e,t,n,i,r,a,o,s){var A,l,c=0,h=m.width;for(l=t;l!==i;l+=n)for(A=r;A!==o;A+=a,c+=2)e[4*(A+h*l)+0]=s[c+0],e[4*(A+h*l)+1]=s[c+0],e[4*(A+h*l)+2]=s[c+0],e[4*(A+h*l)+3]=s[c+1]}(e,o,f,g,a,s,p,i);break;default:console.error("TGALoader: Format not supported.")}else switch(m.pixel_size){case 8:!function(e,t,n,i,r,a,o,s,A){var l,c,h,u=A,d=0,f=m.width;for(h=t;h!==i;h+=n)for(c=r;c!==o;c+=a,d++)l=s[d],e[4*(c+f*h)+3]=255,e[4*(c+f*h)+2]=u[3*l+0],e[4*(c+f*h)+1]=u[3*l+1],e[4*(c+f*h)+0]=u[3*l+2]}(e,o,f,g,a,s,p,i,r);break;case 16:!function(e,t,n,i,r,a,o,s){var A,l,c,h=0,u=m.width;for(c=t;c!==i;c+=n)for(l=r;l!==o;l+=a,h+=2)A=s[h+0]+(s[h+1]<<8),e[4*(l+u*c)+0]=(31744&A)>>7,e[4*(l+u*c)+1]=(992&A)>>2,e[4*(l+u*c)+2]=(31&A)>>3,e[4*(l+u*c)+3]=32768&A?0:255}(e,o,f,g,a,s,p,i);break;case 24:!function(e,t,n,i,r,a,o,s){var A,l,c=0,h=m.width;for(l=t;l!==i;l+=n)for(A=r;A!==o;A+=a,c+=3)e[4*(A+h*l)+3]=255,e[4*(A+h*l)+2]=s[c+0],e[4*(A+h*l)+1]=s[c+1],e[4*(A+h*l)+0]=s[c+2]}(e,o,f,g,a,s,p,i);break;case 32:!function(e,t,n,i,r,a,o,s){var A,l,c=0,h=m.width;for(l=t;l!==i;l+=n)for(A=r;A!==o;A+=a,c+=4)e[4*(A+h*l)+2]=s[c+0],e[4*(A+h*l)+1]=s[c+1],e[4*(A+h*l)+0]=s[c+2],e[4*(A+h*l)+3]=s[c+3]}(e,o,f,g,a,s,p,i);break;default:console.error("TGALoader: Format not supported.")}}(b.data,m.width,m.height,C.pixel_data,C.palettes),x.putImageData(b,0,0),w}});var Cf=new WeakMap,Mf=function(e){A(i,e);var t=p(i);function i(e){var n;return r(this,i),(n=t.call(this,e)).transcoderPath="",n.transcoderBinary=null,n.transcoderPending=null,n.workerLimit=4,n.workerPool=[],n.workerNextTaskID=1,n.workerSourceURL="",n.workerConfig=null,n}return o(i,[{key:"setTranscoderPath",value:function(e){return this.transcoderPath=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"detectSupport",value:function(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}},{key:"load",value:function(e,t,n,i){var r=this,a=new VA(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);var o=new Yo;return a.load(e,(function(e){r.loadFromBuffer(e,t,i,o)}),n,i),o}},{key:"loadFromBuffer",value:function(e,t,n,i){return void 0===i&&(i=new Yo),Cf.has(e)?Cf.get(e).promise.then(t).catch(n):(this._createTexture([e]).then((function(e){i.copy(e),i.needsUpdate=!0,t&&t(i)})).catch(n),i)}},{key:"parseInternalAsync",value:function(e){for(var t=e.levels,i=new Set,r=0;r<t.length;r++)i.add(t[r].data.buffer);return this._createTexture(Array.from(i),n(n({},e),{},{lowLevel:!0}))}},{key:"_createTexture",value:function(e){for(var t,n,i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r,o=0,s=0;s<e.length;s++)o+=e[s].byteLength;var A=this._allocateWorker(o).then((function(r){return t=r,n=i.workerNextTaskID++,new Promise((function(i,r){t._callbacks[n]={resolve:i,reject:r},t.postMessage({type:"transcode",id:n,buffers:e,taskConfig:a},e)}))})).then((function(e){var t=e.mipmaps,n=new Yo(t,e.width,e.height,e.format,Y);return n.minFilter=1===t.length?W:Z,n.magFilter=W,n.generateMipmaps=!0,n.needsUpdate=!0,n}));return A.catch((function(){return!0})).then((function(){t&&n&&(t._taskLoad-=o,delete t._callbacks[n])})),Cf.set(e[0],{promise:A}),A}},{key:"_initTranscoder",value:function(){var e=this;if(!this.transcoderPending){var t=new VA(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);var n=new Promise((function(e,n){t.load("amrt_transcoder.js",e,void 0,n)})),r=new VA(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);var a=new Promise((function(e,t){r.load("amrt_transcoder.wasm",e,void 0,t)})),o=[];o.push(n),o.push(a),this.transcoderPending=Promise.all(o).then((function(t){var n=v(t,2),r=n[0],a=n[1],o=i.BasisWorker.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(i.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(i.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(i.BasisFormat),"/* amrt_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([s])),e.transcoderBinary=a}))}return this.transcoderPending}},{key:"_allocateWorker",value:function(e){var t=this;return this._initTranscoder().then((function(){var n;t.workerPool.length<t.workerLimit?((n=new Worker(t.workerSourceURL))._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:t.workerConfig,transcoderBinary:t.transcoderBinary}),n.onmessage=function(e){var t=e.data;switch(t.type){case"transcode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('BasisTextureLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(n)):t.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=t.workerPool[t.workerPool.length-1])._taskLoad+=e,n}))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),i}(QA);Mf.BasisFormat={ETC1S:0,UASTC_4x4:1},Mf.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Mf.EngineFormat={RGBAFormat:oe,RGBA_ASTC_4x4_Format:be,RGBA_BPTC_Format:Ce,RGBA_ETC2_EAC_Format:Be,RGBA_PVRTC_4BPPV1_Format:ye,RGBA_S3TC_DXT5_Format:me,RGB_ETC1_Format:xe,RGB_ETC2_Format:Me,RGB_PVRTC_4BPPV1_Format:ge,RGB_S3TC_DXT1_Format:de},Mf.BasisWorker=function(){var e,t,n,i=_EngineFormat,r=_TranscoderFormat,a=_BasisFormat;onmessage=function(i){var r,o=i.data;switch(o.type){case"init":e=o.config,r=o.transcoderBinary,t=new Promise((function(e){n={wasmBinary:r,onRuntimeInitialized:e},BASIS(n)})).then((function(){n.initializeBasis()}));break;case"transcode":t.then((function(){try{for(var e=o.taskConfig.lowLevel?function(e){var t=e.basisFormat,i=e.width,r=e.height,o=e.hasAlpha,s=l(t,i,r,o),A=s.transcoderFormat,f=s.engineFormat,p=n.getBytesPerBlockOrPixel(A);c(n.isFormatSupported(A),"BasisTextureLoader: Unsupported format.");var m=[];if(t===a.ETC1S){var g=new n.LowLevelETC1SImageTranscoder,v=e.globalData,y=v.endpointCount,w=v.endpointsData,x=v.selectorCount,b=v.selectorsData,C=v.tablesData;try{c(g.decodePalettes(y,w,x,b),"BasisTextureLoader: decodePalettes() failed."),c(g.decodeTables(C),"BasisTextureLoader: decodeTables() failed.");for(var M=0;M<e.levels.length;M++){var B=e.levels[M],I=e.globalData.imageDescs[M],E=d(A,B.width,B.height),S=new Uint8Array(E);c(g.transcodeImage(A,S,E/p,B.data,h(A,B.width),u(A,B.height),B.width,B.height,B.index,I.rgbSliceByteOffset,I.rgbSliceByteLength,I.alphaSliceByteOffset,I.alphaSliceByteLength,I.imageFlags,o,!1,0,0),"BasisTextureLoader: transcodeImage() failed for level "+B.index+"."),m.push({data:S,width:B.width,height:B.height})}}finally{g.delete()}}else for(var T=0;T<e.levels.length;T++){var L=e.levels[T],F=d(A,L.width,L.height),_=new Uint8Array(F);c(n.transcodeUASTCImage(A,_,F/p,L.data,h(A,L.width),u(A,L.height),L.width,L.height,L.index,0,L.data.byteLength,0,o,!1,0,0,-1,-1),"BasisTextureLoader: transcodeUASTCImage() failed for level "+L.index+"."),m.push({data:_,width:L.width,height:L.height})}return{width:i,height:r,hasAlpha:o,mipmaps:m,format:f}}(o.taskConfig):function(e){var t=new n.BasisFile(new Uint8Array(e)),i=t.isUASTC()?a.UASTC_4x4:a.ETC1S,r=t.getImageWidth(0,0),o=t.getImageHeight(0,0),s=t.getNumLevels(0),A=t.getHasAlpha();function c(){t.close(),t.delete()}var h=l(i,r,o,A),u=h.transcoderFormat,d=h.engineFormat;if(!r||!o||!s)throw c(),new Error("BasisTextureLoader:\tInvalid texture");if(!t.startTranscoding())throw c(),new Error("BasisTextureLoader: .startTranscoding failed");for(var f=[],p=0;p<s;p++){var m=t.getImageWidth(0,p),g=t.getImageHeight(0,p),v=new Uint8Array(t.getImageTranscodedSizeInBytes(0,p,u));if(!t.transcodeImage(v,0,p,u,0,A))throw c(),new Error("BasisTextureLoader: .transcodeImage failed.");f.push({data:v,width:m,height:g})}return c(),{width:r,height:o,hasAlpha:A,mipmaps:f,format:d}}(o.buffers[0]),t=e.width,i=e.height,r=e.hasAlpha,s=e.mipmaps,A=e.format,f=[],p=0;p<s.length;++p)f.push(s[p].data.buffer);self.postMessage({type:"transcode",id:o.id,width:t,height:i,hasAlpha:r,mipmaps:s,format:A},f)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}}))}};var o=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC1],engineFormat:[i.RGB_ETC1_Format,i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=o.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),A=o.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function l(t,n,o,l){for(var c=t===a.ETC1S?s:A,h=0;h<c.length;h++){var u=c[h];if(e[u.if]&&(u.basisFormat.includes(t)&&(!u.needsPowerOfTwo||f(n)&&f(o))))return{transcoderFormat:u.transcoderFormat[l?1:0],engineFormat:u.engineFormat[l?1:0]}}return console.warn("BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:r.RGBA32,engineFormat:i.RGBAFormat}}function c(e,t){if(!e)throw new Error(t)}function h(e,t){return Math.ceil(t/n.getFormatBlockWidth(e))}function u(e,t){return Math.ceil(t/n.getFormatBlockHeight(e))}function d(e,t,i){var a=n.getBytesPerBlockOrPixel(e);if(n.formatIsUncompressed(e))return t*i*a;if(e===r.PVRTC1_4_RGB||e===r.PVRTC1_4_RGBA){var o=t+3&-4,s=i+3&-4;return(Math.max(8,o)*Math.max(8,s)*4+7)/8}return h(e,t)*u(e,i)*a}function f(e){return e<=2||0==(e&e-1)&&0!==e}};var Bf=[],If=function(){function e(t){r(this,e),this.count=0,this.loaded=0,this.THUMB_SIZE=512,this.BASE_URL="",this.RESIZE=!0,this.RENAME=!1,this.renderer=null,this.basisLoader=null,t&&(this.renderer=t.renderManager.defaultRenderer)}return o(e,[{key:"setBaseUrl",value:function(e){this.BASE_URL=e||""}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=function(t){console.error(":"+e,t),r&&r(t)};if(e.constructor===String){if(6===e.split(",").length){e=e.split(",");for(var A=0;A<e.length;A++)this.RESIZE?e[A]=this._resize(e[A]):e[A]=_rebuildUrl(e[A]);return(new YA).load(e,(function(e){n(e)}),i,s)}var l=e.substr(e.lastIndexOf(".")+1).split("?")[0].toUpperCase();switch(l){case"HDR":var c=$;return(xf.isMobile||AMRT.isWebGL2)&&(c=Y),(navigator.userAgent.indexOf("Trident")>-1||navigator.userAgent.indexOf("Firefox")>-1||navigator.userAgent.indexOf("Safari")>-1&&-1==navigator.userAgent.indexOf("Chrome"))&&(c=Y),e=this._rebuildUrl(e),(new Ph).setDataType(o||c).load(e,(function(t){t.image.src=e,n(t)}),i,s);case"TGA":return e=this._rebuildUrl(e),(new bf).load(e,(function(t){t.image.src=e,n(t)}),i,s);case"BASIS":case"MRTB":return e=this._rebuildUrl(e),this.basisLoader||(this.basisLoader=new Mf,this.basisLoader.setWorkerLimit(8),this.basisLoader.setTranscoderPath(xf.getDecoderPath()),this.basisLoader.detectSupport(this.renderer),Bf.push(this.basisLoader)),this.count++,this.basisLoader.load(e,(function(i){i.wrapS=G,i.wrapT=G,n(i),i.image.src=e,i.flipY=!0,t.loaded++,t.loaded>=t.count&&t.basisLoader.dispose()}),(function(e){}),(function(e){console.error(e)}));default:var h=e;return h=this.RESIZE?this._resize(h,a):this._rebuildUrl(h),(new KA).load(h,(function(e){Ke.isPowerOfTwo(e.image.width)&&Ke.isPowerOfTwo(e.image.height),e.wrapS=G,e.wrapT=G,n(e)}),i,s)}}else if(Array.isArray(e)&&6===e.length){for(var u=0;u<e.length;u++)this.RESIZE?e[u]=this._resize(e[u]):e[u]=this.BASE_URL+e[u];return(new YA).load(e,(function(e){n(e)}),i,s)}}},{key:"loadEnvMap",value:function(e,t,n){var i=this;this.load(e,(function(e){var n=i.convertTexture(e);t&&t(n)}),(function(){}),n)}},{key:"convertTexture",value:function(e){var t,n=new lf(this.renderer),i=e.image.src;return e.constructor===Ar?(i=e.image.map((function(e){return e.src})).join(","),n.compileCubemapShader(),t=n.fromCubemap(e).texture):(n.compileEquirectangularShader(),t=n.fromEquirectangular(e).texture),n.dispose(),t.image.src=i,t._texture=e,t}},{key:"_resize",value:function(e,t){if(void 0!==t){var n="x-image-process=image/resize,w_"+t+",h_"+t;return e.indexOf("?")>-1?e+="&"+n:e+="?"+n,e}if(xf.isMobile&&!e.startsWith("data:image")){var i="x-image-process=image/resize,w_"+(t=2048)+",h_"+t+"/quality,q_100/marker,u_plus";e.indexOf("?")>-1?e+="&"+i:e+="?"+i}return e}},{key:"_rename",value:function(e){return e=e.split("?")[0],encodeURIComponent(e.slice(e.lastIndexOf("/")+1))}},{key:"_rebuildUrl",value:function(e){return this.RENAME&&(e=this._rename(e)),e.startsWith("http")||e.startsWith("data:")?e:this.BASE_URL+e}}]),e}(),Ef=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.cacheMats=[],this.queryMats={},this.cacheMeshes=[],this.cacheMesheIds=[],this.cacheAnimations=[],this.cacheActions=[],this.cacheSkinnedMeshs=[],this.cacheSkinnedMeshIds=[],this.cacheEnvMap={},this.cacheAoMap={},this.hasSkinnedAnimation=!1,this.model=t.isBIM?new Td:new Id,this.model.objects=this.cacheMeshes,this.model.materials=this.cacheMats,this.instances=null,this.ref=[],this.sref=[],this.boneListByMeshMap=new Map,this.boneListMap=new Map,this.meshLoader=new Pd,this.extraMaterial={},this.cacheExtraMat=[],this.instanceMap=new Map,this.loadCount=0,this.currentLoadCount=0,this.meshLoader.setDecoderPath(xf.getDecoderPath()),this.meshLoader.setWorkerLimit(8),this.isOpenInstance=t.instance||!1,this.isOpenInstance&&console.log(""),this.meshGroupDic=new Map,this.materialConfig=null,this.animNameMap=new Map,this.viewer=t.viewer,this.mapLoader=new If(this.viewer)}return o(e,[{key:"setLoadCount",value:function(e){this.loadCount=e}},{key:"load",value:function(e,t,n,i){var r=this;this.meshLoader.load(e,(function(e){if(e){var t;e.attributes.normal||e.computeVertexNormals(),e.attributes.uv&&$u(e);var n=r.instanceMap.get(e.custom_data.id);if(n){if(!0!==r.isOpenInstance){for(var i=0;i<n.length;i++){(new ni).copy(e),(t=new xi(e,r.generateMaterial(e))).ID=n[i].ID,r.addToCache(t),t.applyMatrix(n[i].matrix.clone()),t.sid=n[i].sid,t.parentId=n[i].parentId,t.materialIndex=e.custom_data.materialIndex.concat(),t.nodeType=1,t.name=n[i].name,r._assembly(t)}return r.instanceMap.set(e.custom_data.id,void 0),void delete e.custom_data}t=new kd(e,r.generateMaterial(e),n.length)}else if(1===e.custom_data.nodeType){t=new xi(e,r.generateMaterial(e)),r.addToCache(t)}else if(2===e.custom_data.nodeType){var a=r.boneListByMeshMap.get(e.custom_data.id);if(a)(t=new wo(e,r.generateMaterial(e,!0))).boneNum=a.maxBoneCount,t.visible=!1,r.addToCache(t)}else if(4===e.custom_data.nodeType){var o=r.boneListMap.get(e.custom_data.id);t=o||new Mo}else t=new Dt;if(t.ID=e.custom_data.id,4!==e.custom_data.nodeType)t.applyMatrix((new vt).fromArray(e.custom_data.matrix));else{var s=(new vt).fromArray(e.custom_data.matrix);t.offsetMatrix&&t.version>=3?(t.hasPose=!0,t.applyMatrix(t.offsetMatrix),t.initMatrix=s):t.applyMatrix(s)}t.sid=e.custom_data.id,t.parentId=n?-1:e.custom_data.parentId,t.materialIndex=e.custom_data.materialIndex,t.nodeType=e.custom_data.nodeType,t.name=e.name,delete e.custom_data,r._assembly(t)}}),(function(){if(r.currentLoadCount++,r.loadCount===r.currentLoadCount&&!0===r.isOpenInstance){var e=new vt;e.getInverse(r.model.matrixWorld);var n,i=C(r.instanceMap);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(r.ref[a[0]]){var o=r.ref[a[0]],s=a[1];if(s){for(var A=0;A<s.length;A++){s[A].instanceMesh=o,s[A].instanceIndex=A,s[A].updateMatrixWorld(!0);var l=new vt;o.setMatrixAt(A,l.multiplyMatrices(e,s[A].matrixWorld)),o.instanceMatrix.needsUpdate=!0,o.objects.push(s[A])}r.instanceMap.set(a[0],void 0)}}}}catch(e){i.e(e)}finally{i.f()}r.currentLoadCount=0,console.log("complete")}t(r.model)}),n,i)}},{key:"bindSkeleton",value:function(){var e,t=C(this.boneListByMeshMap);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=n[1].bones,r=this.ref[n[0]];if(r){var a=new Co(i);r.bind(a)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"initSkeletonTransform",value:function(){var e,t=C(this.boneListMap);try{for(t.s();!(e=t.n()).done;){var n=e.value[1];if(n.initMatrix){var i=new tt,r=new qe,a=new tt;n.initMatrix.decompose(i,r,a),n.position.set(i.x,i.y,i.z),n.quaternion.set(r.x,r.y,r.z,r.w),n.scale.set(a.x,a.y,a.z),n.updateMatrix()}}}catch(e){t.e(e)}finally{t.f()}var o,s=C(this.boneListByMeshMap);try{for(s.s();!(o=s.n()).done;){var A=o.value,l=this.ref[A[0]];l&&(l.visible=!0)}}catch(e){s.e(e)}finally{s.f()}}},{key:"combinMesh",value:function(e,t){var n=e.geometry,i=t.geometry,r=n.attributes.position.count;if(i.attributes.position){var a=this.mergeBufferGeometry(n,i,"position");n.setAttribute("position",new Dn(a,3)),n.attributes.position.needsUpdate=!0}if(i.attributes.uv){var o=this.mergeBufferGeometry(n,i,"uv");n.setAttribute("uv",new Dn(o,2)),n.attributes.uv.needsUpdate=!0}if(i.attributes.uv2){var s=this.mergeBufferGeometry(n,i,"uv2");n.setAttribute("uv2",new Dn(s,2)),n.attributes.uv2.needsUpdate=!0}if(i.attributes.normal){var A=this.mergeBufferGeometry(n,i,"normal");n.setAttribute("normal",new Dn(A,3)),n.attributes.normal.needsUpdate=!0}if(i.attributes.tangent){var l=this.mergeBufferGeometry(n,i,"tangent");n.setAttribute("tangent",new Dn(l,4)),n.attributes.tangent.needsUpdate=!0}for(var c=n.index.array,h=i.index.array,u=c.length,d=h.length,f=[],p=0;p<u;p++)f.push(c[p]);for(var m=0;m<d;m++)f.push(h[m]+r);if(delete n.index,n.setIndex(f),n.index.needsUpdate=!0,n.groups.length>0&&i.groups.length>0){var g=n.groups[n.groups.length-1];if(e.materialIndex[g.materialIndex]==t.materialIndex[0])g.count+=i.groups[0].count;else{e.material.push(t.material[0]),e.materialIndex.push(t.materialIndex[0]);var v=g.start+g.count;n.addGroup(v,i.groups[0].count,e.materialIndex.length-1)}}}},{key:"mergeBufferGeometry",value:function(e,t,n){for(var i=e.getAttribute(n).array,r=t.getAttribute(n).array,a=i.length,o=r.length,s=new Float32Array(a+o),A=0;A<a;A++)s[A]=i[A];for(var l=0;l<o;l++)s[a+l]=r[l];return s}},{key:"combineMeshArray",value:function(e,t){}},{key:"loadAdditionPack",value:function(e){var t=this,n=this._createDracoLoader();n.load(e,(function(e){if("meshGroup"==e.type&&e.meshIds)for(var n=0;n<e.meshIds.length;n++){var i=e.meshIds[n],r=e.groupIds[n],a=t.ref[i];if(a){var o=r,s=t.meshGroupDic.get(o);if(s){if(t.combinMesh(s,a),a.parent&&a.parent.remove(a),delete t.ref[i],t.sref[i]&&delete t.sref[i],t.sref[a.parentId])for(var A=t.sref[a.parentId],l=0;l<A.length;l++)if(A[l]===i){A.splice(l,1);break}s.geometry.boundingSphere=null,s.geometry.boundingBox=null}else t.meshGroupDic.set(o,a)}}}),(function(){n.dispose()}))}},{key:"_assembly",value:function(e){var t=this;this.ref[e.sid]=e,-1===e.parentId?e.isBone&&e.hasPose?this.model.attach(e):this.model.add(e):this.ref[e.parentId]?(e.isBone&&e.hasPose?this.ref[e.parentId].attach(e):this.ref[e.parentId].add(e),e.updateMatrixWorld(!0)):(void 0===this.sref[e.parentId]&&(this.sref[e.parentId]=[]),this.sref[e.parentId].push(e.sid)),this.sref[e.sid]&&(this.sref[e.sid].forEach((function(n){e.add(t.ref[n]),e.updateMatrixWorld(!0)})),this.sref[e.sid]=null)}},{key:"clearTempData",value:function(){this.ref=null,this.sref=null}},{key:"loadBoneList",value:function(e,t){var n=this,i=this._createDracoLoader();i.load(e,(function(e){if(e){if(e.boneMeshList)for(var t=0;t<e.boneMeshList.length;t++){for(var i=e.boneMeshList[t],r={},a=[],o=0;o<i.boneList.length;o++){var s=n.boneListMap.get(i.boneList[o]);s||((s=new Mo).version=e.version,n.boneListMap.set(i.boneList[o],s)),a.push(s)}r.bones=a,r.maxBoneCount=i.maxBoneCount,n.boneListByMeshMap.set(i.meshId,r)}if(e.bones)for(var A=0;A<e.bones.length;A++){var l=e.bones[A],c=n.boneListMap.get(l.id);if(c){var h=(new vt).fromArray(l.offsetMatrix);c.offsetMatrix=h}}}}),(function(){t&&t(),i.dispose()}))}},{key:"loadSkin",value:function(e,t){var n=this,i=this._createDracoLoader();i.load(e,(function(e){if(e)for(var t=0;t<e.boneIndices.length;t++)n.ref[e.meshId].geometry.setAttribute("skinIndex_"+4*(t+1),new Qn(e.boneIndices[t],4)),n.ref[e.meshId].geometry.setAttribute("skinWeight_"+4*(t+1),new Vn(e.boneWeights[t],4))}),(function(){t&&t(),i.dispose()}))}},{key:"loadInstance",value:function(e,t){var n=this,i=this._createDracoLoader();i.load(e,(function(e){e&&e.insts&&(e.insts.forEach((function(e){var t=new Nd;t.applyMatrix4((new vt).fromArray(e.offsetMatrix)),t.name=e.name,t.ID=e.id,t.sid=e.id,t.parentId=e.parent_Id,n.isOpenInstance&&n.addToCache(t);var i=n.instanceMap.get(e.ref_id);i?i.push(t):n.instanceMap.set(e.ref_id,[t]),n.isOpenInstance&&n._assembly(t)})),delete e.insts)}),(function(){t&&t(),i.dispose()}))}},{key:"loadMaterials",value:function(e){var t=this,n=e.url,i=e.onLoad,r=e.onTextureLoad,a=e.onError;(new VA).load(n,(function(e){if(e=JSON.parse(e),t.model.originMaps={},e.z)for(var n in e.b)t.model.originMaps[e.b[n]]=e.z[n];qu.getDefaultRenderer().extensions.has("OES_texture_half_float")||(console.log(" OES_texture_half_float "),e.b=e.z||[]),t.materialConfig?_d.merge(t.materialConfig,e):t.materialConfig=e,t.parseMaterials(t.materialConfig,i,r,a)}))}},{key:"loadAOMap",value:function(e,t){var n=this;this.mapLoader.load(e,(function(e){e.wrapS=e.wrapT=1e3,n.cacheMats.forEach((function(t){t.aoMap=e,t.needsUpdate=!0})),t&&t instanceof Function&&t()}),null,t)}},{key:"generateMaterial",value:function(e,t){for(var n=[],i=0;i<e.custom_data.materialIndex.length;i++){var r=e.custom_data.materialIndex[i];if(void 0!==this.queryMats[r]){var a=this.cacheMats[this.queryMats[r]];n.push(a)}else{var o=this._createBaseMaterial(r);n.push(o),t&&(o.skinning=!0),this.cacheMats.push(o),this.queryMats[r]=this.cacheMats.length-1}}return n}},{key:"_createBaseMaterial",value:function(e){var t=new xA;return t.name=e,t.ID=e,t.color=new Sn("#cccccc"),t}},{key:"parseMaterials",value:function(e,t,n,i){var r=this;if(Array.isArray(e)&&(e={a:e,b:[]}),this.extraMaterial=e.c||{},e.a.length>0){var a=0,o=0,s=e.a.length,A=new Map;e.a.forEach((function(l){var c=l;if(void 0!==c.re){var h=c.a,u=c.re;(c=A.get(u))?(c=JSON.parse(JSON.stringify(c))).re=u:c={},c.a=h,c.ee=""}else A.set(c.a,c);r.parseMaterial({config:c,maps:e.b,onLoad:function(){++a===s&&(r._initMaterial(),t&&t instanceof Function&&t())},onTextureLoad:function(){++o===s&&n&&n instanceof Function&&n()},onError:i,edited:!1})})),A.clear()}else t&&t instanceof Function&&t()}},{key:"parseMaterial",value:function(e){var t=e.config,n=e.maps,i=e.onLoad,r=e.onTextureLoad;e.onError,e.edited;var a=t.a,o=this.queryMats[a];if(void 0===o&&a&&a.toString().indexOf("_")>-1){var s=a.split("_")[0],A=this.queryMats[s],l=this.cacheMats[A],c=this.cacheMeshes.find((function(e){return e.name===t.mn})),h=l.clone();h.name=t.ee||a,h.sname=l.sname,h.ID=a,this.cacheMats.push(h),o=this.cacheMats.length-1,this.queryMats[a]=o,c.material[c.material.indexOf(l)]=h}var u=this.cacheMats[o];u||(u=this._createBaseMaterial(a),this.cacheMats.push(u),this.queryMats[a]=this.cacheMats.length-1),_d.parseAmrtMaterial(t,n,u,i,r,this.mapLoader)}},{key:"addToCache",value:function(e){this.cacheMeshes.push(e),this.cacheMesheIds.push(e.ID)}},{key:"loadAnimationComplete",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=this.animNameMap.get(e[n]);i&&t.push(i)}this.model.animation.setAnimationList(t)}},{key:"loadAnimation",value:function(e,t){var n=this;this.hasSkinnedAnimation=!0;var i=this._createDracoLoader();i.load(e,(function(i){try{if(i){var r=[];if(i.animType2Anim){var a=n.parseAnimation(i);r=r.concat(a)}else i.boneId2Anim&&i.boneId2Anim.length>0&&(r=r.concat(n.parseSkinAnimation(i)));var o=new RA(i.name,i.Duration,r);n.model.animation.addClip(o),n.animNameMap.set(e,i.name)}}catch(e){console.error("",e)}t&&t()}),(function(){i.dispose()}))}},{key:"parseSkinAnimation",value:function(e){if(e.boneId2Anim){var t=new vt,n=new tt,i=new qe,r=new tt;e.Duration;for(var a=[],o=0;o<e.boneId2Anim.length;o++){for(var s=e.boneId2Anim[o],A=this.ref[s.boneId].name,l=s.frameTimes,c=[],h=[],u=[],d=0;d<s.frameVals.length;d++){var f=s.frameVals[d];t.fromArray(f),t.decompose(n,i,r),c.push(n.x,n.y,n.z),h.push(i.x,i.y,i.z,i.w),u.push(r.x,r.y,r.z)}var p=new DA(A+".position",l,c),m=new PA(A+".quaternion",l,h),g=new DA(A+".scale",l,u);a.push(p,m,g)}return a}}},{key:"parseAnimation",value:function(e){var t=e.animType2Anim,n=[];if(t.transAnim)for(var i=0;i<t.transAnim.length;i++)for(var r=t.transAnim[i],a=0;a<r.meshId.length;a++)if(this.ref[r.meshId[a]]){var o=this.ref[r.meshId[a]].uuid;n.push(new DA(o+".position",r.frameTimes,r.frameVals))}if(t.scaleAnim)for(var s=0;s<t.scaleAnim.length;s++)for(var A=t.scaleAnim[s],l=0;l<A.meshId.length;l++)if(this.ref[A.meshId[l]]){var c=this.ref[A.meshId[l]].uuid;n.push(new DA(c+".scale",A.frameTimes,A.frameVals))}if(t.rotAnim)for(var h=0;h<t.rotAnim.length;h++)for(var u=t.rotAnim[h],d=0;d<u.meshId.length;d++)if(this.ref[u.meshId[d]]){var f=this.ref[u.meshId[d]].uuid;n.push(new PA(f+".quaternion",u.frameTimes,u.frameVals))}return n}},{key:"parseSkinnedAnimation",value:function(e){for(var t,n=[],i=0,r=0;r<e.length;r++){var a=e[r],o=this.cacheSkinnedMeshs[a.a].name,s=[],A=[],l=[],c=[];a.d>i&&(i=a.d);for(var h=0;h<a.b.length;h++){s.push(a.b[h].a);var u=(new vt).fromArray(a.b[h].b),d=new tt,f=new qe,p=new tt;u.decompose(d,f,p),A.push(d.x),A.push(d.y),A.push(d.z),l.push(f.x),l.push(f.y),l.push(f.z),l.push(f.w),c.push(p.x),c.push(p.y),c.push(p.z)}n.push(new DA(o+".position",s,A)),n.push(new PA(o+".quaternion",s,l)),n.push(new DA(o+".scale",s,c))}var m=new RA("test",i,n),g=(t=new Fc(this.model)).clipAction(m);g.play(),this.cacheAnimations.push(t),this.cacheActions.push(g)}},{key:"_initMaterial",value:function(){var e=this;this.cacheMeshes.forEach((function(t){if(t.isMesh&&!t.isHotSpotEntity){t.renderOrder=(Array.isArray(t.material)?t.material[0]:t.material).renderOrder;var n=Array.isArray(t.material)?t.material:[t.material];t.geometry.attributes&&!t.geometry.attributes.uv&&n.forEach((function(e){e.vertexTangents=!1})),t.geometry.attributes&&t.geometry.attributes.uv2&&n.forEach((function(e){void 0===e.aoUV&&(e.aoUV=1)}));var i=function(n){var i=e.extraMaterial[n],r=e.cacheMats.find((function(e){return e.name==n}));if(!r)return"continue";i.map((function(n){n.a==t.ID&&(e.cacheExtraMat.push({a:t.ID,b:n.b,c:t.material[n.b].name}),r.skinning=t.material[n.b].skinning,t.material[n.b]=r,t.overMaterial=[n.b].concat(y(t.overMaterial||[])))}))};for(var r in e.extraMaterial)i(r)}}))}},{key:"replaceMaterials",value:function(e){var t=this,n=e.url,i=e.onload,r=e.onTextureLoad;this.cacheExtraMat.map((function(e){var n=t.cacheMeshes.find((function(t){return t.ID==e.a})),i=t.cacheMats[t.queryMats[e.c]];n.material[e.b]=i})),this.extraMaterial={},this.loadMaterials({url:n,onload:i,onTextureLoad:r})}},{key:"_createDracoLoader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=new Pd;return t.setDecoderPath(xf.getDecoderPath()),t.setWorkerLimit(e),t}}]),e}(),Sf=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).logId="",i.viewer=e,i.mapLoader=new If(e),i}return o(n,[{key:"load",value:function(e,t,n,i){var r=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.paths=e,void 0!==e.localPath&&this.mapLoader.setBaseUrl(e.localPath),this._onLoad=t,this._onProgress=n,this._onError=i,this.logId=!!a.log&&a.log.toString(),e.m[0].indexOf(".mbin")>-1||e.m[0].indexOf(".mrmb")>-1?this.loader=new Ef(a):this.loader=new Ud(a),this.loader.mapLoader=this.mapLoader,this.paths.nodes)this.loader.loadNodes(this.paths.nodes,(function(){r._loadMultiMesh()}));else if(this.paths.instance&&this.paths.instance.length>0)for(var o=0;o<this.paths.instance.length;o++)this.loader.loadInstance(this.paths.instance[o],(function(){r._loadSkinAndMesh()}));else this._loadSkinAndMesh();return this.loader.model.name=a.name||this.loader.model.name,this.loader.model.ID=a.id||"",a.position&&(Array.isArray(a.position)?this.loader.model.position.fromArray(a.position):a.position.isVector3&&this.loader.model.position.copy(a.position)),a.rotation&&Array.isArray(a.rotation)&&this.loader.model.rotation.set(Ke.degToRad(a.rotation[0]),Ke.degToRad(a.rotation[1]),Ke.degToRad(a.rotation[2])),a.scale&&(Array.isArray(a.scale)&&3===a.scale.length?this.loader.model.scale.fromArray(a.scale):isNaN(a.scale)?a.scale.isVector3&&this.loader.model.scale.copy(a.scale):this.loader.model.scale.multiplyScalar(a.scale)),this.loader.model}},{key:"_loadSkinAndMesh",value:function(){var e=this;if(this.paths.bone&&this.paths.bone.length>0)for(var t=0;t<this.paths.bone.length;t++)this.loader.loadBoneList(this.paths.bone[t],(function(){e._loadMultiMesh()}));else this._loadMultiMesh()}},{key:"_loadMaterials",value:function(e){var t=this;this.logId&&console.time("(".concat(this.logId,")")),this.logId&&console.time("(".concat(this.logId,")")),void 0!==this.paths.rs&&(this.mapLoader.RESIZE=Boolean(this.paths.rs)),void 0!==this.paths.localPath&&(this.mapLoader.RESIZE=!1);var n=0,i=e.length;e.forEach((function(e){t.loader.loadMaterials({url:e,onLoad:function(){++n===i&&(t.dispatchEvent(Xu.MATERIAL_LOADED,t.loader.model),t.logId&&console.timeEnd("(".concat(t.logId,")")))},onTextureLoad:function(){t.paths.ao&&t.paths.ao,t.dispatchEvent(Xu.TEXTURE_LOADED),t.logId&&console.timeEnd("(".concat(t.logId,")"))},onError:function(e){t.dispatchEvent(Xu.MATERIAL_LOAD_ERROR),console.error("",e)}})}))}},{key:"_loadAnimations",value:function(){var e=this;this.logId&&console.time("(".concat(this.logId,")"));var t=0,n=this.paths.a.length;this.paths.a.forEach((function(i){e.loader.loadAnimation(i,(function(){++t===n&&(e.loader.loadAnimationComplete(e.paths.a),e.dispatchEvent(Xu.ANIMATION_LOADED),e._loadAdditionPack(),e.logId&&console.timeEnd("(".concat(e.logId,")")))}))}))}},{key:"_loadAdditionPack",value:function(){var e=this;Array.isArray(this.paths.addition)&&this.paths.addition.forEach((function(t){t&&e.loader.loadAdditionPack(t)}))}},{key:"_loadComplete",value:function(e){var t=this;e.objects=[],e.traverse((function(t){t.isMesh&&e.objects.push(t)})),e.update(),this.loader.bindSkeleton(),this._loadMaterials(this.paths.mat),this.paths.a&&this.paths.a.length>0?this.paths.skin&&this.paths.skin.length>0?this._loadSkin(this.paths.skin,(function(){t.loader.initSkeletonTransform(),t._loadAnimations()})):this._loadAnimations():this._loadAdditionPack(),this._onProgress&&this._onProgress(100),this.dispatchEvent(Xu.MESH_LOADED,e),this._onLoad&&this._onLoad(e),this.loader.meshLoader&&this.loader.meshLoader.dispose()}},{key:"_loadSkin",value:function(e,t){for(var n=0;n<e.length;n++)this.loader.loadSkin(e[n],t)}},{key:"_loadMultiMesh",value:function(){var e=this;this.logId&&console.time("(".concat(this.logId,")"));var t=this.paths.m.length,n=0,i=new Array(t).fill(0),r=new Array(t).fill(0),a=new Array(t).fill(0),o=0,s=function(){n++,l(1),n>=t&&(e.logId&&console.timeEnd("(".concat(e.logId,")")),e.paths.i&&e.paths.ii?e.loadInstanceMesh((function(){e._loadComplete(e.loader.model)})):e._loadComplete(e.loader.model))},A=function(t){e._onError&&e._onError(t),e.dispatchEvent(Xu.MESH_LOAD_ERROR)},l=function(n){e.loader.setLoadCount&&e.loader.setLoadCount(t);for(var l=function(t){var n=e.paths.m[o];e.loader.load(n,s,(function(n){!function(t,n){var o=e.paths.ms&&e.paths.ms[n];if(e._onProgress){if(r[n]=o||t.total,!r[n])return;i[n]=t.loaded,a[n]=i[n]/r[n];var s=a.reduce((function(e,t){return e+t}),0)/a.length;e._onProgress(parseInt(100*s))}}(n,t)}),A),o++},c=0;c<n&&o<t;c++)l(c)};t>0?l(Math.min(t,20)):s()}},{key:"_preloadMaterial",value:function(){var e=this;void 0!==this.paths.localPath&&(this.mapLoader.RESIZE=!1),this.paths.mat.forEach((function(t){(new VA).load(t,(function(t){for(var n in(t=JSON.parse(t)).b)e.mapLoader.load(t.b[n])}))}))}},{key:"loadInstanceMesh",value:function(e){var t=this;(new VA).load(this.paths.i,(function(n){var i=JSON.parse(n);t.loader.instances=i;var r=t.paths.ii.length,a=0;t.paths.ii.forEach((function(n){t.loader.load(n,(function(n){(n=n[0]).parent&&n.parent.remove(n);var o=[];i.forEach((function(e,t){e.c==n.iid&&o.push(e)}));var s=new xA;s.name=name,s.color=new Sn("#cccccc");var A=[s],l=new kd(n.geometry,A,o.length);t.loader.model.add(l);var c=new vt;c.getInverse(t.loader.model.matrixWorld),o.forEach((function(e,n){var i=new Nd;i.name=e.b,i.instanceMesh=l,i.instanceIndex=n,i.applyMatrix((new vt).fromArray(e.d));var r=t.loader.model.getObjectByProperty("ID",e.e)||t.loader.model;r&&(r.add(i),t.loader.addToCache(i)),i.updateMatrixWorld(!0);var a=new vt;l.setMatrixAt(n,a.multiplyMatrices(c,i.matrixWorld)),l.objects.push(i)})),l.instanceMatrix.needsUpdate=!0,++a>=r&&e()}))}))}),void 0,(function(){console.error(""),e()}))}},{key:"preloadMap",value:function(e,t,n){this.loader.preloadMap(e,t,void 0,n)}},{key:"dispatchEvent",value:function(e,t){g(l(n.prototype),"dispatchEvent",this).call(this,{type:e,data:t})}},{key:"addEventListener",value:function(e,t){return g(l(n.prototype),"addEventListener",this).call(this,e,t),this}}]),n}(Xe),Tf=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).isBIMLoader=!0,i}return o(n,[{key:"load",value:function(e,t,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return a.isBIM=!0,g(l(n.prototype),"load",this).call(this,e,t,i,r,a),this.loadConfig(this.paths.bim),this.paths.bimNode&&this.loadNodeTree(this.paths.bimNode),this.loader.model}},{key:"loadNodeTree",value:function(e){var t=this;(new VA).setResponseType("json").load(e,(function(e){console.time("nodeTree");var n={};e.forEach((function(e){if(e.b.indexOf("##")>-1){var t=e.b.split("##");e.b=t[0],e.CID=parseInt(t[1])}n[e.a]=e}));for(var i={},r={children:{}},a=0;a<e.length;a++)if(e[a].children={},i[e[a].a]=e[a].c,-1==e[a].c)r.children[e[a].a]=e[a];else{var o=e[a].c,s=[];for(s.push(o);-1!==i[o];)o=i[o],s.push(o);s.reverse();for(var A=r,l=0;l<s.length;l++)A=A.children[s[l]];A.children[e[a].a]=e[a]}for(var c=0;c<e.length;c++)e[c].children=Object.values(e[c].children);console.timeEnd(""),i=null,r=Object.values(r.children)[0],console.log(r),t.loader.model.nodeArray=e,t.loader.model.nodeTree=r,console.timeEnd("nodeTree"),t.paths.bimFace&&(new VA).setResponseType("json").load(t.paths.bimFace,(function(e){t.loader.model.faceMap=e}))}))}},{key:"loadConfig",value:function(e,t){var n=this;this.loader.model.isBIM=!0,this.loader.model.basePath=e.substring(0,e.lastIndexOf("/"))+"/",this.loader.model.extension=e.substring(e.lastIndexOf(".")+1,e.length),this.loader.model.extension=this.loader.model.extension.split("?")[0],(new VA).load(e,(function(e){e=JSON.parse(e),n.loader.model.bimConfig=e.c,n.loader.model.structureTree=e.d,n.viewer.dispatchEvent("BIMOnLoad"),t&&t()}))}}]),n}(Sf),Lf=function(){function e(){r(this,e)}return o(e,null,[{key:"create",value:function(t){var n=new Ff(t);return e.ModelManagerArray.push(n),n}}]),e}();Lf.ModelManagerArray=[];var Ff=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),(i=t.call(this)).viewer=null,i.root=null,i.modelGroup=null,i.scene=null,i.intersectObjects={click:[],dblclick:[],mousedown:[],mousemove:[]},i.viewer=e,!i.viewer.sceneManager.scene)throw new Error("scene is not instance of Scene.");return i.scene=i.viewer.sceneManager.scene,i.root=i.viewer.sceneManager.root,i.modelGroup=i.viewer.sceneManager.modelGroup,i.picker=e.picker,i.viewer.container.addEventListener("click",i._eventHandler.bind(d(i),"click")),i.viewer.container.addEventListener("dblclick",i._eventHandler.bind(d(i),"dblclick")),i.viewer.container.addEventListener("mousedown",i._eventHandler.bind(d(i),"mousedown")),i.viewer.container.addEventListener("mousemove",i._eventHandler.bind(d(i),"mousemove")),i}return o(n,[{key:"mapLoader",get:function(){return this.viewer.sceneManager.mapLoader}},{key:"_eventHandler",value:function(e,t){if(0!=this.intersectObjects[e].length){var n=this.picker.intersectObject(t,this.intersectObjects[e],!0);if(n){var i=[];n.object.traverseAncestors((function(t){switch(e){case"click":i=t.clickCallback;break;case"dblclick":i=t.dblclickCallback;break;case"mousedown":i=t.mousedownCallback;break;case"mousemove":i=t.mousemoveCallback}t.isModel&&i.map((function(e){e.bind(t)()}))}))}}}},{key:"add",value:function(e){e.isModel?this.addModel(e):e.isPostProcessing?this.viewer.composer.add(e):e.isObject3D&&this.root.add(e),this.viewer.renderManager.render()}},{key:"remove",value:function(e){e.isModel?this.removeModel(e):e.isPostProcessing?this.viewer.composer.remove(e):e.isObject3D&&this.root.remove(e),this.viewer.renderManager.render()}},{key:"addModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.modelGroup.add(e),this.dispatchEvent({type:Xu.MODEL_UPDATE}),(1===this.modelGroup.children.length||t.fitCamera||void 0===t.fitCamera)&&(t.box&&!t.box.isBox3&&(t.box=(new Jt).setFromArray(t.box.min.concat(t.box.max))),this.viewer.sceneManager.fitCamera(e,t.box)),this.viewer.renderManager.render()}},{key:"removeModel",value:function(e){e.parent&&e.parent.remove(e),this.dispatchEvent({type:Xu.MODEL_UPDATE}),this.viewer.renderManager.render()}},{key:"loadModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e;if(n.background=n.background||void 0===n.background,n.env=n.env||void 0===n.env,n.focus=n.focus||void 0===n.focus,n.addModel=n.addModel||void 0===n.addModel,n.postprocessing=n.postprocessing||void 0===n.postprocessing,e&&n.offline){if(!(i=tu.getFileList(e)))return;i.localPath=e+"Texture/"}else{if(/^\d{19}/.test(e)){n.id=n.id||e;try{i=n.local?tu.getLocalModelById(e):tu.getModelById(e),n.local&&tu.setOnlinePath(i)}catch(e){return void(n.onError&&n.onError(e))}}n.baseURL&&(i=tu.setLocalPath(i,n.baseURL))}if(nu.options&&nu.options.offline){var r=!1,a=function(e){var t=i[e];if(Array.isArray(t)){if(t.find((function(e){return t&&t.includes&&e.includes("https://laozi-auto-east.obs.cn-east-2.myhuaweicloud.com")})))throw r=!0,new Error("")}else if(t&&t.includes&&t.includes("https://laozi-auto-east.obs.cn-east-2.myhuaweicloud.com"))throw r=!0,new Error("")};for(var o in i)a(o);if(r)return}if(!i.levelUrl){var s=i.bim?new Tf(this.viewer):new Sf(this.viewer),A=s.load(i,(function(e){i.fitCamera=n.focus,n.addModel&&t.addModel(e,i),n.onLoad&&n.onLoad(e),e.onComplete&&e.onComplete()}),(function(e){n.onProgress&&n.onProgress(e)}),(function(e){n.onError&&n.onError(e)}),n);A.viewer=this.viewer;var l=n.localPath||i.localPath||"";return s.addEventListener(Xu.MATERIAL_LOADED,(function(){i.scene?t.viewer.sceneManager.loadSceneFile(i.scene,{localPath:l,onLoad:function(e){n.env&&e.e?(t.mapLoader.loadEnvMap(l+e.e,(function(i){A.materials.map((function(t){t.envMap=i,t.envMapIntensity=e.ei||.7,t.envRotateY=Math.PI/180*(e.ea||0),t.needsUpdate=!0})),n.onSceneLoad&&n.onSceneLoad(e),setTimeout((function(){n.postprocessing&&t.viewer.sceneManager.loadPostProcessing(A),n.onPostProcessingLoad&&n.onPostProcessingLoad()}),1e3)})),t.viewer.sceneManager.setEnvMapIntensity(e.ei||.7),t.viewer.sceneManager.setEnvMapRotation(e.ea||0),t.viewer.sceneManager.envMapUrl=e.e):(n.onSceneLoad&&n.onSceneLoad(e),setTimeout((function(){n.postprocessing&&t.viewer.sceneManager.loadPostProcessing(A),n.onPostProcessingLoad&&n.onPostProcessingLoad()}),1e3))},background:n.background},A):i.sky?(i.sky.b&&n.background&&t.viewer.sceneManager.setSkyBox(i.sky.b),i.sky.a&&n.env&&(t.mapLoader.loadEnvMap(i.sky.a,(function(e){A.setEnvMap(e),n.onSceneLoad&&n.onSceneLoad({a:{aa:"#FFFFFF",ab:.7},b:{ba:"#FFFFFF",bb:.7,bc:[0,.7,.7]},c:1,ca:i.sky.b,cb:.5,e:i.sky.a,ea:0,ei:.7})})),t.viewer.sceneManager.envMapUrl=i.sky.a),n.onPostProcessingLoad&&n.onPostProcessingLoad(null)):(n.onSceneLoad&&n.onSceneLoad({a:{aa:"#FFFFFF",ab:.7},b:{ba:"#FFFFFF",bb:.7,bc:[0,.7,.7]},c:2,ca:"#000000"}),n.onPostProcessingLoad&&n.onPostProcessingLoad(null)),!n.env&&t.viewer.sceneManager.envMapUrl&&n.onLoad&&n.onLoad(m).setEnvMap(t.viewer.sceneManager.envMapUrl),n.onMatLoad&&n.onMatLoad()})),s.addEventListener(Xu.ANIMATION_LOADED,(function(){n.onAnimeLoad&&n.onAnimeLoad(A)})),s.addEventListener(Xu.TEXTURE_LOADED,(function(){n.onTextureLoad&&n.onTextureLoad()})),A.options=n,A.loader=s,A}i.levelUrl.endsWith("AMRT-L")?this.viewer.largeSceneLoader2.load(i.levelUrl,{focus:n.focus,onload:function(e){e.coordinate=i.coordinate,n.onLoad&&n.onLoad(e)}}):this.viewer.largeSceneLoader.load(i.levelUrl,(function(e){e.coordinate=i.coordinate,n.onLoad&&n.onLoad(e)}))}},{key:"loadModel_miniprogram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e,i=this;if(t.background=t.background||void 0===t.background,t.env=t.env||void 0===t.env,t.focus=t.focus||void 0===t.focus,t.addModel=t.addModel||void 0===t.addModel,t.postprocessing=t.postprocessing||void 0===t.postprocessing,e.constructor!==String&&isNaN(e))t.baseURL&&(n=tu.setLocalPath(e,t.baseURL)),a();else{t.id=t.id||e;var r=t.local?tu.getLocalModelById:tu.getModelById;r(e).then((function(i){if(n=i,""!=i){if("token"===i)return nu.token=nu.checkDevloper(),void(nu.token&&tu.getModelById(e).then((function(e){n=e,t.local&&tu.setOnlinePath(n),a()})));t.local&&tu.setOnlinePath(n),a()}})).catch((function(e){t.onError&&t.onError(e)}))}function a(){var e=n.bim?new Tf(i.viewer):new Sf(i.viewer),r=e.load(n,(function(e){n.fitCamera=void 0===t.focus||t.focus,!1!==t.addModel&&i.addModel(e,n),t.onLoad&&t.onLoad(e)}),(function(e){t.onProgress&&t.onProgress(e)}),(function(e){t.onError&&t.onError(e)}),t);return r.viewer=i.viewer,e.addEventListener(Xu.MATERIAL_LOADED,(function(){t.onMatLoad&&t.onMatLoad(),n.scene?i.viewer.sceneManager.loadSceneFile(n.scene,{onLoad:function(e){t.env&&e.e&&(i.mapLoader.loadEnvMap(e.e,(function(t){r.materials.map((function(n){n.envMap=t,e.ei?n.envMapIntensity=Number(e.ei):n.envMapIntensity=.7,e.ea&&0!==e.ea?n.envRotateY=Math.PI/180*Number(e.ea):n.envRotateY=0,n.needsUpdate=!0}))})),t.onSceneLoad&&t.onSceneLoad(e),setTimeout((function(){t.postprocessing&&i.viewer.sceneManager.loadPostProcessing(r),t.onPostProcessingLoad&&t.onPostProcessingLoad()}),1e3))},background:t.background}):n.sky&&(n.sky.b&&t.background&&i.viewer.sceneManager.setSkyBox(n.sky.b),n.sky.a&&t.env&&(i.mapLoader.loadEnvMap(n.sky.a,(function(e){r.setEnvMap(e)})),t.onSceneLoad&&t.onSceneLoad(config),setTimeout((function(){t.postprocessing&&i.viewer.sceneManager.loadPostProcessing(r),t.onPostProcessingLoad&&t.onPostProcessingLoad()}),1e3))),!t.env&&i.viewer.sceneManager.envMapUrl&&m.setEnvMap(i.viewer.sceneManager.envMapUrl)})),e.addEventListener(Xu.ANIMATION_LOADED,(function(){t.onAnimeLoad&&t.onAnimeLoad(r)})),r.loader=e,r}}},{key:"loadSingleMaterial",value:function(e,t){var n=new Ef(this);if(t.mapRoot){var i=e.b;for(var r in i)i[r].startsWith("http")&&(i[r]=i[r].slice(i[r].lastIndexOf("/")+1)),i[r]=t.mapRoot+i[r]}n.parseMaterials(e,(function(){t.onLoad&&t.onLoad(n.cacheMats)}))}}]),n}(Xe);function _f(e){var t=new Rt;t.viewer=e;var n=new Li;n.deleteAttribute("uv");var i=new dA({side:1}),r=new dA,a=new Il(16777215,5,28,2);a.position.set(.418,16.199,.3),t.add(a);var o=new xi(n,i);o.position.set(-.757,13.219,.717),o.scale.set(31.713,28.305,28.591),t.add(o);var s=new xi(n,r);s.position.set(-10.906,2.009,1.846),s.rotation.set(0,-.195,0),s.scale.set(2.328,7.905,4.651),t.add(s);var A=new xi(n,r);A.position.set(-5.607,-.754,-.758),A.rotation.set(0,.994,0),A.scale.set(1.97,1.534,3.955),t.add(A);var l=new xi(n,r);l.position.set(6.167,.857,7.803),l.rotation.set(0,.561,0),l.scale.set(3.927,6.285,3.687),t.add(l);var c=new xi(n,r);c.position.set(-2.017,.018,6.124),c.rotation.set(0,.333,0),c.scale.set(2.002,4.566,2.064),t.add(c);var h=new xi(n,r);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),t.add(h);var u=new xi(n,r);u.position.set(-2.193,-.369,-5.547),u.rotation.set(0,.516,0),u.scale.set(3.875,3.487,2.986),t.add(u);var d=new xi(n,y(50));d.position.set(-16.116,14.37,8.208),d.scale.set(.1,2.428,2.739),t.add(d);var f=new xi(n,y(50));f.position.set(-16.109,18.021,-8.207),f.scale.set(.1,2.425,2.751),t.add(f);var p=new xi(n,y(17));p.position.set(14.904,12.198,-1.832),p.scale.set(.15,4.265,6.331),t.add(p);var m=new xi(n,y(43));m.position.set(-.462,8.89,14.52),m.scale.set(4.38,5.441,.088),t.add(m);var g=new xi(n,y(20));g.position.set(3.235,11.486,-12.541),g.scale.set(2.5,2,.1),t.add(g);var v=new xi(n,y(100));function y(e){var t=new kn;return t.color.setScalar(e),t}return v.position.set(0,20,0),v.scale.set(1,.1,1),t.add(v),t}var Uf=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).boundingBox=new Jt,e.boundingSphere=new en,e.name="modelGroup",e}return o(n,[{key:"add",value:function(){g(l(n.prototype),"add",this).apply(this,arguments),this.update()}},{key:"remove",value:function(){g(l(n.prototype),"remove",this).apply(this,arguments),this.update()}},{key:"update",value:function(){this.boundingBox.setFromObject(this),this.boundingBox.getBoundingSphere(this.boundingSphere)}},{key:"onAfterRender",value:function(){}}]),n}(Dt),Pf=new Pc,kf=new Jt,Df=new tt,Rf=function(){function e(){r(this,e)}return o(e,null,[{key:"create",value:function(t){var n=new Gf(t);return e.SceneManagerArray.push(n),n}}]),e}();Rf.SceneManagerArray=[];var Of,Nf,Gf=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this))._backgroundVisible=!0,i._backgroundBrightness=.5,i._enableDof=!1,i._sceneData=null,i._enableShadow=!1,i._prevBackground=null,i._shadowStrength=1,i._shadowDecay=1,i._shadowOffset=0,i.icon=null,i.root=null,i.modelGroup=null,i.scene=null,i.ambientLight=null,i.directLight=null,i.lightFollow=!1,i.camera=null,i.envMapUrl=null,i.viewer=e,i.scene=new Rt,i.scene.viewer=e,i.scene.background=new Sn(15658734),i.scene.environment=new lf(i.viewer.renderManager.defaultRenderer).fromScene(new _f(e)).texture,i.root=new Dt,i.root.name="root",i.scene.add(i.root),i.ambientLight=new Ll(16777215,.7),i.root.add(i.ambientLight),i.directLight=new Tl(16777215,.3),i.directLight.position.set(0,1,1).normalize(),i.root.add(i.directLight),i.modelGroup=new Uf,i.root.add(i.modelGroup),i.mapLoader=new If(i.viewer),i}return o(n,[{key:"visible",get:function(){return this.root.visible},set:function(e){this.root.visible=e}},{key:"backgroundVisible",get:function(){return this._backgroundVisible},set:function(e){e?!this._backgroundVisible&&this._prevBackground&&(this.scene.background=this._prevBackground,this.viewer.renderManager.domElement.style.background="#000"):this._backgroundVisible&&(this._prevBackground=this.scene.background,this.viewer.renderManager.domElement.style.background="transparent",this.clearBackground()),this._backgroundVisible=Boolean(e)}},{key:"backgroundBrightness",get:function(){return this._backgroundBrightness},set:function(e){this._backgroundBrightness=e,this.scene.background&&(this.scene.background.brightness=2*e)}},{key:"enableClickDof",get:function(){return this._enableDof},set:function(e){if(e){if(!this.icon){var t=this.viewer.renderManager.containerRect,n=t.width,i=t.height;this.icon=new Image,this.icon.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAAwCAYAAACmCaIKAAAAAXNSR0IArs4c6QAAAT5JREFUaEPtWsENwjAMvFuHXeAHI/BjBmAFeMEK/GAoxjCKKKgfmrqiVpRcX0i9ND2f7ZrYBAAzOwHYpd8jrw3J20js7DAz2wK4ODZ6kFzRzO4AlgAOYxeTPI7FRuHMbO/YK3E9J/KWiJdIyEHGBe0MdRB5KV9gHLt82QGW26c8p4SnbF/et9sRxi6oYr4X80WVqy4ZJ4A/5TAnrK1michXI6WTiJR3GqwauJSvRkonkVDlzWwNYDHwjk+SVyeHyfBo8unUaPAiGfZOYRslxkP/IL/1tsjn/OM/96X8f+yYf4rc/sfBiWL+bZiwUAzbqJftm/3UtVvk5FNiLCLU7WOp5XcT+byN6kRI+Tp1zbNqW/mu3m6zaaEurbq06tLmU2QFCLWoNZaiIURNYBY3TztXbu0nvHYHj7uztSZHzl/kIiMOWht+IQAAAABJRU5ErkJggg==",this.icon.style.position="absolute",this.icon.style.width="30px",this.icon.style.height="30px",this.icon.style.top=i/2-15+"px",this.icon.style.left=n/2-15+"px",this.icon.style.opacity=0,this.icon.style.transition="opacity 1s",this.viewer.renderManager.container.appendChild(this.icon),this.viewer.renderManager.container.style.position="relative"}if(this._enableDof)return;this.viewer.composer.enableDof=!0,this._dofClickHandler=Qf.bind(this),this.viewer.renderManager.container.addEventListener("mousedown",Hf),this.viewer.renderManager.container.addEventListener("mouseup",this._dofClickHandler)}else{if(!this._dofClickHandler||!this._enableDof)return;this.viewer.renderManager.container.removeEventListener("mousedown",Hf),this.viewer.renderManager.container.addEventListener("mouseup",this._dofClickHandler),this._dofClickHandler=null,this.viewer.composer.enableDof=!1}this._enableDof=e}},{key:"enableShadow",get:function(){return this._enableShadow},set:function(e){this._enableShadow=Boolean(e),this.updateShadowMaterial()}},{key:"shadowStrength",get:function(){return this._shadowStrength},set:function(e){e=Math.max(0,Math.min(1,e)),this._shadowStrength=e,this.updateShadowMaterial()}},{key:"shadowDecay",get:function(){return this._shadowDecay},set:function(e){this._shadowDecay=e,this.updateShadowMaterial()}},{key:"shadowOffset",get:function(){return this._shadowOffset},set:function(e){this._shadowOffset=e,this.updateShadowMaterial()}},{key:"getEnvMap",value:function(){return this.envMapUrl?this.modelGroup.children[0].envMap:""}},{key:"setEnvMap",value:function(e,t,n){var i=!0;this.modelGroup.children.map((function(r){r.isModel&&r.setEnvMap(e,(function(){t&&i&&(i=!1,t())}),n)})),this.envMapUrl=e?e.isTexture?e.image.src:e:null}},{key:"getEnvMapRotation",value:function(){return this.envMapRotation||0}},{key:"setEnvMapRotation",value:function(e){this.modelGroup.children.map((function(t){t.isModel&&t.setEnvMapRotation(e)})),this.envMapRotation=e}},{key:"getEnvMapIntensity",value:function(){return this.envMapIntensity||.7}},{key:"setEnvMapIntensity",value:function(e){this.modelGroup.children.map((function(t){t.isModel&&t.setEnvMapIntensity(e)})),this.envMapIntensity=e}},{key:"setSkyBox",value:function(e,t){var n=this;if(void 0!==e&&""!==e&&null!==e)if(e.isWebGLRenderTarget)this.scene.background=e;else var i=this.mapLoader.load(e,(function(r){if(r.constructor===Ar)n.scene.background=r;else{i.constructor===Ph?(r.wrapS=r.wrapT=1001,r.mapping=EquirectangularReflectionMapping):r.mapping=P;var a={generateMipmaps:!0,minFilter:Z,magFilter:W};n.scene.background=new Ni(1024,1024,a).fromEquirectangularTexture(n.viewer.renderManager.defaultRenderer,r)}n.scene.background.sky=e,n.scene.background._texture=r,t&&t()}));else this.scene.background=null}},{key:"setBackground",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e&&(0===e.indexOf("#")?(this.scene.background=(new Sn).setStyle(e),t&&t()):(new KA).setPath(i).load(e,(function(e){e.minFilter=W,n.scene.background=e,t&&t()})))}},{key:"clearBackground",value:function(){this.scene.background=null,this.viewer.renderManager.render()}},{key:"setLightness",value:function(e){this.ambientLight.intensity=e,this.viewer.renderManager.render()}},{key:"getLightness",value:function(){return this.ambientLight.intensity}},{key:"getLightColor",value:function(){return"#"+this.ambientLight.color.getHexString()}},{key:"setLightColor",value:function(e){this.ambientLight.color.setStyle(e),this.viewer.renderManager.render()}},{key:"setDirectLightLightness",value:function(e){this.directLight.intensity=e,this.viewer.renderManager.render()}},{key:"getDirectLightLightness",value:function(){return this.directLight.intensity}},{key:"getDirectLightColor",value:function(){return"#"+this.directLight.color.getHexString()}},{key:"setDirectLightPosition",value:function(e,t,n){e.isVector3?this.directLight.position.copy(e):(void 0!==e&&(this.directLight.position.x=e),void 0!==t&&(this.directLight.position.y=t),void 0!==n&&(this.directLight.position.z=n)),this.viewer.renderManager.render(),this.enableShadow&&this.updateShadowMaterial()}},{key:"getDirectLightPosition",value:function(){return this.directLight.position}},{key:"setDirectLightColor",value:function(e){this.directLight.color.setStyle(e),this.viewer.renderManager.render()}},{key:"addSpotLight",value:function(e){if(e.position){var t=new Ml(e.color||16777215,e.intensity||1,e.distance||100,e.angle||Math.PI/8,e.penumbra||.5,e.decay||.5);return Array.isArray(e.position)?t.position.fromArray(e.position):t.position.copy(e.position),e.target&&(t.target=e.target),this.root.add(t),t}console.warn("addSpotLightposition")}},{key:"saveSceneData",value:function(){var e={};e.a={aa:this.getLightColor(),ab:this.getLightness()},e.b={ba:this.getDirectLightColor(),bb:this.getDirectLightLightness()},this.lightFollow||(e.b.bc=this.directLight.position.toArray()),e.b.bv=this.directLight.visible;var t=this.scene.background||this._prevBackground;return t&&(t.sky?(e.c=1,e.ca=t.sky,e.cb=this.backgroundBrightness):t.isTexture?(e.c=2,e.ca=[t.image.src,t.image.src].join(",")):t.isColor&&(e.c=2,e.ca="#"+t.getHexString())),this.envMapUrl&&(e.e=this.envMapUrl,e.ea=this.envMapRotation||0,e.ei=this.envMapIntensity||.7),e.v=Boolean(this.backgroundVisible),e.u={v:!1,s:0,r:0},this.viewer.composer.enableUnrealBloom&&(e.u.v=!0,e.u.s=this.viewer.composer.unrealBloom.getStrength(),e.u.r=this.viewer.composer.unrealBloom.getRadius(),e.u.t=this.viewer.composer.unrealBloom.getThreshold()),e.k={v:!1,h:0,s:0,b:0},this.viewer.composer.enableColorAdjustment&&(e.k.v=!0,e.k.h=this.viewer.composer.colorAdjustment.getHue(),e.k.s=this.viewer.composer.colorAdjustment.getContrast(),e.k.b=this.viewer.composer.colorAdjustment.getVibrance()),e.f={v:!1,a:0,b:0},this.viewer.composer.enableDof&&(e.f.v=!0,e.f.a=this.viewer.composer.dof.aperture,e.f.b=this.viewer.composer.dof.maxblur),e.s={v:!1,r:0,s:0},this.viewer.composer.enableSSAO&&(e.s.v=!0,e.s.r=this.viewer.composer.ssao.getRadius(),e.s.s=this.viewer.composer.ssao.getStrength()),e.g={v:!1,d:0,o:0},this.viewer.composer.enableVignette&&(e.g.v=!0,e.g.d=this.viewer.composer.vignette.getDarkness(),e.g.o=this.viewer.composer.vignette.getOffset()),e}},{key:"loadSceneData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=void 0===n.background||n.background,a=n.localPath||"";e=JSON.parse(e);var o=Boolean(e.v)||void 0===e.v;return this._data=e,r?(this.setLightColor(e.a.aa),this.setLightness(e.a.ab),this.setDirectLightColor(e.b.ba),this.setDirectLightLightness(e.b.bb),Array.isArray(e.b.bc)?this.directLight.position.fromArray(e.b.bc):this.lightFollow=!0,!1===e.b.bv&&(this.directLight.visible=!1),1==e.c&&this.setSkyBox(a+e.ca,(function(){t.backgroundVisible=o,t.backgroundBrightness=e.cb||.5,i&&i(e)})),2==e.c&&(Array.isArray(e.ca)||(e.ca=e.ca.split(",")),1==e.ca.length?(this.setBackground(e.ca[0]),e.ca=e.ca[0],this.backgroundVisible=o,i&&i(e)):2==e.ca.length&&(xf.isMobile?this.setBackground(e.ca[1]+"?time="+Date.now(),(function(){t.backgroundVisible=o,i&&i(e)}),a):this.setBackground(e.ca[0]+"?time="+Date.now(),(function(){t.backgroundVisible=o,i&&i(e)}),a)))):i&&i(e),e}},{key:"loadSceneFile",value:function(e,t){var n=this;(new VA).load(e,(function(e){n.loadSceneData(e,t,(function(e){n._sceneData=e,t.onLoad&&t.onLoad(e)}))}))}},{key:"loadPostProcessing",value:function(e){var t=this._sceneData;if(t)return t.k&&t.k.v&&(this.viewer.composer.enableColorAdjustment=!0,this.viewer.composer.colorAdjustment.setHue(t.k.h),this.viewer.composer.colorAdjustment.setContrast(t.k.s),this.viewer.composer.colorAdjustment.setVibrance(t.k.b)),t.f&&t.f.v&&(this.viewer.composer.enableDof=!0,this.viewer.composer.dof.setAperture(t.f.a),this.viewer.composer.dof.setMaxblur(t.f.b),this.enableClickDof=!0),t.s&&t.s.v&&(this.viewer.composer.enableSSAO=!0,this.viewer.composer.ssao.setStrength(t.s.s),this.viewer.composer.ssao.setRadius(t.s.r)),t.u&&t.u.v&&(this.viewer.composer.enableUnrealBloom=!0,this.viewer.composer.unrealBloom.setStrength(t.u.s),this.viewer.composer.unrealBloom.setRadius(t.u.r),this.viewer.composer.unrealBloom.setThreshold(t.u.t),this.viewer.composer.unrealBloom.add(e)),t.g&&t.g.v&&(this.viewer.composer.enableVignette=!0,this.viewer.composer.vignette.setDarkness(t.g.d),this.viewer.composer.vignette.setOffset(t.g.o)),{colorAdjustment:this.viewer.composer.enableColorAdjustment,dof:this.viewer.composer.enableDof,ssao:this.viewer.composer.enableSSAO,unrealBloom:this.viewer.composer.enableUnrealBloom}}},{key:"hidePostprocessing",value:function(){this.viewer.composer.enableUnrealBloom=!1,this.viewer.composer.enableColorAdjustment=!1,this.viewer.composer.enableDof=!1,this.viewer.composer.enableSSAO=!1,this.viewer.composer.enableVignette=!1,this.enableClickDof=!1}},{key:"showFog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#ffffff",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.scene.fog=new qa(e,t,n)}},{key:"showFogExp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#ffffff",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;t*=5e-5,this.scene.fog=new Ja(e,t)}},{key:"setFogDensity",value:function(e){e=e,this.scene.fog&&(this.scene.fog.density=5e-5*e)}},{key:"clearFog",value:function(){this.scene.fog=null}},{key:"showGridHelp",value:function(e,t,n){this.gridHelp?this.gridHelp.visible=!0:(this.gridHelp=new ch(e,t,n,n),this.root.add(this.gridHelp))}},{key:"hideGridHelp",value:function(){this.gridHelp&&(this.gridHelp.visible=!1)}},{key:"showAxesHelper",value:function(e){if(this.axesHelper&&this.root.remove(this.axesHelper),!e){var t=(new Jt).setFromObject(this.modelGroup);e=Math.max(t.getSize().x,t.getSize().y,t.getSize().z)}this.axesHelper=new Uh(e),this.root.add(this.axesHelper)}},{key:"hideAxesHelper",value:function(){this.axesHelper&&this.root.remove(this.axesHelper)}},{key:"fitCamera",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.modelGroup,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n&&n.isBox3?e=n:(e=new Jt).expandByObject(t);var i=e.getCenter(new tt);t===this.modelGroup&&(t.translateX(-i.x),t.translateY(-i.y),t.translateZ(-i.z),i.x=i.y=i.z=0),this.modelGroup.traverse((function(e){e._shadow&&(t.updateMatrixWorld(),t.matrixWorld.decompose(e._shadow.parent.position,e._shadow.parent.quaternion,e._shadow.parent.scale))}));var r=1.5,a=.8,o=.05,s=this.viewer.renderManager.container.getBoundingClientRect();s.width<s.height&&(r=2);var A=e.getSize(new tt),l=Math.max(A.x,A.y,A.z),c=this.camera.fov*(Math.PI/180),h=Math.abs(l/(2*Math.tan(c/2))),u=Math.min(A.x,A.y,A.z);this.camera.near=u*o,20*l>this.camera.far&&(this.camera.far=20*l),this.camera.far<5e3&&(this.camera.far=5e3),this.camera.defaultPos.copy(this.camera.position),this.camera.updateProjectionMatrix();var d=new tt(i.x,i.y+h*a,i.z+h*r);this.camera.controller?(this.camera.controller.setPosition(d.x,d.y,d.z),this.camera.controller.setTarget(i.x,i.y,i.z)):(this.camera.position.z=d.z,this.camera.position.y=d.y,this.camera.lookAt(i.x,i.y,i.z))}},{key:"dispose",value:function(){this.scene.traverse((function(e){e.isMesh&&(e.geometry&&e.geometry.dispose(),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map&&e.map.dispose(),e.dispose()})))})),this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.dispose(),this.scene.background=null}},{key:"updateShadowMaterial",value:function(){var e=this;kf.setFromObject(this.modelGroup);var t=new At(0,kf.min.y/Math.abs(kf.min.y),0,Math.abs(kf.min.y)+this.shadowOffset),n=this.shadowDecay,i=this.shadowStrength;this.modelGroup.traverse((function(r){r.isModel&&(e._enableShadow?(kf.setFromObject(r),r.shadowMaterial?(r.shadowMaterial.lightDirection.copy((new tt).sub(e.directLight.position)),r.shadowMaterial.shadowPlane=t,r.shadowMaterial.shadowLength=kf.getSize(Df).length()*n,r.shadowMaterial.color=new Sn(0).add(new Sn(16777215).multiplyScalar(1-i)),kf.getCenter(r.shadowMaterial.center)):r.shadowMaterial=new bA({lightDirection:(new tt).sub(e.directLight.position),shadowPlane:t,shadowLength:kf.getSize(Df).length()*n,color:new Sn(0).add(new Sn(16777215).multiplyScalar(1-i)),center:kf.getCenter(Df)})):r.shadowMaterial=null)}))}}]),n}(Xe);function Qf(e){var t=this;if(Nf&&!(Date.now()-Nf>200)){var n=e.offsetX,i=e.offsetY;this.icon.style.left=n-15+"px",this.icon.style.top=i-15+"px",this.icon.style.opacity=1,this.icon.style["-webkit-user-drag"]="none",Of&&clearTimeout(Of),Of=setTimeout((function(){return t.icon.style.opacity=0}),1e3);var r=xf.getDomMouse(e,this.viewer.renderManager.containerRect);Pf.setFromCamera(r,this.viewer.renderManager.camera);var a=Pf.intersectObject(this.modelGroup,!0);if(a[0]){var o=a[0].distance;this.viewer.composer.dof.setFocus(o)}}}function Hf(e){Nf=Date.now()}function zf(e){this.viewer=e;var t=this.object=e.camera;this.domElement=void 0!==e.renderer.domElement?e.renderer.domElement:document,this.enabled=!0,this.target=new tt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._minPolarAngle=0,this._maxPolarAngle=Math.PI,this._minAzimuthAngle=-1/0,this._maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this._enableZoom=!0,this.zoomSpeed=1,this._enableRotate=!0,this.rotateSpeed=1,this._enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:B.LEFT,MIDDLE:B.MIDDLE,RIGHT:B.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._rotateLeft=function(e){M(e)},this._rotateUp=function(e){I(e)},this.panLeft=function(e){S(e,n.object.matrix)},this.panRight=function(e){S(-e,n.object.matrix)},this.panUp=function(e){T(e,n.object.matrix)},this.panDown=function(e){T(-e,n.object.matrix)},this.dollyIn=function(t){F(t,!0),e.renderManager.render()},this.dollyOut=function(t){_(t,!0),e.renderManager.render()},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){u.set(0,0,0),n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n._update(),s=o.NONE},this._update=function(){var e=new tt,r=(new qe).setFromUnitVectors(t.up,new tt(0,1,0)),a=r.clone().inverse(),f=new tt,p=new qe;return function(){var t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(r),l.setFromVector3(e),n.autoRotate&&s===o.NONE&&M(2*Math.PI/60/60*n.autoRotateSpeed),l.theta+=c.theta,l.phi+=c.phi,l.theta=Math.max(n._minAzimuthAngle,Math.min(n._maxAzimuthAngle,l.theta)),l.phi=Math.max(n._minPolarAngle,Math.min(n._maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=h,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),n.target.add(u),e.setFromSpherical(l),e.applyQuaternion(a),t.equals(n.target.clone().add(e))||t.copy(n.target).add(e),n.object.lookAt(n.target);var m=!1;return u.equals(new tt)||(m=!0),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),u.set(0,0,0)),h=1,!!(d||f.distanceToSquared(n.object.position)>A||8*(1-p.dot(n.object.quaternion))>A)&&(m?i.data="pan":delete i.data,n.dispatchEvent(i),f.copy(n.object.position),p.copy(n.object.quaternion),d=!1,!0)}}(),this.computePosition=function(e,t,i,r){var a=(new qe).setFromUnitVectors(n.object.up,new tt(0,1,0)),o=a.clone().inverse(),s=new tt;return s.copy(e).sub(t),s.applyQuaternion(a),l.setFromVector3(s),void 0!==i?l.theta=i:l.theta+=c.theta,void 0!==r?l.phi=r:l.phi+=c.phi,l.theta=Math.max(n._minAzimuthAngle,Math.min(n._maxAzimuthAngle,l.theta)),l.phi=Math.max(n._minPolarAngle,Math.min(n._maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=h,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),s.setFromSpherical(l),s.applyQuaternion(o),e.copy(t).add(s),e},this.dispose=function(){n.domElement.removeEventListener("contextmenu",H,!1),n.domElement.removeEventListener("mousedown",P,!1),n.domElement.removeEventListener("wheel",R,!1),n.domElement.removeEventListener("touchstart",N,!1),n.domElement.removeEventListener("touchend",Q,!1),n.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",D,!1),window.removeEventListener("keydown",O,!1)};var n=this,i={type:"change"},r={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},s=o.NONE,A=1e-6,l=new Rc,c=new Rc;this.sphericalDelta=c;var h=1,u=new tt,d=!1,f=new Je,p=new Je,m=new Je,g=new Je,v=new Je,y=new Je,w=new Je,x=new Je,b=new Je;function C(){return Math.pow(.95,n.zoomSpeed)}function M(t){c.theta-=t,e.renderManager.render()}function I(t){c.phi-=t,e.renderManager.render()}this.spherical=l;var E,S=function(){var t=new tt;return function(n,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-n),u.add(t),e.renderManager.render()}}(),T=function(){var t=new tt;return function(i,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(i),u.add(t),e.renderManager.render()}}(),L=(E=new tt,function(e,t){var i=n.domElement===document?n.domElement.body:n.domElement;if(n.object.isPerspectiveCamera){var r=n.object.position;E.copy(r).sub(n.target);var a=E.length();a*=Math.tan(n.object.fov/2*Math.PI/180),S(2*e*a/i.clientHeight,n.object.matrix),T(2*t*a/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(S(e*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),T(t*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n._enablePan=!1)});function F(e,t){n.object.isPerspectiveCamera?t?h=e:h/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n._enableZoom=!1)}function _(e,t){n.object.isPerspectiveCamera?t?h=e:h*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n._enableZoom=!1)}function U(e){g.set(e.clientX,e.clientY)}function P(e){if(!1!==n.enabled){switch(e.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),e.button){case n.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n._enablePan)return;U(e),s=o.PAN}else{if(!1===n._enableRotate)return;!function(e){f.set(e.clientX,e.clientY)}(e),s=o.ROTATE}break;case n.mouseButtons.MIDDLE:if(!1===n._enableZoom)return;!function(e){w.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case n.mouseButtons.RIGHT:if(!1===n._enablePan)return;U(e),s=o.PAN}s!==o.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",D,!1),n.dispatchEvent(r))}}function k(e){if(!1!==n.enabled)switch(e.preventDefault(),s){case o.ROTATE:if(!1===n._enableRotate)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);var t=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*m.x/t.clientHeight),I(2*Math.PI*m.y/t.clientHeight),f.copy(p),n._update()}(e);break;case o.DOLLY:if(!1===n._enableZoom)return;!function(e){x.set(e.clientX,e.clientY),b.subVectors(x,w),b.y>0?F(C()):b.y<0&&_(C()),w.copy(x),n._update()}(e);break;case o.PAN:if(!1===n._enablePan)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,g).multiplyScalar(n.panSpeed),L(y.x,y.y),g.copy(v),n._update()}(e)}}function D(e){!1!==n.enabled&&(document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",D,!1),n.dispatchEvent(a),s=o.NONE)}function R(e){!1===n.enabled||!1===n._enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),n.dispatchEvent(r),function(e){e.deltaY<0?_(C()):e.deltaY>0&&F(C()),n._update()}(e),n.dispatchEvent(a))}function O(e){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n._enablePan&&function(e){var t=!1;switch(e.keyCode){case n.keys.UP:L(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:L(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:L(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:L(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n._update())}(e)}function N(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===n._enableRotate)return;!function(e){f.set(e.touches[0].pageX,e.touches[0].pageY)}(e),s=o.TOUCH_ROTATE;break;case 2:if(!1===n._enableZoom&&!1===n._enablePan)return;!function(e){if(n._enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);w.set(0,r)}if(n._enablePan){var a=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(a,o)}}(e),s=o.TOUCH_DOLLY_PAN;break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(r)}}function G(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===n._enableRotate)return;if(s!==o.TOUCH_ROTATE)return;!function(e){p.set(e.touches[0].pageX,e.touches[0].pageY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);var t=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*m.x/t.clientHeight),I(2*Math.PI*m.y/t.clientHeight),f.copy(p),n._update()}(e);break;case 2:if(!1===n._enableZoom&&!1===n._enablePan)return;if(s!==o.TOUCH_DOLLY_PAN)return;!function(e){if(n._enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);x.set(0,r),b.set(0,Math.pow(x.y/w.y,n.zoomSpeed)),F(b.y),w.copy(x)}if(n._enablePan){var a=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(a,o),y.subVectors(v,g).multiplyScalar(n.panSpeed),L(y.x,y.y),g.copy(v)}n._update()}(e);break;default:s=o.NONE}}function Q(e){s=o.NONE,!1!==n.enabled&&(n.dispatchEvent(a),s=o.NONE)}function H(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",H,!1),n.domElement.addEventListener("mousedown",P,!1),n.domElement.addEventListener("wheel",R,!1),n.domElement.addEventListener("touchstart",N,!1),n.domElement.addEventListener("touchend",Q,!1),n.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",O,!1),this._update()}zf.prototype=Object.create(Xe.prototype),zf.prototype.constructor=zf,Object.defineProperties(zf.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this._enableZoom},set:function(e){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this._enableZoom=!e}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use ._enableRotate instead."),!this._enableRotate},set:function(e){console.warn("OrbitControls: .noRotate has been deprecated. Use ._enableRotate instead."),this._enableRotate=!e}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var Vf=function e(){r(this,e)};Vf.TOP="top",Vf.NORMAL="normal",Vf.MAP="map",Vf.ROAM_FREE="roam_free",Vf.ROAM_AUTO="roam_auto",Vf.ORBIT="orbit",Vf.GLOBE="globe",Vf.FLY="fly",Vf.DRIVE="drive";var jf=function(e){A(n,e);var t=p(n);function n(e,i,a,o){var s;return r(this,n),(s=t.call(this)).object=e,s.camera=i,s.tween=a,s.controls=o,s}return o(n,[{key:"setCameraFloor",value:function(e){this.cameraPos=this.camera.position.clone(),this.controls.enabled=!1,e&&(e.z*=-1,this.camera.position.copy(e)),this.camera.lookAt(new tt),this.object.add(this.camera)}},{key:"stopCameraFloor",value:function(){this.controls.enabled=!0,this.camera.parent==this.object&&this.object.remove(this.camera),this.cameraPos&&this.camera.position.copy(this.cameraPos)}},{key:"stopMoving",value:function(){this.tween.stop(),this.stopCameraFloor()}}]),n}(Xe),Wf={type:Xu.CHANGE},Xf={type:"move"},Zf=function(e){A(n,e);var t=p(n);function n(e){var i,a,o;return r(this,n),(o=t.call(this,e))._viewMode=Vf.NORMAL,o._rotateTween=null,o.viewer=e,o.object=e.camera,o.camera=e.camera,e.camera.controller=d(o),g((i=d(o),l(n.prototype)),"addEventListener",i).call(i,"change",(function(){return o.dispatchEvent(Xf)})),g((a=d(o),l(n.prototype)),"addEventListener",a).call(a,"end",(function(){return o.dispatchEvent(Wf)})),o}return o(n,[{key:"viewMode",get:function(){return this._viewMode},set:function(e){this._viewMode=e,this.dispatchEvent({type:"view_change",data:e})}},{key:"getView",value:function(){return{position:this.object.position.toArray(),target:this.target.toArray()}}},{key:"setView",value:function(e){void 0!==e&&(void 0!==e.position&&(Array.isArray(e.position)?this.object.position.fromArray(e.position):this.object.position.copy(e.position)),void 0!==e.target&&this.target&&(Array.isArray(e.position)?this.target.fromArray(e.target):this.target.copy(e.target))),this.viewer.renderManager.render(!0)}},{key:"enablePan",get:function(){return this._enablePan},set:function(e){this._enablePan=e}},{key:"enableRotate",get:function(){return this._enableRotate},set:function(e){this._enableRotate=e}},{key:"enableZoom",get:function(){return this._enableZoom},set:function(e){this._enableZoom=e}},{key:"maxPolarAngle",get:function(){return this._maxPolarAngle/(Math.PI/180)},set:function(e){this._maxPolarAngle=Math.PI/180*e}},{key:"minPolarAngle",get:function(){return this._minPolarAngle/(Math.PI/180)},set:function(e){this._minPolarAngle=Math.PI/180*e}},{key:"maxAzimuthAngle",get:function(){return this._maxAzimuthAngle/(Math.PI/180)},set:function(e){this._maxAzimuthAngle=Math.PI/180*e}},{key:"minAzimuthAngle",get:function(){return this._minAzimuthAngle/(Math.PI/180)},set:function(e){this._minAzimuthAngle=Math.PI/180*e}},{key:"flyTo",value:function(e){var t,n,i=this,r=[Ku.Easing.Linear.None,Ku.Easing.Quadratic.InOut,Ku.Easing.Quadratic.Out,Ku.Easing.Cubic.InOut,Ku.Easing.Cubic.Out,Ku.Easing.Sinusoidal.InOut,Ku.Easing.Sinusoidal.Out,Ku.Easing.Exponential.InOut,Ku.Easing.Exponential.Out,Ku.Easing.Circular.InOut,Ku.Easing.Circular.Out,Ku.Easing.Elastic.InOut,Ku.Easing.Elastic.Out,Ku.Easing.Back.InOut,Ku.Easing.Back.Out,Ku.Easing.Bounce.InOut,Ku.Easing.Bounce.Out],a=e&&e.type?r[e.type]:r[10];if(void 0!==(e=e||{}).position&&(t=Array.isArray(e.position)?(new tt).fromArray(e.position):(new tt).copy(e.position)),void 0!==e.target&&(n=Array.isArray(e.target)?(new tt).fromArray(e.target):(new tt).copy(e.target)),e.object&&(e.object.isObject3D||e.object.isMesh)&&(n=e.object.parent.localToWorld(e.object.position.clone()),t=this._fitCamera(e.object).add(n),e.yAngle&&(t.x=0,t.applyAxisAngle(new tt(0,1,0),Math.PI/180*e.yAngle).add(n)),e.xAngle)){var o=this._fitCamera(e.object).add(n);o.applyAxisAngle(new tt(1,0,0),Math.PI/180*e.xAngle*-1),t.copy(o),e.yAngle&&(t.x=0,t.applyAxisAngle(new tt(0,1,0),Math.PI/180*e.yAngle).add(n))}if(t){n&&n.distanceTo(this.target)>0&&new Ku.Tween(this.target).easing(a).to(n,e.time+100||600).onUpdate((function(){i.object.lookAt(i.target)})).start(),new Ku.Tween(this.object.position).easing(a).to(t,e.time||500).onUpdate((function(){i._dispatchEvent(Wf)})).onComplete((function(){e.complete&&e.complete()})).start()}}},{key:"fit",value:function(e){if(e.isMesh||e.isObject3D){this.viewer.renderManager.render(!0);var t=e.parent.localToWorld(e.position.clone()),n=this._fitCamera(e).add(t);this.object.position.copy(n),this.target.copy(t),this._dispatchEvent(Wf)}}},{key:"setPosition",value:function(e,t,n){this.object.position.set(e,t,n),this._dispatchEvent(Wf)}},{key:"setTarget",value:function(e,t,n){this.target.set(e,t,n),this._dispatchEvent(Wf)}},{key:"moveForward",value:function(e){var t=new tt;this.object.getWorldDirection(t),this.object.position.add(t.multiplyScalar(e)),this._dispatchEvent(Wf)}},{key:"moveBackward",value:function(e){var t=new tt;this.object.getWorldDirection(t),this.object.position.add(t.multiplyScalar(-e)),this._dispatchEvent(Wf)}},{key:"moveLeft",value:function(e){this.panLeft(e)}},{key:"moveRight",value:function(e){this.panRight(e)}},{key:"moveUp",value:function(e){this.panUp(e)}},{key:"moveDown",value:function(e){this.panDown(e)}},{key:"rotateLeft",value:function(e){e=Math.PI/180*e,this._rotateLeft(e)}},{key:"rotateUp",value:function(e){e=Math.PI/180*e,this._rotateUp(e)}},{key:"rotateAround",value:function(e){var t,n=this,i=e.target,r=e.object;r&&(r.isMesh||r.isObject3D)?t=r.parent.localToWorld(r.position.clone()):i&&void 0!==i.x&&void 0!==i.y&&void 0!==i.z&&(t=(new tt).copy(i)),this.stopRotateAround();var a=function(){if(e.yAngle){var t=0,i={angle:0};n._rotateTween=new Ku.Tween(i).to({angle:e.yAngle},e.time).onUpdate((function(){n.rotateLeft(i.angle-t),t=i.angle})).start().repeat(e.loop||1)}if(e.xAngle){var r=0,a={angle:0};n._rotateTween=new Ku.Tween(a).to({angle:e.xAngle},e.time).onUpdate((function(){n.rotateUp(a.angle-r),r=a.angle})).start().repeat(e.loop||1)}};t.distanceTo(this.target)>0?new Ku.Tween(this.target).to(t,500).onUpdate((function(){n.object.lookAt(n.target),n._dispatchEvent(Wf)})).onComplete((function(){a()})).start():a()}},{key:"stopRotateAround",value:function(){this._rotateTween&&this._rotateTween.stop()}},{key:"movePath",value:function(e){var t,n=[];e.path.forEach((function(e){n.push((new tt).copy(e))}));var i=new al(n);i.curveType="catmullrom",i.tension=0,i.getPoints(50);var r,a={t:0},o=new tt,s=new Ku.Tween(a).to({t:1},e.time).onUpdate((function(){var t=new tt;i.getPoint(a.t,t),o.copy(t),r&&i.getPoint(a.t+.01,o),r=a.t,e.object.lookAt(o.clone()),e.object.position.copy(t.clone())})).onComplete((function(){t.stopCameraFloor()})).repeat(e.loop||1).start();return t=new jf(e.object,this.object,s,this)}},{key:"_fitCamera",value:function(e){var t=new Jt;t.makeEmpty(),t.expandByObject(e);var n=1.5;this.viewer.containerRect.width<this.viewer.containerRect.height&&(n=2);var i=new tt,r=t.getSize(new tt),a=Math.max(r.x,r.y,r.z),o=this.object.fov*(Math.PI/180),s=Math.abs(a/(2*Math.tan(o/2)));return i.z=s*n,i.y=.5*s,i}},{key:"update",value:function(){this.enabled&&this._update()}},{key:"_dispatchEvent",value:function(e){this.dispatchEvent(e)}},{key:"switchToOrthoCamera",value:function(){var e=new El(this.viewer.containerRect.width/-2,this.viewer.containerRect.width/2,this.viewer.containerRect.height/2,this.viewer.containerRect.height/-2,this.viewer.camera.near,this.viewer.camera.far),t=xf.getSize(this.viewer.modelGroup),n=.7*Math.min(this.viewer.containerRect.width,this.viewer.containerRect.height)/Math.max(t.x,t.z);e.position.set(0,1,0),e.zoom=n,e.updateProjectionMatrix(),this.object=e,this._viewMode=Vf.TOP,this.enabled=!0,this.enableRotate=!1,this.update(),this.viewer.renderManager.setCamera(e),this.viewer.renderManager.render()}},{key:"switchToPerspectiveCamera",value:function(){this.object=this.viewer.camera,this._viewMode=Vf.NORMAL,this.enabled=!0,this.enableRotate=!0,this.update(),this.viewer.renderManager.setCamera(),this.viewer.renderManager.render()}},{key:"setViewMode",value:function(e){var t=this;if(e===Vf.NORMAL){if(this.object.isPerspectiveCamera)return;this.viewer.renderManager.setCamera(),this.switchToPerspectiveCamera(),this._prevView&&(new Ku.Tween(this.target).to(this._prevView.target,500).start(),new Ku.Tween(this.object.position).to(this._prevView.position,500).onUpdate((function(){t.object.lookAt(t.target)})).onComplete((function(){})).start(),this._prevView=null)}else if(e===Vf.TOP){if(this.object.isOrthographicCamera)return;this._prevView=this.getView(),this._prevView.position=(new tt).fromArray(this._prevView.position),this._prevView.target=(new tt).fromArray(this._prevView.target);var n=new tt;this.enabled=!1,this.target.copy(n);var i=this.computePosition(this.object.defaultPos,n,0,0),r=this._prevView.target.clone();new Ku.Tween(r).to(n,500).onUpdate((function(){t.object.lookAt(r)})).start(),new Ku.Tween(this.object.position).to(i,500).onComplete((function(){t.switchToOrthoCamera()})).start()}}},{key:"startAutoRotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;this.autoRotateSpeed=e,this.autoRotate=!0}},{key:"stopAutoRotate",value:function(){this.autoRotate=!1}},{key:"follow",value:function(e,t){var n=this;e||console.error("object"),this.followTask=function(){var i=n._fitCamera(e),r=new tt(0,0,0);t&&(i.add(t),r.add(t)),n.setPosition(e.position.x+i.x,e.position.y+i.y,e.position.z+i.z),n.setTarget(e.position.x+r.x,e.position.y+r.y,e.position.z+r.z)}.bind(this),this.viewer.addEventListener("update",this.followTask)}},{key:"stopFollow",value:function(){this.viewer.removeEventListener("update",this.followTask)}}]),n}(zf);Zf.VIEW_CHANGE="view_change";var Yf="#DDDDDD",Kf="#F2F5CE",Jf="#FFFFFF",qf=256,$f=[],ep=[],tp=[],np=[],ip=[],rp=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,s=arguments.length>3?arguments[3]:void 0;function A(){ep=[{name:cp.FRONT,map:lp("",{fontSize:qf,font:"Arial Narrow, sans-serif"})},{name:cp.RIGHT,map:lp("",{fontSize:qf,font:"Arial Narrow, sans-serif"})},{name:cp.BACK,map:lp("",{fontSize:qf,font:"Arial Narrow, sans-serif"})},{name:cp.LEFT,map:lp("",{fontSize:qf,font:"Arial Narrow, sans-serif"})},{name:cp.TOP,map:lp("",{fontSize:qf,font:"Arial Narrow, sans-serif"})},{name:cp.BOTTOM,map:lp("",{fontSize:qf,font:"Arial Narrow, sans-serif"})}],tp=[{name:cp.TOP_FRONT_RIGHT_CORNER},{name:cp.TOP_BACK_RIGHT_CORNER},{name:cp.TOP_BACK_LEFT_CORNER},{name:cp.TOP_FRONT_LEFT_CORNER},{name:cp.BOTTOM_BACK_RIGHT_CORNER},{name:cp.BOTTOM_FRONT_RIGHT_CORNER},{name:cp.BOTTOM_FRONT_LEFT_CORNER},{name:cp.BOTTOM_BACK_LEFT_CORNER}],np=[{name:cp.TOP_FRONT_EDGE},{name:cp.TOP_RIGHT_EDGE},{name:cp.TOP_BACK_EDGE},{name:cp.TOP_LEFT_EDGE},{name:cp.BOTTOM_BACK_EDGE},{name:cp.BOTTOM_RIGHT_EDGE},{name:cp.BOTTOM_FRONT_EDGE},{name:cp.BOTTOM_LEFT_EDGE}],ip=[{name:cp.FRONT_RIGHT_EDGE},{name:cp.BACK_RIGHT_EDGE},{name:cp.BACK_LEFT_EDGE},{name:cp.FRONT_LEFT_EDGE}],$f=[].concat(y(ep),y(tp),y(np),y(ip))}return r(this,n),A(),(i=t.call(this)).cubeSize=a,i.edgeSize=o,i._cube=new ap({size:i.cubeSize,edge:i.edgeSize,outline:!0,bgColor:Yf,hoverColor:Kf,outlineColor:Jf}),i._animation=null,i._handleMouseMove=i._handleMouseMove.bind(d(i)),i._handleMouseClick=i._handleMouseClick.bind(d(i)),i._controls=s,i._renderer=new Ka({antialias:!0,alpha:!0}),i._renderer.setPixelRatio(window.devicePixelRatio),i._renderer.setSize(150,150),i._renderer.setClearAlpha(0),i._renderer.domElement.style.position="absolute",i._renderer.domElement.style.right="0px",i._renderer.domElement.style.top="0px",e.appendChild(i._renderer.domElement),i.domElement=i._renderer.domElement,i._listen(),i._scene=new Rt,i._scene.add(i._cube),i._camera=new Di(50,1,.1,1e3),i._camera.position.set(0,0,70),i._camera.lookAt(0,0,0),i}return o(n,[{key:"_listen",value:function(){var e=this;this.domElement.addEventListener("mousemove",this._handleMouseMove),this.domElement.addEventListener("click",this._handleMouseClick),this._controls.addEventListener(Xu.CHANGE,(function(){var t=-1*(e._controls.spherical.phi-Math.PI/2),n=-e._controls.spherical.theta;e._cube.rotation.set(t,n,0)}))}},{key:"_handleMouseClick",value:function(e){var t=e.offsetX/e.target.clientWidth*2-1,n=-e.offsetY/e.target.clientHeight*2+1;this._checkSideTouch(t,n)}},{key:"_checkSideTouch",value:function(e,t){var n=new Pc;n.setFromCamera({x:e,y:t},this._camera);var i=n.intersectObjects(this._cube.children,!0);if(i.length){var r,a=C(i);try{for(a.s();!(r=a.n()).done;){var o=r.value.object;if(o.name){this._rotateTheCube(o.name),this._rotateTheCamera(o.name);break}}}catch(e){a.e(e)}finally{a.f()}}}},{key:"_rotateTheCamera",value:function(e){var t=new tt;switch(e){case cp.FRONT:t.set(0,0,1);break;case cp.BACK:t.set(0,0,-1);break;case cp.LEFT:t.set(-1,0,0);break;case cp.RIGHT:t.set(1,0,0);break;case cp.TOP:t.set(0,1,0);break;case cp.BOTTOM:t.set(0,-1,0);break;case cp.TOP_FRONT_EDGE:t.set(0,1,1);break;case cp.TOP_BACK_EDGE:t.set(0,1,-1);break;case cp.TOP_RIGHT_EDGE:t.set(1,1,0);break;case cp.TOP_LEFT_EDGE:t.set(-1,1,0);break;case cp.BOTTOM_FRONT_EDGE:t.set(0,-1,1);break;case cp.BOTTOM_BACK_EDGE:t.set(0,-1,-1);break;case cp.BOTTOM_RIGHT_EDGE:t.set(1,-1,0);break;case cp.BOTTOM_LEFT_EDGE:t.set(-1,-1,0);break;case cp.FRONT_RIGHT_EDGE:t.set(1,0,1);break;case cp.FRONT_LEFT_EDGE:t.set(-1,0,1);break;case cp.BACK_RIGHT_EDGE:t.set(1,0,-1);break;case cp.BACK_LEFT_EDGE:t.set(-1,0,-1);break;case cp.TOP_FRONT_RIGHT_CORNER:t.set(1,1,1);break;case cp.TOP_FRONT_LEFT_CORNER:t.set(-1,1,1);break;case cp.TOP_BACK_RIGHT_CORNER:t.set(1,1,-1);break;case cp.TOP_BACK_LEFT_CORNER:t.set(-1,1,-1);break;case cp.BOTTOM_FRONT_RIGHT_CORNER:t.set(1,-1,1);break;case cp.BOTTOM_FRONT_LEFT_CORNER:t.set(-1,-1,1);break;case cp.BOTTOM_BACK_RIGHT_CORNER:t.set(1,-1,-1);break;case cp.BOTTOM_BACK_LEFT_CORNER:t.set(-1,-1,-1)}t.clone();var n=this._controls.target.distanceTo(this._controls.object.position),i=t.normalize().multiplyScalar(n).add(this._controls.target);this._controls.camera.rotation.set(0,0,0),this._controls.flyTo({position:i,rotation:new tt})}},{key:"_rotateTheCube",value:function(e){switch(e){case cp.FRONT:this._setCubeAngles(0,0,0);break;case cp.RIGHT:this._setCubeAngles(0,-90,0);break;case cp.BACK:this._setCubeAngles(0,-180,0);break;case cp.LEFT:this._setCubeAngles(0,-270,0);break;case cp.TOP:this._setCubeAngles(90,0,0);break;case cp.BOTTOM:this._setCubeAngles(-90,0,0);break;case cp.TOP_FRONT_EDGE:this._setCubeAngles(45,0,0);break;case cp.TOP_RIGHT_EDGE:this._setCubeAngles(45,-90,0);break;case cp.TOP_BACK_EDGE:this._setCubeAngles(45,-180,0);break;case cp.TOP_LEFT_EDGE:this._setCubeAngles(45,-270,0);break;case cp.BOTTOM_FRONT_EDGE:this._setCubeAngles(-45,0,0);break;case cp.BOTTOM_RIGHT_EDGE:this._setCubeAngles(-45,-90,0);break;case cp.BOTTOM_BACK_EDGE:this._setCubeAngles(-45,-180,0);break;case cp.BOTTOM_LEFT_EDGE:this._setCubeAngles(-45,-270,0);break;case cp.FRONT_RIGHT_EDGE:this._setCubeAngles(0,-45,0);break;case cp.BACK_RIGHT_EDGE:this._setCubeAngles(0,-135,0);break;case cp.BACK_LEFT_EDGE:this._setCubeAngles(0,-225,0);break;case cp.FRONT_LEFT_EDGE:this._setCubeAngles(0,-315,0);break;case cp.TOP_FRONT_RIGHT_CORNER:this._setCubeAngles(45,-45,0);break;case cp.TOP_BACK_RIGHT_CORNER:this._setCubeAngles(45,-135,0);break;case cp.TOP_BACK_LEFT_CORNER:this._setCubeAngles(45,-225,0);break;case cp.TOP_FRONT_LEFT_CORNER:this._setCubeAngles(45,-315,0);break;case cp.BOTTOM_FRONT_RIGHT_CORNER:this._setCubeAngles(-45,-45,0);break;case cp.BOTTOM_BACK_RIGHT_CORNER:this._setCubeAngles(-45,-135,0);break;case cp.BOTTOM_BACK_LEFT_CORNER:this._setCubeAngles(-45,-225,0);break;case cp.BOTTOM_FRONT_LEFT_CORNER:this._setCubeAngles(-45,-315,0)}}},{key:"_setCubeAngles",value:function(e,t,n){var i=this._cube.rotation;this._animation={base:{x:i.x,y:i.y,z:i.z},delta:{x:Ap(i.x,e*op),y:Ap(i.y,t*op),z:Ap(i.z,n*op)},duration:500,time:Date.now()}}},{key:"_handleMouseMove",value:function(e){var t=e.offsetX/e.target.clientWidth*2-1,n=-e.offsetY/e.target.clientHeight*2+1;this._checkSideOver(t,n)}},{key:"_checkSideOver",value:function(e,t){var n=new Pc;n.setFromCamera({x:e,y:t},this._camera);var i=n.intersectObjects(this._cube.children,!0);if(this._cube.traverse((function(e){e.name&&e.material.color.setStyle(e.material.color0)})),i.length){var r,a=C(i);try{var o=function(){var e=r.value.object;if(e.name){$f.find((function(t){return t.name===e.name}));return e.parent.children.forEach((function(t){t.name===e.name&&(t.material.color0||(t.material.color0="#"+t.material.color.getHexString()),t.material.color.setStyle(Kf))})),"break"}};for(a.s();!(r=a.n()).done;){if("break"===o())break}}catch(e){a.e(e)}finally{a.f()}}}},{key:"update",value:function(){this._animate(),this._renderer.render(this._scene,this._camera)}},{key:"_animate",value:function(){if(this._animation){var e=Date.now(),t=this._animation,n=t.duration,i=t.time,r=Math.min((e-i)/n,1);this._animateCubeRotation(this._animation,r),1==r&&(this._animation=null),this.dispatchEvent({type:"angle-change",quaternion:this._cube.quaternion.clone()})}}},{key:"_animateCubeRotation",value:function(e,t){var n=e.base,i=e.delta,r=.5*(Math.sin((2*t-1)*Math.PI*.5)+1),a=-sp+n.x+i.x*r,o=-sp+n.y+i.y*r,s=-sp+n.z+i.z*r;this._cube.rotation.set(a%sp,o%sp,s%sp)}},{key:"setQuaternion",value:function(e){this._cube.setRotationFromQuaternion(e)}},{key:"getObject",value:function(){return this._cube}}]),n}(Xe),ap=function(e){A(n,e);var t=p(n);function n(e){var i,a=e.size,o=void 0===a?60:a,s=e.edge,A=void 0===s?5:s,l=e.outline,c=void 0===l||l,h=e.bgColor,u=void 0===h?"#CCCCCC":h,d=e.hoverColor,f=void 0===d?"#FFFFFF":d,p=e.outlineColor,m=void 0===p?"#999999":p,g=e.cornerColor,v=void 0===g?"#ffffff":g;return r(this,n),(i=t.call(this))._cubeSize=o,i._edgeSize=A,i._outline=c,i._bgColor=u,i._hoverColor=f,i._outlineColor=m,i._cornerColor=v,i._build(),i}return o(n,[{key:"_build",value:function(){var e,t=this._cubeSize-2*this._edgeSize,n=this._cubeSize/2,i=this._edgeSize,r=this._createCubeFaces(t,n),a=C(ep.entries());try{for(a.s();!(e=a.n()).done;){var o=v(e.value,2),s=o[0],A=o[1];r.children[s].name=A.name,r.children[s].material.color.setStyle(this._bgColor),r.children[s].material.map=A.map}}catch(e){a.e(e)}finally{a.f()}this.add(r);var l,c=[],h=C(tp.entries());try{for(h.s();!(l=h.n()).done;){var u=v(l.value,2),d=u[0],f=u[1],p=this._createCornerFaces(i,n,f.name,{color:this._bgColor});p.rotateOnAxis(new tt(0,1,0),d%4*90*op),c.push(p)}}catch(e){h.e(e)}finally{h.f()}var m=new Ha,g=new Ha;this.add(m.add.apply(m,y(c.slice(0,4)))),this.add(g.add.apply(g,y(c.slice(4))).rotateOnAxis(new tt(1,0,0),180*op));var w,x=[],b=C(np.entries());try{for(b.s();!(w=b.n()).done;){var M=v(w.value,2),B=M[0],I=M[1],E=this._createHorzEdgeFaces(t,i,n,I.name,{color:this._bgColor});E.rotateOnAxis(new tt(0,1,0),B%4*90*op),x.push(E)}}catch(e){b.e(e)}finally{b.f()}var S=new Ha,T=new Ha;this.add(S.add.apply(S,y(x.slice(0,4)))),this.add(T.add.apply(T,y(x.slice(4))).rotateOnAxis(new tt(1,0,0),180*op));var L,F=new Ha,_=C(ip.entries());try{for(_.s();!(L=_.n()).done;){var U=v(L.value,2),P=U[0],k=U[1],D=this._createVertEdgeFaces(i,t,n,k.name,{color:this._bgColor});D.rotateOnAxis(new tt(0,1,0),90*P*op),F.add(D)}}catch(e){_.e(e)}finally{_.f()}this.add(F),this._outline&&this.add(this._createCubeOutline(this._cubeSize))}},{key:"_createFace",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.axis,a=void 0===r?[0,1,0]:r,o=i.angle,s=void 0===o?0:o,A=i.name,l=void 0===A?"":A,c=i.matProps,h=void 0===c?{}:c;Array.isArray(e)||(e=[e,e]);var d=new kn(h),f=new Yi(e[0],e[1]),p=new xi(f,d);return p.name=l,p.rotateOnAxis(u(tt,y(a)),s*op),(n=p.position).set.apply(n,y(t)),p}},{key:"_createCubeFaces",value:function(e,t){var n=new Dt;return n.add(this._createFace(e,[0,0,t],{axis:[0,1,0],angle:0})),n.add(this._createFace(e,[t,0,0],{axis:[0,1,0],angle:90})),n.add(this._createFace(e,[0,0,-t],{axis:[0,1,0],angle:180})),n.add(this._createFace(e,[-t,0,0],{axis:[0,1,0],angle:270})),n.add(this._createFace(e,[0,t,0],{axis:[1,0,0],angle:-90})),n.add(this._createFace(e,[0,-t,0],{axis:[1,0,0],angle:90})),n}},{key:"_createCornerFaces",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=new Dt,a=t-e/2;return r.add(this._createFace(e,[a,a,t],{axis:[0,1,0],angle:0,matProps:i,name:n})),r.add(this._createFace(e,[t,a,a],{axis:[0,1,0],angle:90,matProps:i,name:n})),r.add(this._createFace(e,[a,t,a],{axis:[1,0,0],angle:-90,matProps:i,name:n})),r}},{key:"_createHorzEdgeFaces",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=new Dt,o=n-t/2;return a.add(this._createFace([e,t],[0,o,n],{axis:[0,1,0],angle:0,name:i,matProps:r})),a.add(this._createFace([e,t],[0,n,o],{axis:[1,0,0],angle:-90,name:i,matProps:r})),a}},{key:"_createVertEdgeFaces",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=new Dt,o=n-e/2;return a.add(this._createFace([e,t],[o,0,n],{axis:[0,1,0],angle:0,name:i,matProps:r})),a.add(this._createFace([e,t],[n,0,o],{axis:[0,1,0],angle:90,name:i,matProps:r})),a}},{key:"_createCubeOutline",value:function(e){return new Go(new iA(new Ti(e,e,e)),new Fo({color:this._outlineColor,linewidth:1}))}},{key:"_createCubeOutline2",value:function(e){return new Go(new iA(new Ti(e.x,e.y,e.z)),new Fo({color:this._outlineColor,linewidth:1}))}}]),n}(Dt),op=Math.PI/180,sp=2*Math.PI;function Ap(e,t){var n=t-e,i=n-sp,r=n+sp;return Math.abs(n)>Math.abs(i)?i:Math.abs(n)>Math.abs(r)?r:n}function lp(e,t){var n=t.font||"Helvetica",i=t.fontSize||30,r=t.width||512,a=t.height||512,o=t.color?t.bgColor.join(", "):"255, 255, 255, 1.0",s=t.color?t.color.join(", "):"0, 0, 0, 1.0",A=document.createElement("canvas");A.width=r,A.height=a;var l=A.getContext("2d");l.font="bold ".concat(i,"px ").concat(n),l.fillStyle="rgba(".concat(o,")"),l.fillRect(0,0,r,a);var c=l.measureText(e).width;l.fillStyle="rgba(".concat(s,")"),l.fillText(e,r/2-c/2,a/2+i/2-2);var h=new Ko(A);return h.minFilter=1008,h.needsUpdate=!0,h.anisotropy=2,h}var cp={TOP:1,FRONT:2,RIGHT:3,BACK:4,LEFT:5,BOTTOM:6,TOP_FRONT_EDGE:7,TOP_RIGHT_EDGE:8,TOP_BACK_EDGE:9,TOP_LEFT_EDGE:10,FRONT_RIGHT_EDGE:11,BACK_RIGHT_EDGE:12,BACK_LEFT_EDGE:13,FRONT_LEFT_EDGE:14,BOTTOM_FRONT_EDGE:15,BOTTOM_RIGHT_EDGE:16,BOTTOM_BACK_EDGE:17,BOTTOM_LEFT_EDGE:18,TOP_FRONT_RIGHT_CORNER:19,TOP_BACK_RIGHT_CORNER:20,TOP_BACK_LEFT_CORNER:21,TOP_FRONT_LEFT_CORNER:22,BOTTOM_FRONT_RIGHT_CORNER:23,BOTTOM_BACK_RIGHT_CORNER:24,BOTTOM_BACK_LEFT_CORNER:25,BOTTOM_FRONT_LEFT_CORNER:26},hp=function(){function e(t){r(this,e),this.viewer=t}return o(e,[{key:"init",value:function(){}},{key:"update",value:function(e){}},{key:"destory",value:function(){}}]),e}(),up=function(){function e(t,n){r(this,e),this.isHotSpotEntity=!0,this.options=n,this.name=t,this.init(),this.load()}return o(e,[{key:"init",value:function(){this.object=null,this.material=null,this.name=this.name,this.position=new tt(0,0,0),this.options.pos&&3===this.options.pos.length?this.localPosition=new tt(this.options.pos[0],this.options.pos[1],this.options.pos[2]):this.localPosition=new tt(0,0,0),this.scale=new tt(1,1,1),this.color=new At(1,1,1),this.width=0,this.height=0,this.hoverColor=null}},{key:"load",value:function(){this.object=new Dt}},{key:"setColor",value:function(e,t,n){this.color.x=e,this.color.y=t,this.color.z=n,this.material&&(this.material.needsUpdate=!0)}},{key:"setAlpha",value:function(e){this.color.w=e,this.material&&(this.material.needsUpdate=!0)}},{key:"onEnterHover",value:function(){this.hoverColor&&this.material&&(this.material.uniforms.color.value=this.hoverColor,this.material.needsUpdate=!0)}},{key:"onExitHover",value:function(){this.hoverColor&&this.material&&(this.material.uniforms.color.value=this.color,this.material.needsUpdate=!0)}}]),e}(),dp=function(e){A(n,e);var t=p(n);function n(e,i){return r(this,n),t.call(this,e,i)}return o(n,[{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.width=this.options.scale[0],this.height=this.options.scale[1],this.url=this.options.url,this.options.color&&4===this.options.color.length&&(this.color=new At(this.options.color[0],this.options.color[1],this.options.color[2],this.options.color[3])),this.options.hoverColor&&4===this.options.hoverColor.length&&(this.hoverColor=new At(this.options.hoverColor[0],this.options.hoverColor[1],this.options.hoverColor[2],this.options.hoverColor[3]))}},{key:"load",value:function(){this.createMesh(this.width,this.height,this.url)}},{key:"createMesh",value:function(e,t,n){var i=(new KA).load(n),r=e/2,a=t/2,o=[-r,-a,0,-r,a,0,r,a,0,r,-a,0],s=new ni;s.setAttribute("position",new Vn(o,3)),s.setAttribute("uv",new Vn([0,0,0,1,1,1,1,0],2)),s.setIndex([0,1,2,2,3,0]);var A={};A.mainTex={value:i},A.color={value:this.color},this.material=new Pi({uniforms:A,vertexShader:this.getVertShader(),fragmentShader:this.getFragmentShader(),transparent:!0,depthWrite:!1,side:2}),s.addGroup(0,6,0),this.object=new xi(s,[this.material]),this.object.isHotSpotEntity=!0,this.object.position.set(this.localPosition.x,this.localPosition.y,this.localPosition.z)}},{key:"getVertShader",value:function(){return"\n            varying vec2 vUv;\n            void main()\n            {\n                vUv = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        "}},{key:"getFragmentShader",value:function(){return"\n            uniform sampler2D mainTex;\n            uniform vec4 color;\n            varying vec2 vUv;\n            void main()\n            {\n                vec4 texColor = texture2D(mainTex,vUv.xy);\n                vec4 col = texColor * color;\n                gl_FragColor = col;\n            }\n        "}}]),n}(up),fp=function(e){A(n,e);var t=p(n);function n(e,i){return r(this,n),t.call(this,e,i)}return o(n,[{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.backMaterial=null,this.options.backColor&&4===this.options.backColor.length?this.backColor=new At(this.options.backColor[0],this.options.backColor[1],this.options.backColor[2],this.options.backColor[3]):this.backColor=new At(1,1,1,1),this.options.backHoverColor&&4===this.options.backHoverColor.length&&(this.backHoverColor=new At(this.options.backHoverColor[0],this.options.backHoverColor[1],this.options.backHoverColor[2],this.options.backHoverColor[3]))}},{key:"load",value:function(){g(l(n.prototype),"load",this).call(this);var e={};e.mainTex={value:this.material.uniforms.mainTex.value},e.color={value:this.backColor},this.backMaterial=new Pi({uniforms:e,vertexShader:this.getVertShader(),fragmentShader:this.getFragmentShader(),transparent:!0,depthWrite:!1,side:2,depthFunc:6}),this.object.geometry.addGroup(0,6,1),this.object.material.push(this.backMaterial)}},{key:"onEnterHover",value:function(){g(l(n.prototype),"onEnterHover",this).call(this),this.backHoverColor&&this.backMaterial&&(this.backMaterial.uniforms.color.value=this.backHoverColor,this.backMaterial.needsUpdate=!0)}},{key:"onExitHover",value:function(){g(l(n.prototype),"onExitHover",this).call(this),this.backHoverColor&&this.backMaterial&&(this.backMaterial.uniforms.color.value=this.backColor,this.backMaterial.needsUpdate=!0)}}]),n}(dp),pp=new(function(){function e(){r(this,e),this.fontDic=new Map}return o(e,[{key:"getFont",value:function(e,t){var n=this,i=this.fontDic.get(e);i?t(i):(new Xl).load(e,(function(i){return n.fontDic.set(e,i),t(i),i}))}}]),e}()),mp=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this,e,i)).texObj=null,a}return o(n,[{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.text="",this.font=null,this.length=0,this.options.size?this.fontSize=this.options.size:this.fontSize=1,this.options.color&&4===this.options.color.length&&(this.color=new At(this.options.color[0],this.options.color[1],this.options.color[2],this.options.color[3])),this.options.hoverColor&&4===this.options.hoverColor.length&&(this.hoverColor=new At(this.options.hoverColor[0],this.options.hoverColor[1],this.options.hoverColor[2],this.options.hoverColor[3]))}},{key:"load",value:function(){this.object=new Dt,this.object.name=this.name,this.refresh()}},{key:"setText",value:function(e){this.text=e+"",this.refresh()}},{key:"setFont",value:function(e){var t=this;this.fontPath=e,pp.getFont(this.fontPath,(function(e){t.font=e,t.refresh()}))}},{key:"setFontSize",value:function(e){this.fontSize=e,this.refresh()}},{key:"refresh",value:function(){if(this.font){var e=new tA(this.font.generateShapes(this.text,this.fontSize),void 0,!0);e.computeBoundingBox(),this.refreshGeometry(e),this.length=e.boundingBox.max.x-e.boundingBox.min.x,this.texObj?this.texObj.geometry=e:this.createTextMesh(e);var t=-this.length/2-e.boundingBox.min.x,n=-this.fontSize/2;this.texObj.position.set(t,n,this.fontSize/100),this.width=e.boundingBox.max.x-e.boundingBox.min.x,this.height=e.boundingBox.max.y-e.boundingBox.min.y}else this.setFont("https://sdk-localresource.laozicloud.com/helvetiker_regular.typeface.json")}},{key:"createTextMesh",value:function(e){var t={};t.color={value:this.color},this.material=new Pi({uniforms:t,vertexShader:this.getVertShader(),fragmentShader:this.getFragmentShader(),side:2,transparent:!0}),this.texObj=new xi(e,[this.material]),this.texObj.isHotSpotEntity=!0,this.object.add(this.texObj),this.object.position.set(this.localPosition.x,this.localPosition.y,this.localPosition.z)}},{key:"refreshGeometry",value:function(e){e.addGroup(0,e.index.count,0)}},{key:"getVertShader",value:function(){return"\n            varying vec2 vUv;\n            void main()\n            {\n                vUv = uv;\n                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        "}},{key:"getFragmentShader",value:function(){return"\n            uniform vec4 color;\n            void main()\n            {\n                gl_FragColor = color;\n                //gl_FragColor = vec4(1.0,0.0,0.0,1.0);\n            }\n        "}}]),n}(up),gp=function(e){A(n,e);var t=p(n);function n(e,i){return r(this,n),t.call(this,e,i)}return o(n,[{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.backMaterial=null,this.options.backColor&&4===this.options.backColor.length?this.backColor=new At(this.options.backColor[0],this.options.backColor[1],this.options.backColor[2],this.options.backColor[3]):this.backColor=new At(1,1,1,1),this.options.backHoverColor&&4===this.options.backHoverColor.length&&(this.backHoverColor=new At(this.options.backHoverColor[0],this.options.backHoverColor[1],this.options.backHoverColor[2],this.options.backHoverColor[3]))}},{key:"createTextMesh",value:function(e){g(l(n.prototype),"createTextMesh",this).call(this,e);var t={};t.color={value:this.backColor},this.backMaterial=new Pi({uniforms:t,vertexShader:this.getVertShader(),fragmentShader:this.getFragmentShader(),transparent:!0,depthWrite:!1,side:2,depthFunc:6}),this.texObj.material.push(this.backMaterial)}},{key:"refreshGeometry",value:function(e){g(l(n.prototype),"refreshGeometry",this).call(this,e),e.addGroup(0,e.index.count,1)}},{key:"onEnterHover",value:function(){g(l(n.prototype),"onEnterHover",this).call(this),this.backHoverColor&&this.backMaterial&&(this.backMaterial.uniforms.color.value=this.backHoverColor,this.backMaterial.needsUpdate=!0)}},{key:"onExitHover",value:function(){g(l(n.prototype),"onExitHover",this).call(this),this.backHoverColor&&this.backMaterial&&(this.backMaterial.uniforms.color.value=this.backColor,this.backMaterial.needsUpdate=!0)}}]),n}(mp),vp=new vt,yp=new tt,wp=new tt,xp=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).objects=[],e.click=null,e.viewMatrx=new vt,e.isAutoScale=!1,e.autoZ=0,e.ishover=!1,e.box=new Jt,e.hotRaycast=new Pc,e.depth=0,e.isBulletionBoard=!0,e}return o(n,[{key:"getObjectByName",value:function(e){for(var t=0;t<this.objects.length;t++)if(this.objects[t].name===e)return this.objects[t];return null}},{key:"setColor",value:function(e,t,n){for(var i=0;i<this.objects.length;i++)this.objects[i].setColor(e,t,n)}},{key:"setAlpha",value:function(e){for(var t=0;t<this.objects.length;t++)this.objects[t].setAlpha(e)}},{key:"load",value:function(e){(new VA).load(e,this.loadComplete.bind(this))}},{key:"loadComplete",value:function(e){this.setData(e)}},{key:"setData",value:function(e){var t=JSON.parse(e);t.data&&t.data.z&&(this.autoZ=t.data.z,this.isAutoScale=!0);var n=t.node;if(Array.isArray(n))for(var i=0;i<n.length;i++)this.parseJson(n[i],this);else this.parseJson(n,this);this.recalutionBound()}},{key:"parseJson",value:function(e,t){var n=this.createObject(e);if(t.add(n.object),n.object.updateMatrixWorld(!0),this.objects.push(n),e.child)for(var i=0;i<e.child.length;i++)this.parseJson(e.child[i],n)}},{key:"createObject",value:function(e){if("image"===e.type)return new dp(e.name,e);if("text"===e.type){var t=new mp(e.name,e);return t.setText(e.text),t}if("doubleImage"===e.type)return new fp(e.name,e);if("doubleText"===e.type){var n=new gp(e.name,e);return n.setText(e.text),n}}},{key:"recalutionBound",value:function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e],n=t.object.parent.localToWorld(t.object.position.clone()),i=this.worldToLocal(n),r=i.x-t.width/2,a=i.x+t.width/2,o=i.y-t.height/2,s=i.y+t.height/2;0===e?(this.box.min.set(r,o,0),this.box.max.set(a,s,0)):(this.box.min.x=Math.min(r,this.box.min.x),this.box.min.y=Math.min(o,this.box.min.y),this.box.max.x=Math.max(a,this.box.max.x),this.box.max.y=Math.max(s,this.box.max.y))}}},{key:"raycaster",value:function(e){if(this.viewer){if(!this.click)return!1;var t=xf.getDomMouse(e,this.viewer.containerRect);return vp.multiplyMatrices(this.viewer.camera.matrixWorldInverse,this.matrixWorld),vp.premultiply(this.viewer.camera.projectionMatrix),yp=this.box.min.clone().applyMatrix4(vp),wp=this.box.max.clone().applyMatrix4(vp),t.x>=yp.x&&t.x<=wp.x&&t.y>=yp.y&&t.y<=wp.y}}},{key:"onclick",value:function(){this.click&&this.click()}},{key:"onEnterHover",value:function(){this.ishover=!0;for(var e=0;e<this.objects.length;e++)this.objects[e].onEnterHover()}},{key:"onExitHover",value:function(){this.ishover=!1;for(var e=0;e<this.objects.length;e++)this.objects[e].onExitHover()}},{key:"update",value:function(e){if(this.viewer&&this.isAutoScale){this.viewMatrx.multiplyMatrices(this.viewer.camera.matrixWorldInverse,this.parent.matrixWorld);var t=this.position.clone().applyMatrix4(this.viewMatrx);this.depth=t.z;var n=-t.z/this.autoZ;this.scale.set(n,n,n)}}},{key:"updateMatrixWorld",value:function(e){if(this.isBulletionBoard){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){var t=this.matrixWorld.clone();if(null===this.parent)this.matrixWorld.copy(this.matrix);else{var i=this.position.clone().applyMatrix4(this.parent.matrixWorld);this.matrixWorld=this.matrix.clone().setPosition(i)}this.matrixWorldNeedsUpdate=!1,e=!0,this.matrixWorld.equals(t)||(this.viewer&&this.viewer.renderManager.render(),this.setDirty())}for(var r=this.children,a=0,o=r.length;a<o;a++)r[a].updateMatrixWorld(e)}else g(l(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"updateWorldMatrix",value:function(e,t){if(this.isBulletionBoard){this.viewer&&this.viewer.renderManager.render();var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent)this.matrixWorld.copy(this.matrix);else{var r=this.position.clone().applyMatrix4(this.parent.matrixWorld);this.matrixWorld=this.matrix.clone().setPosition(r)}if(!0===t)for(var a=this.children,o=0,s=a.length;o<s;o++)a[o].updateWorldMatrix(!1,!0)}else g(l(n.prototype),"updateWorldMatrix",this).call(this,e,t)}}]),n}(Dt),bp=new tt,Cp=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).isAmrtAlphaHotSpotEntity=!0,e.text="",e.texObj=null,e}return o(n,[{key:"loadComplete",value:function(e){g(l(n.prototype),"loadComplete",this).call(this,e),this.texObj=this.getObjectByName("text"),this.refreshText()}},{key:"setText",value:function(e){this.text=e,this.refreshText()}},{key:"refreshText",value:function(){this.texObj&&""!=this.text&&this.texObj.setText(this.text)}},{key:"setPosAndDir",value:function(e,t){e&&(this.position.copy(e),this.insertPosition=(new tt).copy(e),this.tempPostion=new tt,this.boxSize=new tt),t&&(this.insertDirection=(new tt).copy(t))}},{key:"update",value:function(e){if(g(l(n.prototype),"update",this).call(this,e),this.insertPosition&&this.insertDirection)if(NaN==this.box.min.x||NaN==this.box.min.y||NaN==this.box.min.z||Math.abs(this.box.min.x)==1/0||Math.abs(this.box.min.y)==1/0||Math.abs(this.box.min.z)==1/0)this.recalutionBound();else{this.tempPostion.copy(this.insertPosition),this.parent.getWorldScale(bp);var t=this.box.getSize(this.boxSize).x/2*Math.abs(this.scale.x/bp.x),i=this.tempPostion.addScaledVector(this.insertDirection,t);this.position.copy(i)}}}]),n}(xp),Mp=function(e){A(n,e);var t=p(n);function n(){return r(this,n),t.apply(this,arguments)}return n}(Xe),Bp={click:"click",mousemove:"mousemove"},Ip=function(e){A(n,e);var t=p(n);function n(e){return r(this,n),t.call(this,e)}return o(n,[{key:"init",value:function(){var e=this;this.event=new Mp,this.startPoint=new Je,this.viewer.domElement.addEventListener(Xu.START,(function(t){t.constructor===MouseEvent&&0!==t.button||(t=xf.getTouchByEvent(t),e.startPoint.set(t.clientX,t.clientY))})),this.viewer.domElement.addEventListener(Xu.END,(function(t){t.constructor===MouseEvent&&0!==t.button||(t=xf.getTouchByEvent(t),e.startPoint.distanceTo(new Je(t.clientX,t.clientY))<5&&e.event.dispatchEvent({type:Bp.click,point:t}))})),xf.isMobile||this.viewer.domElement.addEventListener("mousemove",(function(t){t=xf.getTouchByEvent(t),e.event.dispatchEvent({type:Bp.mousemove,point:t})}))}},{key:"addEventListener",value:function(e,t){this.event.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.event.removeEventListener(e,t)}}]),n}(hp);new vt,new vt;var Ep=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).viewer=e,i.stop=!1,i}return o(n,[{key:"init",value:function(){var e=this;this.hotspot=[],this.viewer.moduleManager.event.addEventListener(Bp.click,(function(t){for(var n=0;n<e.hotspot.length;n++){if(e.hotspot[n].raycaster(t.point))return void e.hotspot[n].onclick()}})),this.viewer.moduleManager.event.addEventListener(Bp.mousemove,(function(t){for(var n=!1,i=0;i<e.hotspot.length;i++){var r=e.hotspot[i].raycaster(t.point);r&&!n?(e.hotspot[i].ishover||e.hotspot[i].onEnterHover(),n=!0):r&&!n||!e.hotspot[i].ishover||e.hotspot[i].onExitHover()}}))}},{key:"addDefaultHotSpot",value:function(e,t){var n=new Cp;return n.load(t||"https://sdk-localresource.laozicloud.com/alphaHotspot.bin"),e?e.add(n):this.viewer.scene.add(n),this.hotspot.push(n),n}},{key:"addHotSpot",value:function(e,t){var n=new xp;return-1!=e.indexOf("http")?n.load(e):n.setData(e),t?t.add(n):this.viewer.scene.add(n),this.hotspot.push(n),n}},{key:"removeHotSpot",value:function(e){e.parent.remove(e);for(var t=0;t<this.hotspot.length;t++)if(this.hotspot[t]==e)return void this.hotspot.splice(t,1)}},{key:"update",value:function(e){if(!this.stop){for(var t=this.viewer.camera,n=0;n<this.hotspot.length;n++)this.hotspot[n].parent&&this.hotspot[n].quaternion.set(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w),this.hotspot[n].update(e);this.hotspot.sort((function(e,t){return t.depth-e.depth}))}}}]),n}(hp),Sp=function(){function e(t){r(this,e),this.viewer=t,this.modules=[],this.event=new Ip(t),this.modules.push(this.event),this.hotspot=new Ep(t),this.modules.push(this.hotspot)}return o(e,[{key:"init",value:function(){for(var e=0;e<this.modules.length;e++)this.modules[e].init()}},{key:"update",value:function(e){for(var t=0;t<this.modules.length;t++)this.modules[t].update(e)}},{key:"destory",value:function(){for(var e=0;e<this.modules.length;e++)this.modules[e].destory()}}]),e}(),Tp=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,n),(i=t.call(this)).containerRect=null,i.camera=null,i.renderManager=null,i.sceneManager=null,i.disposed=!1,i.composer=null,i.moduleManager=null,i.controls=null,i.onControlsChange=null,i._options=a,e.constructor===String&&(e=document.querySelector("#"+e)||document.querySelector("."+e)),i.container=e||document.body,!a.nv){if(nu.init(a),a.offline)return f(i);if(void 0!==a.offlinekey)nu.offlineValidation((function(e){if(!e)throw new Error("")}));else{var o=nu.checkDevloper();o?nu.token=o:i.dispose()}}return Object.defineProperty(window,"__viewer",{writable:!0,value:d(i)}),i}return o(n,[{key:"renderer",get:function(){return this.renderManager.defaultRenderer}},{key:"render",get:function(){return this.renderManager.render.bind(this.renderManager)}},{key:"domElement",get:function(){return this.renderManager.domElement}},{key:"scene",get:function(){return this.sceneManager.scene}},{key:"root",get:function(){return this.sceneManager.root}},{key:"modelGroup",get:function(){return this.sceneManager.modelGroup}},{key:"setSkyBox",get:function(){return this.sceneManager.setSkyBox.bind(this.sceneManager)}},{key:"setBackground",get:function(){return this.sceneManager.setBackground.bind(this.sceneManager)}},{key:"clearBackground",get:function(){return this.sceneManager.clearBackground.bind(this.sceneManager)}},{key:"loadSceneData",get:function(){return this.sceneManager.loadSceneData.bind(this.sceneManager)}},{key:"saveSceneData",get:function(){return this.sceneManager.saveSceneData.bind(this.sceneManager)}},{key:"fitCamera",get:function(){return this.sceneManager.fitCamera.bind(this.sceneManager)}},{key:"add",get:function(){return this.modelManager.add.bind(this.modelManager)}},{key:"remove",get:function(){return this.modelManager.remove.bind(this.modelManager)}},{key:"loadModel",get:function(){return this.modelManager.loadModel.bind(this.modelManager)}},{key:"validate",value:function(){return new Promise((function(e,t){nu.checkDevloper().then((function(n){n&&6e4===n.resp_code?(nu.token=n.datas,e()):t(",")})).catch((function(e){t(",")}))}))}},{key:"initialize",value:function(e){var t=this;this.containerRect=this.container.getBoundingClientRect(),this.camera=new Di(50,this.containerRect.width/this.containerRect.height,1,5e3),this.camera.position.set(0,0,1),this.renderManager=qu.create(this,e),this.renderManager.setCamera(this.camera),this.moduleManager=new Sp(this),this.moduleManager.init(),this.renderManager.moduleManager=this.moduleManager,this.sceneManager=Rf.create(this),this.modelManager=Lf.create(this),this.renderManager.scene=this.scene,this.renderManager.camera=this.camera,this.renderManager.defaultCamera=this.camera,this.sceneManager.camera=this.camera,this.composer=new ju(this),e.isMap?(this.renderer.domElement.style.pointerEvents="none",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top=0,this.renderer.domElement.style.left=0,this.renderManager.setLoop(!1)):(this.renderManager.render(!0),this._initControls(),window.addEventListener("resize",(function(){t.resize()}),!1),this.container.addEventListener("resize",(function(){t.resize()}),!1)),this._proxyEvent()}},{key:"_initControls",value:function(){var e=this;this.controls=new Zf(this),this.controls.screenSpacePanning=!0,this.controls.addEventListener(Xu.CHANGE,(function(){e.sceneManager.lightFollow&&(e.sceneManager.directLight.position.copy(e.camera.position),e.sceneManager.updateShadowMaterial()),e.onControlsChange&&e.onControlsChange()})),this.controls.addEventListener(Zf.VIEW_CHANGE,(function(t){e.controls.setViewMode(t.data)})),this.camera.defaultPos=this.camera.position.clone(),this.renderManager.addAfterRenderTask(this.controls.update.bind(this.controls)),this.viewCubeControls=new rp(this.container,30,5,this.controls),this.viewCubeControlsUpdate=this.viewCubeControls.update.bind(this.viewCubeControls),this.hideViewCube()}},{key:"_proxyEvent",value:function(){var e=this;this.renderManager.addEventListener(Xu.UPDATE,(function(){e.controls.update(),e.dispatchEvent(Xu.UPDATE)})),this.modelManager.addEventListener(Xu.MODEL_UPDATE,(function(){e.dispatchEvent(Xu.MODEL_UPDATE)}))}},{key:"resize",value:function(){this.containerRect=this.container.getBoundingClientRect(),this.camera.aspect=this.containerRect.width/this.containerRect.height,this.camera.updateProjectionMatrix(),this.domElement.style.width=this.containerRect.width+"px",this.domElement.style.height=this.containerRect.height+"px",this.renderManager.resize()}},{key:"dispatchEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;g(l(n.prototype),"dispatchEvent",this).call(this,{type:e,data:t})}},{key:"getComponentInfo",value:function(e,t){e.traverseAncestors((function(n){n.isBIM&&n.getComponentInfo(e,t)}))}},{key:"showViewCube",value:function(){this.viewCubeControls.domElement.style.display="block",this.renderManager.addAfterRenderTask(this.viewCubeControlsUpdate)}},{key:"hideViewCube",value:function(){this.viewCubeControls.domElement.style.display="none",this.renderManager.removeAfterRenderTask(this.viewCubeControlsUpdate)}},{key:"dispose",value:function(){this.sceneManager.dispose(),this.renderManager.dispose(),this.controls.dispose(),this.composer.dispose(),this.disposed=!0,this.container.innerHTML=""}}]),n}(Xe);function Lp(e,t,n,i){if(e instanceof ki){console.warn("DragControls: Constructor now expects ( objects, camera, domElement )");var r=e;e=t,t=r}var a=new dn,o=new Pc,s=new tt,A=new tt,l=new tt,c=new vt,h=null,u=this;function d(){n.addEventListener("mousemove",p,!1),n.addEventListener("mousedown",m,!1),n.addEventListener("mouseup",g,!1),n.addEventListener("mouseleave",g,!1),n.addEventListener("touchmove",p,!1),n.addEventListener("touchstart",m,!1),n.addEventListener("touchend",g,!1)}function f(){n.removeEventListener("mousemove",p,!1),n.removeEventListener("mousedown",m,!1),n.removeEventListener("mouseup",g,!1),n.removeEventListener("mouseleave",g,!1),n.removeEventListener("touchmove",p,!1),n.removeEventListener("touchstart",m,!1),n.removeEventListener("touchend",g,!1)}function p(e){if(function(e){e=xf.getTouchByEvent(e);var i=xf.getDomMouse(e,n);o.setFromCamera(i,t)}(e),h&&u.enabled)return o.ray.intersectPlane(a,A)&&h.position.copy(A.sub(s).applyMatrix4(c)),void u.dispatchEvent({type:"drag",object:h})}function m(e){!function(e,i){e.length>0&&(h=e[0].object,r=h,d=l.setFromMatrixPosition(r.matrixWorld),a.setFromNormalAndCoplanarPoint(t.getWorldDirection(a.normal),d),o.ray.intersectPlane(a,A)&&(c.getInverse(h.parent.matrixWorld),s.copy(A).sub(l.setFromMatrixPosition(h.matrixWorld))),n.style.cursor="move",u.dispatchEvent({type:"dragstart",object:h}));var r,d}(i.intersectModels(e))}function g(e){e.preventDefault(),u.dispatchEvent({type:"dragend",object:h}),h=null,n.style.cursor="auto"}d(),this.enabled=!0,this.activate=d,this.deactivate=f,this.dispose=function(){f()}}Lp.prototype=Object.create(Xe.prototype),Lp.prototype.constructor=Lp;var Fp,_p,Up,Pp,kp,Dp=new tt,Rp=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).viewer=e,i._enabled=!1,i._enableDrag=!1,i._startPoint=new Je,i._selected=null,i.selectedColor="#b2ac00",i.objects=[],i.dragControls=new Lp(i.viewer.modelGroup,i.viewer.camera,i.viewer.domElement,i.viewer),i.dragControls.deactivate(),i.dragControls.enabled=!1,i.onChange=function(){},i._initEvents(),i}return o(n,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this._initData()}},{key:"enableDrag",get:function(){return this._enableDrag},set:function(e){this._enableDrag=e,this.dragControls.enabled=e,this._enableDrag?this.dragControls.activate():this.dragControls.deactivate()}},{key:"_initEvents",value:function(){var e=this;this.viewer.domElement.addEventListener(Xu.START,(function(t){t.constructor===MouseEvent&&0!==t.button||(t=xf.getTouchByEvent(t),e._startPoint.set(t.clientX,t.clientY))})),this.viewer.domElement.addEventListener(Xu.END,(function(t){if(t.constructor!==MouseEvent||0===t.button){t=xf.getTouchByEvent(t);var n=e._startPoint.distanceTo(new Je(t.clientX,t.clientY));e.enabled&&!e._enableDrag&&n<5&&e.viewer.intersectModels(t,e._rayCasterHandler,e)}})),this.dragControls.addEventListener("dragstart",(function(t){e.enableDrag&&(e.selected=t.object,e.viewer.controls.enabled=!1,Dp.copy(e.selected.position))})),this.dragControls.addEventListener("dragend",(function(t){e.enableDrag&&(e.viewer.controls.enabled=!0,Dp.equals(e.selected.position)||(e.onChange(),Dp.copy(e.selected.position)))})),this.viewer.addEventListener(Xu.MODEL_UPDATE,(function(){e._enabled&&e._initData()}))}},{key:"_rayCasterHandler",value:function(e){e.length>0&&this.selected!=e[0].object?(this.selected=e[0].object,this.dispatchEvent(Xu.CHANGE,this.selected)):0===e.length&&this.selected&&(this.selected=null,this.dispatchEvent(Xu.CHANGE,this.selected))}},{key:"selected",get:function(){return this._selected},set:function(e){var t=this;if(this.selected&&(this.selected.material=this.selected.material0,this.selected.transparent&&(this.selected.material=this._cloneMate(this.selected.material),this.transparent(this.selected))),this._selected=e,!this._selected)return this.viewer.composer.enableOutline=!1,this.viewer.composer.outline.pass.edgeThickness=2,void(this.viewer.composer.outline.pass.edgeStrength=6.5);(this.viewer.composer.enableOutline||(this.viewer.composer.enableOutline=!0,this.viewer.composer.outline.pass.edgeThickness=1,this.viewer.composer.outline.pass.edgeStrength=4.5),this._selected.isMesh||this._selected.intanceObject)&&(this._selected.material=this._cloneMate(this._selected.material),(Array.isArray(this._selected.material)?this._selected.material:[this._selected.material]).forEach((function(e){e.isAMRTBasicMaterial&&e.color.setStyle(t.selectedColor)})),this._selected.transparent&&this.transparent(this._selected),this.viewer.composer.outline.pass.selectedObjects=[this._selected])}},{key:"unSelected",value:function(e){e.isMesh&&(e.material=e.material0)}},{key:"toggleDisplay",value:function(){this.objects.forEach((function(e){e.visible=!e.visible})),this.viewer.renderManager.render(),this.onChange()}},{key:"hide",value:function(){this.selected&&(this.selected&&(this.selected.visible=!1),this.onChange())}},{key:"showAlone",value:function(){this.selected&&(this.objects.forEach((function(e){e.visible=!1})),this.selected.visible=!0,this.onChange())}},{key:"showAll",value:function(){this.objects.forEach((function(e){e.visible=!0})),this.onChange()}},{key:"transparent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selected;if(e){e.transparent=!0;var t=Array.isArray(e.material)?e.material:[e.material];t.forEach((function(e){e.isAMRTBasicMaterial&&(e.opacity0=void 0!==e.opacity0?e.opacity0:e.opacity,e.transparent0=void 0!==e.transparent0?e.transparent0:e.transparent,e.opacity=.15,e.transparent=!0)}))}this.onChange()}},{key:"unTransparent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selected;e&&(Array.isArray(e.material)?e.material.forEach((function(e){e.isAMRTBasicMaterial&&(e.opacity=e.opacity0,e.transparent=e.transparent0)})):(e.material.opacity=void 0!==e.material.opacity0?e.material.opacity0:1,e.material.transparent=e.material.transparent0),e.transparent=!1),this.onChange()}},{key:"translucenceOthers",value:function(e){var t=this;this.objects.forEach((function(n){n!==e&&n.visible&&t.transparent(n)}))}},{key:"restore",value:function(){var e=this;this.objects.forEach((function(t){e.restoreObject(t)})),this.onChange(),this.selected=null}},{key:"restoreObject",value:function(e){e&&(e.visible||(e.visible=!0),this.restoreMaterial(e),this.restorePosition(e),e.transparent=e.transparent0,e==this.selected&&(this.selected=null))}},{key:"restoreMaterial",value:function(e){e&&(e.material=e.material0,(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.isAMRTBasicMaterial&&(e.opacity=e.opacity0,e.transparent=e.transparent0)})),this.viewer.renderManager.render())}},{key:"restorePosition",value:function(e){e&&e.position.copy(e.position0)}},{key:"dispose",value:function(){this.dragControls.enabled=!1,this.dragControls.deactivate()}},{key:"_initData",value:function(){var e=this;this.objects=[],this.viewer.modelGroup.traverse((function(t){t.isMesh&&(e.objects.push(t),t.material0||(t.position0=t.position.clone(),(Array.isArray(t.material)?t.material:[t.material]).forEach((function(e){e.isAMRTBasicMaterial&&(e.opacity0=e.opacity,e.transparent0=e.transparent)})),t.material0=t.material))}))}},{key:"_cloneMate",value:function(e){var t;return Array.isArray(e)?(t=[],e.forEach((function(e){if(e.isAMRTBasicMaterial){var n=e.clone();n.opacity0=e.opacity0,n.transparent0=e.transparent0,t.push(n)}else t.push(e)}))):((t=e.clone()).opacity0=e.opacity0,t.transparent0=e.transparent0),t}}]),n}(Ad),Op=function(){var e=new zi,t=new tt,n=new tt,i=new tt,r=new tt,a=new tt,o=new tt,s=new tt,A=new tt,l=new tt,c=new tt,h=new tt,u=new tt,d=new tt,f=new tt;function p(e,t,n){this.camera=e,this.scene=t,this.startPoint=new tt,this.endPoint=new tt,this.collection=[],this.deep=n||Number.MAX_VALUE}return p.prototype.select=function(t,n){return this.startPoint=t||this.startPoint,this.endPoint=n||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(e,this.scene),this.collection},p.prototype.updateFrustum=function(t,p){if(t=t||this.startPoint,p=p||this.endPoint,t.x===p.x&&(p.x+=Number.EPSILON),t.y===p.y&&(p.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)n.copy(t),n.x=Math.min(t.x,p.x),n.y=Math.max(t.y,p.y),p.x=Math.max(t.x,p.x),p.y=Math.min(t.y,p.y),i.setFromMatrixPosition(this.camera.matrixWorld),r.copy(n),a.set(p.x,n.y,0),o.copy(p),s.set(n.x,p.y,0),r.unproject(this.camera),a.unproject(this.camera),o.unproject(this.camera),s.unproject(this.camera),u.copy(r).sub(i),d.copy(a).sub(i),f.copy(o).sub(i),u.normalize(),d.normalize(),f.normalize(),u.multiplyScalar(this.deep),d.multiplyScalar(this.deep),f.multiplyScalar(this.deep),u.add(i),d.add(i),f.add(i),(m=e.planes)[0].setFromCoplanarPoints(i,r,a),m[1].setFromCoplanarPoints(i,a,o),m[2].setFromCoplanarPoints(o,s,i),m[3].setFromCoplanarPoints(s,r,i),m[4].setFromCoplanarPoints(a,o,s),m[5].setFromCoplanarPoints(f,d,u),m[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){var m,g=Math.min(t.x,p.x),v=Math.max(t.y,p.y),y=Math.max(t.x,p.x),w=Math.min(t.y,p.y);r.set(g,v,-1),a.set(y,v,-1),o.set(y,w,-1),s.set(g,w,-1),A.set(g,v,1),l.set(y,v,1),c.set(y,w,1),h.set(g,w,1),r.unproject(this.camera),a.unproject(this.camera),o.unproject(this.camera),s.unproject(this.camera),A.unproject(this.camera),l.unproject(this.camera),c.unproject(this.camera),h.unproject(this.camera),(m=e.planes)[0].setFromCoplanarPoints(r,A,l),m[1].setFromCoplanarPoints(a,l,c),m[2].setFromCoplanarPoints(c,h,s),m[3].setFromCoplanarPoints(h,A,r),m[4].setFromCoplanarPoints(a,o,s),m[5].setFromCoplanarPoints(c,l,A),m[5].normal.multiplyScalar(-1)}else console.error("SelectionBox: Unsupported camera type.")},p.prototype.searchChildInFrustum=function(e,n){if("_shadow.mesh"!=n.name&&((n.isMesh||n.isLine||n.isPoints)&&void 0!==n.material&&(null===n.geometry.boundingSphere&&n.geometry.computeBoundingSphere(),t.copy(n.geometry.boundingSphere.center),t.applyMatrix4(n.matrixWorld),e.containsPoint(t)&&this.collection.push(n)),n.children.length>0))for(var i=0;i<n.children.length;i++)this.searchChildInFrustum(e,n.children[i])},p}(),Np=function(){function e(e,t,n){this.enabled=!1,this.element=document.createElement("div"),this.element.classList.add(n),this.element.style.pointerEvents="none",this.renderer=t,this.startPoint=new Je,this.pointTopLeft=new Je,this.pointBottomRight=new Je,this.isDown=!1,this.renderer.domElement.addEventListener("pointerdown",function(e){this.enabled&&(this.isDown=!0,this.onSelectStart(e))}.bind(this)),this.renderer.domElement.addEventListener("pointermove",function(e){this.enabled&&this.isDown&&this.onSelectMove(e)}.bind(this)),this.renderer.domElement.addEventListener("pointerup",function(e){this.enabled&&(this.isDown=!1,this.onSelectOver(e))}.bind(this))}return e.prototype.onSelectStart=function(e){this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY},e.prototype.onSelectMove=function(e){this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"},e.prototype.onSelectOver=function(){this.element.parentElement.removeChild(this.element)},e}(),Gp="",Qp=!1,Hp=[],zp=[],Vp=[],jp=[],Wp={},Xp=!1,Zp=!1,Yp=new vA({color:16711680,transparent:!0,opacity:.5}),Kp=function(e){A(i,e);var t=p(i);function i(e,n){var a;r(this,i),(a=t.call(this)).selected=null,a.selectedMaterial=null,a.selectable=!0,a.boxSelected=[],a.onChange=function(){},a.onError=function(){},Fp=e,a.mapLoader=new If(Fp);var o=new Je,s=Fp.domElement,A=s.clientWidth,l=s.clientHeight;return Fp.domElement.addEventListener(Xu.START,(function(e){Qp&&(e.constructor===MouseEvent&&0!==e.button||(e=xf.getTouchByEvent(e),Xp?(a.selectedMaterial&&a._onChange(null),a.boxSelected=[],Vp.map((function(e){return e.material=e.material_0})),_p.startPoint.set(e.clientX/A*2-1,-e.clientY/l*2+1,.5)):o.set(e.clientX,e.clientY)))})),Fp.domElement.addEventListener(Xu.MOVE,(function(e){if(Qp&&Xp&&Up.isDown){for(var t=0;t<_p.collection.length;t++){var n=_p.collection[t];n.material=n.material_0}_p.endPoint.set(e.clientX/A*2-1,-e.clientY/l*2+1,.5),a.boxSelected.length=0;for(var i=_p.select(),r=0;r<i.length;r++)i[r].material=i[r].material.map((function(e){return e.isAMRTShadowMaterial?e:Yp})),a.boxSelected.push(i[r])}})),Fp.domElement.addEventListener(Xu.END,(function(e){if(Qp&&(e.constructor!==MouseEvent||0===e.button))if(e=xf.getTouchByEvent(e),Xp){_p.endPoint.set(e.clientX/A*2-1,-e.clientY/l*2+1,.5);var t=_p.select();a.boxSelected.length=0;for(var n=0;n<t.length;n++)t[n].material=t[n].material.map((function(e){return e.isAMRTShadowMaterial?e:Yp})),a.boxSelected.push(t[n])}else{if(!a.selectable)return;var i=o.distanceTo(new Je(e.clientX,e.clientY));!a._enableDrag&&i<5&&(a.enableMutilpeSelection||a.boxSelected.length>0&&(a.boxSelected.length=0,a.clearBoxSelected()),Fp.intersectModels(e,(function(e){if(a.enableMutilpeSelection){a._onChange(null);var t=e[0]?e[0].object:null;t&&(a.boxSelected.includes(t)?(t.material=t.material_0,a.boxSelected.remove(t)):(t.material=t.material.map((function(e){return e.isAMRTShadowMaterial?e:Yp})),a.boxSelected.push(t)))}else a._onChange(e.length>0?e[0]:null)}),d(a)))}})),n&&n.isModel&&a.setTarget(n),a}return o(i,[{key:"materials",get:function(){return zp}},{key:"mode",get:function(){return Gp},set:function(e){Gp=e,this.selectedMaterial=null,this.selected=null,Fp.composer.outline.pass.selectedObjects=jp=[]}},{key:"enabled",get:function(){return Qp},set:function(e){Qp!=e&&(e?(Fp.composer.enableOutline=!0,Fp.composer.outline.pass.edgeGlow=0,Fp.composer.outline.pass.edgeThickness=1,Fp.composer.outline.pass.edgeStrength=4.5):(Fp.composer.enableOutline=!1,Fp.composer.outline.pass.edgeGlow=1,Fp.composer.outline.pass.edgeThickness=2,Fp.composer.outline.pass.edgeStrength=6.5,this.selected=null,this.selectedMaterial=null,Vp=[],zp=[],jp=[],Wp={}),Qp=e)}},{key:"enableBoxSelection",get:function(){return Xp},set:function(e){e!==Xp&&(e?(_p||(_p=new Op(Fp.camera,Fp.modelGroup)),Up||(Up=new Np(_p,Fp.renderer,"selectBox")),this.selectionBox=_p,Up.enabled=!0,Up.element.style.display="block",Fp.controls.enabled=!1):(Up.enabled=!1,Fp.controls.enabled=!0,Up.element.style.display="none"),Xp=e)}},{key:"enableMutilpeSelection",get:function(){return Zp},set:function(e){e!==Zp&&(Zp=e)}},{key:"clearBoxSelected",value:function(){Vp.map((function(e){e.material[0]===Yp&&e.material_0&&(e.material=e.material_0)}))}},{key:"_onChange",value:function(e){var t=e?e.object:null;if(t){var n,i=e.faceIndex;t.geometry.groups.forEach((function(e){i>=e.start&&i<e.start+e.count&&!t.material[e.materialIndex].isAMRTShadowMaterial&&(n=t.material[e.materialIndex])})),this.setOutlineObjects(t,n)}else this.clearSelected();this.dispatchEvent(Xu.CHANGE,this.selectedMaterial),this.onChange&&this.onChange(this.selectedMaterial)}},{key:"clearSelected",value:function(){Fp.composer.outline.pass.selectedObjects=jp=[],this.selectedMaterial=null,this.selected=null,zp.map((function(e){e.skinning_0&&(e.skinning=!0,e.needsUpdate=!0)}))}},{key:"setTarget",value:function(e){this.enabled=!1,e&&e.isModel&&(this.model=e,e.traverse((function(e){e.isMesh&&((Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.skinning_0=Boolean(e.skinning),zp.indexOf(e)<0&&e.isAMRTBasicMaterial&&zp.push(e)})),e.material_0=e.material,Vp.push(e))})),this.enabled=!0,void 0===this.model.materialRecords&&(this.model.materialRecords=[])),this.getAllMaterials()}},{key:"getAllMaterials",value:function(){return zp=this.model.materials,Hp.map((function(e){zp.includes(e)||zp.push(e)})),zp.filter((function(e){return void 0===e.re}))}},{key:"setSelectedMaterial",value:function(e){var t=this;e.isAMRTBasicMaterial&&(Fp.composer.outline.pass.selectedObjects=jp=[],void 0!==e.re?this.selectedMaterial=zp.find((function(t){return t.ID===e.re})):this.selectedMaterial=e,Vp.forEach((function(e){var n=Array.isArray(e.material)?e.material:[e.material],i=!1;n.forEach((function(e){t.selectedMaterial.id!==e.id&&t.selectedMaterial.ID!==e.re||(i=!0)})),i&&jp.push(e)})),this.selected=jp[0],Fp.renderManager.render())}},{key:"setSelectedMesh",value:function(e){e.isMesh&&(Fp.composer.outline.pass.selectedObjects=jp=[e],this.selected=e,this.selectedMaterial=e.material[0],Fp.renderManager.render())}},{key:"setOutlineObjects",value:function(e,t){"MESH"==this.mode.toLocaleUpperCase()?(this.setSelectedMesh(e),this.selectedMaterial=t):(this.setSelectedMaterial(t),this.selected=e)}},{key:"cloneMaterial",value:function(e){if(e||(e=this.selectedMaterial),!e)return console.error("!");var t=e.clone();return t.sname=this._generateMaterialName(e.sname||e.name.toString()),t.ID=t.name=this._generateMaterialID(),Hp.push(t),this.getAllMaterials(),t}},{key:"createMaterial",value:function(e){if(this.getAllMaterials(),zp.find((function(t){return t.name===e})))return console.error(":  ".concat(e," !"));var t=new xA;return t.sname=e,t.ID=t.name=this._generateMaterialID(),Hp.push(t),this.getAllMaterials(),t}},{key:"_generateMaterialName",value:function(e){this.getAllMaterials();for(var t=e.split("-")[0],n=1;i(t+"-"+n);)n++;return t+"-"+n;function i(e){return zp.find((function(t){return t.sname===e}))}}},{key:"_generateMaterialID",value:function(){var e=zp.map((function(e){return e.ID}));return Math.max.apply(Math,y(e))+Hp.length+1}},{key:"applyMaterial",value:function(e,t){var n=this;if(("Mesh"===e.type||"SkinnedMesh"===e.type)&&"AMRTBasicMaterial"===t.type)return e.overMaterial=[],e.material.map((function(i,r){i.isAMRTBasicMaterial&&(n.model.materialRecords.find((function(t){return t.a===e.id}))||n.model.materialRecords.unshift({a:e.id,b:r,c:i.name}),e.material[r]=t,e.overMaterial.push(r))})),e.material_0=e.material,t}},{key:"hide",value:function(){var e=this;this.boxSelected.length>0&&this.boxSelected.map((function(e){return e.visible=!1})),this.selectedMaterial&&Vp.map((function(t){t.material.forEach((function(n){e.selectedMaterial.id!==n.id&&e.selectedMaterial.ID!==n.re||(t.visible=!1)}))}))}},{key:"showAll",value:function(){Vp.forEach((function(e){e.visible||(e.visible=!0)}))}},{key:"showIndependent",value:function(e){(this.selectedMaterial||e)&&(e=e?zp.find((function(t){return t.id===e.id})):this.selectedMaterial,Vp.forEach((function(t){t.visible=Boolean(t.material.find((function(t){return t.id===e.id||t.re===e.ID})))})))}},{key:"toggleDisplay",value:function(){Vp.forEach((function(e){e.visible=!e.visible}))}},{key:"setColor",value:function(e){this._applyParams("color",e,"color")}},{key:"getColor",value:function(){return this._getParams("color")}},{key:"setRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.albedo&&this.selectedMaterial.albedo.repeat.set(e,t),Fp.renderManager.render()}},{key:"getRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.albedo)return this.selectedMaterial.albedo.repeat}},{key:"setRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.albedo&&(this.selectedMaterial.albedo.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getRotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.albedo)return 180*this.selectedMaterial.albedo.rotation/Math.PI}},{key:"setOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.albedo&&this.selectedMaterial.albedo.offset.set(e,t),Fp.renderManager.render()}},{key:"getOffset",value:function(e){if(this.selectedMaterial&&this.selectedMaterial.albedo)return this.selectedMaterial.albedo.offset}},{key:"setAlbedoMap",value:function(e){this._applyParams("albedo",e,"map"),Fp.renderManager.render()}},{key:"getAlbedoMap",value:function(){return this._getParams("albedo")}},{key:"clearAlbedoMap",value:function(){this.selectedMaterial&&(this.selectedMaterial.albedo=null,this.selectedMaterial.needsUpdate=!0,Fp.renderManager.render())}},{key:"setAlbedoUV",value:function(e){this._applyParams("albedoUV",parseInt(e)),Fp.renderManager.render()}},{key:"getAlbedoUV",value:function(){return Number(this._getParams("albedoUV"))}},{key:"setNormalMap",value:function(e){this._applyParams("normalMap",e,"map")}},{key:"getNormalMap",value:function(){return this._getParams("normalMap")}},{key:"setNormalScale",value:function(e){this._applyParams("normalScale",e)}},{key:"getNormalScale",value:function(){return this._getParams("normalScale")}},{key:"setNormalRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.normalMap&&this.selectedMaterial.normalMap.repeat.set(e,t),Fp.renderManager.render()}},{key:"getNormalRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.normalMap)return this.selectedMaterial.normalMap.repeat}},{key:"setNormalRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.normalMap&&(this.selectedMaterial.normalMap.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getNormalRotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.normalMap)return 180*this.selectedMaterial.normalMap.rotation/Math.PI}},{key:"setNormalOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.normalMap&&this.selectedMaterial.normalMap.offset.set(e,t),Fp.renderManager.render()}},{key:"getNormalOffset",value:function(e){if(this.selectedMaterial&&this.selectedMaterial.normalMap)return this.selectedMaterial.normalMap.offset}},{key:"setNormal2Map",value:function(e){this._applyParams("normalMap2",e,"map")}},{key:"getNormal2Map",value:function(){return this._getParams("normalMap2")}},{key:"setNormal2Scale",value:function(e){this._applyParams("normalScale2",e)}},{key:"getNormal2Scale",value:function(){return this._getParams("normalScale2")}},{key:"setNormal2Repeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.normalMap2&&this.selectedMaterial.normalMap2.repeat.set(e,t),Fp.renderManager.render()}},{key:"getNormal2Repeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.normalMap2)return this.selectedMaterial.normalMap2.repeat}},{key:"setNormal2Rotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.normalMap2&&(this.selectedMaterial.normalMap2.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"setSide",value:function(e){e<0||e>2||this._applyParams("side",e)}},{key:"getSide",value:function(){return this.selectedMaterial.side}},{key:"getNormal2Rotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.normalMap2)return 180*this.selectedMaterial.normalMap2.rotation/Math.PI}},{key:"setNormal2Offset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.normalMap2&&this.selectedMaterial.normalMap2.offset.set(e,t),Fp.renderManager.render()}},{key:"getNormal2Offset",value:function(e){if(this.selectedMaterial&&this.selectedMaterial.normalMap2)return this.selectedMaterial.normalMap2.offset}},{key:"setMetallicMap",value:function(e){this._applyParams("metallicMap",e,"map")}},{key:"setMetallicRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.metallicMap&&this.selectedMaterial.metallicMap.repeat.set(e,t),Fp.renderManager.render()}},{key:"getMetallicRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.metallicMap)return this.selectedMaterial.metallicMap.repeat}},{key:"setMetallicRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.metallicMap&&(this.selectedMaterial.metallicMap.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getMetallicRotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.metallicMap)return 180*this.selectedMaterial.metallicMap.rotation/Math.PI}},{key:"setMetallicOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.metallicMap&&this.selectedMaterial.metallicMap.offset.set(e,t),Fp.renderManager.render()}},{key:"getMetallicOffset",value:function(e){this.selectedMaterial&&this.selectedMaterial.metallicMap&&this.selectedMaterial.metallicMap.offset}},{key:"setMetallic",value:function(e){this._applyParams("metallic",e)}},{key:"getMetallic",value:function(){return this._getParams("metallic")}},{key:"setRoughnessMap",value:function(e){this._applyParams("roughnessMap",e,"map")}},{key:"setRoughnessRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.roughnessMap&&this.selectedMaterial.roughnessMap.repeat.set(e,t),Fp.renderManager.render()}},{key:"getRoughnessRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.roughnessMap)return this.selectedMaterial.roughnessMap.repeat}},{key:"setRoughnessRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.roughnessMap&&(this.selectedMaterial.roughnessMap.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getRoughnessRotation",value:function(){return this.selectedMaterial&&this.selectedMaterial.roughnessMap?180*this.selectedMaterial.roughnessMap.rotation/Math.PI:null}},{key:"setRoughnessOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.roughnessMap&&this.selectedMaterial.roughnessMap.offset.set(e,t),Fp.renderManager.render()}},{key:"getRoughnessOffset",value:function(){return this.selectedMaterial&&this.selectedMaterial.roughnessMap?this.selectedMaterial.roughnessMap.offset:null}},{key:"setSmoothness",value:function(e){this._applyParams("smoothness",e)}},{key:"getSmoothness",value:function(){return this._getParams("smoothness")}},{key:"setAOMap",value:function(e,t){this._applyParams("aoMap",e,"map")}},{key:"clearAOMap",value:function(){this.selectedMaterial?(this.selectedMaterial.aoMap=null,this.selectedMaterial.needsUpdate=!0,Fp.renderManager.render()):this.onError("")}},{key:"getAOMap",value:function(){return this._getParams("aoMap")}},{key:"setAORepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.aoMap&&this.selectedMaterial.aoMap.repeat.set(e,t),Fp.renderManager.render()}},{key:"getAORepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.aoMap)return this.selectedMaterial.aoMap.repeat}},{key:"setAORotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.aoMap&&(this.selectedMaterial.aoMap.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getAORotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.aoMap)return 180*this.selectedMaterial.aoMap.rotation/Math.PI}},{key:"setAOOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.aoMap&&this.selectedMaterial.aoMap.offset.set(e,t),Fp.renderManager.render()}},{key:"getAOOffset",value:function(e){if(this.selectedMaterial&&this.selectedMaterial.aoMap)return this.selectedMaterial.aoMap.offset}},{key:"setAOScale",value:function(e){this._applyParams("aoScale",e)}},{key:"getAOScale",value:function(){return this._getParams("aoScale")}},{key:"setAOUV",value:function(e){this._applyParams("aoUV",parseInt(e))}},{key:"getAOUV",value:function(){return this._getParams("aoUV")}},{key:"setEmissiveMap",value:function(e){this._applyParams("emissiveMap",e,"map")}},{key:"setEmissiveRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.emissiveMap&&this.selectedMaterial.emissiveMap.repeat.set(e,t),Fp.renderManager.render()}},{key:"getEmissiveRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.emissiveMap)return this.selectedMaterial.emissiveMap.repeat}},{key:"setEmissiveRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.emissiveMap&&(this.selectedMaterial.emissiveMap.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getEmissiveRotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.emissiveMap)return 180*this.selectedMaterial.emissiveMap.rotation/Math.PI}},{key:"setEmissiveOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.emissiveMap&&this.selectedMaterial.emissiveMap.offset.set(e,t),Fp.renderManager.render()}},{key:"getEmissiveOffset",value:function(e){if(this.selectedMaterial&&this.selectedMaterial.emissiveMap)return this.selectedMaterial.emissiveMap.offset}},{key:"setEmissiveColor",value:function(e){this._applyParams("emissive",e,"color")}},{key:"getEmissiveColor",value:function(){return this._getParams("emissive")}},{key:"setEmissiveUV",value:function(e){this._applyParams("emissiveUV",e)}},{key:"getEmissiveUV",value:function(){return this._getParams("emissiveUV")}},{key:"setReflectMap",value:function(e){this._applyParams("reflectMap",e,"map")}},{key:"setReflectRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.reflectMap&&this.selectedMaterial.reflectMap.repeat.set(e,t),Fp.renderManager.render()}},{key:"getReflectRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.reflectMap)return this.selectedMaterial.reflectMap.repeat}},{key:"setReflectRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.reflectMap&&(this.selectedMaterial.reflectMap.rotation=Math.PI/180*e),Fp.renderManager.render()}},{key:"getReflectRotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.reflectMap)return 180*this.selectedMaterial.reflectMap.rotation/Math.PI}},{key:"setReflectOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.reflectMap&&this.selectedMaterial.reflectMap.offset.set(e,t),Fp.renderManager.render()}},{key:"getReflectOffset",value:function(e){if(this.selectedMaterial&&this.selectedMaterial.reflectMap)return this.selectedMaterial.reflectMap.offset}},{key:"setReflectIntensity",value:function(e){this._applyParams("reflectIntensity",e)}},{key:"getReflectIntensity",value:function(){return this._getParams("reflectIntensity")}},{key:"setReflectivity",value:function(e){this._applyParams("reflectivity",e)}},{key:"getReflectivity",value:function(){return this._getParams("reflectivity")}},{key:"setAlphaMap",value:function(e){this._applyParams("alphaMap",e,"map")}},{key:"setAlphaMapRepeat",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.alphaMap&&this.selectedMaterial.alphaMap.repeat.set(e,t)}},{key:"getAlphaMapRepeat",value:function(){if(this.selectedMaterial&&this.selectedMaterial.alphaMap)return this.selectedMaterial.alphaMap.repeat}},{key:"setAlphaMapRotation",value:function(e){this.selectedMaterial&&this.selectedMaterial.alphaMap&&(this.selectedMaterial.alphaMap.rotation=Math.PI/180*e)}},{key:"getAlphaMapRotation",value:function(){if(this.selectedMaterial&&this.selectedMaterial.alphaMap)return 180*this.selectedMaterial.alphaMap.rotation/Math.PI}},{key:"setAlphaMapOffset",value:function(e,t){this.selectedMaterial&&this.selectedMaterial.alphaMap&&this.selectedMaterial.alphaMap.offset.set(e,t)}},{key:"getAlphaMapOffset",value:function(){if(this.selectedMaterial&&this.selectedMaterial.alphaMap)return this.selectedMaterial.alphaMap.offset}},{key:"setRefractionRatio",value:function(e){this._applyParams("refractionRatio",e)}},{key:"getRefractionRatio",value:function(){return this._getParams("refractionRatio")}},{key:"setTransparency",value:function(e){this._applyParams("transparency",e),this._updateTransparent()}},{key:"_updateTransparent",value:function(){this.selectedMaterial&&(this.selectedMaterial.opacity<1||this.selectedMaterial.transparency>0||this.selectedMaterial.alphaMap?this.selectedMaterial.transparent=!0:1!=this.selectedMaterial.opacity||0!=this.selectedMaterial.transparency||this.selectedMaterial.alphaMap||(this.selectedMaterial.transparent=!1))}},{key:"getTransparency",value:function(){return this._getParams("transparency")}},{key:"setOpacity",value:function(e){this._applyParams("opacity",e),this._updateTransparent()}},{key:"getOpacity",value:function(){return this._getParams("opacity")}},{key:"setTransparent",value:function(e){this._applyParams("transparent",Boolean(e))}},{key:"getTransparent",value:function(){return this._getParams("transparent")}},{key:"getAlphaTest",value:function(){return this._getParams("alphaTest")}},{key:"setAlphaTest",value:function(e){this._applyParams("alphaTest",e)}},{key:"getRetainMap",value:function(){if(this.selectedMaterial)return this.selectedMaterial.retainMap}},{key:"setRetainMap",value:function(e){if(this.selectedMaterial)return this.selectedMaterial.retainMap=e}},{key:"setRenderOrder",value:function(e){this.selectedMaterial&&(this._updateRenderOrderByMaterial(this.selectedMaterial,e),this.selectedMaterial.renderOrder=e,Fp.renderManager.render())}},{key:"getRenderOrder",value:function(){if(this.selected)return this.selected.renderOrder}},{key:"_getMeshByMaterial",value:function(e){var t=[];return Vp.forEach((function(n){var i=n.material;(Array.isArray(i)?i:[i]).forEach((function(i){i==e&&t.push(n)}))})),t}},{key:"_updateRenderOrderByMaterial",value:function(e,t){e&&this._getMeshByMaterial(this.selectedMaterial).forEach((function(e){return e.renderOrder=t}))}},{key:"_applyParams",value:function(e,t,n){var i=this;if(this.selectedMaterial){if(Wp[this.selectedMaterial.name]||(Wp[this.selectedMaterial.name]=this.selectedMaterial.clone()),"map"===n){if(t){var r=t;this.mapLoader.setBaseUrl(""),t=this.mapLoader.load(t,(function(t){var n=r.substr(r.lastIndexOf(".")+1).split("?")[0].toUpperCase();"reflectMap"===e||"envMap"===e?((t=i.mapLoader.convertTexture(t)).image.src=r,i.selectedMaterial[e]=t,i.selectedMaterial.needsUpdate=!0):"BASIS"===n&&(i.selectedMaterial[e]=t,i.selectedMaterial.needsUpdate=!0)})),"envMap"===e?t.custom=!0:t.wrapS=t.wrapT=1e3}else t=null;this.selectedMaterial[e]=t,this.selectedMaterial.needsUpdate=!0}else"color"===n?this.selectedMaterial[e].setStyle(t):this.selectedMaterial[e]=t;this.selectedMaterial.needsUpdate=!0,zp.map((function(e){void 0!==e.re&&e.re===i.selectedMaterial.ID&&(e.copy(i.selectedMaterial),e.needsUpdate=!0)})),this.onEdit&&this.onEdit()}else this.onError("")}},{key:"_getParams",value:function(e){if(this.selectedMaterial)return this.selectedMaterial[e]&&this.selectedMaterial[e].constructor===Sn?"#"+this.selectedMaterial[e].getHexString():this.selectedMaterial[e]&&this.selectedMaterial[e].constructor===st?this.selectedMaterial[e].image.currentSrc||this.selectedMaterial[e].image.src:this.selectedMaterial[e];this.onError("")}},{key:"replace",value:function(e,t){var i=this.selectedMaterial;if(i){Wp[i.name]||(Wp[i.name]=i.clone());for(var r=e.lod1,a={},o=0;o<Object.keys(r).length;o++){var s=Object.keys(r)[o];a[o]=r[s],r[s]=o}var A=n(n(n({a:i.name,ee:i.sname,re:i.re},r),e.params.allParams),{},{transparent:e.transparent});_d.parseAmrtMaterial(A,a,i,null,(function(){t&&t()}),this.mapLoader,e.keepDiffuse||!1)}else this.onError("")}},{key:"restore",value:function(){var e=this;if(this.selectedMaterial){Fp.renderManager.render();var t=Wp[this.selectedMaterial.name];if(t)t.envMap=this.selectedMaterial.envMap,Wp[this.selectedMaterial.name]=t.clone(),this._getMeshByMaterial(this.selectedMaterial).forEach((function(n){if(Array.isArray(n.material))for(var i=0;i<n.material.length;i++)n.material[i]==e.selectedMaterial&&(n.material[i]=t);else n.material==e.selectedMaterial&&(n.material=t)})),zp.splice(zp.indexOf(this.selectedMaterial),1,t),this.selectedMaterial=t}}},{key:"saveToJSON",value:function(){var e={},t=[],n=[];this.getAllMaterials();var i=zp.map((function(e){return e.re}));zp.map((function(e){var t=!1;Vp.map((function(n){t=t||n.material.find((function(t){return t.ID===e.ID}))})),(t||void 0!==e.ID&&i.includes(e.ID))&&n.push(e)})),(n=n.filter((function(e){return"AMRTBasicMaterial"==e.type}))).map((function(n){return t.push(_d.export(n,e))})),t=t.sort((function(e,t){return(void 0===t.re?-1:t.re)-(void 0===e.re?-1:e.re)})).reverse();var r={};Vp.map((function(e){e.overMaterial&&e.overMaterial.map((function(t){var n=e.material[t].name;r[n]||(r[n]=[]),r[n].push({a:e.ID,b:t})}))}));var a={};for(var o in e){var s=e[o];".basis"==s.slice(s.lastIndexOf("."))&&(s=this.model.originMaps[s]||""),e[o]&&e[o].startsWith("data:image")?e[o]="":a[o]=s}var A={a:t,b:e,c:r,ed:!0,z:a};return JSON.stringify(A)}},{key:"exportSingleMaterial",value:function(e){var t={},i=n({},e);delete i.re;var r=_d.export(i,t);for(var a in delete r.a,delete r.ee,t)t[a]&&t[a].startsWith("data:image")&&(t[a]="");return{a:r,b:t}}},{key:"importSingleMaterial",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n||(n=this.selectedMaterial),!n)return this.onError("");_d.parseAmrtMaterial(e.a,e.b,n,null,i,this.mapLoader,r),this.materials.map((function(a){return a.re===n.ID&&_d.parseAmrtMaterial(e.a,e.b,a,null,i,t.mapLoader,r)}))}},{key:"rename",value:function(e,t){return t||(t=this.selectedMaterial),t?(t.sname=e,!0):(this.onError(""),!1)}}]),i}(Ad),Jp=function(){function e(t){r(this,e),this._rayCaster=null,this.viewer=t}return o(e,[{key:"rayCaster",get:function(){return this._rayCaster||(this._rayCaster=new Pc),this._rayCaster}},{key:"rayIntersect",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=t||this.viewer.sceneManager.root;var i=xf.getDomMouse(e,this.viewer.renderManager.containerRect);return this.rayCaster.setFromCamera(i,this.viewer.renderManager.camera),Array.isArray(t)?this.rayCaster.intersectObjects(t,n):this.rayCaster.intersectObject(t,n)}},{key:"intersectObject",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return console.error(": MouseEvent"),!1;t=t||this.viewer.sceneManager.modelGroup;var i=this.rayIntersect(e,t,n);return i.length>0?i[0]:null}},{key:"intersectObjects",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return console.error(": MouseEvent"),!1;t=t||this.viewer.sceneManager.modelGroup;var i=this.rayIntersect(e,t,n);return i}},{key:"intersectModels",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!e)return console.error(": MouseEvent"),!1;if(i=i||this.viewer.sceneManager.modelGroup,this.rayCaster.constructor===Pc){var a=this.rayIntersect(e,i,r);return t&&(n?t.call(n,a):t(a)),a}this.rayCaster.executeTest((function(e){t&&(n?t.call(n,e.intersects):t(e.intersects))}),!0)}},{key:"intersectBox",value:function(e,t){if(!e)return console.error(": MouseEvent"),!1;var n=xf.getDomMouse(e,this.viewer.renderManager.containerRect);this.rayCaster.setFromCamera(n,this.viewer.renderManager.camera);var i=(new Jt).setFromObject(t);return this.rayCaster.ray.intersectBox(i)}},{key:"screenToVector",value:function(e){var t=this.intersectObject(e,this.viewer.sceneManager.root);return t?t.point:null}},{key:"vectorToScreen",value:function(e){var t=this.viewer.renderManager.container.getBoundingClientRect(),n=t.width/2,i=t.height/2,r=e.clone();return r.project(this.viewer.renderManager.camera),new Je(r.x*n+n,-r.y*i+i)}}]),e}(),qp=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),e.transform?f(i,e.transform):((i=t.call(this)).viewer=e,i._controls=new Mu(e.camera,e.container,!1),i.viewer.root.add(i._controls),i._controls.addEventListener("dragging-changed",(function(e){i.viewer.controls.enabled=!e.value,i.dispatchEvent({type:"dragging-changed",data:i.target})})),i._controls.addEventListener("mouseDown",(function(){i.dispatchEvent({type:"mouseDown",data:i.target})})),i._controls.addEventListener("mouseUp",(function(){i.dispatchEvent({type:"mouseUp",data:i.target})})),i._controls.addEventListener("objectChange",(function(e){i.dispatchEvent({type:Xu.CHANGE,data:i.target})})),i.target=null,e.transform=d(i),i)}return o(n,[{key:"setTarget",value:function(e){this.target=e,e?this._controls.attach(this.target):this._controls.detach(),this.viewer.renderManager.render()}},{key:"remove",value:function(){this._controls.detach(),this.target=null,this.viewer.renderManager.render()}},{key:"getTarget",value:function(){return this.target}},{key:"getMode",value:function(e){return this._controls.mode}},{key:"setMode",value:function(e){this._controls.setMode(e),this.viewer.renderManager.render()}},{key:"size",get:function(){return this._controls.size},set:function(e){this._controls.setSize(e),this.viewer.renderManager.render()}},{key:"enabled",get:function(){return this._controls.enabled},set:function(e){this._controls.enabled=e,this.viewer.renderManager.render()}},{key:"showX",get:function(){return this._controls.showX},set:function(e){this._controls.showX=e,this.viewer.renderManager.render()}},{key:"showY",get:function(){return this._controls.showY},set:function(e){this._controls.showY=e,this.viewer.renderManager.render()}},{key:"showZ",get:function(){return this._controls.showZ},set:function(e){this._controls.showZ=e,this.viewer.renderManager.render()}},{key:"dispose",value:function(){this._controls.dispose(),this.viewer.renderManager.render()}}]),n}(Xe),$p=function e(){r(this,e)};$p.TRANSLATE="translate",$p.ROTATE="rotate",$p.SCALE="scale";var em=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),(i=t.call(this,e,a)).isViewer=!0,i._mapLoader=null,!a.isMap&&i.initialize(a),i}return o(n,[{key:"screenShot",get:function(){console.warn("viewer.screenShot has been removed, use AMRT.ScreenHelper.screenShot(viewer) instead.")}},{key:"encircleScreenShot",get:function(){console.warn("viewer.screenShot has been removed, use AMRT.ScreenHelper.encircleScreenShot(viewer) instead.")}},{key:"intersectObjects",get:function(){return this.picker.intersectObjects.bind(this.picker)}},{key:"intersectObject",get:function(){return this.picker.intersectObject.bind(this.picker)}},{key:"intersectModels",get:function(){return this.picker.intersectModels.bind(this.picker)}},{key:"screenToVector",get:function(){return this.picker.screenToVector.bind(this.picker)}},{key:"vectorToScreen",get:function(){return this.picker.vectorToScreen.bind(this.picker)}},{key:"enableOutline",get:function(){return this.composer.enableOutline},set:function(e){this.composer.enableOutline=e}},{key:"outline",get:function(){return this.composer.outline}},{key:"enableUnrealBloom",get:function(){return this.composer.enableUnrealBloom},set:function(e){this.composer.enableUnrealBloom=e}},{key:"unrealBloom",get:function(){return this.composer.unrealBloom}},{key:"enableDof",get:function(){return this.composer.enableDof},set:function(e){this.composer.enableDof=e}},{key:"dof",get:function(){return this.composer.dof}},{key:"enableSSAO",get:function(){return this.composer.enableSSAO},set:function(e){this.composer.enableSSAO=e}},{key:"ssao",get:function(){return this.composer.ssao}},{key:"enableColorAdjustment",get:function(){return this.composer.enableColorAdjustment},set:function(e){this.composer.enableColorAdjustment=e}},{key:"colorAdjustment",get:function(){return this.composer.colorAdjustment}},{key:"enableVignette",get:function(){return this.composer.enableVignette},set:function(e){this.composer.enableVignette=e}},{key:"vignette",get:function(){return this.composer.vignette}},{key:"enableCircleSweep",get:function(){return this.composer.enableCircleSweep},set:function(e){this.composer.enableCircleSweep=e}},{key:"circleSweep",get:function(){return this.composer.circleSweep}},{key:"mapLoader",get:function(){return this._mapLoader||(this._mapLoader=new If(this)),this._mapLoader}},{key:"materialEditor",get:function(){return Pp||(Pp=new Kp(this)),Pp}},{key:"operator",get:function(){return kp||(kp=new Rp(this)),kp}},{key:"enableTransform",set:function(e){e?(!this.transform&&(this.transform=new qp(this)),this.transform.enabled=!0,this.transform.setMode($p.TRANSLATE)):(this.transform.enabled=!1,this.transform.setTarget(null))}},{key:"hotspot",get:function(){return this.moduleManager.hotspot}},{key:"initialize",value:function(e){this.picker=new Jp(this),g(l(n.prototype),"initialize",this).call(this,e)}},{key:"dispose",value:function(){this.enableOutline=!1,this.enableDof=!1,this.enableUnrealBloom=!1,g(l(n.prototype),"dispose",this).call(this)}}]),n}(Tp),tm=function e(){r(this,e)};tm.CENTER="center",tm.LEFT="left",tm.RIGHT="right",tm.TOP="top",tm.BOTTOM="bottom",tm.TOP_LEFT="top-left",tm.TOP_RIGHT="top-right",tm.BOTTOM_LEFT="bottom-left",tm.BOTTOM_RIGHT="bottom-right";var nm=function(){function e(t){var n=this;r(this,e),this.position=t.position.clone(),this.objectId=t.objectId,this.worldPos=t.worldPos,this.cameraView=t.cameraView,this.cameraView&&this.cameraView.position&&this.cameraView.target&&(this.cameraView.position=Array.isArray(this.cameraView.position)?(new tt).fromArray(this.cameraView.position):(new tt).copy(this.cameraView.position),this.cameraView.target=Array.isArray(this.cameraView.target)?(new tt).fromArray(this.cameraView.target):(new tt).copy(this.cameraView.target)),this.element=t.element,this.onUpdate=t.onUpdate,this.userData=t.userData||{},this.screenCoord=void 0,this.onclick=t.onclick,this.anchor=t.anchor||tm.BOTTOM,this.offset=t.offset||new Je,this.hided=!1,this.focus=function(){},this.complete=t.complete,this.flicker=t.flicker,this.flicker&&this.showFlicker(),this.element.onclick=function(e){n.focus(),n.onclick&&n.onclick(e)}}return o(e,[{key:"showFlicker",value:function(){var e=this;this.interval||(this.interval=setInterval((function(){e.element.parentElement&&!e.hided&&(e.element.style.display="none"==e.element.style.display?"block":"none")}),500))}},{key:"stopFlicker",value:function(){this.interval&&(clearInterval(this.interval),this.interval=null,this.element.style.display=this.hided?"none":"block")}},{key:"updateScreenCoords",value:function(e){if(e){this.screenCoord=e;var t=this._convertAnchor();this.element.style.left=e.x+t.x+this.offset.x+"px",this.element.style.top=e.y+t.y+this.offset.y+"px"}}},{key:"hide",value:function(){this.element.style.display="none",this.hided=!0}},{key:"show",value:function(){this.element.style.display="block",this.hided=!1}},{key:"remove",value:function(){this.element.parentElement&&this.element.parentElement.removeChild(this.element),this.stopFlicker()}},{key:"toJSON",value:function(){return{position:this.worldPos?this.worldPos.toArray():this.position.toArray(),objectId:this.objectId,cameraView:{position:this.cameraView&&this.cameraView.position?this.cameraView.position.toArray():null,target:this.cameraView&&this.cameraView.target?this.cameraView.target.toArray():null},element:(new XMLSerializer).serializeToString(this.element),userData:this.userData}}},{key:"_convertAnchor",value:function(){var e=this.element.getBoundingClientRect(),t=new Je;switch(this.anchor){case"center":t.set(-e.width/2,-e.height/2);break;case"top":t.set(-e.width/2,0);break;case"bottom":t.set(-e.width/2,-e.height);break;case"left":t.set(0,-e.height/2);break;case"right":t.set(-e.width,-e.height/2);break;case"top-left":t.set(0,0);break;case"top-right":t.set(-e.width,0);break;case"bottom-left":t.set(0,-e.height);break;case"bottom-right":t.set(-e.width,-e.height)}return t}}]),e}(),im=function(){function e(){r(this,e),this.spots=[],this._visible=!0,this.name=""}return o(e,[{key:"visible",get:function(){return this._visible},set:function(e){this._setVisible(e)}},{key:"hide",value:function(){this._setVisible(0)}},{key:"show",value:function(){this._setVisible(1)}},{key:"add",value:function(e){this.spots.push(e),e.parent=this}},{key:"remove",value:function(e){this.spots.remove(e),e.remove(),e.parent=null}},{key:"removeAll",value:function(){this.spots.forEach((function(e){e.remove()})),this.spots=[]}},{key:"_setVisible",value:function(e){this._visible=e,this.spots.forEach((function(t){e?t.show():t.hide()}))}},{key:"toJSON",value:function(){var e=[];return this.spots.forEach((function(t){e.push(t.toJSON())})),e}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;
/*!
   * html2canvas 1.3.2 <https://html2canvas.hertzen.com>
   * Copyright (c) 2021 Niklas von Hertzen <https://hertzen.com>
   * Released under MIT License
   */
var rm=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){e.exports=function(){
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */
var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return(n=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function o(e){try{A(i.next(e))}catch(e){a(e)}}function s(e){try{A(i.throw(e))}catch(e){a(e)}}function A(e){e.done?n(e.value):r(e.value).then(o,s)}A((i=i.apply(e,t||[])).next())}))}function r(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return A([e,t])}}function A(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function a(e,t,n){if(n||2===arguments.length)for(var i,r=0,a=t.length;r<a;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||t)}for(var o=function(){function e(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}return e.prototype.add=function(t,n,i,r){return new e(this.left+t,this.top+n,this.width+i,this.height+r)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var i=n[0];return i?new e(i.x+t.windowBounds.left,i.y+t.windowBounds.top,i.width,i.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),s=function(e,t){return o.fromClientRect(e,t.getBoundingClientRect())},A=function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var i=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),r=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new o(0,0,i,r)},l=function(e){for(var t=[],n=0,i=e.length;n<i;){var r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var a=e.charCodeAt(n++);56320==(64512&a)?t.push(((1023&r)<<10)+(1023&a)+65536):(t.push(r),n--)}else t.push(r)}return t},c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var i=[],r=-1,a="";++r<n;){var o=e[r];o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)),(r+1===n||i.length>16384)&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return a},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="undefined"==typeof Uint8Array?[]:new Uint8Array(256),d=0;d<h.length;d++)u[h.charCodeAt(d)]=d;var f=function(e){var t,n,i,r,a,o=.75*e.length,s=e.length,A=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(o):new Array(o),c=Array.isArray(l)?l:new Uint8Array(l);for(t=0;t<s;t+=4)n=u[e.charCodeAt(t)],i=u[e.charCodeAt(t+1)],r=u[e.charCodeAt(t+2)],a=u[e.charCodeAt(t+3)],c[A++]=n<<2|i>>4,c[A++]=(15&i)<<4|r>>2,c[A++]=(3&r)<<6|63&a;return l},p=function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n.push(e[i+1]<<8|e[i]);return n},m=function(e){for(var t=e.length,n=[],i=0;i<t;i+=4)n.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return n},g=5,v=11,y=2,w=v-g,x=65536>>g,b=1<<g,C=b-1,M=1024>>g,B=x+M+32,I=65536>>v,E=(1<<w)-1,S=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},T=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},L=function(e){var t=f(e),n=Array.isArray(t)?m(t):new Uint32Array(t),i=Array.isArray(t)?p(t):new Uint16Array(t),r=24,a=S(i,r/2,n[4]/2),o=2===n[5]?S(i,(r+n[4])/2):T(n,Math.ceil((r+n[4])/4));return new F(n[0],n[1],n[2],n[3],a,o)},F=function(){function e(e,t,n,i,r,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=r,this.data=a}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>g])<<y)+(e&C),this.data[t];if(e<=65535)return t=((t=this.index[x+(e-55296>>g)])<<y)+(e&C),this.data[t];if(e<this.highStart)return t=B-I+(e>>v),t=this.index[t],t+=e>>g&E,t=((t=this.index[t])<<y)+(e&C),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),_=50,U=1,P=2,k=3,D=4,R=5,O=7,N=8,G=9,Q=10,H=11,z=12,V=13,j=14,W=15,X=16,Z=17,Y=18,K=19,J=20,q=21,$=22,ee=23,te=24,ne=25,ie=26,re=27,ae=28,oe=29,se=30,Ae=31,le=32,ce=33,he=34,ue=35,de=36,fe=37,pe=38,me=39,ge=40,ve=41,ye=42,we=43,xe=[9001,65288],be="!",Ce="",Me="",Be=L("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Ie=[se,de],Ee=[U,P,k,R],Se=[Q,N],Te=[re,ie],Le=Ee.concat(Se),Fe=[pe,me,ge,he,ue],_e=[W,V],Ue=function(e,t){void 0===t&&(t="strict");var n=[],i=[],r=[];return e.forEach((function(e,a){var o=Be.get(e);if(o>_?(r.push(!0),o-=_):r.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return i.push(a),n.push(X);if(o===D||o===H){if(0===a)return i.push(a),n.push(se);var s=n[a-1];return-1===Le.indexOf(s)?(i.push(i[a-1]),n.push(s)):(i.push(a),n.push(se))}return i.push(a),o===Ae?n.push("strict"===t?q:fe):o===ye||o===oe?n.push(se):o===we?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(fe):n.push(se):void n.push(o)})),[i,n,r]},Pe=function(e,t,n,i){var r=i[n];if(Array.isArray(e)?-1!==e.indexOf(r):e===r)for(var a=n;a<=i.length;){if((A=i[++a])===t)return!0;if(A!==Q)break}if(r===Q)for(a=n;a>0;){var o=i[--a];if(Array.isArray(e)?-1!==e.indexOf(o):e===o)for(var s=n;s<=i.length;){var A;if((A=i[++s])===t)return!0;if(A!==Q)break}if(o!==Q)break}return!1},ke=function(e,t){for(var n=e;n>=0;){var i=t[n];if(i!==Q)return i;n--}return 0},De=function(e,t,n,i,r){if(0===n[i])return Ce;var a=i-1;if(Array.isArray(r)&&!0===r[a])return Ce;var o=a-1,s=a+1,A=t[a],l=o>=0?t[o]:0,c=t[s];if(A===P&&c===k)return Ce;if(-1!==Ee.indexOf(A))return be;if(-1!==Ee.indexOf(c))return Ce;if(-1!==Se.indexOf(c))return Ce;if(ke(a,t)===N)return Me;if(Be.get(e[a])===H)return Ce;if((A===le||A===ce)&&Be.get(e[s])===H)return Ce;if(A===O||c===O)return Ce;if(A===G)return Ce;if(-1===[Q,V,W].indexOf(A)&&c===G)return Ce;if(-1!==[Z,Y,K,te,ae].indexOf(c))return Ce;if(ke(a,t)===$)return Ce;if(Pe(ee,$,a,t))return Ce;if(Pe([Z,Y],q,a,t))return Ce;if(Pe(z,z,a,t))return Ce;if(A===Q)return Me;if(A===ee||c===ee)return Ce;if(c===X||A===X)return Me;if(-1!==[V,W,q].indexOf(c)||A===j)return Ce;if(l===de&&-1!==_e.indexOf(A))return Ce;if(A===ae&&c===de)return Ce;if(c===J)return Ce;if(-1!==Ie.indexOf(c)&&A===ne||-1!==Ie.indexOf(A)&&c===ne)return Ce;if(A===re&&-1!==[fe,le,ce].indexOf(c)||-1!==[fe,le,ce].indexOf(A)&&c===ie)return Ce;if(-1!==Ie.indexOf(A)&&-1!==Te.indexOf(c)||-1!==Te.indexOf(A)&&-1!==Ie.indexOf(c))return Ce;if(-1!==[re,ie].indexOf(A)&&(c===ne||-1!==[$,W].indexOf(c)&&t[s+1]===ne)||-1!==[$,W].indexOf(A)&&c===ne||A===ne&&-1!==[ne,ae,te].indexOf(c))return Ce;if(-1!==[ne,ae,te,Z,Y].indexOf(c))for(var h=a;h>=0;){if((u=t[h])===ne)return Ce;if(-1===[ae,te].indexOf(u))break;h--}if(-1!==[re,ie].indexOf(c))for(h=-1!==[Z,Y].indexOf(A)?o:a;h>=0;){var u;if((u=t[h])===ne)return Ce;if(-1===[ae,te].indexOf(u))break;h--}if(pe===A&&-1!==[pe,me,he,ue].indexOf(c)||-1!==[me,he].indexOf(A)&&-1!==[me,ge].indexOf(c)||-1!==[ge,ue].indexOf(A)&&c===ge)return Ce;if(-1!==Fe.indexOf(A)&&-1!==[J,ie].indexOf(c)||-1!==Fe.indexOf(c)&&A===re)return Ce;if(-1!==Ie.indexOf(A)&&-1!==Ie.indexOf(c))return Ce;if(A===te&&-1!==Ie.indexOf(c))return Ce;if(-1!==Ie.concat(ne).indexOf(A)&&c===$&&-1===xe.indexOf(e[s])||-1!==Ie.concat(ne).indexOf(c)&&A===Y)return Ce;if(A===ve&&c===ve){for(var d=n[a],f=1;d>0&&t[--d]===ve;)f++;if(f%2!=0)return Ce}return A===le&&c===ce?Ce:Me},Re=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=Ue(e,t.lineBreak),i=n[0],r=n[1],a=n[2];return"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(r=r.map((function(e){return-1!==[ne,se,ye].indexOf(e)?fe:e}))),[i,r,"keep-all"===t.wordBreak?a.map((function(t,n){return t&&e[n]>=19968&&e[n]<=40959})):void 0]},Oe=function(){function e(e,t,n,i){this.codePoints=e,this.required=t===be,this.start=n,this.end=i}return e.prototype.slice=function(){return c.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),Ne=function(e,t){var n=l(e),i=Re(n,t),r=i[0],a=i[1],o=i[2],s=n.length,A=0,c=0;return{next:function(){if(c>=s)return{done:!0,value:null};for(var e=Ce;c<s&&(e=De(n,a,r,++c,o))===Ce;);if(e!==Ce||c===s){var t=new Oe(n,e,A,c);return A=c,{value:t,done:!1}}return{done:!0,value:null}}}},Ge=1,Qe=2,He=4,ze=8,Ve=10,je=47,We=92,Xe=9,Ze=32,Ye=34,Ke=61,Je=35,qe=36,$e=37,et=39,tt=40,nt=41,it=95,rt=45,at=33,ot=60,st=62,At=64,lt=91,ct=93,ht=61,ut=123,dt=63,ft=125,pt=124,mt=126,gt=128,vt=65533,yt=42,wt=43,xt=44,bt=58,Ct=59,Mt=46,Bt=0,It=8,Et=11,St=14,Tt=31,Lt=127,Ft=-1,_t=48,Ut=97,Pt=101,kt=102,Dt=117,Rt=122,Ot=65,Nt=69,Gt=70,Qt=85,Ht=90,zt=function(e){return e>=_t&&e<=57},Vt=function(e){return e>=55296&&e<=57343},jt=function(e){return zt(e)||e>=Ot&&e<=Gt||e>=Ut&&e<=kt},Wt=function(e){return e>=Ut&&e<=Rt},Xt=function(e){return e>=Ot&&e<=Ht},Zt=function(e){return Wt(e)||Xt(e)},Yt=function(e){return e>=gt},Kt=function(e){return e===Ve||e===Xe||e===Ze},Jt=function(e){return Zt(e)||Yt(e)||e===it},qt=function(e){return Jt(e)||zt(e)||e===rt},$t=function(e){return e>=Bt&&e<=It||e===Et||e>=St&&e<=Tt||e===Lt},en=function(e,t){return e===We&&t!==Ve},tn=function(e,t,n){return e===rt?Jt(t)||en(t,n):!!Jt(e)||!(e!==We||!en(e,t))},nn=function(e,t,n){return e===wt||e===rt?!!zt(t)||t===Mt&&zt(n):zt(e===Mt?t:e)},rn=function(e){var t=0,n=1;e[t]!==wt&&e[t]!==rt||(e[t]===rt&&(n=-1),t++);for(var i=[];zt(e[t]);)i.push(e[t++]);var r=i.length?parseInt(c.apply(void 0,i),10):0;e[t]===Mt&&t++;for(var a=[];zt(e[t]);)a.push(e[t++]);var o=a.length,s=o?parseInt(c.apply(void 0,a),10):0;e[t]!==Nt&&e[t]!==Pt||t++;var A=1;e[t]!==wt&&e[t]!==rt||(e[t]===rt&&(A=-1),t++);for(var l=[];zt(e[t]);)l.push(e[t++]);var h=l.length?parseInt(c.apply(void 0,l),10):0;return n*(r+s*Math.pow(10,-o))*Math.pow(10,A*h)},an={type:2},on={type:3},sn={type:4},An={type:13},ln={type:8},cn={type:21},hn={type:9},un={type:10},dn={type:11},fn={type:12},pn={type:14},mn={type:23},gn={type:1},vn={type:25},yn={type:24},wn={type:26},xn={type:27},bn={type:28},Cn={type:29},Mn={type:31},Bn={type:32},In=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(l(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Bn;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Ye:return this.consumeStringToken(Ye);case Je:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(qt(t)||en(n,i)){var r=tn(t,n,i)?Qe:Ge;return{type:5,value:this.consumeName(),flags:r}}break;case qe:if(this.peekCodePoint(0)===Ke)return this.consumeCodePoint(),An;break;case et:return this.consumeStringToken(et);case tt:return an;case nt:return on;case yt:if(this.peekCodePoint(0)===Ke)return this.consumeCodePoint(),pn;break;case wt:if(nn(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case xt:return sn;case rt:var a=e,o=this.peekCodePoint(0),s=this.peekCodePoint(1);if(nn(a,o,s))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(tn(a,o,s))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(o===rt&&s===st)return this.consumeCodePoint(),this.consumeCodePoint(),yn;break;case Mt:if(nn(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case je:if(this.peekCodePoint(0)===yt)for(this.consumeCodePoint();;){var A=this.consumeCodePoint();if(A===yt&&(A=this.consumeCodePoint())===je)return this.consumeToken();if(A===Ft)return this.consumeToken()}break;case bt:return wn;case Ct:return xn;case ot:if(this.peekCodePoint(0)===at&&this.peekCodePoint(1)===rt&&this.peekCodePoint(2)===rt)return this.consumeCodePoint(),this.consumeCodePoint(),vn;break;case At:var l=this.peekCodePoint(0),h=this.peekCodePoint(1),u=this.peekCodePoint(2);if(tn(l,h,u))return{type:7,value:this.consumeName()};break;case lt:return bn;case We:if(en(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case ct:return Cn;case ht:if(this.peekCodePoint(0)===Ke)return this.consumeCodePoint(),ln;break;case ut:return dn;case ft:return fn;case Dt:case Qt:var d=this.peekCodePoint(0),f=this.peekCodePoint(1);return d!==wt||!jt(f)&&f!==dt||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case pt:if(this.peekCodePoint(0)===Ke)return this.consumeCodePoint(),hn;if(this.peekCodePoint(0)===pt)return this.consumeCodePoint(),cn;break;case mt:if(this.peekCodePoint(0)===Ke)return this.consumeCodePoint(),un;break;case Ft:return Bn}return Kt(e)?(this.consumeWhiteSpace(),Mn):zt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Jt(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:c(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();jt(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===dt&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(c.apply(void 0,e.map((function(e){return e===dt?_t:e}))),16),end:parseInt(c.apply(void 0,e.map((function(e){return e===dt?Gt:e}))),16)};var i=parseInt(c.apply(void 0,e),16);if(this.peekCodePoint(0)===rt&&jt(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var r=[];jt(t)&&r.length<6;)r.push(t),t=this.consumeCodePoint();return{type:30,start:i,end:parseInt(c.apply(void 0,r),16)}}return{type:30,start:i,end:i}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===tt?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===tt?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===et||t===Ye){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft||this.peekCodePoint(0)===nt)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),mn)}for(;;){var i=this.consumeCodePoint();if(i===Ft||i===nt)return{type:22,value:c.apply(void 0,e)};if(Kt(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft||this.peekCodePoint(0)===nt?(this.consumeCodePoint(),{type:22,value:c.apply(void 0,e)}):(this.consumeBadUrlRemnants(),mn);if(i===Ye||i===et||i===tt||$t(i))return this.consumeBadUrlRemnants(),mn;if(i===We){if(!en(i,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),mn;e.push(this.consumeEscapedCodePoint())}else e.push(i)}},e.prototype.consumeWhiteSpace=function(){for(;Kt(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===nt||e===Ft)return;en(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t=6e4,n="";e>0;){var i=Math.min(t,e);n+=c.apply(void 0,this._value.splice(0,i)),e-=i}return this._value.shift(),n},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var i=this._value[n];if(i===Ft||void 0===i||i===e)return{type:0,value:t+=this.consumeStringSlice(n)};if(i===Ve)return this._value.splice(0,n),gn;if(i===We){var r=this._value[n+1];r!==Ft&&void 0!==r&&(r===Ve?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):en(i,r)&&(t+=this.consumeStringSlice(n),t+=c(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=He,n=this.peekCodePoint(0);for(n!==wt&&n!==rt||e.push(this.consumeCodePoint());zt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===Mt&&zt(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ze;zt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var r=this.peekCodePoint(2);if((n===Nt||n===Pt)&&((i===wt||i===rt)&&zt(r)||zt(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ze;zt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[rn(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],i=this.peekCodePoint(0),r=this.peekCodePoint(1),a=this.peekCodePoint(2);return tn(i,r,a)?{type:15,number:t,flags:n,unit:this.consumeName()}:i===$e?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(jt(e)){for(var t=c(e);jt(this.peekCodePoint(0))&&t.length<6;)t+=c(this.consumeCodePoint());Kt(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||Vt(n)||n>1114111?vt:n}return e===Ft?vt:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(qt(t))e+=c(t);else{if(!en(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=c(this.consumeEscapedCodePoint())}}},e}(),En=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new In;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(32===n.type||Dn(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Bn:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Sn=function(e){return 15===e.type},Tn=function(e){return 17===e.type},Ln=function(e){return 20===e.type},Fn=function(e){return 0===e.type},_n=function(e,t){return Ln(e)&&e.value===t},Un=function(e){return 31!==e.type},Pn=function(e){return 31!==e.type&&4!==e.type},kn=function(e){var t=[],n=[];return e.forEach((function(e){if(4===e.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}31!==e.type&&n.push(e)})),n.length&&t.push(n),t},Dn=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},Rn=function(e){return 17===e.type||15===e.type},On=function(e){return 16===e.type||Rn(e)},Nn=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Gn={type:17,number:0,flags:He},Qn={type:16,number:50,flags:He},Hn={type:16,number:100,flags:He},zn=function(e,t,n){var i=e[0],r=e[1];return[Vn(i,t),Vn(void 0!==r?r:i,n)]},Vn=function(e,t){if(16===e.type)return e.number/100*t;if(Sn(e))switch(e.unit){case"rem":case"em":return 16*e.number;case"px":default:return e.number}return e.number},jn="deg",Wn="grad",Xn="rad",Zn="turn",Yn={name:"angle",parse:function(e,t){if(15===t.type)switch(t.unit){case jn:return Math.PI*t.number/180;case Wn:return Math.PI/200*t.number;case Xn:return t.number;case Zn:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")}},Kn=function(e){return 15===e.type&&(e.unit===jn||e.unit===Wn||e.unit===Xn||e.unit===Zn)},Jn=function(e){switch(e.filter(Ln).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Gn,Gn];case"to top":case"bottom":return qn(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Gn,Hn];case"to right":case"left":return qn(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Hn,Hn];case"to bottom":case"top":return qn(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Hn,Gn];case"to left":case"right":return qn(270)}return 0},qn=function(e){return Math.PI*e/180},$n={name:"color",parse:function(e,t){if(18===t.type){var n=Ai[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(5===t.type){if(3===t.value.length){var i=t.value.substring(0,1),r=t.value.substring(1,2),a=t.value.substring(2,3);return ni(parseInt(i+i,16),parseInt(r+r,16),parseInt(a+a,16),1)}if(4===t.value.length){i=t.value.substring(0,1),r=t.value.substring(1,2),a=t.value.substring(2,3);var o=t.value.substring(3,4);return ni(parseInt(i+i,16),parseInt(r+r,16),parseInt(a+a,16),parseInt(o+o,16)/255)}if(6===t.value.length)return i=t.value.substring(0,2),r=t.value.substring(2,4),a=t.value.substring(4,6),ni(parseInt(i,16),parseInt(r,16),parseInt(a,16),1);if(8===t.value.length)return i=t.value.substring(0,2),r=t.value.substring(2,4),a=t.value.substring(4,6),o=t.value.substring(6,8),ni(parseInt(i,16),parseInt(r,16),parseInt(a,16),parseInt(o,16)/255)}if(20===t.type){var s=ci[t.value.toUpperCase()];if(void 0!==s)return s}return ci.TRANSPARENT}},ei=function(e){return 0==(255&e)},ti=function(e){var t=255&e,n=255&e>>8,i=255&e>>16,r=255&e>>24;return t<255?"rgba("+r+","+i+","+n+","+t/255+")":"rgb("+r+","+i+","+n+")"},ni=function(e,t,n,i){return(e<<24|t<<16|n<<8|Math.round(255*i)<<0)>>>0},ii=function(e,t){if(17===e.type)return e.number;if(16===e.type){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},ri=function(e,t){var n=t.filter(Pn);if(3===n.length){var i=n.map(ii),r=i[0],a=i[1],o=i[2];return ni(r,a,o,1)}if(4===n.length){var s=n.map(ii),A=(r=s[0],a=s[1],o=s[2],s[3]);return ni(r,a,o,A)}return 0};function ai(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var oi,si=function(e,t){var n=t.filter(Pn),i=n[0],r=n[1],a=n[2],o=n[3],s=(17===i.type?qn(i.number):Yn.parse(e,i))/(2*Math.PI),A=On(r)?r.number/100:0,l=On(a)?a.number/100:0,c=void 0!==o&&On(o)?Vn(o,1):1;if(0===A)return ni(255*l,255*l,255*l,1);var h=l<=.5?l*(A+1):l+A-l*A,u=2*l-h,d=ai(u,h,s+1/3),f=ai(u,h,s),p=ai(u,h,s-1/3);return ni(255*d,255*f,255*p,c)},Ai={hsl:si,hsla:si,rgb:ri,rgba:ri},li=function(e,t){return $n.parse(e,En.create(t).parseComponentValue())},ci={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};!function(e){e[e.BORDER_BOX=0]="BORDER_BOX",e[e.PADDING_BOX=1]="PADDING_BOX",e[e.CONTENT_BOX=2]="CONTENT_BOX"}(oi||(oi={}));var hi,ui={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Ln(e))switch(e.value){case"padding-box":return oi.PADDING_BOX;case"content-box":return oi.CONTENT_BOX}return oi.BORDER_BOX}))}},di={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fi=function(e,t){var n=$n.parse(e,t[0]),i=t[1];return i&&On(i)?{color:n,stop:i}:{color:n,stop:null}},pi=function(e,t){var n=e[0],i=e[e.length-1];null===n.stop&&(n.stop=Gn),null===i.stop&&(i.stop=Hn);for(var r=[],a=0,o=0;o<e.length;o++){var s=e[o].stop;if(null!==s){var A=Vn(s,t);A>a?r.push(A):r.push(a),a=A}else r.push(null)}var l=null;for(o=0;o<r.length;o++){var c=r[o];if(null===c)null===l&&(l=o);else if(null!==l){for(var h=o-l,u=(c-r[l-1])/(h+1),d=1;d<=h;d++)r[l+d-1]=u*d;l=null}}return e.map((function(e,n){return{color:e.color,stop:Math.max(Math.min(1,r[n]/t),0)}}))},mi=function(e,t,n){var i=t/2,r=n/2,a=Vn(e[0],t)-i,o=r-Vn(e[1],n);return(Math.atan2(o,a)+2*Math.PI)%(2*Math.PI)},gi=function(e,t,n){var i="number"==typeof e?e:mi(e,t,n),r=Math.abs(t*Math.sin(i))+Math.abs(n*Math.cos(i)),a=t/2,o=n/2,s=r/2,A=Math.sin(i-Math.PI/2)*s,l=Math.cos(i-Math.PI/2)*s;return[r,a-l,a+l,o-A,o+A]},vi=function(e,t){return Math.sqrt(e*e+t*t)},yi=function(e,t,n,i,r){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var a=t[0],o=t[1],s=vi(n-a,i-o);return(r?s<e.optimumDistance:s>e.optimumDistance)?{optimumCorner:t,optimumDistance:s}:e}),{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},wi=function(e,t,n,i,r){var a=0,o=0;switch(e.size){case ki.CLOSEST_SIDE:e.shape===Pi.CIRCLE?a=o=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(n),Math.abs(n-r)):e.shape===Pi.ELLIPSE&&(a=Math.min(Math.abs(t),Math.abs(t-i)),o=Math.min(Math.abs(n),Math.abs(n-r)));break;case ki.CLOSEST_CORNER:if(e.shape===Pi.CIRCLE)a=o=Math.min(vi(t,n),vi(t,n-r),vi(t-i,n),vi(t-i,n-r));else if(e.shape===Pi.ELLIPSE){var s=Math.min(Math.abs(n),Math.abs(n-r))/Math.min(Math.abs(t),Math.abs(t-i)),A=yi(i,r,t,n,!0),l=A[0],c=A[1];o=s*(a=vi(l-t,(c-n)/s))}break;case ki.FARTHEST_SIDE:e.shape===Pi.CIRCLE?a=o=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(n),Math.abs(n-r)):e.shape===Pi.ELLIPSE&&(a=Math.max(Math.abs(t),Math.abs(t-i)),o=Math.max(Math.abs(n),Math.abs(n-r)));break;case ki.FARTHEST_CORNER:if(e.shape===Pi.CIRCLE)a=o=Math.max(vi(t,n),vi(t,n-r),vi(t-i,n),vi(t-i,n-r));else if(e.shape===Pi.ELLIPSE){s=Math.max(Math.abs(n),Math.abs(n-r))/Math.max(Math.abs(t),Math.abs(t-i));var h=yi(i,r,t,n,!1);l=h[0],c=h[1],o=s*(a=vi(l-t,(c-n)/s))}}return Array.isArray(e.size)&&(a=Vn(e.size[0],i),o=2===e.size.length?Vn(e.size[1],r):a),[a,o]},xi=function(e,t){var n=qn(180),i=[];return kn(t).forEach((function(t,r){if(0===r){var a=t[0];if(20===a.type&&"to"===a.value)return void(n=Jn(t));if(Kn(a))return void(n=Yn.parse(e,a))}var o=fi(e,t);i.push(o)})),{angle:n,stops:i,type:hi.LINEAR_GRADIENT}},bi=function(e,t){var n=qn(180),i=[];return kn(t).forEach((function(t,r){if(0===r){var a=t[0];if(20===a.type&&-1!==["top","left","right","bottom"].indexOf(a.value))return void(n=Jn(t));if(Kn(a))return void(n=(Yn.parse(e,a)+qn(270))%qn(360))}var o=fi(e,t);i.push(o)})),{angle:n,stops:i,type:hi.LINEAR_GRADIENT}},Ci=function(e,t){var n=qn(180),i=[],r=hi.LINEAR_GRADIENT,a=Pi.CIRCLE,o=ki.FARTHEST_CORNER,s=[];return kn(t).forEach((function(t,n){var a=t[0];if(0===n){if(Ln(a)&&"linear"===a.value)return void(r=hi.LINEAR_GRADIENT);if(Ln(a)&&"radial"===a.value)return void(r=hi.RADIAL_GRADIENT)}if(18===a.type)if("from"===a.name){var o=$n.parse(e,a.values[0]);i.push({stop:Gn,color:o})}else if("to"===a.name)o=$n.parse(e,a.values[0]),i.push({stop:Hn,color:o});else if("color-stop"===a.name){var s=a.values.filter(Pn);if(2===s.length){o=$n.parse(e,s[1]);var A=s[0];Tn(A)&&i.push({stop:{type:16,number:100*A.number,flags:A.flags},color:o})}}})),r===hi.LINEAR_GRADIENT?{angle:(n+qn(180))%qn(360),stops:i,type:r}:{size:o,shape:a,stops:i,position:s,type:r}},Mi="closest-side",Bi="farthest-side",Ii="closest-corner",Ei="farthest-corner",Si="circle",Ti="ellipse",Li="cover",Fi="contain",_i=function(e,t){var n=Pi.CIRCLE,i=ki.FARTHEST_CORNER,r=[],a=[];return kn(t).forEach((function(t,o){var s=!0;if(0===o){var A=!1;s=t.reduce((function(e,t){if(A)if(Ln(t))switch(t.value){case"center":return a.push(Qn),e;case"top":case"left":return a.push(Gn),e;case"right":case"bottom":return a.push(Hn),e}else(On(t)||Rn(t))&&a.push(t);else if(Ln(t))switch(t.value){case Si:return n=Pi.CIRCLE,!1;case Ti:return n=Pi.ELLIPSE,!1;case"at":return A=!0,!1;case Mi:return i=ki.CLOSEST_SIDE,!1;case Li:case Bi:return i=ki.FARTHEST_SIDE,!1;case Fi:case Ii:return i=ki.CLOSEST_CORNER,!1;case Ei:return i=ki.FARTHEST_CORNER,!1}else if(Rn(t)||On(t))return Array.isArray(i)||(i=[]),i.push(t),!1;return e}),s)}if(s){var l=fi(e,t);r.push(l)}})),{size:i,shape:n,stops:r,position:a,type:hi.RADIAL_GRADIENT}},Ui=function(e,t){var n=Pi.CIRCLE,i=ki.FARTHEST_CORNER,r=[],a=[];return kn(t).forEach((function(t,o){var s=!0;if(0===o?s=t.reduce((function(e,t){if(Ln(t))switch(t.value){case"center":return a.push(Qn),!1;case"top":case"left":return a.push(Gn),!1;case"right":case"bottom":return a.push(Hn),!1}else if(On(t)||Rn(t))return a.push(t),!1;return e}),s):1===o&&(s=t.reduce((function(e,t){if(Ln(t))switch(t.value){case Si:return n=Pi.CIRCLE,!1;case Ti:return n=Pi.ELLIPSE,!1;case Fi:case Mi:return i=ki.CLOSEST_SIDE,!1;case Bi:return i=ki.FARTHEST_SIDE,!1;case Ii:return i=ki.CLOSEST_CORNER,!1;case Li:case Ei:return i=ki.FARTHEST_CORNER,!1}else if(Rn(t)||On(t))return Array.isArray(i)||(i=[]),i.push(t),!1;return e}),s)),s){var A=fi(e,t);r.push(A)}})),{size:i,shape:n,stops:r,position:a,type:hi.RADIAL_GRADIENT}};!function(e){e[e.URL=0]="URL",e[e.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",e[e.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(hi||(hi={}));var Pi,ki,Di=function(e){return e.type===hi.LINEAR_GRADIENT},Ri=function(e){return e.type===hi.RADIAL_GRADIENT};(function(e){e[e.CIRCLE=0]="CIRCLE",e[e.ELLIPSE=1]="ELLIPSE"})(Pi||(Pi={})),function(e){e[e.CLOSEST_SIDE=0]="CLOSEST_SIDE",e[e.FARTHEST_SIDE=1]="FARTHEST_SIDE",e[e.CLOSEST_CORNER=2]="CLOSEST_CORNER",e[e.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(ki||(ki={}));var Oi={name:"image",parse:function(e,t){if(22===t.type){var n={url:t.value,type:hi.URL};return e.cache.addImage(t.value),n}if(18===t.type){var i=Qi[t.name];if(void 0===i)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return i(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function Ni(e){return!(20===e.type&&"none"===e.value||18===e.type&&!Qi[e.name])}var Gi,Qi={"linear-gradient":xi,"-moz-linear-gradient":bi,"-ms-linear-gradient":bi,"-o-linear-gradient":bi,"-webkit-linear-gradient":bi,"radial-gradient":_i,"-moz-radial-gradient":Ui,"-ms-radial-gradient":Ui,"-o-radial-gradient":Ui,"-webkit-radial-gradient":Ui,"-webkit-gradient":Ci},Hi={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t.filter((function(e){return Pn(e)&&Ni(e)})).map((function(t){return Oi.parse(e,t)}))}},zi={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Ln(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Vi={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return kn(t).map((function(e){return e.filter(On)})).map(Nn)}};!function(e){e[e.REPEAT=0]="REPEAT",e[e.NO_REPEAT=1]="NO_REPEAT",e[e.REPEAT_X=2]="REPEAT_X",e[e.REPEAT_Y=3]="REPEAT_Y"}(Gi||(Gi={}));var ji,Wi={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return kn(t).map((function(e){return e.filter(Ln).map((function(e){return e.value})).join(" ")})).map(Xi)}},Xi=function(e){switch(e){case"no-repeat":return Gi.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return Gi.REPEAT_X;case"repeat-y":case"no-repeat repeat":return Gi.REPEAT_Y;case"repeat":default:return Gi.REPEAT}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(ji||(ji={}));var Zi,Yi={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return kn(t).map((function(e){return e.filter(Ki)}))}},Ki=function(e){return Ln(e)||On(e)},Ji=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},qi=Ji("top"),$i=Ji("right"),er=Ji("bottom"),tr=Ji("left"),nr=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return Nn(t.filter(On))}}},ir=nr("top-left"),rr=nr("top-right"),ar=nr("bottom-right"),or=nr("bottom-left");!function(e){e[e.NONE=0]="NONE",e[e.SOLID=1]="SOLID",e[e.DASHED=2]="DASHED",e[e.DOTTED=3]="DOTTED",e[e.DOUBLE=4]="DOUBLE"}(Zi||(Zi={}));var sr,Ar=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return Zi.NONE;case"dashed":return Zi.DASHED;case"dotted":return Zi.DOTTED;case"double":return Zi.DOUBLE}return Zi.SOLID}}},lr=Ar("top"),cr=Ar("right"),hr=Ar("bottom"),ur=Ar("left"),dr=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Sn(t)?t.number:0}}},fr=dr("top"),pr=dr("right"),mr=dr("bottom"),gr=dr("left"),vr={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},yr={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},wr={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Ln).reduce((function(e,t){return e|xr(t.value)}),0)}},xr=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.INLINE_START=3]="INLINE_START",e[e.INLINE_END=4]="INLINE_END"}(sr||(sr={}));var br,Cr={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return sr.LEFT;case"right":return sr.RIGHT;case"inline-start":return sr.INLINE_START;case"inline-end":return sr.INLINE_END}return sr.NONE}},Mr={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(br||(br={}));var Br,Ir={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"strict":return br.STRICT;case"normal":default:return br.NORMAL}}},Er={name:"line-height",initialValue:"normal",prefix:!1,type:4},Sr=function(e,t){return Ln(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:On(e)?Vn(e,t):t},Tr={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Oi.parse(e,t)}};!function(e){e[e.INSIDE=0]="INSIDE",e[e.OUTSIDE=1]="OUTSIDE"}(Br||(Br={}));var Lr,Fr={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){switch(t){case"inside":return Br.INSIDE;case"outside":default:return Br.OUTSIDE}}};!function(e){e[e.NONE=-1]="NONE",e[e.DISC=0]="DISC",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.DECIMAL=3]="DECIMAL",e[e.CJK_DECIMAL=4]="CJK_DECIMAL",e[e.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",e[e.LOWER_ROMAN=6]="LOWER_ROMAN",e[e.UPPER_ROMAN=7]="UPPER_ROMAN",e[e.LOWER_GREEK=8]="LOWER_GREEK",e[e.LOWER_ALPHA=9]="LOWER_ALPHA",e[e.UPPER_ALPHA=10]="UPPER_ALPHA",e[e.ARABIC_INDIC=11]="ARABIC_INDIC",e[e.ARMENIAN=12]="ARMENIAN",e[e.BENGALI=13]="BENGALI",e[e.CAMBODIAN=14]="CAMBODIAN",e[e.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",e[e.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",e[e.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",e[e.DEVANAGARI=18]="DEVANAGARI",e[e.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",e[e.GEORGIAN=20]="GEORGIAN",e[e.GUJARATI=21]="GUJARATI",e[e.GURMUKHI=22]="GURMUKHI",e[e.HEBREW=22]="HEBREW",e[e.HIRAGANA=23]="HIRAGANA",e[e.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",e[e.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",e[e.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",e[e.KANNADA=27]="KANNADA",e[e.KATAKANA=28]="KATAKANA",e[e.KATAKANA_IROHA=29]="KATAKANA_IROHA",e[e.KHMER=30]="KHMER",e[e.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",e[e.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",e[e.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",e[e.LAO=34]="LAO",e[e.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",e[e.MALAYALAM=36]="MALAYALAM",e[e.MONGOLIAN=37]="MONGOLIAN",e[e.MYANMAR=38]="MYANMAR",e[e.ORIYA=39]="ORIYA",e[e.PERSIAN=40]="PERSIAN",e[e.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",e[e.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",e[e.TAMIL=43]="TAMIL",e[e.TELUGU=44]="TELUGU",e[e.THAI=45]="THAI",e[e.TIBETAN=46]="TIBETAN",e[e.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",e[e.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",e[e.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",e[e.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",e[e.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(Lr||(Lr={}));var _r,Ur={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return Lr.DISC;case"circle":return Lr.CIRCLE;case"square":return Lr.SQUARE;case"decimal":return Lr.DECIMAL;case"cjk-decimal":return Lr.CJK_DECIMAL;case"decimal-leading-zero":return Lr.DECIMAL_LEADING_ZERO;case"lower-roman":return Lr.LOWER_ROMAN;case"upper-roman":return Lr.UPPER_ROMAN;case"lower-greek":return Lr.LOWER_GREEK;case"lower-alpha":return Lr.LOWER_ALPHA;case"upper-alpha":return Lr.UPPER_ALPHA;case"arabic-indic":return Lr.ARABIC_INDIC;case"armenian":return Lr.ARMENIAN;case"bengali":return Lr.BENGALI;case"cambodian":return Lr.CAMBODIAN;case"cjk-earthly-branch":return Lr.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return Lr.CJK_HEAVENLY_STEM;case"cjk-ideographic":return Lr.CJK_IDEOGRAPHIC;case"devanagari":return Lr.DEVANAGARI;case"ethiopic-numeric":return Lr.ETHIOPIC_NUMERIC;case"georgian":return Lr.GEORGIAN;case"gujarati":return Lr.GUJARATI;case"gurmukhi":return Lr.GURMUKHI;case"hebrew":return Lr.HEBREW;case"hiragana":return Lr.HIRAGANA;case"hiragana-iroha":return Lr.HIRAGANA_IROHA;case"japanese-formal":return Lr.JAPANESE_FORMAL;case"japanese-informal":return Lr.JAPANESE_INFORMAL;case"kannada":return Lr.KANNADA;case"katakana":return Lr.KATAKANA;case"katakana-iroha":return Lr.KATAKANA_IROHA;case"khmer":return Lr.KHMER;case"korean-hangul-formal":return Lr.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return Lr.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return Lr.KOREAN_HANJA_INFORMAL;case"lao":return Lr.LAO;case"lower-armenian":return Lr.LOWER_ARMENIAN;case"malayalam":return Lr.MALAYALAM;case"mongolian":return Lr.MONGOLIAN;case"myanmar":return Lr.MYANMAR;case"oriya":return Lr.ORIYA;case"persian":return Lr.PERSIAN;case"simp-chinese-formal":return Lr.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return Lr.SIMP_CHINESE_INFORMAL;case"tamil":return Lr.TAMIL;case"telugu":return Lr.TELUGU;case"thai":return Lr.THAI;case"tibetan":return Lr.TIBETAN;case"trad-chinese-formal":return Lr.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return Lr.TRAD_CHINESE_INFORMAL;case"upper-armenian":return Lr.UPPER_ARMENIAN;case"disclosure-open":return Lr.DISCLOSURE_OPEN;case"disclosure-closed":return Lr.DISCLOSURE_CLOSED;case"none":default:return Lr.NONE}}},Pr=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},kr=Pr("top"),Dr=Pr("right"),Rr=Pr("bottom"),Or=Pr("left");!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.SCROLL=2]="SCROLL",e[e.CLIP=3]="CLIP",e[e.AUTO=4]="AUTO"}(_r||(_r={}));var Nr,Gr={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Ln).map((function(e){switch(e.value){case"hidden":return _r.HIDDEN;case"scroll":return _r.SCROLL;case"clip":return _r.CLIP;case"auto":return _r.AUTO;case"visible":default:return _r.VISIBLE}}))}},Qr={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},Hr=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},zr=Hr("top"),Vr=Hr("right"),jr=Hr("bottom"),Wr=Hr("left");!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(Nr||(Nr={}));var Xr,Zr={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return Nr.RIGHT;case"center":case"justify":return Nr.CENTER;case"left":default:return Nr.LEFT}}};!function(e){e[e.STATIC=0]="STATIC",e[e.RELATIVE=1]="RELATIVE",e[e.ABSOLUTE=2]="ABSOLUTE",e[e.FIXED=3]="FIXED",e[e.STICKY=4]="STICKY"}(Xr||(Xr={}));var Yr,Kr={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return Xr.RELATIVE;case"absolute":return Xr.ABSOLUTE;case"fixed":return Xr.FIXED;case"sticky":return Xr.STICKY}return Xr.STATIC}},Jr={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&_n(t[0],"none")?[]:kn(t).map((function(t){for(var n={color:ci.TRANSPARENT,offsetX:Gn,offsetY:Gn,blur:Gn},i=0,r=0;r<t.length;r++){var a=t[r];Rn(a)?(0===i?n.offsetX=a:1===i?n.offsetY=a:n.blur=a,i++):n.color=$n.parse(e,a)}return n}))}};!function(e){e[e.NONE=0]="NONE",e[e.LOWERCASE=1]="LOWERCASE",e[e.UPPERCASE=2]="UPPERCASE",e[e.CAPITALIZE=3]="CAPITALIZE"}(Yr||(Yr={}));var qr,$r={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return Yr.UPPERCASE;case"lowercase":return Yr.LOWERCASE;case"capitalize":return Yr.CAPITALIZE}return Yr.NONE}},ea={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var n=ta[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},ta={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),n=t[0],i=t[1];t[2],t[3];var r=t[4],a=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var o=t[12],s=t[13];return t[14],t[15],16===t.length?[n,i,r,a,o,s]:null}},na={type:16,number:50,flags:He},ia=[na,na],ra={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter(On);return 2!==n.length?ia:[n[0],n[1]]}};!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.COLLAPSE=2]="COLLAPSE"}(qr||(qr={}));var aa,oa={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return qr.HIDDEN;case"collapse":return qr.COLLAPSE;case"visible":default:return qr.VISIBLE}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(aa||(aa={}));var sa,Aa={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return aa.BREAK_ALL;case"keep-all":return aa.KEEP_ALL;case"normal":default:return aa.NORMAL}}},la={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Tn(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},ca={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},ha={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Tn(t)?t.number:1}},ua={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},da={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Ln).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},fa={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],i=[];return t.forEach((function(e){switch(e.type){case 20:case 0:n.push(e.value);break;case 17:n.push(e.number.toString());break;case 4:i.push(n.join(" ")),n.length=0}})),n.length&&i.push(n.join(" ")),i.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},pa={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ma={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){if(Tn(t))return t.number;if(Ln(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},ga={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Ln).map((function(e){return e.value}))}};!function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(sa||(sa={}));var va,ya={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return sa.OBLIQUE;case"italic":return sa.ITALIC;case"normal":default:return sa.NORMAL}}},wa=function(e,t){return 0!=(e&t)},xa={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t}},ba={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;for(var i=[],r=t.filter(Un),a=0;a<r.length;a++){var o=r[a],s=r[a+1];if(20===o.type){var A=s&&Tn(s)?s.number:1;i.push({counter:o.value,increment:A})}}return i}},Ca={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var n=[],i=t.filter(Un),r=0;r<i.length;r++){var a=i[r],o=i[r+1];if(Ln(a)&&"none"!==a.value){var s=o&&Tn(o)?o.number:0;n.push({counter:a.value,reset:s})}}return n}},Ma={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Sn).map((function(t){return ca.parse(e,t)}))}},Ba={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;var i=[],r=t.filter(Fn);if(r.length%2!=0)return null;for(var a=0;a<r.length;a+=2){var o=r[a].value,s=r[a+1].value;i.push({open:o,close:s})}return i}},Ia=function(e,t,n){if(!e)return"";var i=e[Math.min(t,e.length-1)];return i?n?i.open:i.close:""},Ea={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&_n(t[0],"none")?[]:kn(t).map((function(t){for(var n={color:255,offsetX:Gn,offsetY:Gn,blur:Gn,spread:Gn,inset:!1},i=0,r=0;r<t.length;r++){var a=t[r];_n(a,"inset")?n.inset=!0:Rn(a)?(0===i?n.offsetX=a:1===i?n.offsetY=a:2===i?n.blur=a:n.spread=a,i++):n.color=$n.parse(e,a)}return n}))}};!function(e){e[e.FILL=0]="FILL",e[e.STROKE=1]="STROKE",e[e.MARKERS=2]="MARKERS"}(va||(va={}));for(var Sa={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[va.FILL,va.STROKE,va.MARKERS],i=[];return t.filter(Ln).forEach((function(e){switch(e.value){case"stroke":i.push(va.STROKE);break;case"fill":i.push(va.FILL);break;case"markers":i.push(va.MARKERS)}})),n.forEach((function(e){-1===i.indexOf(e)&&i.push(e)})),i}},Ta={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},La={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Sn(t)?t.number:0}},Fa=function(){function e(e,t){var n,i;this.animationDuration=Pa(e,Ma,t.animationDuration),this.backgroundClip=Pa(e,ui,t.backgroundClip),this.backgroundColor=Pa(e,di,t.backgroundColor),this.backgroundImage=Pa(e,Hi,t.backgroundImage),this.backgroundOrigin=Pa(e,zi,t.backgroundOrigin),this.backgroundPosition=Pa(e,Vi,t.backgroundPosition),this.backgroundRepeat=Pa(e,Wi,t.backgroundRepeat),this.backgroundSize=Pa(e,Yi,t.backgroundSize),this.borderTopColor=Pa(e,qi,t.borderTopColor),this.borderRightColor=Pa(e,$i,t.borderRightColor),this.borderBottomColor=Pa(e,er,t.borderBottomColor),this.borderLeftColor=Pa(e,tr,t.borderLeftColor),this.borderTopLeftRadius=Pa(e,ir,t.borderTopLeftRadius),this.borderTopRightRadius=Pa(e,rr,t.borderTopRightRadius),this.borderBottomRightRadius=Pa(e,ar,t.borderBottomRightRadius),this.borderBottomLeftRadius=Pa(e,or,t.borderBottomLeftRadius),this.borderTopStyle=Pa(e,lr,t.borderTopStyle),this.borderRightStyle=Pa(e,cr,t.borderRightStyle),this.borderBottomStyle=Pa(e,hr,t.borderBottomStyle),this.borderLeftStyle=Pa(e,ur,t.borderLeftStyle),this.borderTopWidth=Pa(e,fr,t.borderTopWidth),this.borderRightWidth=Pa(e,pr,t.borderRightWidth),this.borderBottomWidth=Pa(e,mr,t.borderBottomWidth),this.borderLeftWidth=Pa(e,gr,t.borderLeftWidth),this.boxShadow=Pa(e,Ea,t.boxShadow),this.color=Pa(e,vr,t.color),this.direction=Pa(e,yr,t.direction),this.display=Pa(e,wr,t.display),this.float=Pa(e,Cr,t.cssFloat),this.fontFamily=Pa(e,fa,t.fontFamily),this.fontSize=Pa(e,pa,t.fontSize),this.fontStyle=Pa(e,ya,t.fontStyle),this.fontVariant=Pa(e,ga,t.fontVariant),this.fontWeight=Pa(e,ma,t.fontWeight),this.letterSpacing=Pa(e,Mr,t.letterSpacing),this.lineBreak=Pa(e,Ir,t.lineBreak),this.lineHeight=Pa(e,Er,t.lineHeight),this.listStyleImage=Pa(e,Tr,t.listStyleImage),this.listStylePosition=Pa(e,Fr,t.listStylePosition),this.listStyleType=Pa(e,Ur,t.listStyleType),this.marginTop=Pa(e,kr,t.marginTop),this.marginRight=Pa(e,Dr,t.marginRight),this.marginBottom=Pa(e,Rr,t.marginBottom),this.marginLeft=Pa(e,Or,t.marginLeft),this.opacity=Pa(e,ha,t.opacity);var r=Pa(e,Gr,t.overflow);this.overflowX=r[0],this.overflowY=r[r.length>1?1:0],this.overflowWrap=Pa(e,Qr,t.overflowWrap),this.paddingTop=Pa(e,zr,t.paddingTop),this.paddingRight=Pa(e,Vr,t.paddingRight),this.paddingBottom=Pa(e,jr,t.paddingBottom),this.paddingLeft=Pa(e,Wr,t.paddingLeft),this.paintOrder=Pa(e,Sa,t.paintOrder),this.position=Pa(e,Kr,t.position),this.textAlign=Pa(e,Zr,t.textAlign),this.textDecorationColor=Pa(e,ua,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=Pa(e,da,null!==(i=t.textDecorationLine)&&void 0!==i?i:t.textDecoration),this.textShadow=Pa(e,Jr,t.textShadow),this.textTransform=Pa(e,$r,t.textTransform),this.transform=Pa(e,ea,t.transform),this.transformOrigin=Pa(e,ra,t.transformOrigin),this.visibility=Pa(e,oa,t.visibility),this.webkitTextStrokeColor=Pa(e,Ta,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Pa(e,La,t.webkitTextStrokeWidth),this.wordBreak=Pa(e,Aa,t.wordBreak),this.zIndex=Pa(e,la,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===qr.VISIBLE},e.prototype.isTransparent=function(){return ei(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return this.position!==Xr.STATIC},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==sr.NONE},e.prototype.isInlineLevel=function(){return wa(this.display,4)||wa(this.display,33554432)||wa(this.display,268435456)||wa(this.display,536870912)||wa(this.display,67108864)||wa(this.display,134217728)},e}(),_a=function(){function e(e,t){this.content=Pa(e,xa,t.content),this.quotes=Pa(e,Ba,t.quotes)}return e}(),Ua=function(){function e(e,t){this.counterIncrement=Pa(e,ba,t.counterIncrement),this.counterReset=Pa(e,Ca,t.counterReset)}return e}(),Pa=function(e,t,n){var i=new In,r=null!=n?n.toString():t.initialValue;i.write(r);var a=new En(i.read());switch(t.type){case 2:var o=a.parseComponentValue();return t.parse(e,Ln(o)?o.value:t.initialValue);case 0:return t.parse(e,a.parseComponentValue());case 1:return t.parse(e,a.parseComponentValues());case 4:return a.parseComponentValue();case 3:switch(t.format){case"angle":return Yn.parse(e,a.parseComponentValue());case"color":return $n.parse(e,a.parseComponentValue());case"image":return Oi.parse(e,a.parseComponentValue());case"length":var s=a.parseComponentValue();return Rn(s)?s:Gn;case"length-percentage":var A=a.parseComponentValue();return On(A)?A:Gn;case"time":return ca.parse(e,a.parseComponentValue())}}},ka="data-html2canvas-debug",Da=function(e){switch(e.getAttribute(ka)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Ra=function(e,t){var n=Da(e);return 1===n||t===n},Oa=function(){function e(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,Ra(t,3),this.styles=new Fa(e,window.getComputedStyle(t,null)),Bs(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=s(this.context,t),Ra(t,4)&&(this.flags|=16)}return e}(),Na="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Ga="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qa="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ha=0;Ha<Ga.length;Ha++)Qa[Ga.charCodeAt(Ha)]=Ha;for(var za=function(e){var t,n,i,r,a,o=.75*e.length,s=e.length,A=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(o):new Array(o),c=Array.isArray(l)?l:new Uint8Array(l);for(t=0;t<s;t+=4)n=Qa[e.charCodeAt(t)],i=Qa[e.charCodeAt(t+1)],r=Qa[e.charCodeAt(t+2)],a=Qa[e.charCodeAt(t+3)],c[A++]=n<<2|i>>4,c[A++]=(15&i)<<4|r>>2,c[A++]=(3&r)<<6|63&a;return l},Va=function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n.push(e[i+1]<<8|e[i]);return n},ja=function(e){for(var t=e.length,n=[],i=0;i<t;i+=4)n.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return n},Wa=5,Xa=11,Za=2,Ya=65536>>Wa,Ka=(1<<Wa)-1,Ja=Ya+(1024>>Wa)+32,qa=65536>>Xa,$a=(1<<Xa-Wa)-1,eo=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},to=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},no=function(e,t){var n=za(e),i=Array.isArray(n)?ja(n):new Uint32Array(n),r=Array.isArray(n)?Va(n):new Uint16Array(n),a=24,o=eo(r,a/2,i[4]/2),s=2===i[5]?eo(r,(a+i[4])/2):to(i,Math.ceil((a+i[4])/4));return new io(i[0],i[1],i[2],i[3],o,s)},io=function(){function e(e,t,n,i,r,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=r,this.data=a}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>Wa])<<Za)+(e&Ka),this.data[t];if(e<=65535)return t=((t=this.index[Ya+(e-55296>>Wa)])<<Za)+(e&Ka),this.data[t];if(e<this.highStart)return t=Ja-qa+(e>>Xa),t=this.index[t],t+=e>>Wa&$a,t=((t=this.index[t])<<Za)+(e&Ka),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),ro="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ao="undefined"==typeof Uint8Array?[]:new Uint8Array(256),oo=0;oo<ro.length;oo++)ao[ro.charCodeAt(oo)]=oo;var so,Ao=1,lo=2,co=3,ho=4,uo=5,fo=7,po=8,mo=9,go=10,vo=11,yo=12,wo=13,xo=14,bo=15,Co=function(e){for(var t=[],n=0,i=e.length;n<i;){var r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var a=e.charCodeAt(n++);56320==(64512&a)?t.push(((1023&r)<<10)+(1023&a)+65536):(t.push(r),n--)}else t.push(r)}return t},Mo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var i=[],r=-1,a="";++r<n;){var o=e[r];o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)),(r+1===n||i.length>16384)&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return a},Bo=no(Na),Io="",Eo="",So=function(e){return Bo.get(e)},To=function(e,t,n){var i=n-2,r=t[i],a=t[n-1],o=t[n];if(a===lo&&o===co)return Io;if(a===lo||a===co||a===ho)return Eo;if(o===lo||o===co||o===ho)return Eo;if(a===po&&-1!==[po,mo,vo,yo].indexOf(o))return Io;if(!(a!==vo&&a!==mo||o!==mo&&o!==go))return Io;if((a===yo||a===go)&&o===go)return Io;if(o===wo||o===uo)return Io;if(o===fo)return Io;if(a===Ao)return Io;if(a===wo&&o===xo){for(;r===uo;)r=t[--i];if(r===xo)return Io}if(a===bo&&o===bo){for(var s=0;r===bo;)s++,r=t[--i];if(s%2==0)return Io}return Eo},Lo=function(e){var t=Co(e),n=t.length,i=0,r=0,a=t.map(So);return{next:function(){if(i>=n)return{done:!0,value:null};for(var e=Io;i<n&&(e=To(t,a,++i))===Io;);if(e!==Io||i===n){var o=Mo.apply(null,t.slice(r,i));return r=i,{value:o,done:!1}}return{done:!0,value:null}}}},Fo=function(e){for(var t,n=Lo(e),i=[];!(t=n.next()).done;)t.value&&i.push(t.value.slice());return i},_o=function(e){var t=123;if(e.createRange){var n=e.createRange();if(n.getBoundingClientRect){var i=e.createElement("boundtest");i.style.height=t+"px",i.style.display="block",e.body.appendChild(i),n.selectNode(i);var r=n.getBoundingClientRect(),a=Math.round(r.height);if(e.body.removeChild(i),a===t)return!0}}return!1},Uo=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var i=t.firstChild,r=l(i.data).map((function(e){return c(e)})),a=0,o={},s=r.every((function(e,t){n.setStart(i,a),n.setEnd(i,a+e.length);var r=n.getBoundingClientRect();a+=e.length;var s=r.x>o.x||r.y>o.y;return o=r,0===t||s}));return e.body.removeChild(t),s},Po=function(){return void 0!==(new Image).crossOrigin},ko=function(){return"string"==typeof(new XMLHttpRequest).responseType},Do=function(e){var t=new Image,n=e.createElement("canvas"),i=n.getContext("2d");if(!i)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(t,0,0),n.toDataURL()}catch(e){return!1}return!0},Ro=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},Oo=function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var i=t.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,n,n);var r=new Image,a=t.toDataURL();r.src=a;var o=No(n,n,0,0,r);return i.fillStyle="red",i.fillRect(0,0,n,n),Go(o).then((function(t){i.drawImage(t,0,0);var r=i.getImageData(0,0,n,n).data;i.fillStyle="red",i.fillRect(0,0,n,n);var o=e.createElement("div");return o.style.backgroundImage="url("+a+")",o.style.height=n+"px",Ro(r)?Go(No(n,n,0,0,o)):Promise.reject(!1)})).then((function(e){return i.drawImage(e,0,0),Ro(i.getImageData(0,0,n,n).data)})).catch((function(){return!1}))},No=function(e,t,n,i,r){var a="http://www.w3.org/2000/svg",o=document.createElementNS(a,"svg"),s=document.createElementNS(a,"foreignObject");return o.setAttributeNS(null,"width",e.toString()),o.setAttributeNS(null,"height",t.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",n.toString()),s.setAttributeNS(null,"y",i.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(s),s.appendChild(r),o},Go=function(e){return new Promise((function(t,n){var i=new Image;i.onload=function(){return t(i)},i.onerror=n,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Qo={get SUPPORT_RANGE_BOUNDS(){var e=_o(document);return Object.defineProperty(Qo,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Qo.SUPPORT_RANGE_BOUNDS&&Uo(document);return Object.defineProperty(Qo,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=Do(document);return Object.defineProperty(Qo,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?Oo(document):Promise.resolve(!1);return Object.defineProperty(Qo,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=Po();return Object.defineProperty(Qo,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=ko();return Object.defineProperty(Qo,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Qo,"SUPPORT_CORS_XHR",{value:e}),e}},Ho=function(){function e(e,t){this.text=e,this.bounds=t}return e}(),zo=function(e,t,n,i){var r=Xo(t,n),a=[],s=0;return r.forEach((function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Qo.SUPPORT_RANGE_BOUNDS)Qo.SUPPORT_WORD_BREAKING?a.push(new Ho(t,Wo(e,i,s,t.length))):a.push(new Ho(t,o.fromDOMRectList(e,jo(i,s,t.length).getClientRects())));else{var r=i.splitText(t.length);a.push(new Ho(t,Vo(e,i))),i=r}else Qo.SUPPORT_RANGE_BOUNDS||(i=i.splitText(t.length));s+=t.length})),a},Vo=function(e,t){var n=t.ownerDocument;if(n){var i=n.createElement("html2canvaswrapper");i.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(i,t);var a=s(e,i);return i.firstChild&&r.replaceChild(i.firstChild,i),a}}return o.EMPTY},jo=function(e,t,n){var i=e.ownerDocument;if(!i)throw new Error("Node has no owner document");var r=i.createRange();return r.setStart(e,t),r.setEnd(e,t+n),r},Wo=function(e,t,n,i){return o.fromClientRect(e,jo(t,n,i).getBoundingClientRect())},Xo=function(e,t){return 0!==t.letterSpacing?Fo(e):Yo(e,t)},Zo=[32,160,4961,65792,65793,4153,4241],Yo=function(e,t){for(var n,i=Ne(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),r=[],a=function(){if(n.value){var e=n.value.slice(),t=l(e),i="";t.forEach((function(e){-1===Zo.indexOf(e)?i+=c(e):(i.length&&r.push(i),r.push(c(e)),i="")})),i.length&&r.push(i)}};!(n=i.next()).done;)a();return r},Ko=function(){function e(e,t,n){this.text=Jo(t.data,n.textTransform),this.textBounds=zo(e,this.text,n,t)}return e}(),Jo=function(e,t){switch(t){case Yr.LOWERCASE:return e.toLowerCase();case Yr.CAPITALIZE:return e.replace(qo,$o);case Yr.UPPERCASE:return e.toUpperCase();default:return e}},qo=/(^|\s|:|-|\(|\))([a-z])/g,$o=function(e,t,n){return e.length>0?t+n.toUpperCase():e},es=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return t(n,e),n}(Oa),ts=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return t(n,e),n}(Oa),ns=function(e){function n(t,n){var i=e.call(this,t,n)||this,r=new XMLSerializer,a=s(t,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return t(n,e),n}(Oa),is=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.value=n.value,i}return t(n,e),n}(Oa),rs=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.start=n.start,i.reversed="boolean"==typeof n.reversed&&!0===n.reversed,i}return t(n,e),n}(Oa),as=[{type:15,flags:0,unit:"px",number:3}],os=[{type:16,flags:0,number:50}],ss=function(e){return e.width>e.height?new o(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new o(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},As=function(e){var t=e.type===hs?new Array(e.value.length+1).join(""):e.value;return 0===t.length?e.placeholder||"":t},ls="checkbox",cs="radio",hs="password",us=707406591,ds=function(e){function n(t,n){var i=e.call(this,t,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=As(n),i.type!==ls&&i.type!==cs||(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=Zi.SOLID,i.styles.backgroundClip=[oi.BORDER_BOX],i.styles.backgroundOrigin=[0],i.bounds=ss(i.bounds)),i.type){case ls:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=as;break;case cs:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=os}return i}return t(n,e),n}(Oa),fs=function(e){function n(t,n){var i=e.call(this,t,n)||this,r=n.options[n.selectedIndex||0];return i.value=r&&r.text||"",i}return t(n,e),n}(Oa),ps=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.value=n.value,i}return t(n,e),n}(Oa),ms=function(e){function n(t,n){var i=e.call(this,t,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=ws(t,n.contentWindow.document.documentElement);var r=n.contentWindow.document.documentElement?li(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):ci.TRANSPARENT,a=n.contentWindow.document.body?li(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):ci.TRANSPARENT;i.backgroundColor=ei(r)?ei(a)?i.styles.backgroundColor:a:r}}catch(e){}return i}return t(n,e),n}(Oa),gs=["OL","UL","MENU"],vs=function(e,t,n,i){for(var r=t.firstChild,a=void 0;r;r=a)if(a=r.nextSibling,Cs(r)&&r.data.trim().length>0)n.textNodes.push(new Ko(e,r,n.styles));else if(Ms(r))if(Gs(r)&&r.assignedNodes)r.assignedNodes().forEach((function(t){return vs(e,t,n,i)}));else{var o=ys(e,r);o.styles.isVisible()&&(xs(r,o,i)?o.flags|=4:bs(o.styles)&&(o.flags|=2),-1!==gs.indexOf(r.tagName)&&(o.flags|=8),n.elements.push(o),r.slot,r.shadowRoot?vs(e,r.shadowRoot,o,i):Os(r)||Fs(r)||Ns(r)||vs(e,r,o,i))}},ys=function(e,t){return Ps(t)?new es(e,t):Us(t)?new ts(e,t):Fs(t)?new ns(e,t):Es(t)?new is(e,t):Ss(t)?new rs(e,t):Ts(t)?new ds(e,t):Ns(t)?new fs(e,t):Os(t)?new ps(e,t):ks(t)?new ms(e,t):new Oa(e,t)},ws=function(e,t){var n=ys(e,t);return n.flags|=4,vs(e,t,n,n),n},xs=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||_s(e)&&n.styles.isTransparent()},bs=function(e){return e.isPositioned()||e.isFloating()},Cs=function(e){return e.nodeType===Node.TEXT_NODE},Ms=function(e){return e.nodeType===Node.ELEMENT_NODE},Bs=function(e){return Ms(e)&&void 0!==e.style&&!Is(e)},Is=function(e){return"object"==typeof e.className},Es=function(e){return"LI"===e.tagName},Ss=function(e){return"OL"===e.tagName},Ts=function(e){return"INPUT"===e.tagName},Ls=function(e){return"HTML"===e.tagName},Fs=function(e){return"svg"===e.tagName},_s=function(e){return"BODY"===e.tagName},Us=function(e){return"CANVAS"===e.tagName},Ps=function(e){return"IMG"===e.tagName},ks=function(e){return"IFRAME"===e.tagName},Ds=function(e){return"STYLE"===e.tagName},Rs=function(e){return"SCRIPT"===e.tagName},Os=function(e){return"TEXTAREA"===e.tagName},Ns=function(e){return"SELECT"===e.tagName},Gs=function(e){return"SLOT"===e.tagName},Qs=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,i=e.counterReset,r=!0;null!==n&&n.forEach((function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(r=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)}));var a=[];return r&&i.forEach((function(e){var n=t.counters[e.counter];a.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)})),a},e}(),Hs={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},zs={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Vs={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},js={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Ws=function(e,t,n,i,r,a){return e<t||e>n?aA(e,r,a.length>0):i.integers.reduce((function(t,n,r){for(;e>=n;)e-=n,t+=i.values[r];return t}),"")+a},Xs=function(e,t,n,i){var r="";do{n||e--,r=i(e)+r,e/=t}while(e*t>=t);return r},Zs=function(e,t,n,i,r){var a=n-t+1;return(e<0?"-":"")+(Xs(Math.abs(e),a,i,(function(e){return c(Math.floor(e%a)+t)}))+r)},Ys=function(e,t,n){void 0===n&&(n=". ");var i=t.length;return Xs(Math.abs(e),i,!1,(function(e){return t[Math.floor(e%i)]}))+n},Ks=1,Js=2,qs=4,$s=8,eA=function(e,t,n,i,r,a){if(e<-9999||e>9999)return aA(e,Lr.CJK_DECIMAL,r.length>0);var o=Math.abs(e),s=r;if(0===o)return t[0]+s;for(var A=0;o>0&&A<=4;A++){var l=o%10;0===l&&wa(a,Ks)&&""!==s?s=t[l]+s:l>1||1===l&&0===A||1===l&&1===A&&wa(a,Js)||1===l&&1===A&&wa(a,qs)&&e>100||1===l&&A>1&&wa(a,$s)?s=t[l]+(A>0?n[A-1]:"")+s:1===l&&A>0&&(s=n[A-1]+s),o=Math.floor(o/10)}return(e<0?i:"")+s},tA="",nA="",iA="",rA="",aA=function(e,t,n){var i=n?". ":"",r=n?"":"",a=n?", ":"",o=n?" ":"";switch(t){case Lr.DISC:return""+o;case Lr.CIRCLE:return""+o;case Lr.SQUARE:return""+o;case Lr.DECIMAL_LEADING_ZERO:var s=Zs(e,48,57,!0,i);return s.length<4?"0"+s:s;case Lr.CJK_DECIMAL:return Ys(e,"",r);case Lr.LOWER_ROMAN:return Ws(e,1,3999,Hs,Lr.DECIMAL,i).toLowerCase();case Lr.UPPER_ROMAN:return Ws(e,1,3999,Hs,Lr.DECIMAL,i);case Lr.LOWER_GREEK:return Zs(e,945,969,!1,i);case Lr.LOWER_ALPHA:return Zs(e,97,122,!1,i);case Lr.UPPER_ALPHA:return Zs(e,65,90,!1,i);case Lr.ARABIC_INDIC:return Zs(e,1632,1641,!0,i);case Lr.ARMENIAN:case Lr.UPPER_ARMENIAN:return Ws(e,1,9999,zs,Lr.DECIMAL,i);case Lr.LOWER_ARMENIAN:return Ws(e,1,9999,zs,Lr.DECIMAL,i).toLowerCase();case Lr.BENGALI:return Zs(e,2534,2543,!0,i);case Lr.CAMBODIAN:case Lr.KHMER:return Zs(e,6112,6121,!0,i);case Lr.CJK_EARTHLY_BRANCH:return Ys(e,"",r);case Lr.CJK_HEAVENLY_STEM:return Ys(e,"",r);case Lr.CJK_IDEOGRAPHIC:case Lr.TRAD_CHINESE_INFORMAL:return eA(e,"",tA,"",r,Js|qs|$s);case Lr.TRAD_CHINESE_FORMAL:return eA(e,"",nA,"",r,Ks|Js|qs|$s);case Lr.SIMP_CHINESE_INFORMAL:return eA(e,"",tA,"",r,Js|qs|$s);case Lr.SIMP_CHINESE_FORMAL:return eA(e,"",nA,"",r,Ks|Js|qs|$s);case Lr.JAPANESE_INFORMAL:return eA(e,"","",iA,r,0);case Lr.JAPANESE_FORMAL:return eA(e,"","",iA,r,Ks|Js|qs);case Lr.KOREAN_HANGUL_FORMAL:return eA(e,"","",rA,a,Ks|Js|qs);case Lr.KOREAN_HANJA_INFORMAL:return eA(e,"","",rA,a,0);case Lr.KOREAN_HANJA_FORMAL:return eA(e,"","",rA,a,Ks|Js|qs);case Lr.DEVANAGARI:return Zs(e,2406,2415,!0,i);case Lr.GEORGIAN:return Ws(e,1,19999,js,Lr.DECIMAL,i);case Lr.GUJARATI:return Zs(e,2790,2799,!0,i);case Lr.GURMUKHI:return Zs(e,2662,2671,!0,i);case Lr.HEBREW:return Ws(e,1,10999,Vs,Lr.DECIMAL,i);case Lr.HIRAGANA:return Ys(e,"");case Lr.HIRAGANA_IROHA:return Ys(e,"");case Lr.KANNADA:return Zs(e,3302,3311,!0,i);case Lr.KATAKANA:return Ys(e,"",r);case Lr.KATAKANA_IROHA:return Ys(e,"",r);case Lr.LAO:return Zs(e,3792,3801,!0,i);case Lr.MONGOLIAN:return Zs(e,6160,6169,!0,i);case Lr.MYANMAR:return Zs(e,4160,4169,!0,i);case Lr.ORIYA:return Zs(e,2918,2927,!0,i);case Lr.PERSIAN:return Zs(e,1776,1785,!0,i);case Lr.TAMIL:return Zs(e,3046,3055,!0,i);case Lr.TELUGU:return Zs(e,3174,3183,!0,i);case Lr.THAI:return Zs(e,3664,3673,!0,i);case Lr.TIBETAN:return Zs(e,3872,3881,!0,i);case Lr.DECIMAL:default:return Zs(e,48,57,!0,i)}},oA="data-html2canvas-ignore",sA=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new Qs,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement)}return e.prototype.toIFrame=function(e,t){var n=this,a=lA(e,t);if(!a.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,s=e.defaultView.pageYOffset,A=a.contentWindow,l=A.document,c=uA(a).then((function(){return i(n,void 0,void 0,(function(){var e,n;return r(this,(function(i){switch(i.label){case 0:return this.scrolledElements.forEach(gA),A&&(A.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||A.scrollY===t.top&&A.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(A.scrollX-t.left,A.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:l.fonts&&l.fonts.ready?[4,l.fonts.ready]:[3,2];case 1:i.sent(),i.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,hA(l)]:[3,4];case 3:i.sent(),i.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(l,n)})).then((function(){return a}))]:[2,a]}}))}))}));return l.open(),l.write(pA(document.doctype)+"<html></html>"),mA(this.referenceElement.ownerDocument,o,s),l.replaceChild(l.adoptNode(this.documentElement),l.documentElement),l.close(),c},e.prototype.createElementClone=function(e){if(Ra(e,2),Us(e))return this.createCanvasClone(e);if(Ds(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return Ps(t)&&(Ps(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),i=e.cloneNode(!1);return i.textContent=n,i}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch(t){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var r=e.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&r)a.putImageData(r.getImageData(0,0,e.width,e.height),0,0);else{var o=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(o){var s=o.getContextAttributes();!1===(null==s?void 0:s.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}a.drawImage(e,0,0)}return i}catch(t){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},e.prototype.cloneNode=function(e){if(Cs(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var t=e.ownerDocument.defaultView;if(t&&Ms(e)&&(Bs(e)||Is(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var i=t.getComputedStyle(e),r=t.getComputedStyle(e,":before"),a=t.getComputedStyle(e,":after");this.referenceElement===e&&Bs(n)&&(this.clonedReferenceElement=n),_s(n)&&CA(n);for(var o=this.counters.parse(new Ua(this.context,i)),s=this.resolvePseudoContent(e,n,r,so.BEFORE),A=e.firstChild;A;A=A.nextSibling)Ms(A)&&(Rs(A)||A.hasAttribute(oA)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(A))||this.options.copyStyles&&Ms(A)&&Ds(A)||n.appendChild(this.cloneNode(A));s&&n.insertBefore(s,n.firstChild);var l=this.resolvePseudoContent(e,n,a,so.AFTER);return l&&n.appendChild(l),this.counters.pop(o),i&&(this.options.copyStyles||Is(e))&&!ks(e)&&fA(i,n),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(Os(e)||Ns(e))&&(Os(n)||Ns(n))&&(n.value=e.value),n}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,i){var r=this;if(n){var a=n.content,o=t.ownerDocument;if(o&&a&&"none"!==a&&"-moz-alt-content"!==a&&"none"!==n.display){this.counters.parse(new Ua(this.context,n));var s=new _a(this.context,n),A=o.createElement("html2canvaspseudoelement");fA(n,A),s.content.forEach((function(t){if(0===t.type)A.appendChild(o.createTextNode(t.value));else if(22===t.type){var n=o.createElement("img");n.src=t.value,n.style.opacity="1",A.appendChild(n)}else if(18===t.type){if("attr"===t.name){var i=t.values.filter(Ln);i.length&&A.appendChild(o.createTextNode(e.getAttribute(i[0].value)||""))}else if("counter"===t.name){var a=t.values.filter(Pn),l=a[0],c=a[1];if(l&&Ln(l)){var h=r.counters.getCounterValue(l.value),u=c&&Ln(c)?Ur.parse(r.context,c.value):Lr.DECIMAL;A.appendChild(o.createTextNode(aA(h,u,!1)))}}else if("counters"===t.name){var d=t.values.filter(Pn),f=(l=d[0],d[1]);if(c=d[2],l&&Ln(l)){var p=r.counters.getCounterValues(l.value),m=c&&Ln(c)?Ur.parse(r.context,c.value):Lr.DECIMAL,g=f&&0===f.type?f.value:"",v=p.map((function(e){return aA(e,m,!1)})).join(g);A.appendChild(o.createTextNode(v))}}}else if(20===t.type)switch(t.value){case"open-quote":A.appendChild(o.createTextNode(Ia(s.quotes,r.quoteDepth++,!0)));break;case"close-quote":A.appendChild(o.createTextNode(Ia(s.quotes,--r.quoteDepth,!1)));break;default:A.appendChild(o.createTextNode(t.value))}})),A.className=wA+" "+xA;var l=i===so.BEFORE?" "+wA:" "+xA;return Is(t)?t.className.baseValue+=l:t.className+=l,A}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(so||(so={}));var AA,lA=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(oA,"true"),e.body.appendChild(n),n},cA=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},hA=function(e){return Promise.all([].slice.call(e.images,0).map(cA))},uA=function(e){return new Promise((function(t,n){var i=e.contentWindow;if(!i)return n("No window assigned for iframe");var r=i.document;i.onload=e.onload=function(){i.onload=e.onload=null;var n=setInterval((function(){r.body.childNodes.length>0&&"complete"===r.readyState&&(clearInterval(n),t(e))}),50)}}))},dA=["all","d","content"],fA=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e.item(n);-1===dA.indexOf(i)&&t.style.setProperty(i,e.getPropertyValue(i))}return t},pA=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},mA=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},gA=function(e){var t=e[0],n=e[1],i=e[2];t.scrollLeft=n,t.scrollTop=i},vA=":before",yA=":after",wA="___html2canvas___pseudoelement_before",xA="___html2canvas___pseudoelement_after",bA='{\n    content: "" !important;\n    display: none !important;\n}',CA=function(e){MA(e,"."+wA+vA+bA+"\n         ."+xA+yA+bA)},MA=function(e,t){var n=e.ownerDocument;if(n){var i=n.createElement("style");i.textContent=t,e.appendChild(i)}},BA=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),IA=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:UA(e)||LA(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a,o=this;return r(this,(function(r){switch(r.label){case 0:return t=BA.isSameOrigin(e),n=!FA(e)&&!0===this._options.useCORS&&Qo.SUPPORT_CORS_IMAGES&&!t,i=!FA(e)&&!t&&!UA(e)&&"string"==typeof this._options.proxy&&Qo.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||FA(e)||UA(e)||i||n?(a=e,i?[4,this.proxy(a)]:[3,2]):[2];case 1:a=r.sent(),r.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var i=new Image;i.onload=function(){return e(i)},i.onerror=t,(_A(a)||n)&&(i.crossOrigin="anonymous"),i.src=a,!0===i.complete&&setTimeout((function(){return e(i)}),500),o._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+o._options.imageTimeout+"ms) loading image")}),o._options.imageTimeout)}))];case 3:return[2,r.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise((function(r,a){var o=Qo.SUPPORT_RESPONSE_TYPE?"blob":"text",s=new XMLHttpRequest;s.onload=function(){if(200===s.status)if("text"===o)r(s.response);else{var e=new FileReader;e.addEventListener("load",(function(){return r(e.result)}),!1),e.addEventListener("error",(function(e){return a(e)}),!1),e.readAsDataURL(s.response)}else a("Failed to proxy resource "+i+" with status code "+s.status)},s.onerror=a;var A=n.indexOf("?")>-1?"&":"?";if(s.open("GET",""+n+A+"url="+encodeURIComponent(e)+"&responseType="+o),"text"!==o&&s instanceof XMLHttpRequest&&(s.responseType=o),t._options.imageTimeout){var l=t._options.imageTimeout;s.timeout=l,s.ontimeout=function(){return a("Timed out ("+l+"ms) proxying "+i)}}s.send()}))},e}(),EA=/^data:image\/svg\+xml/i,SA=/^data:image\/.*;base64,/i,TA=/^data:image\/.*/i,LA=function(e){return Qo.SUPPORT_SVG_DRAWING||!PA(e)},FA=function(e){return TA.test(e)},_A=function(e){return SA.test(e)},UA=function(e){return"blob"===e.substr(0,4)},PA=function(e){return"svg"===e.substr(-3).toLowerCase()||EA.test(e)};!function(e){e[e.VECTOR=0]="VECTOR",e[e.BEZIER_CURVE=1]="BEZIER_CURVE"}(AA||(AA={}));var kA,DA=function(e,t){return e.length===t.length&&e.some((function(e,n){return e===t[n]}))},RA=function(e,t,n,i,r){return e.map((function(e,a){switch(a){case 0:return e.add(t,n);case 1:return e.add(t+i,n);case 2:return e.add(t+i,n+r);case 3:return e.add(t,n+r)}return e}))},OA=function(){function e(e,t){this.type=AA.VECTOR,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),NA=function(e,t,n){return new OA(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},GA=function(){function e(e,t,n,i){this.type=AA.BEZIER_CURVE,this.start=e,this.startControl=t,this.endControl=n,this.end=i}return e.prototype.subdivide=function(t,n){var i=NA(this.start,this.startControl,t),r=NA(this.startControl,this.endControl,t),a=NA(this.endControl,this.end,t),o=NA(i,r,t),s=NA(r,a,t),A=NA(o,s,t);return n?new e(this.start,i,o,A):new e(A,s,a,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),QA=function(e){return e.type===AA.BEZIER_CURVE},HA=function(){function e(e){var t=e.styles,n=e.bounds,i=zn(t.borderTopLeftRadius,n.width,n.height),r=i[0],a=i[1],o=zn(t.borderTopRightRadius,n.width,n.height),s=o[0],A=o[1],l=zn(t.borderBottomRightRadius,n.width,n.height),c=l[0],h=l[1],u=zn(t.borderBottomLeftRadius,n.width,n.height),d=u[0],f=u[1],p=[];p.push((r+s)/n.width),p.push((d+c)/n.width),p.push((a+f)/n.height),p.push((A+h)/n.height);var m=Math.max.apply(Math,p);m>1&&(r/=m,a/=m,s/=m,A/=m,c/=m,h/=m,d/=m,f/=m);var g=n.width-s,v=n.height-h,y=n.width-c,w=n.height-f,x=t.borderTopWidth,b=t.borderRightWidth,C=t.borderBottomWidth,M=t.borderLeftWidth,B=Vn(t.paddingTop,e.bounds.width),I=Vn(t.paddingRight,e.bounds.width),E=Vn(t.paddingBottom,e.bounds.width),S=Vn(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=r>0||a>0?zA(n.left+M/3,n.top+x/3,r-M/3,a-x/3,kA.TOP_LEFT):new OA(n.left+M/3,n.top+x/3),this.topRightBorderDoubleOuterBox=r>0||a>0?zA(n.left+g,n.top+x/3,s-b/3,A-x/3,kA.TOP_RIGHT):new OA(n.left+n.width-b/3,n.top+x/3),this.bottomRightBorderDoubleOuterBox=c>0||h>0?zA(n.left+y,n.top+v,c-b/3,h-C/3,kA.BOTTOM_RIGHT):new OA(n.left+n.width-b/3,n.top+n.height-C/3),this.bottomLeftBorderDoubleOuterBox=d>0||f>0?zA(n.left+M/3,n.top+w,d-M/3,f-C/3,kA.BOTTOM_LEFT):new OA(n.left+M/3,n.top+n.height-C/3),this.topLeftBorderDoubleInnerBox=r>0||a>0?zA(n.left+2*M/3,n.top+2*x/3,r-2*M/3,a-2*x/3,kA.TOP_LEFT):new OA(n.left+2*M/3,n.top+2*x/3),this.topRightBorderDoubleInnerBox=r>0||a>0?zA(n.left+g,n.top+2*x/3,s-2*b/3,A-2*x/3,kA.TOP_RIGHT):new OA(n.left+n.width-2*b/3,n.top+2*x/3),this.bottomRightBorderDoubleInnerBox=c>0||h>0?zA(n.left+y,n.top+v,c-2*b/3,h-2*C/3,kA.BOTTOM_RIGHT):new OA(n.left+n.width-2*b/3,n.top+n.height-2*C/3),this.bottomLeftBorderDoubleInnerBox=d>0||f>0?zA(n.left+2*M/3,n.top+w,d-2*M/3,f-2*C/3,kA.BOTTOM_LEFT):new OA(n.left+2*M/3,n.top+n.height-2*C/3),this.topLeftBorderStroke=r>0||a>0?zA(n.left+M/2,n.top+x/2,r-M/2,a-x/2,kA.TOP_LEFT):new OA(n.left+M/2,n.top+x/2),this.topRightBorderStroke=r>0||a>0?zA(n.left+g,n.top+x/2,s-b/2,A-x/2,kA.TOP_RIGHT):new OA(n.left+n.width-b/2,n.top+x/2),this.bottomRightBorderStroke=c>0||h>0?zA(n.left+y,n.top+v,c-b/2,h-C/2,kA.BOTTOM_RIGHT):new OA(n.left+n.width-b/2,n.top+n.height-C/2),this.bottomLeftBorderStroke=d>0||f>0?zA(n.left+M/2,n.top+w,d-M/2,f-C/2,kA.BOTTOM_LEFT):new OA(n.left+M/2,n.top+n.height-C/2),this.topLeftBorderBox=r>0||a>0?zA(n.left,n.top,r,a,kA.TOP_LEFT):new OA(n.left,n.top),this.topRightBorderBox=s>0||A>0?zA(n.left+g,n.top,s,A,kA.TOP_RIGHT):new OA(n.left+n.width,n.top),this.bottomRightBorderBox=c>0||h>0?zA(n.left+y,n.top+v,c,h,kA.BOTTOM_RIGHT):new OA(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=d>0||f>0?zA(n.left,n.top+w,d,f,kA.BOTTOM_LEFT):new OA(n.left,n.top+n.height),this.topLeftPaddingBox=r>0||a>0?zA(n.left+M,n.top+x,Math.max(0,r-M),Math.max(0,a-x),kA.TOP_LEFT):new OA(n.left+M,n.top+x),this.topRightPaddingBox=s>0||A>0?zA(n.left+Math.min(g,n.width-b),n.top+x,g>n.width+b?0:Math.max(0,s-b),Math.max(0,A-x),kA.TOP_RIGHT):new OA(n.left+n.width-b,n.top+x),this.bottomRightPaddingBox=c>0||h>0?zA(n.left+Math.min(y,n.width-M),n.top+Math.min(v,n.height-C),Math.max(0,c-b),Math.max(0,h-C),kA.BOTTOM_RIGHT):new OA(n.left+n.width-b,n.top+n.height-C),this.bottomLeftPaddingBox=d>0||f>0?zA(n.left+M,n.top+Math.min(w,n.height-C),Math.max(0,d-M),Math.max(0,f-C),kA.BOTTOM_LEFT):new OA(n.left+M,n.top+n.height-C),this.topLeftContentBox=r>0||a>0?zA(n.left+M+S,n.top+x+B,Math.max(0,r-(M+S)),Math.max(0,a-(x+B)),kA.TOP_LEFT):new OA(n.left+M+S,n.top+x+B),this.topRightContentBox=s>0||A>0?zA(n.left+Math.min(g,n.width+M+S),n.top+x+B,g>n.width+M+S?0:s-M+S,A-(x+B),kA.TOP_RIGHT):new OA(n.left+n.width-(b+I),n.top+x+B),this.bottomRightContentBox=c>0||h>0?zA(n.left+Math.min(y,n.width-(M+S)),n.top+Math.min(v,n.height+x+B),Math.max(0,c-(b+I)),h-(C+E),kA.BOTTOM_RIGHT):new OA(n.left+n.width-(b+I),n.top+n.height-(C+E)),this.bottomLeftContentBox=d>0||f>0?zA(n.left+M+S,n.top+w,Math.max(0,d-(M+S)),f-(C+E),kA.BOTTOM_LEFT):new OA(n.left+M+S,n.top+n.height-(C+E))}return e}();!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(kA||(kA={}));var zA=function(e,t,n,i,r){var a=(Math.sqrt(2)-1)/3*4,o=n*a,s=i*a,A=e+n,l=t+i;switch(r){case kA.TOP_LEFT:return new GA(new OA(e,l),new OA(e,l-s),new OA(A-o,t),new OA(A,t));case kA.TOP_RIGHT:return new GA(new OA(e,t),new OA(e+o,t),new OA(A,l-s),new OA(A,l));case kA.BOTTOM_RIGHT:return new GA(new OA(A,t),new OA(A,t+s),new OA(e+o,l),new OA(e,l));case kA.BOTTOM_LEFT:default:return new GA(new OA(A,l),new OA(A-o,l),new OA(e,t+s),new OA(e,t))}},VA=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},jA=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},WA=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},XA=function(){function e(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return e}(),ZA=function(){function e(e,t){this.path=e,this.target=t,this.type=1}return e}(),YA=function(){function e(e){this.opacity=e,this.type=2,this.target=6}return e}(),KA=function(e){return 0===e.type},JA=function(e){return 1===e.type},qA=function(e){return 2===e.type},$A=function(){function e(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e}(),el=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new HA(this.container),this.container.styles.opacity<1&&this.effects.push(new YA(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,r=this.container.styles.transform;this.effects.push(new XA(n,i,r))}if(this.container.styles.overflowX!==_r.VISIBLE){var a=VA(this.curves),o=WA(this.curves);DA(a,o)?this.effects.push(new ZA(a,6)):(this.effects.push(new ZA(a,2)),this.effects.push(new ZA(o,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[Xr.ABSOLUTE,Xr.FIXED].indexOf(this.container.styles.position),n=this.parent,i=this.effects.slice(0);n;){var r=n.effects.filter((function(e){return!JA(e)}));if(t||n.container.styles.position!==Xr.STATIC||!n.parent){if(i.unshift.apply(i,r),t=-1===[Xr.ABSOLUTE,Xr.FIXED].indexOf(n.container.styles.position),n.container.styles.overflowX!==_r.VISIBLE){var a=VA(n.curves),o=WA(n.curves);DA(a,o)||i.unshift(new ZA(o,6))}}else i.unshift.apply(i,r);n=n.parent}return i.filter((function(t){return wa(t.target,e)}))},e}(),tl=function(e,t,n,i){e.container.elements.forEach((function(r){var a=wa(r.flags,4),o=wa(r.flags,2),s=new el(r,e);wa(r.styles.display,2048)&&i.push(s);var A=wa(r.flags,8)?[]:i;if(a||o){var l=a||r.styles.isPositioned()?n:t,c=new $A(s);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var h=r.styles.zIndex.order;if(h<0){var u=0;l.negativeZIndex.some((function(e,t){return h>e.element.container.styles.zIndex.order?(u=t,!1):u>0})),l.negativeZIndex.splice(u,0,c)}else if(h>0){var d=0;l.positiveZIndex.some((function(e,t){return h>=e.element.container.styles.zIndex.order?(d=t+1,!1):d>0})),l.positiveZIndex.splice(d,0,c)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else r.styles.isFloating()?l.nonPositionedFloats.push(c):l.nonPositionedInlineLevel.push(c);tl(s,c,a?c:n,A)}else r.styles.isInlineLevel()?t.inlineLevel.push(s):t.nonInlineLevel.push(s),tl(s,t,n,A);wa(r.flags,8)&&nl(r,A)}))},nl=function(e,t){for(var n=e instanceof rs?e.start:1,i=e instanceof rs&&e.reversed,r=0;r<t.length;r++){var a=t[r];a.container instanceof is&&"number"==typeof a.container.value&&0!==a.container.value&&(n=a.container.value),a.listValue=aA(n,a.container.styles.listStyleType,!0),n+=i?-1:1}},il=function(e){var t=new el(e,null),n=new $A(t),i=[];return tl(t,n,n,i),nl(t.container,i),n},rl=function(e,t){switch(t){case 0:return ll(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return ll(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return ll(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);case 3:default:return ll(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},al=function(e,t){switch(t){case 0:return ll(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return ll(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return ll(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);case 3:default:return ll(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},ol=function(e,t){switch(t){case 0:return ll(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return ll(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return ll(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);case 3:default:return ll(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},sl=function(e,t){switch(t){case 0:return Al(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return Al(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return Al(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);case 3:default:return Al(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},Al=function(e,t){var n=[];return QA(e)?n.push(e.subdivide(.5,!1)):n.push(e),QA(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},ll=function(e,t,n,i){var r=[];return QA(e)?r.push(e.subdivide(.5,!1)):r.push(e),QA(n)?r.push(n.subdivide(.5,!0)):r.push(n),QA(i)?r.push(i.subdivide(.5,!0).reverse()):r.push(i),QA(t)?r.push(t.subdivide(.5,!1).reverse()):r.push(t),r},cl=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},hl=function(e){var t=e.styles,n=e.bounds,i=Vn(t.paddingLeft,n.width),r=Vn(t.paddingRight,n.width),a=Vn(t.paddingTop,n.width),o=Vn(t.paddingBottom,n.width);return n.add(i+t.borderLeftWidth,a+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+i+r),-(t.borderTopWidth+t.borderBottomWidth+a+o))},ul=function(e,t){return 0===e?t.bounds:2===e?hl(t):cl(t)},dl=function(e,t){return e===oi.BORDER_BOX?t.bounds:e===oi.CONTENT_BOX?hl(t):cl(t)},fl=function(e,t,n){var i=ul(vl(e.styles.backgroundOrigin,t),e),r=dl(vl(e.styles.backgroundClip,t),e),a=gl(vl(e.styles.backgroundSize,t),n,i),o=a[0],s=a[1],A=zn(vl(e.styles.backgroundPosition,t),i.width-o,i.height-s);return[yl(vl(e.styles.backgroundRepeat,t),A,a,i,r),Math.round(i.left+A[0]),Math.round(i.top+A[1]),o,s]},pl=function(e){return Ln(e)&&e.value===ji.AUTO},ml=function(e){return"number"==typeof e},gl=function(e,t,n){var i=t[0],r=t[1],a=t[2],o=e[0],s=e[1];if(!o)return[0,0];if(On(o)&&s&&On(s))return[Vn(o,n.width),Vn(s,n.height)];var A=ml(a);if(Ln(o)&&(o.value===ji.CONTAIN||o.value===ji.COVER))return ml(a)?n.width/n.height<a!=(o.value===ji.COVER)?[n.width,n.width/a]:[n.height*a,n.height]:[n.width,n.height];var l=ml(i),c=ml(r),h=l||c;if(pl(o)&&(!s||pl(s)))return l&&c?[i,r]:A||h?h&&A?[l?i:r*a,c?r:i/a]:[l?i:n.width,c?r:n.height]:[n.width,n.height];if(A){var u=0,d=0;return On(o)?u=Vn(o,n.width):On(s)&&(d=Vn(s,n.height)),pl(o)?u=d*a:s&&!pl(s)||(d=u/a),[u,d]}var f=null,p=null;if(On(o)?f=Vn(o,n.width):s&&On(s)&&(p=Vn(s,n.height)),null===f||s&&!pl(s)||(p=l&&c?f/i*r:n.height),null!==p&&pl(o)&&(f=l&&c?p/r*i:n.width),null!==f&&null!==p)return[f,p];throw new Error("Unable to calculate background-size for element")},vl=function(e,t){var n=e[t];return void 0===n?e[0]:n},yl=function(e,t,n,i,r){var a=t[0],o=t[1],s=n[0],A=n[1];switch(e){case Gi.REPEAT_X:return[new OA(Math.round(i.left),Math.round(i.top+o)),new OA(Math.round(i.left+i.width),Math.round(i.top+o)),new OA(Math.round(i.left+i.width),Math.round(A+i.top+o)),new OA(Math.round(i.left),Math.round(A+i.top+o))];case Gi.REPEAT_Y:return[new OA(Math.round(i.left+a),Math.round(i.top)),new OA(Math.round(i.left+a+s),Math.round(i.top)),new OA(Math.round(i.left+a+s),Math.round(i.height+i.top)),new OA(Math.round(i.left+a),Math.round(i.height+i.top))];case Gi.NO_REPEAT:return[new OA(Math.round(i.left+a),Math.round(i.top+o)),new OA(Math.round(i.left+a+s),Math.round(i.top+o)),new OA(Math.round(i.left+a+s),Math.round(i.top+o+A)),new OA(Math.round(i.left+a),Math.round(i.top+o+A))];default:return[new OA(Math.round(r.left),Math.round(r.top)),new OA(Math.round(r.left+r.width),Math.round(r.top)),new OA(Math.round(r.left+r.width),Math.round(r.height+r.top)),new OA(Math.round(r.left),Math.round(r.height+r.top))]}},wl="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",xl="Hidden Text",bl=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),i=this._document.createElement("img"),r=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",a.appendChild(n),i.src=wl,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.appendChild(this._document.createTextNode(xl)),n.appendChild(r),n.appendChild(i);var o=i.offsetTop-r.offsetTop+2;n.removeChild(r),n.appendChild(this._document.createTextNode(xl)),n.style.lineHeight="normal",i.style.verticalAlign="super";var s=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:s}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),Cl=function(){function e(e,t){this.context=e,this.options=t}return e}(),Ml=1e4,Bl=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new bl(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return t(n,e),n.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},n.prototype.applyEffect=function(e){this.ctx.save(),qA(e)&&(this.ctx.globalAlpha=e.opacity),KA(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),JA(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.renderNode=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return wa(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var i=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):Fo(e.text).reduce((function(t,r){return i.ctx.fillText(r,t,e.bounds.top+n),t+i.ctx.measureText(r).width}),e.bounds.left)},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),n=e.fontFamily.join(", "),i=Sn(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,i,n].join(" "),n,i]},n.prototype.renderTextNode=function(e,t){return i(this,void 0,void 0,(function(){var n,i,a,o,s,A,l,c,h=this;return r(this,(function(r){return n=this.createFontStyle(t),i=n[0],a=n[1],o=n[2],this.ctx.font=i,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",s=this.fontMetrics.getMetrics(a,o),A=s.baseline,l=s.middle,c=t.paintOrder,e.textBounds.forEach((function(e){c.forEach((function(n){switch(n){case va.FILL:h.ctx.fillStyle=ti(t.color),h.renderTextWithLetterSpacing(e,t.letterSpacing,A);var i=t.textShadow;i.length&&e.text.trim().length&&(i.slice(0).reverse().forEach((function(n){h.ctx.shadowColor=ti(n.color),h.ctx.shadowOffsetX=n.offsetX.number*h.options.scale,h.ctx.shadowOffsetY=n.offsetY.number*h.options.scale,h.ctx.shadowBlur=n.blur.number,h.renderTextWithLetterSpacing(e,t.letterSpacing,A)})),h.ctx.shadowColor="",h.ctx.shadowOffsetX=0,h.ctx.shadowOffsetY=0,h.ctx.shadowBlur=0),t.textDecorationLine.length&&(h.ctx.fillStyle=ti(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+A),e.bounds.width,1);break;case 2:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:h.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+l),e.bounds.width,1)}})));break;case va.STROKE:t.webkitTextStrokeWidth&&e.text.trim().length&&(h.ctx.strokeStyle=ti(t.webkitTextStrokeColor),h.ctx.lineWidth=t.webkitTextStrokeWidth,h.ctx.lineJoin=window.chrome?"miter":"round",h.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+A)),h.ctx.strokeStyle="",h.ctx.lineWidth=0,h.ctx.lineJoin="miter"}}))})),[2]}))}))},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var i=hl(e),r=WA(t);this.path(r),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return i(this,void 0,void 0,(function(){var t,i,a,s,A,l,c,h,u,d,f,p,m,g,v,y,w,x;return r(this,(function(r){switch(r.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,i=e.curves,a=t.styles,s=0,A=t.textNodes,r.label=1;case 1:return s<A.length?(l=A[s],[4,this.renderTextNode(l,a)]):[3,4];case 2:r.sent(),r.label=3;case 3:return s++,[3,1];case 4:if(!(t instanceof es))return[3,8];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return v=r.sent(),this.renderReplacedElement(t,i,v),[3,8];case 7:return r.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof ts&&this.renderReplacedElement(t,i,t.canvas),!(t instanceof ns))return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return v=r.sent(),this.renderReplacedElement(t,i,v),[3,12];case 11:return r.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof ms&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:c=r.sent(),t.width&&t.height&&this.ctx.drawImage(c,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),r.label=14;case 14:if(t instanceof ds&&(h=Math.min(t.bounds.width,t.bounds.height),t.type===ls?t.checked&&(this.ctx.save(),this.path([new OA(t.bounds.left+.39363*h,t.bounds.top+.79*h),new OA(t.bounds.left+.16*h,t.bounds.top+.5549*h),new OA(t.bounds.left+.27347*h,t.bounds.top+.44071*h),new OA(t.bounds.left+.39694*h,t.bounds.top+.5649*h),new OA(t.bounds.left+.72983*h,t.bounds.top+.23*h),new OA(t.bounds.left+.84*h,t.bounds.top+.34085*h),new OA(t.bounds.left+.39363*h,t.bounds.top+.79*h)]),this.ctx.fillStyle=ti(us),this.ctx.fill(),this.ctx.restore()):t.type===cs&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+h/2,t.bounds.top+h/2,h/4,0,2*Math.PI,!0),this.ctx.fillStyle=ti(us),this.ctx.fill(),this.ctx.restore())),Il(t)&&t.value.length){switch(u=this.createFontStyle(a),w=u[0],d=u[1],f=this.fontMetrics.getMetrics(w,d).baseline,this.ctx.font=w,this.ctx.fillStyle=ti(a.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Sl(t.styles.textAlign),x=hl(t),p=0,t.styles.textAlign){case Nr.CENTER:p+=x.width/2;break;case Nr.RIGHT:p+=x.width}m=x.add(p,0,0,-x.height/2+1),this.ctx.save(),this.path([new OA(x.left,x.top),new OA(x.left+x.width,x.top),new OA(x.left+x.width,x.top+x.height),new OA(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ho(t.value,m),a.letterSpacing,f),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!wa(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if((g=t.styles.listStyleImage).type!==hi.URL)return[3,18];v=void 0,y=g.url,r.label=15;case 15:return r.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return v=r.sent(),this.ctx.drawImage(v,t.bounds.left-(v.width+10),t.bounds.top),[3,18];case 17:return r.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:e.listValue&&t.styles.listStyleType!==Lr.NONE&&(w=this.createFontStyle(a)[0],this.ctx.font=w,this.ctx.fillStyle=ti(a.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new o(t.bounds.left,t.bounds.top+Vn(t.styles.paddingTop,t.bounds.width),t.bounds.width,Sr(a.lineHeight,a.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ho(e.listValue,x),a.letterSpacing,Sr(a.lineHeight,a.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),r.label=20;case 20:return[2]}}))}))},n.prototype.renderStackContent=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a,o,s,A,l,c,h,u,d,f,p,m;return r(this,(function(r){switch(r.label){case 0:return wa(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:r.sent(),t=0,n=e.negativeZIndex,r.label=2;case 2:return t<n.length?(m=n[t],[4,this.renderStack(m)]):[3,5];case 3:r.sent(),r.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:r.sent(),i=0,a=e.nonInlineLevel,r.label=7;case 7:return i<a.length?(m=a[i],[4,this.renderNode(m)]):[3,10];case 8:r.sent(),r.label=9;case 9:return i++,[3,7];case 10:o=0,s=e.nonPositionedFloats,r.label=11;case 11:return o<s.length?(m=s[o],[4,this.renderStack(m)]):[3,14];case 12:r.sent(),r.label=13;case 13:return o++,[3,11];case 14:A=0,l=e.nonPositionedInlineLevel,r.label=15;case 15:return A<l.length?(m=l[A],[4,this.renderStack(m)]):[3,18];case 16:r.sent(),r.label=17;case 17:return A++,[3,15];case 18:c=0,h=e.inlineLevel,r.label=19;case 19:return c<h.length?(m=h[c],[4,this.renderNode(m)]):[3,22];case 20:r.sent(),r.label=21;case 21:return c++,[3,19];case 22:u=0,d=e.zeroOrAutoZIndexOrTransformedOrOpacity,r.label=23;case 23:return u<d.length?(m=d[u],[4,this.renderStack(m)]):[3,26];case 24:r.sent(),r.label=25;case 25:return u++,[3,23];case 26:f=0,p=e.positiveZIndex,r.label=27;case 27:return f<p.length?(m=p[f],[4,this.renderStack(m)]):[3,30];case 28:r.sent(),r.label=29;case 29:return f++,[3,27];case 30:return[2]}}))}))},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach((function(e,n){var i=QA(e)?e.start:e;0===n?t.ctx.moveTo(i.x,i.y):t.ctx.lineTo(i.x,i.y),QA(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},n.prototype.renderRepeat=function(e,t,n,i){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,i),this.ctx.fill(),this.ctx.translate(-n,-i)},n.prototype.resizeImage=function(e,t,n){var i;if(e.width===t&&e.height===n)return e;var r=(null!==(i=this.canvas.ownerDocument)&&void 0!==i?i:document).createElement("canvas");return r.width=Math.max(1,t),r.height=Math.max(1,n),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),r},n.prototype.renderBackgroundImage=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r(this,(function(A){switch(A.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var a,o,s,A,l,c,h,u,d,f,p,m,g,v,y,w,x,b,C,M,B,I,E,S,T,L,F,_,U,P,k;return r(this,(function(r){switch(r.label){case 0:if(n.type!==hi.URL)return[3,5];a=void 0,o=n.url,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,i.context.cache.match(o)];case 2:return a=r.sent(),[3,4];case 3:return r.sent(),i.context.logger.error("Error loading background-image "+o),[3,4];case 4:return a&&(s=fl(e,t,[a.width,a.height,a.width/a.height]),w=s[0],I=s[1],E=s[2],C=s[3],M=s[4],v=i.ctx.createPattern(i.resizeImage(a,C,M),"repeat"),i.renderRepeat(w,v,I,E)),[3,6];case 5:Di(n)?(A=fl(e,t,[null,null,null]),w=A[0],I=A[1],E=A[2],C=A[3],M=A[4],l=gi(n.angle,C,M),c=l[0],h=l[1],u=l[2],d=l[3],f=l[4],(p=document.createElement("canvas")).width=C,p.height=M,m=p.getContext("2d"),g=m.createLinearGradient(h,d,u,f),pi(n.stops,c).forEach((function(e){return g.addColorStop(e.stop,ti(e.color))})),m.fillStyle=g,m.fillRect(0,0,C,M),C>0&&M>0&&(v=i.ctx.createPattern(p,"repeat"),i.renderRepeat(w,v,I,E))):Ri(n)&&(y=fl(e,t,[null,null,null]),w=y[0],x=y[1],b=y[2],C=y[3],M=y[4],B=0===n.position.length?[Qn]:n.position,I=Vn(B[0],C),E=Vn(B[B.length-1],M),S=wi(n,I,E,C,M),T=S[0],L=S[1],T>0&&L>0&&(F=i.ctx.createRadialGradient(x+I,b+E,0,x+I,b+E,T),pi(n.stops,2*T).forEach((function(e){return F.addColorStop(e.stop,ti(e.color))})),i.path(w),i.ctx.fillStyle=F,T!==L?(_=e.bounds.left+.5*e.bounds.width,U=e.bounds.top+.5*e.bounds.height,k=1/(P=L/T),i.ctx.save(),i.ctx.translate(_,U),i.ctx.transform(1,0,0,P,0,0),i.ctx.translate(-_,-U),i.ctx.fillRect(x,k*(b-U)+U,C,M*k),i.ctx.restore()):i.ctx.fill())),r.label=6;case 6:return t--,[2]}}))},i=this,a=0,o=e.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return a<o.length?(s=o[a],[5,n(s)]):[3,4];case 2:A.sent(),A.label=3;case 3:return a++,[3,1];case 4:return[2]}}))}))},n.prototype.renderSolidBorder=function(e,t,n){return i(this,void 0,void 0,(function(){return r(this,(function(i){return this.path(rl(n,t)),this.ctx.fillStyle=ti(e),this.ctx.fill(),[2]}))}))},n.prototype.renderDoubleBorder=function(e,t,n,a){return i(this,void 0,void 0,(function(){var i,o;return r(this,(function(r){switch(r.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,a)]:[3,2];case 1:return r.sent(),[2];case 2:return i=al(a,n),this.path(i),this.ctx.fillStyle=ti(e),this.ctx.fill(),o=ol(a,n),this.path(o),this.ctx.fill(),[2]}}))}))},n.prototype.renderNodeBackgroundAndBorders=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a,o,s,A,l,c=this;return r(this,(function(r){switch(r.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,n=!ei(t.backgroundColor)||t.backgroundImage.length,i=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],a=El(vl(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),ei(t.backgroundColor)||(this.ctx.fillStyle=ti(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:r.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){c.ctx.save();var n=VA(e.curves),i=t.inset?0:Ml,r=RA(n,-i+(t.inset?1:-1)*t.spread.number,(t.inset?1:-1)*t.spread.number,t.spread.number*(t.inset?-2:2),t.spread.number*(t.inset?-2:2));t.inset?(c.path(n),c.ctx.clip(),c.mask(r)):(c.mask(n),c.ctx.clip(),c.path(r)),c.ctx.shadowOffsetX=t.offsetX.number+i,c.ctx.shadowOffsetY=t.offsetY.number,c.ctx.shadowColor=ti(t.color),c.ctx.shadowBlur=t.blur.number,c.ctx.fillStyle=t.inset?ti(t.color):"rgba(0,0,0,1)",c.ctx.fill(),c.ctx.restore()})),r.label=2;case 2:o=0,s=0,A=i,r.label=3;case 3:return s<A.length?(l=A[s]).style!==Zi.NONE&&!ei(l.color)&&l.width>0?l.style!==Zi.DASHED?[3,5]:[4,this.renderDashedDottedBorder(l.color,l.width,o,e.curves,Zi.DASHED)]:[3,11]:[3,13];case 4:return r.sent(),[3,11];case 5:return l.style!==Zi.DOTTED?[3,7]:[4,this.renderDashedDottedBorder(l.color,l.width,o,e.curves,Zi.DOTTED)];case 6:return r.sent(),[3,11];case 7:return l.style!==Zi.DOUBLE?[3,9]:[4,this.renderDoubleBorder(l.color,l.width,o,e.curves)];case 8:return r.sent(),[3,11];case 9:return[4,this.renderSolidBorder(l.color,o,e.curves)];case 10:r.sent(),r.label=11;case 11:o++,r.label=12;case 12:return s++,[3,3];case 13:return[2]}}))}))},n.prototype.renderDashedDottedBorder=function(e,t,n,a,o){return i(this,void 0,void 0,(function(){var i,s,A,l,c,h,u,d,f,p,m,g,v,y,w,x;return r(this,(function(r){return this.ctx.save(),i=sl(a,n),s=rl(a,n),o===Zi.DASHED&&(this.path(s),this.ctx.clip()),QA(s[0])?(A=s[0].start.x,l=s[0].start.y):(A=s[0].x,l=s[0].y),QA(s[1])?(c=s[1].end.x,h=s[1].end.y):(c=s[1].x,h=s[1].y),u=0===n||2===n?Math.abs(A-c):Math.abs(l-h),this.ctx.beginPath(),o===Zi.DOTTED?this.formatPath(i):this.formatPath(s.slice(0,2)),d=t<3?3*t:2*t,f=t<3?2*t:t,o===Zi.DOTTED&&(d=t,f=t),p=!0,u<=2*d?p=!1:u<=2*d+f?(d*=m=u/(2*d+f),f*=m):(g=Math.floor((u+f)/(d+f)),v=(u-g*d)/(g-1),f=(y=(u-(g+1)*d)/g)<=0||Math.abs(f-v)<Math.abs(f-y)?v:y),p&&(o===Zi.DOTTED?this.ctx.setLineDash([0,d+f]):this.ctx.setLineDash([d,f])),o===Zi.DOTTED?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=ti(e),this.ctx.stroke(),this.ctx.setLineDash([]),o===Zi.DASHED&&(QA(s[0])&&(w=s[3],x=s[0],this.ctx.beginPath(),this.formatPath([new OA(w.end.x,w.end.y),new OA(x.start.x,x.start.y)]),this.ctx.stroke()),QA(s[1])&&(w=s[1],x=s[2],this.ctx.beginPath(),this.formatPath([new OA(w.end.x,w.end.y),new OA(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},n.prototype.render=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ti(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=il(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}}))}))},n}(Cl),Il=function(e){return e instanceof ps||e instanceof fs||e instanceof ds&&e.type!==cs&&e.type!==ls},El=function(e,t){switch(e){case oi.BORDER_BOX:return VA(t);case oi.CONTENT_BOX:return jA(t);case oi.PADDING_BOX:default:return WA(t)}},Sl=function(e){switch(e){case Nr.CENTER:return"center";case Nr.RIGHT:return"right";case Nr.LEFT:default:return"left"}},Tl=function(e){function n(t,n){var i=e.call(this,t,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return t(n,e),n.prototype.render=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:return t=No(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,Ll(t)];case 1:return n=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ti(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},n}(Cl),Ll=function(e){return new Promise((function(t,n){var i=new Image;i.onload=function(){t(i)},i.onerror=n,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Fl=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,a([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,a([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,a([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,a([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),_l=function(){function e(t,n){var i;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new Fl({id:this.instanceName,enabled:t.logging}),this.cache=null!==(i=t.cache)&&void 0!==i?i:new IA(this,t)}return e.instanceCount=1,e}(),Ul=function(e,t){return void 0===t&&(t={}),Pl(e,t)};"undefined"!=typeof window&&BA.setContext(window);var Pl=function(e,t){return i(void 0,void 0,void 0,(function(){var i,a,l,c,h,u,d,f,p,m,g,v,y,w,x,b,C,M,B,I,E,S,T,L,F,_,U,P,k,D,R,O,N,G,Q,H,z,V;return r(this,(function(r){switch(r.label){case 0:if(!e||"object"!=typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(i=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(a=i.defaultView))throw new Error("Document is not attached to a Window");return l={allowTaint:null!==(S=t.allowTaint)&&void 0!==S&&S,imageTimeout:null!==(T=t.imageTimeout)&&void 0!==T?T:15e3,proxy:t.proxy,useCORS:null!==(L=t.useCORS)&&void 0!==L&&L},c=n({logging:null===(F=t.logging)||void 0===F||F,cache:t.cache},l),h={windowWidth:null!==(_=t.windowWidth)&&void 0!==_?_:a.innerWidth,windowHeight:null!==(U=t.windowHeight)&&void 0!==U?U:a.innerHeight,scrollX:null!==(P=t.scrollX)&&void 0!==P?P:a.pageXOffset,scrollY:null!==(k=t.scrollY)&&void 0!==k?k:a.pageYOffset},u=new o(h.scrollX,h.scrollY,h.windowWidth,h.windowHeight),d=new _l(c,u),f=null!==(D=t.foreignObjectRendering)&&void 0!==D&&D,p={allowTaint:null!==(R=t.allowTaint)&&void 0!==R&&R,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},d.logger.debug("Starting document clone with size "+u.width+"x"+u.height+" scrolled to "+-u.left+","+-u.top),m=new sA(d,e,p),(g=m.clonedReferenceElement)?[4,m.toIFrame(i,u)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return v=r.sent(),y=_s(g)||Ls(g)?A(g.ownerDocument):s(d,g),w=y.width,x=y.height,b=y.left,C=y.top,M=kl(d,g,t.backgroundColor),B={canvas:t.canvas,backgroundColor:M,scale:null!==(N=null!==(O=t.scale)&&void 0!==O?O:a.devicePixelRatio)&&void 0!==N?N:1,x:(null!==(G=t.x)&&void 0!==G?G:0)+b,y:(null!==(Q=t.y)&&void 0!==Q?Q:0)+C,width:null!==(H=t.width)&&void 0!==H?H:Math.ceil(w),height:null!==(z=t.height)&&void 0!==z?z:Math.ceil(x)},f?(d.logger.debug("Document cloned, using foreign object rendering"),[4,new Tl(d,B).render(g)]):[3,3];case 2:return I=r.sent(),[3,5];case 3:return d.logger.debug("Document cloned, element located at "+b+","+C+" with size "+w+"x"+x+" using computed rendering"),d.logger.debug("Starting DOM parsing"),E=ws(d,g),M===E.styles.backgroundColor&&(E.styles.backgroundColor=ci.TRANSPARENT),d.logger.debug("Starting renderer for element at "+B.x+","+B.y+" with size "+B.width+"x"+B.height),[4,new Bl(d,B).render(E)];case 4:I=r.sent(),r.label=5;case 5:return(null===(V=t.removeContainer)||void 0===V||V)&&(sA.destroy(v)||d.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),d.logger.debug("Finished rendering"),[2,I]}}))}))},kl=function(e,t,n){var i=t.ownerDocument,r=i.documentElement?li(e,getComputedStyle(i.documentElement).backgroundColor):ci.TRANSPARENT,a=i.body?li(e,getComputedStyle(i.body).backgroundColor):ci.TRANSPARENT,o="string"==typeof n?li(e,n):null===n?ci.TRANSPARENT:4294967295;return t===i.documentElement?ei(r)?ei(a)?o:a:r:o};return Ul}()})),am=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).isSpriteLabel=!0,i.sprite=new po(new to({transparent:!0,opacity:0})),i.sprite.renderOrder=5e3,i.sprite.center.set(.5,.1),i.add(i.sprite),e.position&&(Array.isArray(e.position)?i.position.fromArray(e.position):i.position.copy(e.position)),i.userData=e.userData||e,i.element=document.createElement("div"),i.element.style.position="absolute",null!==e.html&&void 0!==e.html&&(e.html.constructor===String?i.element.innerHTML=e.html:i.element.appendChild(e.html),i._fromHTML(e,i.element)),i}return o(n,[{key:"_fromHTML",value:function(){var e=this;document.body.appendChild(this.element),this._onLoadElement(this.element,(function(){rm(e.element,{backgroundColor:"transparent",useCORS:!0,scale:4}).then((function(t){e.sprite.material.map&&e.sprite.material.map.dispose(),e.sprite.material.opacity=1,e.sprite.material.map=new Ko(t),e.sprite.material.needsUpdate=!0;e.sprite.scale.set(t.width/100,t.height/100,1),e.element.parentElement&&e.element.parentElement.removeChild(e.element)}))}))}},{key:"setElement",value:function(e){this.userData=e.userData,e.html.constructor===String?this.element.innerHTML=e.html:(this.element.innerHTML="",this.element.appendChild(e.html)),this._fromHTML()}},{key:"updateElement",value:function(){this._fromHTML()}},{key:"_fromImage",value:function(e){}},{key:"toJSON",value:function(){return{position:this.position.toArray(),scale:this.scale.toArray(),html:encodeURIComponent(this.element.innerHTML),userData:this.userData}}},{key:"_onLoadElement",value:function(e,t){var n,i=e.getElementsByTagName("img"),r=i.length,a=0;function o(){a++,console.log(":"+a+"/"+r),a==r&&(console.log(""),t())}r<=0&&t();for(var s=0;s<i.length;s++)i[n=s].complete?o():i[n].onload=o}},{key:"onClick",value:function(){}}]),n}(Dt),om=function(){function e(t){r(this,e),this.icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAvCAMAAAC18jgTAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACvlBMVEUAAADnTDzAOSvnTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDzAOSvAOSvAOSvAOSvnTDznTDzAOSvAOSvAOSvAOSvAOSvAOSvAOSvAOSvnTDznTDzAOSvAOSvAOSvAOSvnTDznTDznTDznTDzAOSvAOSvAOSvAOSvnTDzAOSvAOSvAOSvAOSvnTDznTDzAOSvAOSvnTDzAOSvAOSvAOSvAOSvAOSvAOSvnTDzAOSvnTDzAOSvAOSvAOSvnTDznTDznTDzAOSvAOSvAOSvnTDznTDznTDzAOSvAOSvAOSvAOSvAOSvnTDznTDznTDznTDzAOSvAOSvAOSvAOSvAOSvnTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDznTDzoTDzlSzviSTrhSTrjSjrXRDXPQDLJPS/EOy3PQDHWRDXiSjrcRzfAOSu/OSvIPS7bRjfmTDzTQjPDOizCOizSQjPUQzTDOyzZRTbHPS7GPC7BOSvNPzHLPzDkSzveRzjBOizcRjfQQTLOQDHJPi/gSDnFPC3eSDjgSTnMPzDfSDnHPC7WRDTkSjvfSDgAAAAbHy20AAAAuXRSTlMAAAAYTpbF3O7w3ceaUxsffc/09dODIxZ+14gptr8wONFBJc3VLhKxvHH+fyLY4Cv14N7zi8bujD8gHj2E6ho+5E0BRPNLdf39eGv6oMMSDLivtYh50P5fUPtpWrqWmdgn0Klm+6IIlXYt4qgtAp/46jkFp6l9eqbdCkz2+lkLsr0PP+zySgKQndrjLxTEzmAIDelEAYqYBBnKRvFSB6y5DEDtlKEGKOUygh5X92QJrQ4860ePnNt8iUMldKgAAAABYktHRACIBR1IAAAACXBIWXMAAAK8AAACvAAsAdHPAAAAB3RJTUUH5AYdASUjJ2RCdAAAAtRJREFUOMt1lAdbkzEQx5OisgTBwXKAKCg4wY1bEXCi4MKJiFscuAEVt+LeA/fee4VioYi+BbTFMt0T5WN4l7R9O+952lzu/3veyyWXEMKNgjk1aNjI2cXVzb2xhyfOiWw4beLl3ZQZrFnzFj7mCLi+fv7MwtwCPE0EOC1bMRtr3cZAwBAYxOyYf1tBUBrczhDKY8r8V0oYhLUPQYDS0A4GWVVQqC4qUr8ufmMgOjoBQWlYuJi+VUsajYS/ktIyEeqEQOcu3Fe+ey+ZTKtT8mDXbgB4CbiYK90jIntwp1xEe1IS2ot7pR8g2rtP335R/QcMxG/oeThoEBnsgo6qArIPGTpMgTY8EojKfIxHjyAxsVhAaZUkxY0EkRD4GzUaCD2vNoCM4RWWQ2TsONSRiB8Pxeh4jgkkgY/VkCFR6EhMBKCGl+pOJuFQWyJJk6fIwNQkWIQKFWcBKNXwhWkyMD1Okipq+amSGTxFIQAzZSARUlRzwZvM4ovEbZqdzKsAPWoOAOW8ihQyNxWBj1og5sXzbVDMXwCTT58RCF9IFi1GsOwLxJKWLE1TKNKSly2HyVd+GitWkvRVPJeqBlYhRaxes3bdenA03/hGsoQNhGZk8lV8r9TIp6n58ZOvIGsjnOamzeLgflVXmYDff0Qsews2zNZtYqYsqNNiu2jr/opuYNt38I7aucvYpv/q9Tqdvl5lnO9OF00ZvMfUyZA5z9izLGevse/DYu21PfMz3BxK9+23px/wlK+WR6atnnXQdDkpPZRiCyQcNr+9gUesddejZg8ApceOWwMnTpq/EJSeyrbUT/tYvCBAnMk11zPPWuoAnDtvDly4aAUAcemyrEdnWOt4JFdk4Oo1GwCI625G/cZNWx2JGMNDwW5R+4Cvu9CDbtvTkbhzF/XUe/Z1AO4/4CU+dAAA8egxY7lPHOlY6lPGnqU7BLD7nueEONaRePHSSv8PoTJomQk+BgwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjAtMDMtMTlUMTA6NTE6MDErMDA6MDBQ+gh4AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTAxLTA4VDE5OjQ1OjEyKzAwOjAwFuH4SwAAACB0RVh0c29mdHdhcmUAaHR0cHM6Ly9pbWFnZW1hZ2ljay5vcme8zx2dAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAGHRFWHRUaHVtYjo6SW1hZ2U6OkhlaWdodAAyMzPP8xcQAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADE1OJ/MhxoAAAAZdEVYdFRodW1iOjpNaW1ldHlwZQBpbWFnZS9wbmc/slZOAAAAF3RFWHRUaHVtYjo6TVRpbWUAMTU0Njk3NjcxMp4G7IoAAAASdEVYdFRodW1iOjpTaXplADEwMzgzQvuof6wAAABadEVYdFRodW1iOjpVUkkAZmlsZTovLy9kYXRhL3d3d3Jvb3Qvd3d3LmVhc3lpY29uLm5ldC9jZG4taW1nLmVhc3lpY29uLmNuL2ZpbGVzLzExOC8xMTg1NjU4LnBuZ9VKt4oAAAAASUVORK5CYII=",this.viewer=t,this.container=document.createElement("div"),this.container.setAttribute("id","markerContainer"),this.container.style.position="absolute",this.container.style.top="0",this.container.style.left="0",t.container.appendChild(this.container),this.defaultLayer=new im,this.layers=[this.defaultLayer],xf.bindAll(["_onUpdate"],this),t.addEventListener("update",this._onUpdate),this.spriteRoot=new Dt,this.spriteRoot.name="spriteRoot",this.viewer.root.add(this.spriteRoot)}return o(e,[{key:"addMarker",value:function(e){if(void 0!==e.position)return void 0===e.element&&(e.element=new Image,e.element.src=this.icon,(e.onclick||e.cameraView)&&(e.element.style.cursor="pointer")),this._addHotSpot(e);console.error("position")}},{key:"add",value:function(e){if(void 0!==e.position){if(void 0!==e.element){if(e.element.constructor===String){e.element='<div class="hot-spot" >'.concat(e.element,"</div>");var t=document.createElement("div");t.innerHTML=e.element,e.element=t.children[0]}return this._addHotSpot(e)}console.error("element")}else console.error("position")}},{key:"addLayer",value:function(e){this.layers.indexOf(e)<0&&this.layers.push(e)}},{key:"hideAll",value:function(){this.layers.forEach((function(e){e.hide()}))}},{key:"showAll",value:function(){this.layers.forEach((function(e){e.show()}))}},{key:"onlyShow",value:function(e){this.hideAll(),e.show()}},{key:"toJSON",value:function(){var e=[];return this.layers.forEach((function(t){e.push(t.toJSON())})),e}},{key:"loadLayer",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultLayer;viewer.camera.updateProjectionMatrix(),this.addLayer(n),e.forEach((function(e){var i=document.createElement("div");i.innerHTML=e.element,i.className="hot-spot",e.element=i,e.layer=n,t._addHotSpot(e)}))}},{key:"_addHotSpot",value:function(e){var t=this;if(e.element.style.position="absolute",this.container.appendChild(e.element),e.position=Array.isArray(e.position)?(new tt).fromArray(e.position):(new tt).copy(e.position),void 0!==e.objectId){var n=this.viewer.root.getObjectById(e.objectId);if(!n)return console.error("id"),null;e.worldPos=e.position.clone(),n.worldToLocal(e.position)}var i=new nm(e);return e.layer=e.layer||this.defaultLayer,e.layer.add(i),i.focus=function(n){e.cameraView&&e.cameraView.position&&(i.cameraView.complete=function(){n?n():i.complete&&i.complete()},t.viewer.controls.flyTo(i.cameraView))},i}},{key:"_onUpdate",value:function(){var e=this;this.layers.forEach((function(t){t.visible&&t.spots.forEach((function(t){var n=t.position.clone();void 0!==t.objectId&&(n=e.viewer.root.getObjectById(t.objectId).localToWorld(t.position.clone())),t.updateScreenCoords(e._getProjectHotPos(n)),t.screenCoord?t.hided||(t.element.style.display="block"):t.element.style.display="none"}))}))}},{key:"_getProjectHotPos",value:function(e){var t=this.viewer,n=t.camera.position.clone().sub(e.clone()).normalize(),i=new tt;t.camera.getWorldDirection(i).clone();var r=t.renderer.domElement.getBoundingClientRect(),a=r.width/2,o=r.height/2,s=e.clone();return s.project(t.camera),i.x=-i.x,i.y=-i.y,i.z=-i.z,n.clone().angleTo(i)>.5*Math.PI?null:new Je(s.x*a+a,-s.y*o+o)}},{key:"createLayer",value:function(){var e=new im;return this.addLayer(e),e}},{key:"deleteLayer",value:function(e){-1!==this.layers.indexOf(e)&&(e.spots.map((function(e){e.element.remove()})),this.layers.splice(this.layers.indexOf(e),1))}},{key:"export",value:function(){return this.toJSON().filter((function(e){return e.length>0}))}},{key:"import",value:function(e){var t=this,n=new DOMParser;e.map((function(e){var i=t.createLayer();e.forEach((function(e){e.element=n.parseFromString(e.element,"text/html").body.children[0],e.layer=i,t._addHotSpot(e)}))}))}},{key:"addSpriteLabel",value:function(e){e.position||console.warn("addSpriteLabel: options.position");var t=new am({position:e.position,html:e.content,userData:e.userData});return this.spriteRoot.add(t),t}}]),e}(),sm=function(){function e(){r(this,e)}return o(e,[{key:"init",value:function(){this.isActive=!1}},{key:"initParticleItem",value:function(e){}},{key:"update",value:function(e,t){}},{key:"reset",value:function(){}}]),e}(),Am="\nattribute vec4 vertexColor;\nvarying vec4 vColor;\nvarying vec2 vUv;\nvoid main()\n{\n     vUv = uv;\n     vColor = vertexColor;\n     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n     gl_Position = projectionMatrix * mvPosition;\n}\n",lm="\n\nuniform sampler2D mainTex;\nvarying vec4 vColor;\nvarying vec2 vUv;\nvoid main()\n{\n    vec4 texColor = texture2D(mainTex,vUv.xy);\n    vec4 col = texColor * vColor;\n    gl_FragColor = col;\n}\n\n",cm="\nattribute vec4 vertexColor;\nuniform vec4 _TintColor;\nvarying vec4 vColor;\nvarying vec2 vUv;\nvoid main()\n{\n     vUv = uv;\n     vColor = vec4(vertexColor.xyz * _TintColor.xyz,vertexColor.w * _TintColor.w);\n     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n     gl_Position = projectionMatrix * mvPosition;\n}\n\n",hm="\n\nuniform sampler2D mainTex;\nvarying vec4 vColor;\nvarying vec2 vUv;\nvoid main()\n{\n    vec4 texColor = texture2D(mainTex,vUv.xy);\n    vec4 col = texColor * vColor * 2.0;\n    col.a = clamp(col.a,0.0,1.0);\n    gl_FragColor = col;\n}\n\n",um="\n    uniform sampler2D mainTex;\n    varying vec4 _TintColor;\n    varying vec4 vColor;\n    varying vec2 vUv;\n    void main()\n    {\n        vec4 texColor = texture2D(mainTex,vUv.xy);\n        vec3 col = texColor.xyz * vColor.xyz * _TintColor.xyz * 2.0;\n        float a = (1 - texColor.w) * (_TintColor.w * vColor.w * 2.0);\n        gl_FragColor = vec4(col.xyz,a);\n    }\n\n",dm="\nuniform sampler2D mainTex;\nvarying vec4 vColor;\nvarying vec2 vUv;\nvoid main()\n{\n    vec4 texColor = texture2D(mainTex,vUv.xy);\n    vec4 col = texColor * vColor;\n    col = lerp(vec4(1,1,1,1),col,col.w);\n    gl_FragColor = col;\n}\n    \n",fm="\n    uniform sampler2D mainTex;\n    varying vec4 vColor;\n    varying vec2 vUv;\n    void main()\n    {\n        vec4 col;\n        vec4 texColor = texture2D(mainTex,vUv.xy);\n        col.xyz = texColor.xyz * vColor.xyz * 2;\n        col.w = vColor.w * texColor.w;\n        col = lerp(vec4(0.5,0.5,0.5,0.5),col,col.a);\n        gl_FragColor = col;\n    }\n",pm="\n\n    uniform sampler2D mainTex;\n    varying vec4 vColor;\n    varying vec2 vUv;\n    void main()\n    {\n        vec4 texColor = texture2D(mainTex,vUv.xy);\n        gl_FragColor = vColor * texColor * vColor.a;\n    }\n",mm=function(){function e(){r(this,e)}return o(e,null,[{key:"randomValue",value:function(e,t){var n=Math.random();return Oh.lerp(e,t,n)}},{key:"randomVector3",value:function(e,t){return new tt(this.randomValue(e.x,t.x),this.randomValue(e.y,t.y),this.randomValue(e.z,t.z))}},{key:"randomVector4",value:function(e,t){var n=Math.random();return e.lerp(t,n)}},{key:"getShader",value:function(e){return"normal_vertex"===e?Am:"normal_fragment"===e?lm:"normal_legacy_vertex"===e?cm:"normal_legacy_fragment"===e?hm:"multily_legacy_fragment"===e?um:"multipy_fragment"===e?dm:"multiplyDouble_fragment"===e?fm:"premultiplyBlend_fragment"===e?pm:""}},{key:"getShaderBlend",value:function(e){return"SrcAlpha"===e?L:"OneMinusSrcAlpha"===e?F:"One"===e?S:"DstColor"===e?U:"Zero"===e?E:"SrcColor"===e?T:S}}]),e}(),gm=function(){function e(t){r(this,e),null!=t?this.setJsonData(t):(this.times=[],this.values=[],this.currentIndex=0)}return o(e,[{key:"setJsonData",value:function(e){this.times=e.times,this.values=e.values,this.currentIndex=0}},{key:"getValue",value:function(e){var t=this.times.length;if(this.currentIndex<t-1&&this.times[this.currentIndex]<=e&&this.times[this.currentIndex+1]>=e)return Oh.lerp(this.values[this.currentIndex],this.values[this.currentIndex+1],(e-this.times[this.currentIndex])/(this.times[this.currentIndex+1]-this.times[this.currentIndex]));for(var n=0;n<t;n++){if(!(n<t-1))return this.currentIndex=n,this.values[n];if(this.times[n]<=e&&this.times[n+1]>=e)return this.currentIndex=n,Oh.lerp(this.values[n],this.values[n+1],(e-this.times[n])/(this.times[n+1]-this.times[n]))}return 0}}]),e}(),vm=function(){function e(t){r(this,e),null!=t?this.setJsonData(t):(this.m_Mode=e.TYPE.Constant,this.m_ConstantMin=0,this.m_ConstantMax=0,this.m_CurveMin=null,this.m_CurveMax=null)}return o(e,[{key:"setJsonData",value:function(t){this.m_Mode=t.mode,this.m_Mode===e.TYPE.Constant?this.setConstantValue(t.max):this.m_Mode===e.TYPE.TwoConstants?this.setConstantMinMax(t.min,t.max):this.m_Mode===e.TYPE.Curve?this.setCurves(new gm(t.maxCurve)):this.m_Mode===e.TYPE.TwoCurves&&this.setCurvesMinMax(new gm(t.minCurve),new gm(t.maxCurve))}},{key:"setConstantValue",value:function(t){this.m_Mode=e.TYPE.Constant,this.m_ConstantMin=0,this.m_ConstantMax=t,this.m_CurveMin=null,this.m_CurveMax=null}},{key:"setConstantMinMax",value:function(t,n){this.m_Mode=e.TYPE.TwoConstants,this.m_ConstantMin=t,this.m_ConstantMax=n,this.m_CurveMin=null,this.m_CurveMax=null}},{key:"setCurves",value:function(t){this.m_Mode=e.TYPE.Curve,this.m_CurveMax=t,this.m_CurveMin=null}},{key:"setCurvesMinMax",value:function(t,n){this.m_Mode=e.TYPE.TwoCurves,this.m_CurveMin=t,this.m_CurveMax=n}},{key:"getRandomValue",value:function(t){if(this.m_Mode==e.TYPE.Constant)return this.m_ConstantMax;if(this.m_Mode==e.TYPE.TwoConstants)return mm.randomValue(this.m_ConstantMin,this.m_ConstantMax);if(this.m_Mode==e.TYPE.Curve)return this.m_CurveMax.getValue(t);if(this.m_Mode==e.TYPE.TwoCurves){var n=Math.random(),i=this.m_CurveMin.getValue(t),r=this.m_CurveMax.getValue(t);return n>.5?r:i}return 0}}]),e}();vm.TYPE=Object.freeze({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3});var ym=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).isActive=!0,null!=e?i.setJsonData(e):(i.rateOverTime=new vm,i.rateOverTime.setConstantValue(5)),i.density=1,i.rateOverTimeResult=i.rateOverTime.getRandomValue(),i.secondParticle=i.rateOverTimeResult*i.density,i.singleTime=1/i.secondParticle,i.playBackTime=0,i.cacheTime=0,i.createParticleCount=0,i}return o(n,[{key:"setJsonData",value:function(e){this.rateOverTime=new vm(e.rateOverTime)}},{key:"setDensity",value:function(e){this.density=e,this.secondParticle=this.rateOverTimeResult*this.density,0==this.secondParticle?this.singleTime=99999999:this.singleTime=1/this.secondParticle}},{key:"update",value:function(e,t){this.playBackTime+=e,this.cacheTime+=e,this.cacheTime>=this.singleTime&&(this.createParticleCount=Math.floor(this.cacheTime/this.singleTime),this.cacheTime=this.cacheTime%this.singleTime)}},{key:"reset",value:function(){g(l(n.prototype),"reset",this).call(this),this.createParticleCount=0}}]),n}(sm),wm=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).isActive=!0,null!=e?i.setJsonData(e):(i.shape=n.TYPE.Box,i.angle=25,i.radius=1,i.radiusThickness=1,i.donutRadius=.2,i.position=new tt(0,0,0),i.rotation=new xt(0,0,0),i.scale=new tt(1,1,1)),i.startPosition=new tt(0,0,0),i.moveDirection=new tt(0,0,0),i}return o(n,[{key:"setJsonData",value:function(e){this.shape=e.shapeMode,this.shape===n.TYPE.Cone&&(this.angle=e.cone.angle,this.radius=e.cone.radius,this.radiusThickness=e.cone.radiusThickness),this.position=new tt(e.position.x,e.position.y,e.position.z),this.rotation=new xt(e.rotation.x,e.rotation.y,e.rotation.z),this.scale=new tt(e.scale.x,e.scale.y,e.scale.z)}},{key:"update",value:function(e,t){if(g(l(n.prototype),"update",this).call(this,e,t),this.shape==n.TYPE.Cone){var i=Oh.lerp(0,this.angle,1-this.radiusThickness),r=Ke.degToRad(mm.randomValue(i,this.angle)),a=Ke.degToRad(mm.randomValue(0,360)),o=Math.sin(r);this.moveDirection=new tt(o*Math.cos(a),Math.cos(r),o*Math.sin(a));var s=Ke.degToRad(mm.randomValue(0,360)),A=mm.randomValue(0,this.radius);this.startPosition=new tt(Math.cos(s)*A,0,Math.sin(s)*A),this.startPosition=this.startPosition.multiply(this.scale).add(this.position),this.moveDirection.applyEuler(this.rotation).multiply(this.scale)}else if(this.shape==n.TYPE.Box){var c=this.scale.clone().multiplyScalar(.5);this.startPosition=mm.randomVector3(new tt(-c.x,-c.y,-c.z),new tt(c.x,c.y,c.z)),this.moveDirection.y=1,this.moveDirection.applyEuler(this.rotation)}}},{key:"reset",value:function(){g(l(n.prototype),"reset",this).call(this),this.startPosition.setScalar(0),this.moveDirection.setScalar(0)}}]),n}(sm);wm.TYPE=Object.freeze({Sphere:0,Hemisphere:2,Cone:4,Box:5,Circle:10});var xm=function(){function e(t){r(this,e),null!=t?this.setJsonData(t):(this.colorLocation=[],this.colors=[],this.alphaLocation=[],this.alphas=[])}return o(e,[{key:"setJsonData",value:function(e){this.colorLocation=e.colorLocation,this.colors=[];for(var t=0;t<e.colors.length;t++)this.colors[t]=new At(e.colors[t].r,e.colors[t].g,e.colors[t].b,e.colors[t].a);this.alphaLocation=e.alphaLocation,this.alphas=e.alphas}},{key:"getValue",value:function(e){var t=this.lerp(e,this.colorLocation,this.colors),n=this.lerp(e,this.alphaLocation,this.alphas);return new At(t.x,t.y,t.z,n)}},{key:"lerp",value:function(e,t,n){for(var r=0;r<t.length;r++){if(t[r]>=e&&0===r)return"number"==typeof n[r]?n[r]:n[r].clone();if(r<t.length-1&&t[r]<=e&&t[r+1]>e){var a=(e-t[r])/(t[r+1]-t[r]);return"number"==typeof n[r]?n[r]+(n[r+1]-n[r])*a:n[r].clone().lerp(n[r+1],a)}}return i("number"==n[n.length-1])?n[n.length-1]:n[n.length-1].clone()}}]),e}(),bm=function(){function e(t){r(this,e),null!=t?this.setJsonData(t):(this.m_mode=e.TYPE.Color,this.minColor=null,this.maxColor=new At(1,1,1,1),this.minGradient=null,this.maxGradient=null)}return o(e,[{key:"setJsonData",value:function(t){if(this.m_mode=t.m_mode,this.m_mode===e.TYPE.Color)this.setColor(new At(t.maxColor.r,t.maxColor.g,t.maxColor.b,t.maxColor.a));else if(this.m_mode===e.TYPE.TwoColors){var n=new At(t.minColor.r,t.minColor.g,t.minColor.b,t.minColor.a),i=new At(t.maxColor.r,t.maxColor.g,t.maxColor.b,t.maxColor.a);this.setColorMinMax(n,i)}else this.m_mode===e.TYPE.Gradient?this.setGradient(new xm(t.maxGradient)):this.m_mode===e.TYPE.TwoGradients&&this.setMinMaxGradient(new xm(t.minGradient),new xm(t.maxGradient))}},{key:"setColorMinMax",value:function(t,n){this.m_mode=e.TYPE.TwoColors,this.minColor=t,this.maxColor=n}},{key:"setGradient",value:function(t){this.m_mode=e.TYPE.Gradient,this.maxGradient=t}},{key:"setMinMaxGradient",value:function(t,n){this.m_mode=e.TYPE.TwoGradients,this.minGradient=t,this.maxGradient=n}},{key:"setColor",value:function(t){this.m_mode=e.TYPE.Color,this.minColor=null,this.maxColor=t}},{key:"getRandomValue",value:function(){if(this.m_mode==e.TYPE.Color)return this.maxColor;if(this.m_mode==e.TYPE.Gradient)return this.maxGradient.getValue(Math.random());if(this.m_mode==e.TYPE.TwoGradients){var t=Math.random(),n=this.minGradient.getValue(t),i=this.maxGradient.getValue(t);return mm.randomVector4(n,i)}return this.m_mode==e.TYPE.TwoColors?mm.randomVector4(this.minColor,this.maxColor):this.m_mode==e.TYPE.RandomColor?this.maxGradient.getValue(Math.random()):this.maxColor}},{key:"getLerpValue",value:function(t){if(this.m_mode==e.TYPE.Gradient)return this.maxGradient.getValue(t);if(this.m_mode==e.TYPE.TwoGradients){var n=Math.random(),i=this.minGradient.getValue(n),r=this.maxGradient.getValue(n);return n>.5?r:i}return this.maxColor}}]),e}();bm.TYPE=Object.freeze({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4});var Cm=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).isActive=!0,i.duration=e.duration,i.isLoop=e.isLoop,i.startDelay=new vm(e.startDelay),i.startLifeTime=new vm(e.startLifeTime),i.startSpeed=new vm(e.startSpeed),i.startSize=new vm(e.startSize),i.startRotation=new vm(e.startRotation),i.startColor=new bm(e.startColor),i.gravityModifier=new vm(e.gravity),i.maxParticles=1e4,i}return o(n,[{key:"initParticleItem",value:function(e){e.startDelay=this.startDelay.getRandomValue(),e.lifeTime=this.startLifeTime.getRandomValue();var t=this.startSpeed.getRandomValue();e.startSpeed=new tt(t,t,t),e.startSize=this.startSize.getRandomValue(),e.startRotation=this.startRotation.getRandomValue(),e.startColor=this.startColor.getRandomValue(),e.gravityModifier=this.gravityModifier.getRandomValue(),e.refresh()}},{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t),t.setScaleXYZ(t.startSize,t.startSize,t.startSize),t.color=t.startColor.clone(),t.speed=t.moveDirection.clone().add(t.startSpeed),t.speed.add(new tt(0,4.905*-t.gravityModifier*2*t.currentTime,0))}}]),n}(sm),Mm=function(){function e(t){r(this,e),this.particleCount=t,this.bufferGeometry=null,this.material=null,this.mesh=null}return o(e,[{key:"init",value:function(){this.bufferGeometry=new ni}},{key:"setColor",value:function(e,t){}},{key:"setPosition",value:function(e,t,n,i){}},{key:"setScale",value:function(e,t,n){}},{key:"setRotation",value:function(e,t,n,i){}},{key:"setAlpha",value:function(){}}]),e}();Mm.RenderMode=Object.freeze({Billboard:0,StretchedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3});var Bm=function(){function e(t){r(this,e),this.particleSystem=t,this.index=0,this.render=null,this.startDelay=0,this.lifeTime=0,this.startSpeed=1,this.startSize=1,this.startColor=new At(1,1,1,1),this.gravityModifier=0,this.startRotation=0,this.startPosition=new tt(0,0,0),this.moveDirection=new tt(0,0,0),this.active=!0,this.currentTime=0,this.pos0=new tt(0,0,0),this.pos1=new tt(0,0,0),this.pos2=new tt(0,0,0),this.pos3=new tt(0,0,0),this.speed=new tt(1,1,1),this.rotationSpeed=new tt(0,0,0),this.position=this.startPosition.clone(),this.rotation=new tt(0,0,0),this.scale=new tt(1,1,1),this.camera=null,this.localMatrix=new vt,this.moveMatrix=new vt,this.scaleMatrix=(new vt).makeScale(1,1,1),this.rotationEuler=new xt(0,0,0),this.billboardRotationEuler=new xt(0,0,0),this.startRotationEuler=new xt(0,0,Ke.degToRad(this.startRotation)),this.directionEuler=new xt(0,0,0),this.color=this.startColor.clone(),this.isDirty=!0,this.isColorDirty=!0,this.texStartFrame=0}return o(e,[{key:"setCamera",value:function(e){this.camera=e}},{key:"initRender",value:function(e,t){this.render=e,this.camera=t,this.pos0=new tt(-this.render.width,-this.render.height,0),this.pos1=new tt(this.render.width,-this.render.height,0),this.pos2=new tt(this.render.width,this.render.height,0),this.pos3=new tt(-this.render.width,this.render.height,0)}},{key:"refresh",value:function(){this.color=this.startColor.clone(),this.startRotationEuler=new xt(0,0,Ke.degToRad(this.startRotation))}},{key:"setStartPosition",value:function(e){this.startPosition=e,this.setRotation(new tt(0,0,0)),this.setPosition(this.startPosition.clone())}},{key:"setActive",value:function(e){this.active!=e&&(this.active=e,this.active?this.render.setColor(this.index,this.color):this.render.setColor(this.index,new At(this.color.x,this.color.y,this.color.z,0)))}},{key:"reset",value:function(){this.currentTime=0,this.scale.set(1,1,1),this.rotation.set(0,0,0),this.rotationEuler.set(0,0,0),this.isDirty=!1,this.isColorDirty=!1,this.position.set(0,0,0),this.texStartFrame=0}},{key:"update",value:function(e){if(this.currentTime+=e,this.currentTime>=this.lifeTime)return this.setActive(!1),void this.reset();this.rotation.addScaledVector(this.rotationSpeed,e),this.setRotationAngleXYZ(this.rotation.x,this.rotation.y,this.rotation.z),this.position.add(this.speed.multiplyScalar(e)),this.setPosition(this.position),this.billboard(),!0===this.isDirty&&this.refreshMatrix(),!0===this.isColorDirty&&this.render.setColor(this.index,this.color)}},{key:"billboard",value:function(){if(null!=this.camera){var e=new tt(0,0,0);this.camera.getWorldDirection(e),e.add(this.camera.position),e=this.particleSystem.worldToLocal(e);var t=this.particleSystem.worldToLocal(this.camera.position.clone());this.render.renderMode==Mm.RenderMode.StretchedBillboard&&e.setY(t.y);var n=new vt;n.lookAt(t,e,new tt(0,1,0));var i=new qe;i.setFromRotationMatrix(n),this.billboardRotationEuler.set(0,0,0),this.billboardRotationEuler.setFromQuaternion(i)}}},{key:"refreshMatrix",value:function(){this.localMatrix=this.scaleMatrix.clone(),this.localMatrix.premultiply(this.moveMatrix);var e=this.pos0.clone().applyEuler(this.startRotationEuler).applyEuler(this.rotationEuler).applyEuler(this.billboardRotationEuler).applyMatrix4(this.localMatrix),t=this.pos1.clone().applyEuler(this.startRotationEuler).applyEuler(this.rotationEuler).applyEuler(this.billboardRotationEuler).applyMatrix4(this.localMatrix),n=this.pos2.clone().applyEuler(this.startRotationEuler).applyEuler(this.rotationEuler).applyEuler(this.billboardRotationEuler).applyMatrix4(this.localMatrix),i=this.pos3.clone().applyEuler(this.startRotationEuler).applyEuler(this.rotationEuler).applyEuler(this.billboardRotationEuler).applyMatrix4(this.localMatrix);this.render.setPosition(4*this.index,e),this.render.setPosition(4*this.index+1,t),this.render.setPosition(4*this.index+2,n),this.render.setPosition(4*this.index+3,i),this.render.refreshPosition()}},{key:"setPosition",value:function(e){this.position.x==e&&this.position.y==e.y&&this.position.z==e.z||(this.position=e,this.moveMatrix.makeTranslation(this.position.x,this.position.y,this.position.z),this.isDirty=!0)}},{key:"setScale",value:function(e){this.setScaleXYZ(e.x,e.y,e.z)}},{key:"setScaleXYZ",value:function(e,t,n){this.scale.x==e&&this.scale.y==t&&this.scale.z==n||(this.scale.set(e,t,n),this.scaleMatrix.makeScale(this.scale.x,this.scale.y,this.scale.z),this.isDirty=!0)}},{key:"setRotationAngleXYZ",value:function(e,t,n){this.setRotationXYZ(Ke.degToRad(e),Ke.degToRad(t),Ke.degToRad(n))}},{key:"setRotation",value:function(e){this.setRotationXYZ(e.x,e.y,e.z)}},{key:"setRotationXYZ",value:function(e,t,n){this.rotationEuler.x==e&&this.rotationEuler.y==t&&this.rotationEuler.z==n||(this.rotation.set(Ke.radToDeg(e),Ke.radToDeg(t),Ke.radToDeg(n)),this.rotationEuler.set(e,t,n),this.isDirty=!0)}},{key:"setColor",value:function(e){this.color.x===e.x&&this.color.y===e.y&&this.color.z===e.z&&this.color.w===e.w||(this.color=e,this.isColorDirty=!0)}},{key:"multiplyColor",value:function(e){this.color.multiply(e),this.isColorDirty=!0}},{key:"setUVs",value:function(e,t){this.render.setUV(this.index,e,t)}}]),e}(),Im=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this,e)).width=.5,a.height=.5,a.mainTexture=null,a.renderMode=n.RenderMode.Billboard,null!=i?(""==i.texName?a.texPath="glow.png":a.texPath=i.texName,a.vertexShaderName=mm.getShader(i.vertexShaderName),a.fragmentShaderName=mm.getShader(i.fragmentShaderName),a.blendSrc=mm.getShaderBlend(i.blendSrc),a.blendDst=mm.getShaderBlend(i.blendDst),a.renderMode=i.renderMode,a.renderMode==Mm.RenderMode.StretchedBillboard?a.lengthScale=i.lengthScale:a.lengthScale=1,null!=i.matColor&&(a.matColor=new At(i.matColor.r,i.matColor.g,i.matColor.b,i.matColor.a))):(a.texPath="glow.png",a.lengthScale=1,a.vertexShaderName=mm.getShader("normal_vertex"),a.fragmentShaderName=mm.getShader("normal_fragment"),a.blendSrc=mm.getShaderBlend("SrcAlpha"),a.blendDst=mm.getShaderBlend("OneMinusSrcAlpha")),a.height*=a.lengthScale,a.init(),a}return o(n,[{key:"init",value:function(){g(l(n.prototype),"init",this).call(this),this.mainTexture=(new KA).load(this.texPath);for(var e=[],t=[],i=[],r=[],a=0;a<this.particleCount;a++){e.push(-this.width,-this.height,0),e.push(this.width,-this.height,0),e.push(this.width,this.height,0),e.push(-this.width,this.height,0);var o=4*a;i.push(o,o+1,o+2),i.push(o,o+2,o+3),r.push(0,0),r.push(1,0),r.push(1,1),r.push(0,1),t.push(1,1,1,1),t.push(1,1,1,1),t.push(1,1,1,1),t.push(1,1,1,1)}this.bufferGeometry.setIndex(i),this.bufferGeometry.setAttribute("position",new Vn(e,3)),this.bufferGeometry.setAttribute("vertexColor",new Vn(t,4)),this.bufferGeometry.setAttribute("uv",new Vn(r,2));var s={};s.mainTex={value:this.mainTexture},null!=this.matColor&&(s._TintColor={value:this.matColor}),this.material=new Pi({uniforms:s,vertexShader:this.vertexShaderName,fragmentShader:this.fragmentShaderName,transparent:!0,blending:5,blendSrc:this.blendSrc,blendDst:this.blendDst,vertexColors:!0,depthWrite:!1}),this.mesh=new xi(this.bufferGeometry,this.material),this.mesh.renderOrder=2e3,this.mesh.frustumCulled=!1}},{key:"setColor",value:function(e,t){this.bufferGeometry.attributes.vertexColor.setXYZW(4*e,t.x,t.y,t.z,t.w),this.bufferGeometry.attributes.vertexColor.setXYZW(4*e+1,t.x,t.y,t.z,t.w),this.bufferGeometry.attributes.vertexColor.setXYZW(4*e+2,t.x,t.y,t.z,t.w),this.bufferGeometry.attributes.vertexColor.setXYZW(4*e+3,t.x,t.y,t.z,t.w),this.bufferGeometry.attributes.vertexColor.needsUpdate=!0}},{key:"setPosition",value:function(e,t){this.bufferGeometry.attributes.position.setXYZ(e,t.x,t.y,t.z)}},{key:"refreshPosition",value:function(){this.bufferGeometry.attributes.position.needsUpdate=!0}},{key:"setUV",value:function(e,t,n){this.bufferGeometry.attributes.uv.setXY(4*e,t.x,t.y),this.bufferGeometry.attributes.uv.setXY(4*e+1,n.x,t.y),this.bufferGeometry.attributes.uv.setXY(4*e+2,n.x,n.y),this.bufferGeometry.attributes.uv.setXY(4*e+3,t.x,n.y),this.bufferGeometry.attributes.uv.needsUpdate=!0}}]),n}(Mm),Em=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),i=t.call(this),null!=e)i.color=new bm(e.color);else{i.color=new bm;var a=new xm;a.colorLocation=[0,1],a.colors=[new tt(1,1,1),new tt(1,0,0)],a.alphaLocation=[0,1],a.alphas=[1,1],i.color.setGradient(a)}return i}return o(n,[{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t);var i=t.currentTime/t.lifeTime;i=Oh.clamp(i,0,1);var r=this.color.getLerpValue(i);t.multiplyColor(r)}}]),n}(sm),Sm=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),i=t.call(this),null!=e?(i.linearSpeedX=new vm(e.linearX),i.linearSpeedY=new vm(e.linearY),i.linearSpeedZ=new vm(e.linearZ)):(i.linearSpeedX=new vm,i.linearSpeedY=new vm,i.linearSpeedZ=new vm,i.linearSpeedX.setConstantValue(10)),i.speedVec=new tt(0,0,0),i.linearSpeedX.m_Mode===vm.TYPE.TwoCurves||i.linearSpeedX.m_Mode===vm.TYPE.Curve?i.isCurve=!0:i.isCurve=!1,i}return o(n,[{key:"initParticleItem",value:function(e){g(l(n.prototype),"initParticleItem",this).call(this,e),!1===this.isCurve&&(this.speedVec.set(0,0,0),this.speedVec.set(this.linearSpeedX.getRandomValue(),this.linearSpeedY.getRandomValue(),this.linearSpeedZ.getRandomValue()),e.startSpeed.add(this.speedVec))}},{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t),!0===this.isCurve&&(this.speedVec.set(this.linearSpeedX.getRandomValue(e),this.linearSpeedY.getRandomValue(e),this.linearSpeedZ.getRandomValue(e)),t.speed.add(this.speedVec))}},{key:"reset",value:function(){g(l(n.prototype),"reset",this).call(this),this.speedVec.set(0,0,0)}}]),n}(sm),Tm=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).x=new vm,e.x.setConstantValue(5),e.y=new vm,e.z=new vm,e}return o(n,[{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t);var i=t.currentTime/t.lifeTime,r=this.x.getRandomValue(i)*t.currentTime,a=this.y.getRandomValue(i)*t.currentTime,o=this.z.getRandomValue(i)*t.currentTime;t.speed.set(t.speed.x+r,t.speed.y+a,t.speed.z+o)}}]),n}(sm),Lm=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),i=t.call(this),null!=e?(null!=e.rx?i.rCurveX=new vm(e.rx):i.rCurveX=new vm,null!=e.ry?i.rCurveY=new vm(e.ry):i.rCurveY=new vm,null!=e.rz?i.rCurveZ=new vm(e.rz):i.rCurveZ=new vm):(i.rCurveX=new vm,i.rCurveY=new vm,i.rCurveZ=new vm),i.rCurveZ.m_Mode===vm.TYPE.Constant||i.rCurveZ.m_Mode===vm.TYPE.TwoConstants?i.isCurve=!1:i.isCurve=!0,i}return o(n,[{key:"initParticleItem",value:function(e){var t=this.rCurveX.getRandomValue(),n=this.rCurveY.getRandomValue(),i=this.rCurveZ.getRandomValue();e.rotationSpeed.set(t,n,i)}},{key:"update",value:function(e,t){if(g(l(n.prototype),"update",this).call(this,e,t),this.isCurve){var i=t.currentTime/t.lifeTime,r=this.rCurveX.getRandomValue(i),a=this.rCurveY.getRandomValue(i),o=this.rCurveZ.getRandomValue(i);t.rotationSpeed.set(r,a,o)}}}]),n}(sm),Fm=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),i=t.call(this),null!=e)i.tileX=e.tileX,i.tileY=e.tileY,i.animation=e.animationMode,i.rowMode=e.rowMode,i.row=e.row,i.timeMode=e.timeMode,i.frameOverTime=new vm(e.frameOverTime),i.startFrame=new vm(e.startFrame),i.cycles=e.cycles,null!=e.speedRange&&(i.speedRange=new Je(e.speedRange.x,e.speedRange.y));else{i.tileX=8,i.tileY=8,i.animation=n.Animation.WholeSheet,i.rowMode=n.RowMode.Random,i.row=0,i.timeMode=n.TimeMode.LifeTime,i.frameOverTime=new vm;var a=new gm;a.times=[0,1],a.values=[0,1],i.frameOverTime.setCurves(a),i.speedRange=new Je(0,1),i.startFrame=new vm,i.startFrame.setConstantValue(0),i.cycles=1}return i}return o(n,[{key:"initParticleItem",value:function(e){g(l(n.prototype),"initParticleItem",this).call(this,e),e.texStartFrame=this.startFrame.getRandomValue()}},{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t);var i,r,a=t.currentTime/t.lifeTime,o=0,s=0;if(this.animation===n.Animation.WholeSheet)o=0,s=this.tileX*this.tileY;else if(this.animation===n.Animation.SingleRow){var A=0;this.rowMode===n.RowMode.Custom?A=this.row:this.rowMode==n.RowMode.Random&&(A=Math.random()*this.tileX),o=A*this.tileY,s=A*this.tileY+this.tileX}var c=0,h=s-o;if(this.timeMode==n.TimeMode.LifeTime){var u=this.frameOverTime.getRandomValue(a)*this.cycles;c=parseInt(u*h)}else if(this.timeMode==n.TimeMode.Speed){var d=(t.speed.length()-this.speedRange.x)/(this.speedRange.y-this.speedRange.x);d=Oh.clamp(d*this.cycles,0,1),c=parseInt(h*d)}r=(c+=t.texStartFrame)-(i=parseInt(c/this.tileY))*this.tileY,t.setUVs(new Je(r/this.tileY,(this.tileX-i-1)/this.tileX),new Je((r+1)/this.tileY,(this.tileX-i)/this.tileX))}}]),n}(sm);Fm.Animation=Object.freeze({WholeSheet:0,SingleRow:1}),Fm.RowMode=Object.freeze({Custom:0,Random:1}),Fm.TimeMode=Object.freeze({LifeTime:0,Speed:1});var _m=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).dampen=0,e.speedLimitX=new vm,e.speedLimitY=new vm,e.speedLimitZ=new vm,e}return o(n,[{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t);var i=t.currentTime/t.lifeTime;i=Oh.clamp(i);var r=this.speedLimitX.getRandomValue(i),a=this.speedLimitY.getRandomValue(i),o=this.speedLimitZ.getRandomValue(i);r=Math.min(r,t.speed.x),a=Math.min(a,t.speed.y),o=Math.min(o,t.speed.z);var s=Oh.lerp(t.speed.x,r,this.dampen),A=Oh.lerp(t.speed.y,a,this.dampen),c=Oh.lerp(t.speed.z,o,this.dampen);t.speed.set(s,A,c)}}]),n}(sm),Um=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),i=t.call(this),null!=e?!0===e.separateAxes?(i.sizeCurveX=new vm(e.sizeX),i.sizeCurveY=new vm(e.sizeY),i.sizeCurveZ=new vm(e.sizeZ)):(i.sizeCurveX=new vm(e.sizeX),i.sizeCurveY=new vm(e.sizeX),i.sizeCurveZ=new vm(e.sizeX)):(i.sizeCurveX=new vm,i.sizeCurveY=new vm,i.sizeCurveZ=new vm),i}return o(n,[{key:"update",value:function(e,t){g(l(n.prototype),"update",this).call(this,e,t);var i=t.currentTime/t.lifeTime,r=this.sizeCurveX.getRandomValue(i),a=this.sizeCurveY.getRandomValue(i),o=this.sizeCurveZ.getRandomValue(i);t.setScaleXYZ(t.scale.x*r,t.scale.y*a,t.scale.z*o)}}]),n}(sm),Pm=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).render=null,i.camera=null,i.initParticleData(e),i}return o(n,[{key:"initParticleData",value:function(e){this.mainModule=new Cm(e.main),this.emissionModule=new ym(e.emission),this.shapeModule=new wm(e.shape),this.statusModules=[this.mainModule],null!=e.velocityLifeTime&&(this.velocityLifetimeModule=new Sm(e.velocityLifeTime),this.velocityLifetimeModule.isActive=!0,this.statusModules.push(this.velocityLifetimeModule)),null!=e.limitVelocityLifeTime&&(this.limitVelocityLifeTimeModule=new _m(e.limitVelocityLifeTime),this.limitVelocityLifeTimeModule.isActive=!0,this.statusModules.push(this.limitVelocityLifeTimeModule)),null!=e.forceLifeTime&&(this.forceLifeTimeModule=new Tm(e.forceLifeTime),this.forceLifeTimeModule.isActive=!0,this.statusModules.push(this.forceLifeTimeModule)),null!=e.colorLifeTime&&(this.colorLifeTimeModule=new Em(e.colorLifeTime),this.colorLifeTimeModule.isActive=!0,this.statusModules.push(this.colorLifeTimeModule)),null!=e.sizeLifeTime&&(this.sizeLifeTimeModule=new Um(e.sizeLifeTime),this.sizeLifeTimeModule.isActive=!0,this.statusModules.push(this.sizeLifeTimeModule)),null!=e.rotationLifeTime&&(this.rotationLifeTimeModule=new Lm(e.rotationLifeTime),this.rotationLifeTimeModule.isActive=!0,this.statusModules.push(this.rotationLifeTimeModule)),null!=e.texSheetAnimation&&(this.texSheetAnimationModule=new Fm(e.texSheetAnimation),this.texSheetAnimationModule.isActive=!0,this.statusModules.push(this.texSheetAnimationModule)),this.clock=new ic,this.totalParticleCount=this.mainModule.duration*this.emissionModule.secondParticle,this.totalParticleCount>this.mainModule.maxParticles&&(this.totalParticleCount=this.mainModule.maxParticles),this.render=new Im(this.totalParticleCount,e.render),this.add(this.render.mesh),this.itemPool=[],this.activeItemArray=[],this.removeItemArray=[],this.totalTime=0}},{key:"init",value:function(e){this.camera=e;for(var t=0;t<this.totalParticleCount;t++){var n=new Bm(this);n.index=t,n.initRender(this.render,this.camera),n.setActive(!1),this.itemPool.push(n)}}},{key:"onBeforeRender",value:function(e,t,n){this.activeItemArray.map((function(e){e.setCamera(n)}))}},{key:"getItemByPool",value:function(){return this.itemPool.length>0?this.itemPool.pop():null}},{key:"pushItemToPool",value:function(e){this.itemPool.push(e)}},{key:"setDensity",value:function(e){this.emissionModule.setDensity(e);var t=this.mainModule.duration*this.emissionModule.secondParticle;if(t>this.mainModule.maxParticles&&(t=this.mainModule.maxParticles),t>this.totalParticleCount){for(var n=this.totalParticleCount;n<t;n++){var i=new Bm(this);i.index=n,i.initRender(this.render,this.camera),i.setActive(!1),this.itemPool.push(i)}this.totalParticleCount=t}}},{key:"update",value:function(){var e=this.clock.getDelta();this.emissionModule.update(e,null);var t=this.emissionModule.createParticleCount;if(t>0)for(var n=0;n<t;n++){var i=this.getItemByPool();if(null==i)break;this.shapeModule.update(e,null),i.setStartPosition(this.shapeModule.startPosition.clone()),i.moveDirection=this.shapeModule.moveDirection.clone(),i.setActive(!0);for(var r=0;r<this.statusModules.length;r++)this.statusModules[r].isActive&&(this.statusModules[r].initParticleItem(i),this.statusModules[r].reset());this.activeItemArray.push(i),this.shapeModule.reset()}this.emissionModule.reset();for(var a=0;a<this.activeItemArray.length;a++){for(var o=this.activeItemArray[a],s=0;s<this.statusModules.length;s++)this.statusModules[s].isActive&&(this.statusModules[s].update(e,o),this.statusModules[s].reset());o.update(e),o.active||(this.removeItemArray.push(a),this.pushItemToPool(o))}for(var A=0;A<this.removeItemArray.length;A++)this.activeItemArray.splice(this.removeItemArray[A]-A,1);this.removeItemArray.splice(0,this.removeItemArray.length)}}]),n}(Dt),km=function(){function e(){r(this,e)}return o(e,null,[{key:"pushItem",value:function(e){this.pItems.push(e)}},{key:"removeItem",value:function(t){for(var n=0;n<this.pItems.length;n++)e.pItems[n]==t&&e.pItems.unshift(t)}},{key:"update",value:function(){for(var e=0;e<this.pItems.length;e++)this.pItems[e].update()}}]),e}();km.pItems=[];var Dm={nodes:[{id:0,parentId:-1,name:"Fire_Smoke",localPosition:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},{id:1,parentId:0,name:"Fire_Smoke",localPosition:[0,0,0],rotation:[270,0,0],scale:[1,1,1],main:{duration:5,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:3,min:2,max:3},startSpeed:{mode:3,min:0,max:0},startSize:{mode:3,min:5,max:35},startRotation:{mode:3,min:0,max:360},startColor:{m_mode:0,minColor:null,maxColor:{r:1,g:1,b:1,a:.219607845}},gravity:{mode:0,min:0,max:0}},emission:{rateOverTime:{mode:0,min:0,max:100}},shape:{shapeMode:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}},velocityLifeTime:{linearX:{mode:3,min:0,max:0},linearY:{mode:3,min:0,max:0},linearZ:{mode:3,min:15,max:10}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[0,.314702064,.417639434,.497062624,1],colors:[{r:1,g:.8980392,b:.831372559,a:1},{r:1,g:.7607843,b:.5372549,a:1},{r:.9137255,g:.623529434,b:.4392157,a:1},{r:.7176471,g:.5176471,b:.4627451,a:1},{r:.192156866,g:.192156866,b:.192156866,a:1}],alphaLocation:[0,.0441138335,.323537052,.7058824,.855878532,1],alphas:[.305882365,1,.8862745,.9529412,.843137264,0]}}},sizeLifeTime:{separateAxes:!1,sizeX:{mode:1,min:0,max:0,maxCurve:{times:[0,.05,.1,.15,.2,.25,.3,.350000024,.400000036,.418660671,.468660682,.518660665,.5686607,.6186607,.6686607,.7186607,.7686607,.818660736,.868660748,.91866076,.9686608,1],values:[.2159091,.285781056,.359360576,.434577644,.5093622,.5816443,.6493538,.7104207,.762774944,.779661953,.8188196,.8507291,.8764641,.8970983,.91370517,.9273583,.939131439,.9500981,.961331844,.9739063,.988895059,1]}}},texSheetAnimation:{tileX:8,tileY:8,animationMode:0,rowMode:1,row:0,timeMode:0,frameOverTime:{mode:1,min:0,max:0,maxCurve:{times:[0,1],values:[0,1]}},startFrame:{mode:0,min:0,max:0},cycles:1},render:{renderMode:0,lengthScale:-.8,texName:"data:image/png;base64,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",matColor:{r:1,g:1,b:1,a:1},vertexShaderName:"normal_legacy_vertex",fragmentShaderName:"normal_legacy_fragment",blendSrc:"SrcAlpha",blendDst:"OneMinusSrcAlpha"}}]},Rm={nodes:[{id:0,parentId:-1,name:"Rain",localPosition:[0,81.6,0],rotation:[0,0,0],scale:[1,1,1],main:{duration:5,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:0,min:0,max:5},startSpeed:{mode:0,min:0,max:0},startSize:{mode:3,min:.5,max:1},startRotation:{mode:0,min:0,max:0},startColor:{m_mode:2,minColor:{r:1,g:1,b:1,a:.65882355},maxColor:{r:.8584906,g:.8584906,b:.8584906,a:.68235296}},gravity:{mode:3,min:3,max:6}},emission:{rateOverTime:{mode:0,min:0,max:200}},shape:{shapeMode:5,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:50,y:10,z:50}},velocityLifeTime:{linearX:{mode:0,min:0,max:1},linearY:{mode:0,min:0,max:-60},linearZ:{mode:0,min:0,max:0}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[0,1],colors:[{r:1,g:1,b:1,a:1},{r:1,g:1,b:1,a:1}],alphaLocation:[0,.314702064,1],alphas:[0,.929411769,.5019608]}}},sizeLifeTime:{separateAxes:!1,sizeX:{mode:1,min:0,max:0,maxCurve:{times:[0,1],values:[0,1]}}},render:{renderMode:1,lengthScale:8,texName:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABCUExURUxpcefv99Xk9fL2+vL1+vf5/Pf6/fr8/e3z+ff6/Pj6/fb5/HKf1Nrl8fj5++/0+t7n8/b4+/f6/MXc9f////7+/zJK5OYAAAAUdFJOUwBZHIKS4sH+c+jZ1Acy9WlLo6sPMZpK9wAAAKhJREFUOMuVk9sSgyAMRFGBoCC9Jf//q61t0YnAdrqvObOuS2KM1mM1WMH+AJYZz0eWEQJWBH+DmAlG5JcGbMDs+vMLv3XtAvkDRJgAWVABOmVZ3hVa80QHIO0SD4AnlGATdTsoquu8q7nc6kXQDguO0ArBJ/3vMGugfnOvAV8Bk6jfrKtctUPjfhyOYMyAm95i7inENxcm5QLk1Lm7bxeuf30hEkW9b0/Z7BfgolafUQAAAABJRU5ErkJggg==",vertexShaderName:"normal_vertex",fragmentShaderName:"normal_fragment",blendSrc:"SrcAlpha",blendDst:"One"}}]},Om={nodes:[{id:0,parentId:-1,name:"snow",localPosition:[.8075409,40,16.9335175],rotation:[0,0,0],scale:[1,1,1],main:{duration:10,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:0,min:0,max:10},startSpeed:{mode:0,min:0,max:0},startSize:{mode:3,min:.5,max:1},startRotation:{mode:3,min:0,max:360},startColor:{m_mode:0,minColor:null,maxColor:{r:.870588243,g:.9382724,b:.992156863,a:.4392157}},gravity:{mode:3,min:.3,max:.5}},emission:{rateOverTime:{mode:0,min:0,max:100}},shape:{shapeMode:5,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:50,y:50,z:50}},velocityLifeTime:{linearX:{mode:3,min:10,max:-10},linearY:{mode:3,min:0,max:0},linearZ:{mode:3,min:10,max:-10}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[.0882429257,1],colors:[{r:1,g:1,b:1,a:1},{r:1,g:1,b:1,a:1}],alphaLocation:[0,.126466781,.8294194,1],alphas:[0,1,1,0]}}},rotationLifeTime:{rz:{mode:0,min:0,max:45}},render:{renderMode:0,lengthScale:2,texName:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAByUExURUxpcf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4wLXbUAAAAmdFJOUwCHSMjp2+4EsgKQ5KEkfsIQcyyZqWu70Bv71hVaNPcJ8kBS4GI6NWpSxQAAB2hJREFUWMPlV+mO2zwS/HjJNEWJonhpKNLW+f6vuCVnsTPOJECC3X8rBElsmM3q6urq1j///H8999vtdv8vTt9vwzQ8/zoCbr1d/w7j1FE6T/NfhcDhAUcQ4Tafx7FVfLrd/zzCs+umlXbzNAzjWkN/rLV7/hvRH90/jCWUdUKAqa7WHtaqUrv59sf3r2vp7XaO84z8o+9JKOO6rfNva3H7hIf/TbT0pFeK9LR2U5HK2lrH86y/4fGTsNftYy3Bxiy9Osq6bfR6tjHEqI7u9mvAY0e3i7DbK/ujD8XGJF2gtJ44XGuwhaTW0XH6BYTriN3qPAPf/TnStRBClNbOEReNC+u6Uums89Ke3XD/VkoQdm69pec43J7P+UT2lvjUShmdNkIeY9edUoORvi/dE897hPswnihz6FW/VkrX4EzyikgRsyCH9a5001Rt70kgTiOb8V3T92GeVm1UH+hYg/JaRxa1Cr0j0hDnHQnd3I2ryh4AynoQ271rGrBX56xdO4B3rBVGAqtVbE9RRcECnYdhqCpCTaAXF03dm6bvQ1dxA63FtGJvm6bdmdbEMc6lczKW8fkcOloq3Y5DcuH79V3TCEDXsVgaDN+Xj6ZZ+C6EJCovzPU9AYd1pITQgjQB0JFvmr53K3V+oySKx8djafYsdpG833PUFkqoFEIORSUESEb3pf6kafA4H8oewbWPj4+FZ4AQe0oRP5dooz646IJVkjjjlEa9a33X9HMYuvOkQTacP7jICMOFaHibpdbeRxHBBfPE9rZsBZqWfZnecnjO01jPQ+8tbhc7Ajw46ORMGoanaY0x3vbabWs4qmXJnsOXFG6359ydtFgn00XjsiBCm0QjDNsXROJZiCS10+jpSGq1GqX5RPAca7cFum6Eycibx4Nz0Sz7LvIF4vHRAE0LDAtPLhyebLVbty8B0PtofUvr5hICJMHbPTPGQeTjsbQfSAdoeMq81UfZwnZWuNRnBui+Q0l9sdN7r43M4E+w3DzazJdlB6Imxwactsl4cmxoyOeXjrxPOO+lxx9HiJfai8eSc+YXAtGgHBxc4rtlaZUR5ljhCLevrdStge3GRHBkcL0xAL4LELc8Fo4AC/S94zznDE3uKe7/aov3eaoECSYPC0kCobzhvOWXIgFd8OY6CjR8373aKDrp3Q3uz2ntWY6SwLC4iEY7lhiSv6SwtK1oIcwWVCRmVFinrv5sy8NplZYGUoMGDWxY82UHhAUBEOSDNyIyARAwia2O3cs2vyKYa9FRX0nwR6uJ6hXoXprXYfwFTaA1kUmTtSvlKOPw5keXHdGY486ZZu0er1T8lcHHdR73wh3yLgximN5aomydpq8iftmR9spAQmgaCTNyUoKNZvlYhICmHy1DcbxyWmmWJPSGKr6XEe1+oE+XJRsoQXtpWr7nHeVbLhBCOy92hiqLpYXZhQpHfAtA6RkIiaBJbbBmwyTaqN0fTfPxaJJBF+u0M6YJvpWaHCs9pzcloDO07C2RvrdxhwSZiS2UsKCsMJWUPVE+Jo24mcW+0O3yxDce5+BUv1npCdDDA2JshWgFY1JKx0TE0EC35CzB8aElLPFNTC87orZXWSrYuIhaOgP6d8OXRqQMc1fwO7Sqgh/Ya1S9B7g/h7mDZ5OLKJl3H6MzOxTMoMKE1k4QOuYE6Xs0HPKQ2/SuRnh8B5/1zF+1lLI1OqMZdskY1AVH2tP1tep1YtcFhE63b+N57orMDD8ivduzuRyJoaIvO1kEAwipozCuB9/l/L7o3OY1EA2z7SO8KEezc3MpCopEX6Orlx2fBfOYmWTruuEbhIkGBcvXKEPbZCZgKQz9AS0KUHl57KsmWDpIWDu09M8TfqohJsYc8ZlDRQ2kHbOJjO/81VdLC4tLDDuHI3Z9V/O1yWJ6BsRnpAQvctqxXPjeOYgnAQB42BEoxYihS5TrLwxfA8y1q9aikMrCVnJOLLKGm9RCh0mIzD8eIkZMBswo3hpXsDZ1X6SATdZaDM/NgiIGC4cDJCgyYZRLiDJiWCSN0uYY085xHqPx01nvQ6U1YOTY4GU4izb73iJAjliqlPYorvOMkd4nHu1BZB881r1PMd6wyRKLxcpbovutbgohmETqoAwOJ7UiONJvq4VbFKwoViZN/yPGG1bZjUnsEVstWF9oCRjSWea29agrLE5rdfSkYGMFyKDhjIfqP731jv2lQOoW832ldJo7enjOUK5IMAiNIiTAzbGBYVfDwm7VcaJzvogRW2adcLazmTkLzzy3DcK3ISIMlmxbziv0CSu8jeN00rN2cIAvs3WusGsbqjXZ1uF5zUrseH3ROdmCNffcQFrASvNCO3Wv0fSmxFtdqSFIUWHq3/95YlMnLGALcNh/t7CWi7SXCeHN6/mTK//AMEwEm9PcbVh2L11PRVvs3iuyx0o0li+kAcX39x54EhZYaOPH3Lyae63jOOOt5xek/eptAZ40TrdPaWDcAMvtFfkbab95Ley+TH2kOnTXGndF/gVpv4nx9psfn39D2t+9tP6KtP/V8y8l0LzlAIvWOwAAAABJRU5ErkJggg==",vertexShaderName:"normal_vertex",fragmentShaderName:"normal_fragment",blendSrc:"SrcAlpha",blendDst:"One"}}]},Nm={nodes:[{id:0,parentId:-1,name:"WaterSpray",localPosition:[0,0,0],rotation:[0,0,0],scale:[1,1,1],main:{duration:5,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:0,min:0,max:1.7},startSpeed:{mode:0,min:0,max:0},startSize:{mode:0,min:0,max:4},startRotation:{mode:3,min:0,max:360},startColor:{m_mode:0,minColor:null,maxColor:{r:1,g:1,b:1,a:1}},gravity:{mode:0,min:0,max:1}},emission:{rateOverTime:{mode:0,min:0,max:20}},shape:{shapeMode:5,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:.5,y:.5,z:.5}},velocityLifeTime:{linearX:{mode:0,min:0,max:12},linearY:{mode:0,min:0,max:1},linearZ:{mode:0,min:0,max:1}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[0,1],colors:[{r:1,g:1,b:1,a:1},{r:1,g:1,b:1,a:1}],alphaLocation:[0,.23823911,.4735332,1],alphas:[0,1,1,0]}}},sizeLifeTime:{separateAxes:!1,sizeX:{mode:1,min:0,max:0,maxCurve:{times:[0,.05,.1,.15,.2,.25,.3,.350000024,.400000036,.450000048,.50000006,.5500001,.6000001,.6500001,.7000001,.7500001,.800000131,.850000143,.900000155,.950000167,1],values:[0,.0751110539,.149811536,.223729327,.2964923,.367728353,.437065363,.504131258,.568553865,.629961133,.687980831,.7422409,.7923693,.8379938,.8787424,.914242864,.944123149,.9680111,.9855346,.9963217,1]}}},render:{renderMode:0,lengthScale:2,texName:"data:image/png;base64,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",vertexShaderName:"normal_vertex",fragmentShaderName:"normal_fragment",blendSrc:"SrcAlpha",blendDst:"One"}},{id:1,parentId:0,name:"shui02",localPosition:[0,0,0],rotation:[0,0,0],scale:[1,1,1],main:{duration:5,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:0,min:0,max:.5},startSpeed:{mode:0,min:0,max:0},startSize:{mode:0,min:0,max:1},startRotation:{mode:3,min:0,max:360},startColor:{m_mode:0,minColor:null,maxColor:{r:1,g:1,b:1,a:1}},gravity:{mode:0,min:0,max:1}},emission:{rateOverTime:{mode:0,min:0,max:50}},shape:{shapeMode:5,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:.5,y:.5,z:.5}},velocityLifeTime:{linearX:{mode:0,min:0,max:12},linearY:{mode:0,min:0,max:1},linearZ:{mode:0,min:0,max:1}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[0,1],colors:[{r:1,g:1,b:1,a:1},{r:1,g:1,b:1,a:1}],alphaLocation:[0,.5029374,1],alphas:[1,1,0]}}},sizeLifeTime:{separateAxes:!1,sizeX:{mode:1,min:0,max:0,maxCurve:{times:[0,.05,.1,.15,.2,.25,.3,.350000024,.400000036,.450000048,.50000006,.5500001,.6000001,.6500001,.7000001,.7500001,.800000131,.850000143,.900000155,.950000167,1],values:[.253846169,.327116847,.39655,.462154329,.5239385,.5819111,.636080742,.686456263,.7330462,.7758591,.814903855,.850189,.8817231,.909514964,.9335731,.9539063,.9705231,.9834323,.992642343,.998162031,1]}}},render:{renderMode:0,lengthScale:2,texName:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABCUExURUxpcf///////////////////////////////////////////////////////////////////////////////////zezJKIAAAAVdFJOUwDvNFrATyQCBAjJGhBCc7TogWWZ2sfShx8AAAgESURBVHja7VuHlqM6DAUbI4le4v//1SfZhtCSIcHs7DlvfbZMyVhXV11kkuTdgRySit6+JKn5ZYWB5J5T8e0/3M34wMBdAM5dDHAbgHPQbgXw51X7ew/Rr0rniKh+EwB7GdBv2wB+zyF/PRQI/r/k/zUI/obz+574624A/28CvgEBu88vsogG8exLQ0O3wU9XYgDAnAfQHDNwyQeJskwAwAkQ2CQYPwzKYIITiqgmKeN7bn1eKQbqYJYRxZd1+YkD7j6MQECJ50JO4Ss8V8ckpRLlpVU7patnplD1drqK5YXGWktHWkE5iRHZuryriJExll6kyDx4ivukTO44ThOjD5ktJz09+9l9Rdw86Mi3YIo+9AyUMwc5xTVCpt+FX9+LSJsks7MkxLbJY9bDN0GVJz2J/DwXABMCDAzET827KzFx8q1QkBtzX1cwCVZHbsb6W7uDGNUVccp0uMLx7FnIVkklBGCBCK6S5hCbAXxqh8uGw/2xwQU4KDCXsVbH7ycNatx1OCZpW5tYThHWmUEAiPY3AEBhAA2Zp5dPBrBCvmOACpcXACLvkFgyti7jOA0NgNo1foVLlKXvIHLxk4gIlMjFBh2AJstg06MRs18saxaJ31Y3MVBmQi86B5jk21V2cnUKIzDgewCxKrYtBgBNk7ENmGGXhBLO0zQMoS1wJGCez8utizse8WY+ZY/cHOLY5V1ilrkhrxzlo2taCna9RgJQKVB9aOavAIAS3GQA0PN1I7PQdU+nWL10HEcPgJ0z/IgjJYFL5QDCfAqizXRRwX/7RSrCOR+E4OP/1BSCUMGleuRuA8j6KQd2HsCeAg+ELVDCjCNGT8wxjb0YADNaZWD1/LB/IqDWeSGTMddFiJD/RL4HwHDq1Y3DOi8bRrCh8Ju+hFYLOuUBYEGn+v75VVr7ILrMgBdv0EX8W48axAZtUSwS1Nc1mb13+ijLiJwNxAgZreQtvJFFCv0FFYUvRIF8vBKBLhfwfE6d1pi5vjt7v0ohnQiALMtMrEoExKfrdLeXvWCjZU1bH6Kse5FJtWIOYvSkYByARQ48pAq9BaZkBGC8hfBaXyZJRZzKdkNHs4h3K5o0dERP77+SlAQ+GM4p1HFmb/fzGezCMk0xY4flaqkLHe74igTM/V6GVCj33UFV2zUcaUJplnHAsBsWfDC5+ngPlJMrHuCTXLHUWG9BpcQMOBN4ADXWCFoDfgNBh4GQ9UEOQ+591zm2nKbihXyJFm5KC5e+a6mhOrjB92Nhg4YBoA+z9ydNO+4YCjSFL2D1WOgLNSg4UeMYQOzMMquBX0uUG84kWtHIapMpqDFGGmAG2K358m5hAsBgVLWEkOrUN68iH3tukiYlrq2owhUprko0B4laFXt2v9QvSkK9oH5MfA37pP3ZmMHtHnQpfW/arAGUuJ6CszSlZJ4Noo3DSuQ/HqJfg88agOWAqlnZOEvjP1tAl4QcAezhzbQDUjkNbkxqmhel6bLgnPyih1xHzD7V89z5INJhShk1rQePdCoGbyIeyxMO4RIwPquodPlYFMbWDsDDA6hHrTeP9SkVFKnaA8BpwvgqBuVCY4rC2gUAzq8P/oTKdRXgv2UT+yGXTBjSjwYAFEyA9KAlBaK+O6pRcdcyxsjzEkS3frELP7N2AKhr8ZGMsUm3NCeCiBspMG4fkA4BwNRfyJbaevHwmL5DFA8ALZf/yJo5+cMq4uw4LgBIP5pSGj0RSBXANJiAVpnPht4vMEDOBI8I6QDyzRXcDRGJFG2XFBQ4fVcAuPVUSsUm+SNGqIgkomcXCM65WJJOR3xQNmTLMOgOAPCk8S0UHQie/3FrektiHEtSC8wGgDQSq6HzW9Gs/SDLSH972Mkt7C27+nRa4T1reeVNABeepSyId+sXfzE14TGtl81pCCBtk/WuHHLrvIfhdic6Yzq0zGR50ZmvyJcjyLId8QJo+TUcveOYL4cTby4fe2mqH7SeNd1354HDVc1NAKrJOQe3xQMQgwzD2aDQs9uTtHr0eDx28820/CBXhWE7s4xMgQSpTDQAA+TVss7+cPJF3OVcZjOTmcIt5heO/Cyx9Kpl5wyG5LaoGj8qye0y8PM091IYAuHWVYiHV30EIOcq5Zer2uLnzm/Xy99pR/hsRMivBRK/kqn3r83cJS1qaz8Pf/6hzdzn18ILEwSlyAM42F3kAUJ4jlJCWVJeXVoX0LjrPTM5eLgJojlJ24pzUYkEpK5VhpEOotUDOPA/cEmaxopPWV5QHN/13SZx+6gDBnL/OIvGgQ/Meevz6khvc0fmAODhMk7WWyNR9UKfjxd2wgA2SbOt91pX1WGZu/tdWJIXGr+Q0khJtN30Zu/VvP4eh59i59bhecJ2gRXlyTU1Wx7LhPRzL9pw/7xayd1Dtl/Ro1q4Xvh6nyj1qU54dku9BHAYm9hif4O68C4VzAy4GaHlr/cq+fPHNcUDYlu/VwO/ssERH/L0buGNorQp6jCZwOFwAReiwFc8cHK9R2ye+4xeSEBAHzJwVvUKRDq8ji4nvb3vTa8wy4XDImQcAW19/7tu970ca914glWP5xZ+dwXmy+IK0hDAXRkCf071n+/n8cffJtiZIo/6PqkNX3DMQF2voqC8z/G2FaHcsg4/zXsQ3/E2Y5m8W+IP5v9N2s/pZwBR30mH6mgBG+FiI08X8MTv0+A9xJosO83BLZWfstO984use9m25195zeLVb/+2TPXv17b+nX/n3/l3Vuc/HEpSE+zhftsAAAAASUVORK5CYII=",vertexShaderName:"normal_vertex",fragmentShaderName:"normal_fragment",blendSrc:"SrcAlpha",blendDst:"One"}}]},Gm={nodes:[{id:0,parentId:-1,name:"SmallFire",localPosition:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},{id:1,parentId:0,name:"SmallFire",localPosition:[0,0,0],rotation:[270,0,0],scale:[1,1,1],main:{duration:5,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:3,min:1,max:2},startSpeed:{mode:3,min:-1,max:1},startSize:{mode:3,min:0,max:15},startRotation:{mode:3,min:180,max:360},startColor:{m_mode:0,minColor:null,maxColor:{r:1,g:.847058833,b:.7294118,a:.360784322}},gravity:{mode:0,min:0,max:0}},emission:{rateOverTime:{mode:0,min:0,max:75}},shape:{shapeMode:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}},velocityLifeTime:{linearX:{mode:3,min:0,max:0},linearY:{mode:3,min:0,max:0},linearZ:{mode:3,min:15,max:10}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[.114702068,.264698267,1],colors:[{r:1,g:1,b:1,a:1},{r:.6,g:.549019635,b:.466666669,a:1},{r:.796078444,g:.305882365,b:0,a:1}],alphaLocation:[0,.294117659,.4205844,.7058824,.8441138,1],alphas:[1,.8862745,1,.9529412,.843137264,0]}}},sizeLifeTime:{separateAxes:!1,sizeX:{mode:1,min:0,max:0,maxCurve:{times:[0,.05,.1,.15,.2,.200551927,.250551939,.300551951,.342321426,.392321438,.44232145,.492321461,.5420238,.560089767,.6100898,.6600898,.7100898,.7600898,.8100898,.860089839,.9084245,.9584245,1],values:[0,.0652164742,.329441279,.595537543,.6663684,.665323436,.5503927,.425050557,.3403294,.27294594,.22446236,.183398828,.138578773,.034826193,.0321929157,.03092101,.0305348318,.0305587333,.0305170622,.0299341753,.0284090918,.0117929261,0]}}},rotationLifeTime:{rz:{mode:3,min:-180,max:180}},texSheetAnimation:{tileX:8,tileY:8,animationMode:0,rowMode:1,row:0,timeMode:0,frameOverTime:{mode:1,min:0,max:0,maxCurve:{times:[0,1],values:[0,1]}},startFrame:{mode:0,min:0,max:0},cycles:1},render:{renderMode:0,lengthScale:-.13,texName:"data:image/png;base64,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",matColor:{r:1,g:1,b:1,a:1},vertexShaderName:"normal_vertex",fragmentShaderName:"normal_legacy_fragment",blendSrc:"SrcAlpha",blendDst:"One"}},{id:11,parentId:1,name:"glow",localPosition:[0,0,0],rotation:[0,0,0],scale:[1,1,1],main:{duration:5,isLoop:!0,startDelay:{mode:0,min:0,max:0},startLifeTime:{mode:3,min:1,max:2},startSpeed:{mode:3,min:-1,max:1},startSize:{mode:3,min:10,max:30},startRotation:{mode:3,min:180,max:360},startColor:{m_mode:0,minColor:null,maxColor:{r:.06666667,g:.02745098,b:0,a:.192156866}},gravity:{mode:0,min:0,max:0}},emission:{rateOverTime:{mode:0,min:0,max:150}},shape:{shapeMode:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}},velocityLifeTime:{linearX:{mode:3,min:0,max:0},linearY:{mode:3,min:0,max:0},linearZ:{mode:3,min:15,max:10}},colorLifeTime:{color:{m_mode:1,minColor:null,maxColor:null,maxGradient:{colorLocation:[.114702068,.264698267,1],colors:[{r:1,g:1,b:1,a:1},{r:.368627459,g:.3372549,b:.286274523,a:1},{r:.368627459,g:.141176477,b:0,a:1}],alphaLocation:[0,.294117659,.4205844,.7058824,.8441138,1],alphas:[1,.8862745,1,.9529412,.843137264,0]}}},sizeLifeTime:{separateAxes:!1,sizeX:{mode:1,min:0,max:0,maxCurve:{times:[0,.05,.1,.15,.2,.200551927,.250551939,.300551951,.350551963,.400551975,.450552,.500552,.5371929,.560089767,.6100898,.6600898,.7100898,.7600898,.8100898,.860089839,.9084245,.9584245,1],values:[0,.0652164742,.329441279,.595537543,.6663684,.665323436,.572160959,.486265123,.4074504,.335531384,.270322651,.211638719,.172669679,.034826193,.0321929157,.03092101,.0305348318,.0305587333,.0305170622,.0299341753,.0284090918,.0117929261,0]}}},rotationLifeTime:{rz:{mode:3,min:-180,max:180}},render:{renderMode:0,lengthScale:-.13,texName:"data:image/png;base64,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",matColor:{r:1,g:1,b:1,a:1},vertexShaderName:"normal_vertex",fragmentShaderName:"normal_legacy_fragment",blendSrc:"SrcAlpha",blendDst:"One"}}]},Qm={RAIN:Symbol("rain"),FLAME:Symbol("fire_smoke"),SNOW:Symbol("snow"),WATER_SPRAY:Symbol("water_spray"),CANDLE:Symbol("candle")};Object.freeze(Qm);var Hm=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),(i=t.call(this)).rootNode=null,i.nodeArray=new Map,i.particleArray=[],i.camera=null,i.density=1,i.data=null,km.pushItem(d(i)),e)switch(e){case Qm.FLAME:i.onLoad(Dm);break;case Qm.CANDLE:i.onLoad(Gm);break;case Qm.RAIN:i.onLoad(Rm);break;case Qm.SNOW:i.onLoad(Om);break;case Qm.WATER_SPRAY:i.onLoad(Nm)}return i}return o(n,[{key:"load",value:function(e){this.loadbyUrl(e)}},{key:"loadbyUrl",value:function(e){var t=this;(new VA).load(e,(function(){t.onLoad(JSON.parse(t.data))}),null,null)}},{key:"onLoad",value:function(e){this.data=e,this.refreshLoad()}},{key:"refreshLoad",value:function(){if(null!=this.camera&&null!=this.data){for(var e=this.data,t=0;t<e.nodes.length;t++){var n=e.nodes[t],i=null;null==n.main?i=new Dt:((i=new Pm(n)).init(this.camera),this.particleArray.push(i)),this.nodeArray.set(n.id,i),0==t&&(this.rootNode=i,this.add(this.rootNode));var r=new vt;r.makeTranslation(n.localPosition[0],n.localPosition[1],n.localPosition[2]);var a=new vt;a.makeScale(n.scale[0],n.scale[1],n.scale[2]),r.multiply(a);var o=new vt;o.makeRotationFromEuler(new xt(Ke.degToRad(n.rotation[0]),Ke.degToRad(n.rotation[1]),Ke.degToRad(n.rotation[2]))),r.multiply(o),i.applyMatrix4(r),i.name=n.name,n.parentId>=0&&this.nodeArray.get(n.parentId).add(i)}this.data=null}}},{key:"setDensity",value:function(e){this.density=e;for(var t=0;t<this.particleArray.length;t++)this.particleArray[t].setDensity(e)}},{key:"onBeforeRender",value:function(e,t,n){this.camera=n,this.refreshLoad()}},{key:"destory",value:function(){km.removeItem(this),this.removeFromParent()}}]),n}(Dt),zm=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),(e=t.call(this)).options=i,e.isEffect=!0,e.init(),e}return o(n,[{key:"init",value:function(){}},{key:"update",value:function(){}}]),n}(Dt),Vm=function(e,t){xi.call(this,e);var n=this,i=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,r=void 0!==t.textureHeight?t.textureHeight:512,a=void 0!==t.clipBias?t.clipBias:0,o=void 0!==t.alpha?t.alpha:1,s=void 0!==t.time?t.time:0,A=void 0!==t.waterNormals?t.waterNormals:null,l=void 0!==t.sunDirection?t.sunDirection:new tt(.70707,.70707,0),c=new Sn(void 0!==t.sunColor?t.sunColor:16777215),h=new Sn(void 0!==t.waterColor?t.waterColor:8355711),u=void 0!==t.size?t.size:1,d=void 0!==t.eye?t.eye:new tt(0,0,0),f=void 0!==t.distortionScale?t.distortionScale:20,p=void 0!==t.side?t.side:0,m=void 0!==t.fog&&t.fog,g=new dn,v=new tt,y=new tt,w=new tt,x=new vt,b=new tt(0,0,-1),C=new At,M=new tt,B=new tt,I=new At,E=new vt,S=new Di,T=new lt(i,r,{minFilter:W,magFilter:W,format:ae,stencilBuffer:!1});Ke.isPowerOfTwo(i)&&Ke.isPowerOfTwo(r)||(T.texture.generateMipmaps=!1);var L={uniforms:Ui.merge([ji.fog,ji.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new vt},sunColor:{value:new Sn(8355711)},sunDirection:{value:new tt(.70707,.70707,0)},eye:{value:new tt},waterColor:{value:new Sn(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",Vi.fog_pars_vertex,Vi.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Vi.fog_vertex,Vi.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",Vi.common,Vi.packing,Vi.bsdfs,Vi.fog_pars_fragment,Vi.lights_pars_begin,Vi.shadowmap_pars_fragment,Vi.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",Vi.tonemapping_fragment,Vi.fog_fragment,"}"].join("\n")},F=new Pi({fragmentShader:L.fragmentShader,vertexShader:L.vertexShader,uniforms:Ui.clone(L.uniforms),transparent:!0,lights:!0,side:p,fog:m});F.uniforms.mirrorSampler.value=T.texture,F.uniforms.textureMatrix.value=E,F.uniforms.alpha.value=o,F.uniforms.time.value=s,F.uniforms.normalSampler.value=A,F.uniforms.sunColor.value=c,F.uniforms.waterColor.value=h,F.uniforms.size.value=u,F.uniforms.sunDirection.value=l,F.uniforms.distortionScale.value=f,F.uniforms.eye.value=d,n.material=F,n.onBeforeRender=function(e,t,i){y.setFromMatrixPosition(n.matrixWorld),w.setFromMatrixPosition(i.matrixWorld),x.extractRotation(n.matrixWorld),v.set(0,0,1),v.applyMatrix4(x),M.subVectors(y,w),M.reflect(v).negate(),M.add(y),x.extractRotation(i.matrixWorld),b.set(0,0,-1),b.applyMatrix4(x),b.add(w),B.subVectors(y,b),B.reflect(v).negate(),B.add(y),S.position.copy(M),S.up.set(0,1,0),S.up.applyMatrix4(x),S.up.reflect(v),S.lookAt(B),S.far=i.far,S.updateMatrixWorld(),S.projectionMatrix.copy(i.projectionMatrix),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(S.projectionMatrix),E.multiply(S.matrixWorldInverse),g.setFromNormalAndCoplanarPoint(v,y),g.applyMatrix4(S.matrixWorldInverse),C.set(g.normal.x,g.normal.y,g.normal.z,g.constant);var r=S.projectionMatrix;I.x=(Math.sign(C.x)+r.elements[8])/r.elements[0],I.y=(Math.sign(C.y)+r.elements[9])/r.elements[5],I.z=-1,I.w=(1+r.elements[10])/r.elements[14],C.multiplyScalar(2/C.dot(I)),r.elements[2]=C.x,r.elements[6]=C.y,r.elements[10]=C.z+1-a,r.elements[14]=C.w,d.setFromMatrixPosition(i.matrixWorld);var o=e.getRenderTarget(),s=e.vr.enabled,A=e.shadowMap.autoUpdate;n.visible=!1,e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(T),e.clear(),e.render(t,S),n.visible=!0,e.vr.enabled=s,e.shadowMap.autoUpdate=A,e.setRenderTarget(o)}};function jm(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}(Vm.prototype=Object.create(xi.prototype)).constructor=Vm,Object.assign(jm.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},cross:function(e){return void 0!==w?this.crossVectors(e,w):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}});var Wm="data:image/jpeg;base64,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A/gAAAAAAHAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAOEJJTQQAAAAAAAACAAA4QklNBAIAAAAAAAIAADhCSU0EMAAAAAAAAQEAOEJJTQQtAAAAAAAGAAEAAAANOEJJTQQIAAAAAAAQAAAAAQAAAkAAAAJAAAAAADhCSU0EHgAAAAAABAAAAAA4QklNBBoAAAAAA00AAAAGAAAAAAAAAAAAAAQAAAAEAAAAAAwAdwBhAHQAZQByAG4AbwByAG0AYQBsAHMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAAQAAAAAAFJnaHRsb25nAAAEAAAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAAAABUb3AgbG9uZwAAAAAAAAAATGVmdGxvbmcAAAAAAAAAAEJ0b21sb25nAAAEAAAAAABSZ2h0bG9uZwAABAAAAAADdXJsVEVYVAAAAAEAAAAAAABudWxsVEVYVAAAAAEAAAAAAABNc2dlVEVYVAAAAAEAAAAAAAZhbHRUYWdURVhUAAAAAQAAAAAADmNlbGxUZXh0SXNIVE1MYm9vbAEAAAAIY2VsbFRleHRURVhUAAAAAQAAAAAACWhvcnpBbGlnbmVudW0AAAAPRVNsaWNlSG9yekFsaWduAAAAB2RlZmF1bHQAAAAJ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bS45OTggMjAxMC8wMS8xNTowMjowMDowMCBjdXRvZmY7IG0gYnJhbmNoXSkgIFdpbmRvd3MiIHhtcDpDcmVhdGVEYXRlPSIyMDEzLTEyLTAzVDIwOjQyOjEzKzAxOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxMy0xMi0wNVQwMDo1NDowOSswMTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxMy0xMi0wNVQwMDo1NDowOSswMTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9qcGVnIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzYyMUNCMjQzQzVERTMxMUJDRjE5RDcwMEE5NDMwQUIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzUyMUNCMjQzQzVERTMxMUJDRjE5RDcwMEE5NDMwQUIiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpDNTIxQ0IyNDNDNURFMzExQkNGMTlENzAwQTk0MzBBQiI+DQoJCQk8eG1wTU06SGlzdG9yeT4NCgkJCQk8cmRmOlNlcT4NCgkJCQkJPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6QzUyMUNCMjQzQzVERTMxMUJDRjE5RDcwMEE5NDMwQUIiIHN0RXZ0OndoZW49IjIwMTMtMTItMDNUMjA6NDI6MTMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDUzUgKDEyLjB4MjAxMDAxMTUgWzIwMTAwMTE1Lm0uOTk4IDIwMTAvMDEvMTU6MDI6MDA6MDAgY3V0b2ZmOyBtIGJyYW5jaF0pICBXaW5kb3dzIi8+DQoJCQkJCTxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjb252ZXJ0ZWQiIHN0RXZ0OnBhcmFtZXRlcnM9ImZyb20gaW1hZ2UvcG5nIHRvIGltYWdlL2pwZWciLz4NCgkJCQkJPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOkM2MjFDQjI0M0M1REUzMTFCQ0YxOUQ3MDBBOTQzMEFCIiBzdEV2dDp3aGVuPSIyMDEzLTEyLTA1VDAwOjU0OjA5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ1M1ICgxMi4weDIwMTAwMTE1IFsyMDEwMDExNS5tLjk5OCAyMDEwLzAxLzE1OjAyOjAwOjAwIGN1dG9mZjsgbSBicmFuY2hdKSAgV2luZG93cyIgc3RFdnQ6Y2hhbmdlZD0iLyIvPg0KCQkJCTwvcmRmOlNlcT4NCgkJCTwveG1wTU06SGlzdG9yeT4NCgkJPC9yZGY6RGVzY3JpcHRpb24+DQoJPC9yZGY6UkRGPg0KPC94OnhtcG1ldGE+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0ndyc/Pv/iDFhJQ0NfUFJPRklMRQABAQAADEhMaW5vAhAAAG1udHJSR0IgWFlaIAfOAAIACQAGADEAAGFjc3BNU0ZUAAAAAElFQyBzUkdCAAAAAAAAAAAAAAABAAD21gABAAAAANMtSFAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEWNwcnQAAAFQAAAAM2Rlc2MAAAGEAAAAbHd0cHQAAAHwAAAAFGJrcHQAAAIEAAAAFHJYWVoAAAIYAAAAFGdYWVoAAAIsAAAAFGJYWVoAAAJAAAAAFGRtbmQAAAJUAAAAcGRtZGQAAALEAAAAiHZ1ZWQAAANMAAAAhnZpZXcAAAPUAAAAJGx1bWkAAAP4AAAAFG1lYXMAAAQMAAAAJHRlY2gAAAQwAAAADHJUUkMAAAQ8AAAIDGdUUkMAAAQ8AAAIDGJUUkMAAAQ8AAAIDHRleHQAAAAAQ29weXJpZ2h0IChj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",Xm=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),(i=t.call(this,a)).mesh=e,i.color=a.color||"#17b2ff",i.distortion=a.distortion||3.7,i.speed=a.speed||1,i.size=a.size||1,i.water=new Vm(i.mesh.geometry,{textureWidth:512,textureHeight:512,waterNormals:(new KA).load(Wm,(function(e){e.wrapS=e.wrapT=G})),alpha:1,sunDirection:new jm(0,1,0),sunColor:16777215,waterColor:i.color,distortionScale:i.distortion,size:i.size}),i.mesh.material0||(i.mesh.material0=i.mesh.material),i.material=i.mesh.material=i.water.material,i}return o(n,[{key:"setSpeed",value:function(e){this.speed=e,this.material.uniforms.baseSpeed.value=e}},{key:"setDistortion",value:function(e){this.distortion=e,this.material.uniforms.noiseScale.value=e}},{key:"setColor",value:function(e){this.material.uniforms.waterColor.value=new Sn(e)}},{key:"setSize",value:function(e){this.material.uniforms.size.value=e}},{key:"clear",value:function(){this.mesh.material=this.mesh.material0,this.paused=!0,AMRT.render()}},{key:"update",value:function(e){this.paused||(this.water.material.uniforms.time.value+=1/60*this.speed)}},{key:"onBeforeRender",value:function(e,t,n,i){this.water.material.uniforms.sunDirection.value=n.position.clone().normalize(),this.water.onBeforeRender(e,t,n)}},{key:"dispose",value:function(){this.material.dispose()}}]),n}(zm),Zm=function e(t,n){xi.call(this,t),this.type="Reflector";var i=this,r=void 0!==(n=n||{}).color?new Sn(n.color):new Sn(8355711),a=n.textureWidth||512,o=n.textureHeight||512,s=n.clipBias||0,A=n.shader||e.ReflectorShader,l=void 0!==n.recursion?n.recursion:0,c=new dn,h=new tt,u=new tt,d=new tt,f=new vt,p=new tt(0,0,-1),m=new At,g=new tt,v=new tt,y=new At,w=new vt,x=new Di,b=new lt(a,o,{minFilter:W,magFilter:W,format:ae,stencilBuffer:!1});Ke.isPowerOfTwo(a)&&Ke.isPowerOfTwo(o)||(b.texture.generateMipmaps=!1);var C=new Pi({uniforms:Ui.clone(A.uniforms),fragmentShader:A.fragmentShader,vertexShader:A.vertexShader});C.uniforms.tDiffuse.value=b.texture,C.uniforms.color.value=r,C.uniforms.textureMatrix.value=w,this.material=C,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(u.setFromMatrixPosition(i.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),f.extractRotation(i.matrixWorld),h.set(0,0,1),h.applyMatrix4(f),g.subVectors(u,d),!(g.dot(h)>0)){g.reflect(h).negate(),g.add(u),f.extractRotation(n.matrixWorld),p.set(0,0,-1),p.applyMatrix4(f),p.add(d),v.subVectors(u,p),v.reflect(h).negate(),v.add(u),x.position.copy(g),x.up.set(0,1,0),x.up.applyMatrix4(f),x.up.reflect(h),x.lookAt(v),x.far=n.far,x.updateMatrixWorld(),x.projectionMatrix.copy(n.projectionMatrix),x.userData.recursion=0,w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(x.projectionMatrix),w.multiply(x.matrixWorldInverse),w.multiply(i.matrixWorld),c.setFromNormalAndCoplanarPoint(h,u),c.applyMatrix4(x.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var r=x.projectionMatrix;y.x=(Math.sign(m.x)+r.elements[8])/r.elements[0],y.y=(Math.sign(m.y)+r.elements[9])/r.elements[5],y.z=-1,y.w=(1+r.elements[10])/r.elements[14],m.multiplyScalar(2/m.dot(y)),r.elements[2]=m.x,r.elements[6]=m.y,r.elements[10]=m.z+1-s,r.elements[14]=m.w,i.visible=!1;var a=e.getRenderTarget(),o=e.vr.enabled,A=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(b),e.clear(),e.render(t,x),e.vr.enabled=o,e.shadowMap.autoUpdate=A,e.setRenderTarget(a);var C=n.viewport;void 0!==C&&e.state.viewport(C),i.visible=!0}},this.getRenderTarget=function(){return b}};(Zm.prototype=Object.create(xi.prototype)).constructor=Zm,Zm.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Ym=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this,i)).mesh=e,a.mirror=new Zm(a.mesh.geometry,{clipBias:.003,textureWidth:1024*window.devicePixelRatio,textureHeight:1024*window.devicePixelRatio,color:"#777777",recursion:1}),a.mesh.material0||(a.mesh.material0=a.mesh.material),a.mirror.position.copy(e.position),a.mirror.rotation.copy(e.rotation),a.mirror.scale.copy(e.scale),a.mirror.updateMatrixWorld(!0),a.mesh.material=a.mirror.material,a}return o(n,[{key:"clear",value:function(){this.mesh.material=this.mesh.material0,this.paused=!0,AMRT.render()}},{key:"update",value:function(e){}},{key:"onBeforeRender",value:function(e,t,n,i){this.mirror.onBeforeRender(e,t,n)}},{key:"dispose",value:function(){this.material.dispose()}}]),n}(zm),Km=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,n),e=t.call(this);var a=i.size?i.size:5,o=i.color?i.color:"#00fa00",s=i.speed?i.speed:1;return e.map=(new KA).load("img/radar.png"),e.map.center.set(.5,.5),e.circle=new xi(new lA(a,64),new kn({color:o,map:e.map,transparent:!0})),e.circle.renderOrder=6e3,e.circle.rotation.x=-Math.PI/2,e.circle.onBeforeRender=function(){e.map.rotation-=Ke.degToRad(2*s)},e.add(e.circle),e}return n}(Dt),Jm=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,n),e=t.call(this);var a=i.startRadius?i.startRadius:2,o=i.endRadius?i.endRadius:8,s=i.color?i.color:"#ffab03",A=i.speed?i.speed:1,l=(new KA).load("img/tours.png"),c=new Ki(2*a,2*a),h=new kn({map:l,color:s,transparent:!0,side:2});e.tours=new xi(c,h);var u=o/a;return e.tours.renderOrder=1e3,e.tours.onAfterRender=function(){this.scale.x+=.01*A,this.scale.y=this.scale.x,this.scale.x>.4*u&&(this.material.opacity-=.005),this.scale.x>=u&&(this.scale.x=this.scale.y=1,this.material.opacity=1)},e.tours.rotation.x=-Math.PI/2,e.add(e.tours),e}return n}(Dt),qm=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this)).canvas=document.createElement("canvas"),i.canvas.width=e.width,i.canvas.height=e.height,i.context=i.canvas.getContext("2d"),i.radius=e.radius||10,i.context.fillStyle="#00ff00",i.context.fillRect(0,0,e.width,e.height),i.colorStops=e.colorStops||{0:"#2b9dfe",.2:"#42ff00",.4:"#f7ff15",.6:"#ffa509",1:"#f90035"},i.draw(e.data),i.material=new kn({transparent:!0,map:new Ko(i.canvas),side:2}),i.map=new xi(new Li(e.width,e.height),i.material),i.map.rotation.x=Math.PI/180*-90,i}return o(n,[{key:"setColorStops",value:function(e){this.colorStops=e}},{key:"setSource",value:function(e){this.draw(e),this.map.material.map.needsUpdate=!0}},{key:"draw",value:function(e){var t=this;this._convertPoints(e,this.radius),this.dataList=e,console.log(e);var n=this.context;n.clearRect(0,0,this.canvas.width,this.canvas.height);var i=this.dataList.reduce((function(e,t){return Math.max(e,t.value)}),0);this.dataList.forEach((function(e){t._drawRadiation(n,{x:e.x,y:e.y,radius:t.radius,weight:Math.max(Math.min((e.value-0)/(i-0),1),0),value:e.value})}));for(var r=this._createPalette(this.colorStops),a=this.canvas,o=a.width,s=a.height,A=n.getImageData(0,0,o,s),l=A.data,c=3;c<l.length;c+=4){var h=l[c],u=r.pickColor(h);l[c-3]=u[0],l[c-2]=u[1],l[c-1]=u[2]}n.putImageData(A,0,0)}},{key:"_getMinPoint",value:function(e,t){var n=e.reduce((function(e,t){return Math.max(e,t.value)}),0),i={x:0,y:0};e.forEach((function(r,a){var o=Math.max(Math.min((r.value-0)/(n-0),1),0),s=Math.round(t*o);r.x-s<i.x&&(i.x=r.x-s),r.z-s<i.y&&(i.y=r.z-s),e[a]={x:r.x,y:r.z,value:r.value}})),e.forEach((function(t,n){e[n].x-=i.x,e[n].y-=i.y}))}},{key:"_convertPoints",value:function(e){e.forEach((function(e){e.x=e.coord[0],e.y=e.coord[2]}));var t=this.canvas.width/2,n=this.canvas.height/2;e.forEach((function(i,r){i.x>0?i.x+=t:0==i.x?i.x=t:i.x<0&&(i.x=t+i.x),i.y>0?i.y+=n:0==i.y?i.y=n:i.y<0&&(i.y=n+i.y),e[r]=i}))}},{key:"_drawRadiation",value:function(e,t){var n=t.x,i=t.y,r=t.radius,a=t.weight;r=Math.round(r*a);var o=e.createRadialGradient(n,i,0,n,i,r);o.addColorStop(0,"rgba(0, 0, 0, 1)"),o.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=o,e.beginPath(),e.arc(n,i,r,0,2*Math.PI),e.closePath(),console.log(r),e.fill()}},{key:"_getColorByValue",value:function(e){return e>=0&&e<=5?["rgba("+this.colorStops[1]+",1)","rgba("+this.colorStops[0]+",0)"]:e>5&&e<=10?["rgba("+this.colorStops[2]+",1)","rgba("+this.colorStops[1]+",0)"]:e>10&&e<=20?["rgba("+this.colorStops[3]+",1)","rgba("+this.colorStops[2]+",0)"]:e>20?["rgba("+this.colorStops[4]+",1)","rgba("+this.colorStops[3]+",0)"]:void 0}},{key:"_getColorByValue2",value:function(e){return e>=0&&e<=5?["rgb("+this.colorStops[0]+")","rgba("+this.colorStops[1]+")"]:e>5&&e<=10?["rgb("+this.colorStops[1]+")","rgba("+this.colorStops[2]+")"]:e>10&&e<=20?["rgb("+this.colorStops[2]+")","rgba("+this.colorStops[3]+")"]:e>20?["rgb("+this.colorStops[3]+")","rgba("+this.colorStops[4]+")"]:void 0}},{key:"_createPalette",value:function(e){var t=256,n=document.createElement("canvas");n.width=t,n.height=20;var i=n.getContext("2d"),r=i.createLinearGradient(0,0,t,0);for(var a in e)r.addColorStop(a,e[a]);i.fillStyle=r,i.fillRect(0,0,t,20);var o=i.getImageData(0,0,t,1).data;return{canvas:n,pickColor:function(e){return o.slice(4*e,4*e+3)}}}}]),n}(Dt),$m=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,n),(e=t.call(this)).matColor=i.color,e.path=i.path,e.uvSpeed=.01,e.speed=i.speed,e.radius=i.radius,e.texture=i.texture||"img/streamer.png",e.tension=i.tension;var a=(new KA).load(e.texture);a.wrapS=a.wrapT=G,a.repeat.set(1,1),a.needsUpdate=!0;var o=new kn({map:a,side:1,transparent:!0});e.matColor&&(o.color=new Sn(e.matColor));var s=new al(e.path);null!=e.tension&&(s.curveType="catmullrom",s.tension=e.tension);var A=new hs(s,20*e.path.length,e.radius);e.lineMesh=new xi(A,o);var l=d(e);return e.lineMesh.onBeforeRender=function(){a&&(a.offset.x-=l.speed)},e.add(e.lineMesh),e}return o(n,[{key:"radius",get:function(){return this._radius},set:function(e){this._radius=e||.1}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e?e*this.uvSpeed:this.uvSpeed}},{key:"matColor",get:function(){return this._matColor},set:function(e){e&&(this._matColor=e,this.lineMesh&&(this.lineMesh.material.color=new Sn(this.matColor)))}},{key:"path",get:function(){return this._path},set:function(e){if(e){this._path=[];for(var t=0;t<e.length;t++)this._path.push((new tt).copy(e[t]))}else this._path=[new tt(-1,0,-2),new tt(-1,0,-.5),new tt(1,0,-.5),new tt(1,0,1)]}}]),n}(Dt),eg=function(){function e(t){var n=this;r(this,e),this.viewer=t,this.ParticleSystemManager=km,t.controls.addEventListener("change",(function(){n.rain&&n.rain.position.copy(n.viewer.camera.position),n.snow&&n.snow.position.copy(n.viewer.camera.position)}))}return o(e,[{key:"addRain",value:function(){this.rain?this.viewer.root.add(this.rain):(this.rain=new Hm(Qm.RAIN),this.viewer.root.add(this.rain),this.rain.translateY(100),this.rain.position.copy(this.viewer.camera.position))}},{key:"removeRain",value:function(){this.rain&&this.viewer.root.remove(this.rain)}},{key:"addSnow",value:function(){this.snow?this.viewer.root.add(this.snow):(this.snow=new Hm(Qm.SNOW),this.viewer.root.add(this.snow),this.snow.translateY(100),this.snow.position.copy(this.viewer.camera.position))}},{key:"removeSnow",value:function(){this.snow&&this.viewer.root.remove(this.snow)}},{key:"addFire",value:function(){var e=new Hm(Qm.CANDLE);return this.viewer.root.add(e),e}},{key:"removeFire",value:function(e){this.viewer.root.remove(e)}},{key:"addSmoke",value:function(){var e=new Hm(Qm.FLAME);return this.viewer.root.add(e),e}},{key:"removeSmoke",value:function(e){this.viewer.root.remove(e)}},{key:"addSprayWater",value:function(e,t){var n=new Hm(Qm.WATER_SPRAY);return n.rotateY(Ke.degToRad(t)),n.rotateZ(Ke.degToRad(e)),this.viewer.root.add(n),n}},{key:"removeSprayWater",value:function(e){this.viewer.root.remove(e)}},{key:"addWaterSurface",value:function(e,t){var n=new Xm(e,t);return this.viewer.add(n),n}},{key:"removeWaterSurface",value:function(e){e.mesh.material=e.mesh.material0,this.viewer.remove(e)}},{key:"addMirror",value:function(e){var t=new Ym(e);return this.viewer.add(t),t}},{key:"removeMirror",value:function(e){this.viewer.remove(e)}},{key:"addRadarScanning",value:function(e){var t=new Km(e);return this.viewer.root.add(t),t}},{key:"addToursScanning",value:function(e){var t=new Jm(e);return this.viewer.root.add(t),t}},{key:"addHeatMap",value:function(e){var t=new qm(e);return this.viewer.root.add(t.map),t}},{key:"addStreamerPath",value:function(e){var t=new $m(e);return this.viewer.root.add(t),t}}]),e}();function tg(e){QA.call(this,e),this.root=void 0}function ng(e){if(e.sc&&e.sc.length>0){void 0===e.cid&&(e.cid=[]);for(var t=0;t<e.sc.length;t++)e.sc[t].pid=e.id,e.cid.push(e.sc[t].id);for(var n=0;n<e.sc.length;n++)ng(e.sc[n])}}function ig(e,t){if(e.sc&&e.sc.length>0)for(var n=0;n<e.sc.length;n++)t(e.sc[n]),ig(e.sc[n],t)}tg.prototype=Object.assign(Object.create(QA.prototype),{constructor:tg,load:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=new VA(this.manager);a.setResponseType("json");var o=this;a.load(e,(function(e){o.data=e;var n=o.parse(r);t(n)}),n,i)},isInBox:function(e,t,n,i,r,a){return!(e<n||e>r||t<i||t>a)},parse:function(e){for(var t=[],n=this.data,i=0,r=0,a=0,o=0,s=0;s<n.length;s++)0===n[s].b&&n[s].d&&Array.isArray(n[s].d)&&(i+=n[s].d[0],r+=n[s].d[1],a+=n[s].d[2],o++);i/=o,r/=o,a/=o;for(var A=0;A<n.length;A++){var l=(new jm).fromArray(n[A].d);l.y-=r;var c=new Je(n[A].x,n[A].z),h=(new Je).setScalar(n[A].e);e||this.root.localToWorld(l);var u=new en(l,n[A].c);u.id=A,u.acfi=n[A].a,u.acfl=n[A].b,u.ec=c,u.e=(new Gc).setFromCenterAndSize(c,h),u.sc=[],void 0===t[u.acfl]&&(t[u.acfl]=[]),t[u.acfl].push(u)}for(var d=[],f=0,p=t[0].length;f<p;f++)d.push(t[0][f]);var m=d.length;if(t.length>1)for(var g=1;g<t.length;g++)for(var v=0,y=t[g].length;v<y;v++){for(var w=g-1,x=0,b=d;x<=w;){if(0==x){for(var C=0;C<m;C++)if(d[C].e.containsPoint(t[g][v].ec)){b=d[C];break}}else for(var M=0,B=b.sc.length;M<B;M++)if(b.sc[M].e.containsPoint(t[g][v].ec)){b=b.sc[M];break}x++}b.sc.push(t[g][v])}for(var I=0;I<m;I++)ng(d[I]);for(var E=[],S=0;S<m;S++)E[d[S].id]=d[S],ig(d[S],(function(e){E[e.id]=e}));for(var T=0,L=E.length;T<L;T++)delete E[T].sc,delete E[T].e,delete E[T].ec;return{levels:E,center:{x:i,y:r,z:a}}}});var rg={wheeltime:0,WHEELMAX:300,initLevelDetect:function(e,t){rg.detect=t,e.addEventListener("wheel",(function(e){e.preventDefault(),rg.wheeltime=Date.now(),setTimeout((function(){Date.now()-rg.wheeltime>=rg.WHEELMAX&&t()}),rg.WHEELMAX)}),!1),e.addEventListener("mouseup",(function(e){e.preventDefault(),rg.detect(),t()}),!1),e.addEventListener("touchend",(function(e){e.preventDefault(),t()}),!1)}},ag=function(e){this.camera=e,this.focusLevels=function(e){for(var t=0,n=0,i=0,r=0,a=0,o=0,s=0,A=0,l=1e-6,c=0;c<e.length;c++)l+=e[c].center.y,0===c?(t=e[c].center.x,n=e[c].center.x,i=e[c].center.z,r=e[c].center.z,a=e[c].radius,o=e[c].radius,s=e[c].radius,A=e[c].radius):(e[c].center.x<t?(t=e[c].center.x,a=e[c].radius):e[c].center.x>n&&(n=e[c].center.x,o=e[c].radius),e[c].center.z<r?(r=e[c].center.z,A=e[c].radius):e[c].center.z>i&&(i=e[c].center.z,s=e[c].radius));var h=new tt(t-a,l/=e.length,r-A),u=new tt(n+o,l,i+s),d=new tt((h.x+u.x)/2,l,(h.z+u.z)/2),f=Math.abs(h.x-u.x),p=Math.abs(h.z-u.z),m=Math.tan(Math.PI/180*.5*this.camera.fov),g=p/2/m,v=f/this.camera.aspect/2/m,y=(new tt).copy(d);return y.y+=g>v?g:v,this.camera.position.copy(y),this.camera.lookAt(d),this.camera.updateProjectionMatrix(),d},this.focusSimple=function(){return this.camera.position.copy(new tt(0,1e3,0)),this.camera.lookAt(new tt),this.camera.updateProjectionMatrix(),new tt}},og=ad("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCWZ1bmN0aW9uIFZlY3RvcjMoeCwgeSwgeikgewoJICB0aGlzLnggPSB4IHx8IDA7CgkgIHRoaXMueSA9IHkgfHwgMDsKCSAgdGhpcy56ID0geiB8fCAwOwoJfQoKCU9iamVjdC5hc3NpZ24oVmVjdG9yMy5wcm90b3R5cGUsIHsKCSAgaXNWZWN0b3IzOiB0cnVlLAoJICBzZXQ6IGZ1bmN0aW9uIHNldCh4LCB5LCB6KSB7CgkgICAgdGhpcy54ID0geDsKCSAgICB0aGlzLnkgPSB5OwoJICAgIHRoaXMueiA9IHo7CgkgICAgcmV0dXJuIHRoaXM7CgkgIH0sCgkgIGNvcHk6IGZ1bmN0aW9uIGNvcHkodikgewoJICAgIHRoaXMueCA9IHYueDsKCSAgICB0aGlzLnkgPSB2Lnk7CgkgICAgdGhpcy56ID0gdi56OwoJICAgIHJldHVybiB0aGlzOwoJICB9LAoJICBkb3Q6IGZ1bmN0aW9uIGRvdCh2KSB7CgkgICAgcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKCSAgfSwKCSAgbGVuZ3RoU3E6IGZ1bmN0aW9uIGxlbmd0aFNxKCkgewoJICAgIHJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLno7CgkgIH0sCgkgIGxlbmd0aDogZnVuY3Rpb24gbGVuZ3RoKCkgewoJICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56KTsKCSAgfSwKCSAgbWFuaGF0dGFuTGVuZ3RoOiBmdW5jdGlvbiBtYW5oYXR0YW5MZW5ndGgoKSB7CgkgICAgcmV0dXJuIE1hdGguYWJzKHRoaXMueCkgKyBNYXRoLmFicyh0aGlzLnkpICsgTWF0aC5hYnModGhpcy56KTsKCSAgfSwKCSAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUoKSB7CgkgICAgcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCkgfHwgMSk7CgkgIH0sCgkgIGNyb3NzOiBmdW5jdGlvbiBjcm9zcyh2KSB7CgkgICAgaWYgKHcgIT09IHVuZGVmaW5lZCkgewoJICAgICAgcmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKHYsIHcpOwoJICAgIH0KCgkgICAgcmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKHRoaXMsIHYpOwoJICB9LAoJICBjcm9zc1ZlY3RvcnM6IGZ1bmN0aW9uIGNyb3NzVmVjdG9ycyhhLCBiKSB7CgkgICAgdmFyIGF4ID0gYS54LAoJICAgICAgICBheSA9IGEueSwKCSAgICAgICAgYXogPSBhLno7CgkgICAgdmFyIGJ4ID0gYi54LAoJICAgICAgICBieSA9IGIueSwKCSAgICAgICAgYnogPSBiLno7CgkgICAgdGhpcy54ID0gYXkgKiBieiAtIGF6ICogYnk7CgkgICAgdGhpcy55ID0gYXogKiBieCAtIGF4ICogYno7CgkgICAgdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgkgICAgcmV0dXJuIHRoaXM7CgkgIH0sCgkgIGRpc3RhbmNlVG86IGZ1bmN0aW9uIGRpc3RhbmNlVG8odikgewoJICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy5kaXN0YW5jZVRvU3F1YXJlZCh2KSk7CgkgIH0sCgkgIGRpc3RhbmNlVG9TcXVhcmVkOiBmdW5jdGlvbiBkaXN0YW5jZVRvU3F1YXJlZCh2KSB7CgkgICAgdmFyIGR4ID0gdGhpcy54IC0gdi54LAoJICAgICAgICBkeSA9IHRoaXMueSAtIHYueSwKCSAgICAgICAgZHogPSB0aGlzLnogLSB2Lno7CgkgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5ICsgZHogKiBkejsKCSAgfSwKCSAgbWFuaGF0dGFuRGlzdGFuY2VUbzogZnVuY3Rpb24gbWFuaGF0dGFuRGlzdGFuY2VUbyh2KSB7CgkgICAgcmV0dXJuIE1hdGguYWJzKHRoaXMueCAtIHYueCkgKyBNYXRoLmFicyh0aGlzLnkgLSB2LnkpICsgTWF0aC5hYnModGhpcy56IC0gdi56KTsKCSAgfSwKCSAgZnJvbUFycmF5OiBmdW5jdGlvbiBmcm9tQXJyYXkoYXJyYXkpIHsKCSAgICB0aGlzLnggPSBhcnJheVswXTsKCSAgICB0aGlzLnkgPSBhcnJheVsxXTsKCSAgICB0aGlzLnogPSBhcnJheVsyXTsKCSAgICByZXR1cm4gdGhpczsKCSAgfSwKCSAgYXBwbHlNYXRyaXg0OiBmdW5jdGlvbiBhcHBseU1hdHJpeDQobSkgewoJICAgIHZhciB4ID0gdGhpcy54LAoJICAgICAgICB5ID0gdGhpcy55LAoJICAgICAgICB6ID0gdGhpcy56OwoJICAgIHZhciBlID0gbS5lbGVtZW50czsKCSAgICB2YXIgdyA9IDEgLyAoZVszXSAqIHggKyBlWzddICogeSArIGVbMTFdICogeiArIGVbMTVdKTsKCSAgICB0aGlzLnggPSAoZVswXSAqIHggKyBlWzRdICogeSArIGVbOF0gKiB6ICsgZVsxMl0pICogdzsKCSAgICB0aGlzLnkgPSAoZVsxXSAqIHggKyBlWzVdICogeSArIGVbOV0gKiB6ICsgZVsxM10pICogdzsKCSAgICB0aGlzLnogPSAoZVsyXSAqIHggKyBlWzZdICogeSArIGVbMTBdICogeiArIGVbMTRdKSAqIHc7CgkgICAgcmV0dXJuIHRoaXM7CgkgIH0KCX0pOwoKCWZ1bmN0aW9uIFBsYW5lKCkgewoJICB0aGlzLm5vcm1hbCA9IG5ldyBWZWN0b3IzKDEsIDAsIDApOwoJICB0aGlzLmNvbnN0YW50ID0gMDsKCX0KCglPYmplY3QuYXNzaWduKFBsYW5lLnByb3RvdHlwZSwgewoJICBzZXQ6IGZ1bmN0aW9uIHNldChub3JtYWwsIGNvbnN0YW50KSB7CgkgICAgdGhpcy5ub3JtYWwuZnJvbUFycmF5KG5vcm1hbCk7CgkgICAgdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoJICAgIHJldHVybiB0aGlzOwoJICB9LAoJICBkaXN0YW5jZVRvUG9pbnQ6IGZ1bmN0aW9uIGRpc3RhbmNlVG9Qb2ludChwb2ludCkgewoJICAgIHJldHVybiB0aGlzLm5vcm1hbC5kb3QocG9pbnQpICsgdGhpcy5jb25zdGFudDsKCSAgfSwKCSAgZGlzdGFuY2VUb1NwaGVyZTogZnVuY3Rpb24gZGlzdGFuY2VUb1NwaGVyZShzcGhlcmUpIHsKCSAgICByZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQoc3BoZXJlLmNlbnRlcikgLSBzcGhlcmUucmFkaXVzOwoJICB9LAoJICBpbnRlcnNlY3RzU3BoZXJlOiBmdW5jdGlvbiBpbnRlcnNlY3RzU3BoZXJlKHNwaGVyZSkgewoJICAgIHJldHVybiBzcGhlcmUuaW50ZXJzZWN0c1BsYW5lKHRoaXMpOwoJICB9Cgl9KTsKCglmdW5jdGlvbiBGcnVzdHVtKCkgewoJICB0aGlzLnBsYW5lcyA9IFtuZXcgUGxhbmUoKSwgbmV3IFBsYW5lKCksIG5ldyBQbGFuZSgpLCBuZXcgUGxhbmUoKSwgbmV3IFBsYW5lKCksIG5ldyBQbGFuZSgpXTsKCX0KCglPYmplY3QuYXNzaWduKEZydXN0dW0ucHJvdG90eXBlLCB7CgkgIGludGVyc2VjdHNTcGhlcmU6IGZ1bmN0aW9uIGludGVyc2VjdHNTcGhlcmUoc3BoZXJlKSB7CgkgICAgdmFyIHBsYW5lcyA9IHRoaXMucGxhbmVzOwoJICAgIHZhciBjZW50ZXIgPSBzcGhlcmUuY2VudGVyOwoJICAgIHZhciBuZWdSYWRpdXMgPSAtc3BoZXJlLnJhZGl1czsKCgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2OyBpKyspIHsKCSAgICAgIHZhciBkaXN0YW5jZSA9IHBsYW5lc1tpXS5kaXN0YW5jZVRvUG9pbnQoY2VudGVyKTsKCgkgICAgICBpZiAoZGlzdGFuY2UgPCBuZWdSYWRpdXMpIHsKCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIHRydWU7CgkgIH0KCX0pOwoKCWZ1bmN0aW9uIHNvcnRCeURpcyhhLCBiKSB7CgkgIHJldHVybiBiLmQgLSBhLmQ7Cgl9CgoJdmFyIHJycnIgPSBbXTsKCXZhciBsZXZlbHM7Cgl2YXIgRF9MRVZFTFMgPSBbNTAwLCAyMDAsIDEwMCwgLUluZmluaXR5XTsKCXZhciBVX0xFVkVMUyA9IFtJbmZpbml0eSwgNTAwLCAyMDAsIDEwMF07IC8v5paw5aKe77yI5pyA5aSn57qn5Yir5Yik5pat6Zeu6aKY77yJLS3lvIDlp4sKCgl2YXIgZF9sYXN0ID0gRF9MRVZFTFMubGVuZ3RoIC0gMTsKCXZhciBtYXhfbGV2ZWwgPSAwOyAvL+aWsOWinu+8iOacgOWkp+e6p+WIq+WIpOaWremXrumimO+8iS0t57uT5p2fCgoJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCglmdW5jdGlvbiBmaW5kU3ViQ2h1bmsoZiwgdCwgY3AsIGMpIHsKCSAgLy/kuI3lpITnkIbop4bph47lpJbnmoTlv6sKCSAgaWYgKGYuaW50ZXJzZWN0c1NwaGVyZSh0KSkgewoJICAgIHYxLmNvcHkodC5jZW50ZXIpOwoJICAgIHYxLnkgKz0gYy55OwoJICAgIHZhciBkaXMgPSBjcC5kaXN0YW5jZVRvKHYxKTsgLy/mlrDlop7vvIjmnIDlpKfnuqfliKvliKTmlq3pl67popjvvIktLeW8gOWniwoKCSAgICB2YXIgZF9sID0gdC5hY2ZsOwoJICAgIGlmIChkX2wgPT0gbWF4X2xldmVsKSBkX2wgPSBkX2xhc3Q7IC8v5paw5aKe77yI5pyA5aSn57qn5Yir5Yik5pat6Zeu6aKY77yJLS3nu5PmnZ8KCgkgICAgaWYgKGRpcyA+IFVfTEVWRUxTW3QuYWNmbF0pIHsKCSAgICAgIC8v5peg5pWI5Z2XCgkgICAgICBpZiAodC5hY2ZsID4gMCkgewoJICAgICAgICB2MS5jb3B5KGxldmVsc1t0LnBpZF0uY2VudGVyKTsKCSAgICAgICAgdjEueSArPSBjLnk7CgoJICAgICAgICBpZiAoY3AuZGlzdGFuY2VUbyh2MSkgPD0gRF9MRVZFTFNbdC5hY2ZsIC0gMV0pIHsKCSAgICAgICAgICB2YXIgcmUgPSB7fTsKCSAgICAgICAgICByZS5pID0gdC5hY2ZpOwoJICAgICAgICAgIHJlLmwgPSB0LmFjZmw7CgkgICAgICAgICAgcmUucCA9IHQucGlkOwoJICAgICAgICAgIHJlLmMgPSB0LmNpZDsKCSAgICAgICAgICByZS5kID0gZGlzOwoJICAgICAgICAgIHJlLnYgPSB0LmlkOwoJICAgICAgICAgIHJycnIucHVzaChyZSk7CgkgICAgICAgIH0KCSAgICAgIH0gLy/kv67mlLnvvIjmnIDlpKfnuqfliKvliKTmlq3pl67popjvvIktLeW8gOWniwoKCSAgICB9IGVsc2UgaWYgKGRpcyA8PSBEX0xFVkVMU1tkX2xdKSB7CgkgICAgICAvL+S/ruaUue+8iOacgOWkp+e6p+WIq+WIpOaWremXrumimO+8iS0t57uT5p2fCgkgICAgICAvL+afpeaJvuWtkOWdlwoJICAgICAgaWYgKHQuY2lkKSB7CgkgICAgICAgIGZvciAodmFyIHRpID0gMCwgdGMgPSB0LmNpZC5sZW5ndGg7IHRpIDwgdGM7IHRpKyspIHsKCSAgICAgICAgICBmaW5kU3ViQ2h1bmsoZiwgbGV2ZWxzW3QuY2lkW3RpXV0sIGNwLCBjKTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0gZWxzZSB7CgkgICAgICAvL+acieaViOWdlwoJICAgICAgdmFyIHJlID0ge307CgkgICAgICByZS5pID0gdC5hY2ZpOwoJICAgICAgcmUubCA9IHQuYWNmbDsKCSAgICAgIHJlLnAgPSB0LnBpZDsKCSAgICAgIHJlLmMgPSB0LmNpZDsKCSAgICAgIHJlLmQgPSBkaXM7CgkgICAgICByZS52ID0gdC5pZDsKCSAgICAgIHJycnIucHVzaChyZSk7CgkgICAgfQoJICB9Cgl9CgoJZnVuY3Rpb24gTENEZXRlY3QoKSB7CgkgIC8v57qn5Yir5Y+C5pWw77yM5a6e6ZmF6aG555uu5Lit5Y+v5Lul6Ieq55Sx6YWN572u77yM55uu5YmN5pSv5oyB5Yiw56ys5LiJ57qn5YirCgkgIHRoaXMuY3BvcyA9IG5ldyBWZWN0b3IzKCk7CgkgIHRoaXMuZnJ1c3R1bSA9IG5ldyBGcnVzdHVtKCk7CgkgIHRoaXMuY2VudGVyID0gbmV3IFZlY3RvcjMoKTsKCgkgIHRoaXMuc2V0TGV2ZWxzID0gZnVuY3Rpb24gKHRsZXZlbHMpIHsKCSAgICBsZXZlbHMgPSB0bGV2ZWxzOwoJICAgIHRoaXMuY291bnQgPSBsZXZlbHMubGVuZ3RoOwoJICAgIHRoaXMuYmFzZUxldmVscyA9IFtdOwoKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY291bnQ7IGkrKykgewoJICAgICAgaWYgKGxldmVsc1tpXS5hY2ZsID09IDApIHsKCSAgICAgICAgdGhpcy5iYXNlTGV2ZWxzLnB1c2goaSk7CgkgICAgICB9IC8v5paw5aKe77yI5pyA5aSn57qn5Yir5Yik5pat6Zeu6aKY77yJLS3lvIDlp4sKCgoJICAgICAgaWYgKGxldmVsc1tpXS5hY2ZsID4gbWF4X2xldmVsKSBtYXhfbGV2ZWwgPSBsZXZlbHNbaV0uYWNmbDsgLy/mlrDlop7vvIjmnIDlpKfnuqfliKvliKTmlq3pl67popjvvIktLee7k+adnwoJICAgIH0KCgkgICAgdGhpcy5iYXNlTGV2ZWxzQ291bnQgPSB0aGlzLmJhc2VMZXZlbHMubGVuZ3RoOwoJICB9OwoKCSAgdGhpcy5zZXRDYW1lcmFQb3MgPSBmdW5jdGlvbiAoY3BvcykgewoJICAgIHRoaXMuY3Bvcy5mcm9tQXJyYXkoY3Bvcyk7CgkgIH07CgoJICB0aGlzLnNldEZydXN0dW0gPSBmdW5jdGlvbiAoZnJ1c3R1bVN0YXRlKSB7CgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2OyBpKyspIHsKCSAgICAgIHZhciBiYXNlID0gaSAqIDQ7CgkgICAgICB0aGlzLmZydXN0dW0ucGxhbmVzW2ldLnNldChbZnJ1c3R1bVN0YXRlW2Jhc2VdLCBmcnVzdHVtU3RhdGVbYmFzZSArIDFdLCBmcnVzdHVtU3RhdGVbYmFzZSArIDJdXSwgZnJ1c3R1bVN0YXRlW2Jhc2UgKyAzXSk7CgkgICAgfQoJICB9OwoKCSAgdGhpcy5zZXRDb21wbGV0ZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewoJICAgIHRoaXMuY29tcGxldGUgPSBjYWxsYmFjazsKCSAgfTsKCgkgIHRoaXMuc2V0Q2VudGVyID0gZnVuY3Rpb24gKGNlbnRlcikgewoJICAgIHRoaXMuY2VudGVyLnNldChjZW50ZXIueCwgY2VudGVyLnksIGNlbnRlci56KTsKCSAgfTsKCgkgIHRoaXMuZGV0ZWN0ID0gZnVuY3Rpb24gKCkgewoJICAgIHJycnIgPSBbXTsKCgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJhc2VMZXZlbHNDb3VudDsgaSsrKSB7CgkgICAgICBmaW5kU3ViQ2h1bmsodGhpcy5mcnVzdHVtLCBsZXZlbHNbdGhpcy5iYXNlTGV2ZWxzW2ldXSwgdGhpcy5jcG9zLCB0aGlzLmNlbnRlcik7CgkgICAgfQoKCSAgICBycnJyLnNvcnQoc29ydEJ5RGlzKTsKCgkgICAgaWYgKHRoaXMuY29tcGxldGUpIHsKCSAgICAgIHRoaXMuY29tcGxldGUocnJycik7CgkgICAgfQoKCSAgICBycnJyID0gbnVsbDsKCSAgfTsKCX0KCgl2YXIgZGV0ZWN0ID0gbmV3IExDRGV0ZWN0KCk7CglkZXRlY3Quc2V0Q29tcGxldGUoZnVuY3Rpb24gKHIpIHsKCSAgc2VsZi5wb3N0TWVzc2FnZShyKTsKCX0pOwoKCXNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2dCkgewoJICBzd2l0Y2ggKGV2dC5kYXRhLnR5cGUpIHsKCSAgICBjYXNlICJpbml0IjoKCSAgICAgIGRldGVjdC5zZXRMZXZlbHMoZXZ0LmRhdGEuZGF0YSk7CgkgICAgICBkZXRlY3Quc2V0Q2VudGVyKGV2dC5kYXRhLmNlbnRlcik7CgkgICAgICBicmVhazsKCgkgICAgY2FzZSAiZGV0ZWN0IjoKCSAgICAgIGRldGVjdC5zZXRDYW1lcmFQb3MoZXZ0LmRhdGEucG9zKTsKCSAgICAgIGRldGVjdC5zZXRGcnVzdHVtKGV2dC5kYXRhLnN0YXRlKTsKCSAgICAgIGRldGVjdC5kZXRlY3QoKTsKCSAgICAgIGV2dC5kYXRhLnBvcyA9IG51bGw7CgkgICAgICBldnQuZGF0YS5zdGF0ZSA9IG51bGw7CgkgICAgICBicmVhazsKCSAgfQoKCSAgZGVsZXRlIGV2dC5kYXRhOwoJfTsKCn0oKSk7Cgo=",null,!1),sg=ad("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBsb2FkaW5nJDEgPSB7fTsKCglmdW5jdGlvbiBGaWxlTG9hZGVyKCkge30KCglGaWxlTG9hZGVyLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oRmlsZUxvYWRlci5wcm90b3R5cGUsIHsKCSAgY29uc3RydWN0b3I6IEZpbGVMb2FkZXIsCgkgIGxvYWQ6IGZ1bmN0aW9uIGxvYWQodXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHsKCSAgICBpZiAobG9hZGluZyQxW3VybF0gIT09IHVuZGVmaW5lZCkgewoJICAgICAgbG9hZGluZyQxW3VybF0ucHVzaCh7CgkgICAgICAgIG9uTG9hZDogb25Mb2FkLAoJICAgICAgICBvblByb2dyZXNzOiBvblByb2dyZXNzLAoJICAgICAgICBvbkVycm9yOiBvbkVycm9yCgkgICAgICB9KTsKCSAgICAgIHJldHVybjsKCSAgICB9CgoJICAgIGxvYWRpbmckMVt1cmxdID0gW107CgkgICAgbG9hZGluZyQxW3VybF0ucHVzaCh7CgkgICAgICBvbkxvYWQ6IG9uTG9hZCwKCSAgICAgIG9uUHJvZ3Jlc3M6IG9uUHJvZ3Jlc3MsCgkgICAgICBvbkVycm9yOiBvbkVycm9yCgkgICAgfSk7CgkgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCSAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CgkgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkgICAgICB2YXIgcmVzcG9uc2UgPSB0aGlzLnJlc3BvbnNlOwoJICAgICAgdmFyIGNhbGxiYWNrcyA9IGxvYWRpbmckMVt1cmxdOwoJICAgICAgZGVsZXRlIGxvYWRpbmckMVt1cmxdOwoKCSAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gMjAwIHx8IHRoaXMuc3RhdHVzID09PSAwKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CgkgICAgICAgICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwoJICAgICAgICAgIGlmIChjYWxsYmFjay5vbkxvYWQpIGNhbGxiYWNrLm9uTG9hZChyZXNwb25zZSk7CgkgICAgICAgIH0KCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CgkgICAgICAgICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwoJICAgICAgICAgIGlmIChjYWxsYmFjay5vbkVycm9yKSBjYWxsYmFjay5vbkVycm9yKGV2ZW50KTsKCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIHJlcXVlc3QuZW5kID0gdHJ1ZTsKCSAgICB9LCBmYWxzZSk7CgkgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGZ1bmN0aW9uIChldmVudCkgewoJICAgICAgdmFyIGNhbGxiYWNrcyA9IGxvYWRpbmckMVt1cmxdOwoKCSAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CgkgICAgICAgIHZhciBjYWxsYmFjayA9IGNhbGxiYWNrc1tpXTsKCSAgICAgICAgaWYgKGNhbGxiYWNrLm9uUHJvZ3Jlc3MpIGNhbGxiYWNrLm9uUHJvZ3Jlc3MoZXZlbnQpOwoJICAgICAgfQoJICAgIH0sIGZhbHNlKTsKCSAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkgICAgICB2YXIgY2FsbGJhY2tzID0gbG9hZGluZyQxW3VybF07CgkgICAgICBkZWxldGUgbG9hZGluZyQxW3VybF07CgoJICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKCSAgICAgICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwoJICAgICAgICBpZiAoY2FsbGJhY2sub25FcnJvcikgY2FsbGJhY2sub25FcnJvcihldmVudCk7CgkgICAgICB9CgoJICAgICAgcmVxdWVzdC5lbmQgPSB0cnVlOwoJICAgIH0sIGZhbHNlKTsKCSAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZnVuY3Rpb24gKGV2ZW50KSB7CgkgICAgICB2YXIgY2FsbGJhY2tzID0gbG9hZGluZyQxW3VybF07CgkgICAgICBkZWxldGUgbG9hZGluZyQxW3VybF07CgoJICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKCSAgICAgICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwoJICAgICAgICBpZiAoY2FsbGJhY2sub25FcnJvcikgY2FsbGJhY2sub25FcnJvcihldmVudCk7CgkgICAgICB9CgoJICAgICAgcmVxdWVzdC5lbmQgPSB0cnVlOwoJICAgIH0sIGZhbHNlKTsKCSAgICBpZiAodGhpcy5yZXNwb25zZVR5cGUgIT09IHVuZGVmaW5lZCkgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSB0aGlzLnJlc3BvbnNlVHlwZTsKCSAgICByZXF1ZXN0LnNlbmQobnVsbCk7CgkgICAgcmV0dXJuIHJlcXVlc3Q7CgkgIH0sCgkgIHNldFJlc3BvbnNlVHlwZTogZnVuY3Rpb24gc2V0UmVzcG9uc2VUeXBlKHZhbHVlKSB7CgkgICAgdGhpcy5yZXNwb25zZVR5cGUgPSB2YWx1ZTsKCSAgICByZXR1cm4gdGhpczsKCSAgfQoJfSk7CgoJZnVuY3Rpb24gTW9kZWxMb2FkZXIoKSB7fQoKCU1vZGVsTG9hZGVyLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oTW9kZWxMb2FkZXIucHJvdG90eXBlLCB7CgkgIGNvbnN0cnVjdG9yOiBNb2RlbExvYWRlciwKCSAgbG9hZDogZnVuY3Rpb24gbG9hZCh1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvcikgewoJICAgIHZhciBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlcigpOwoJICAgIGxvYWRlci5zZXRSZXNwb25zZVR5cGUoJ2pzb24nKTsKCSAgICB2YXIgc2NvcGUgPSB0aGlzOwoJICAgIHZhciByZXEgPSBsb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uIChqc29uKSB7CgkgICAgICByZXEuZW5kID0gdHJ1ZTsKCSAgICAgIHZhciBkYXRhID0gc2NvcGUucGFyc2UoanNvbik7CgkgICAgICBvbkxvYWQoZGF0YSk7CgkgICAgICBkYXRhLnAgPSBudWxsOyAvLyBkYXRhLm4gPSBudWxsOwoKCSAgICAgIGRhdGEudSA9IG51bGw7CgkgICAgICBkYXRhLmkgPSBudWxsOwoJICAgICAgZGF0YSA9IG51bGw7CgkgICAgICBqc29uID0gbnVsbDsKCSAgICB9LCBvblByb2dyZXNzLCBvbkVycm9yKTsKCSAgICByZXR1cm4gcmVxOwoJICB9LAoJICBwYXJzZTogZnVuY3Rpb24gcGFyc2UoanNvbikgewoJICAgIHZhciBnZW8gPSB0aGlzLnBhcnNlR2VvbWV0cnkoanNvbik7CgkgICAgZ2VvLmEgPSBqc29uLmE7CgkgICAgZ2VvLmIgPSBqc29uLmI7CgkgICAgZ2VvLmMgPSBqc29uLmM7CgkgICAgcmV0dXJuIGdlbzsKCSAgfSwKCSAgcGFyc2VHZW9tZXRyeTogZnVuY3Rpb24gcGFyc2VHZW9tZXRyeShnZW9EYXRhKSB7CgkgICAgdmFyIGdlbyA9IHt9OwoJICAgIGdlby5wID0gbmV3IEZsb2F0MzJBcnJheShnZW9EYXRhLmQpOyAvLyBnZW8ubiA9IG5ldyBGbG9hdDMyQXJyYXkoZ2VvRGF0YS5lKTsKCgkgICAgZ2VvLnUgPSBuZXcgRmxvYXQzMkFycmF5KGdlb0RhdGEuZik7CgoJICAgIGlmICh0aGlzLmFycmF5TWF4KGdlb0RhdGEuZykgPiA2NTUzNSkgewoJICAgICAgZ2VvLmkgPSBuZXcgVWludDMyQXJyYXkoZ2VvRGF0YS5nKTsKCSAgICB9IGVsc2UgewoJICAgICAgZ2VvLmkgPSBuZXcgVWludDE2QXJyYXkoZ2VvRGF0YS5nKTsKCSAgICB9CgoJICAgIHJldHVybiBnZW87CgkgIH0sCgkgIGFycmF5TWF4OiBmdW5jdGlvbiBhcnJheU1heChhcnJheSkgewoJICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHJldHVybiAtSW5maW5pdHk7CgkgICAgdmFyIG1heCA9IGFycmF5WzBdOwoKCSAgICBmb3IgKHZhciBpID0gMSwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7ICsraSkgewoJICAgICAgaWYgKGFycmF5W2ldID4gbWF4KSBtYXggPSBhcnJheVtpXTsKCSAgICB9CgoJICAgIHJldHVybiBtYXg7CgkgIH0KCX0pOwoKCXZhciBwcmVsb2FkaW5nID0gW107Cgl2YXIgbG9hZGluZyA9IFtdOwoKCXNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2dCkgewoJICBzd2l0Y2ggKGV2dC5kYXRhLnR5cGUpIHsKCSAgICBjYXNlICJsb2FkIjoKCSAgICAgIHZhciBjb3VudCA9IHByZWxvYWRpbmcubGVuZ3RoOwoKCSAgICAgIGlmIChjb3VudCA+IDApIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CgkgICAgICAgICAgdmFyIHIgPSBwcmVsb2FkaW5nLnBvcCgpOwoKCSAgICAgICAgICBpZiAoci5lbmQpIDsgZWxzZSB7CgkgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKCSAgICAgICAgICAgICAgYTogci5pbmRleAoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICByLmFib3J0KCk7CgkgICAgICAgICAgICByLmluZGV4ID0gbnVsbDsKCSAgICAgICAgICAgIHIgPSBudWxsOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIHZhciBsZXZlbCA9IGV2dC5kYXRhLmxldmVsOwoJICAgICAgdmFyIGluZGV4ID0gZXZ0LmRhdGEuaW5kZXg7CgkgICAgICB2YXIgbHIgPSBuZXcgTW9kZWxMb2FkZXIoKS5sb2FkKGV2dC5kYXRhLm11cmwsIGZ1bmN0aW9uIChnZW9EYXRhKSB7CgkgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewoJICAgICAgICAgIGE6IGdlb0RhdGEuYSwKCSAgICAgICAgICBiOiBsZXZlbCwKCSAgICAgICAgICBjOiBnZW9EYXRhLmMsCgkgICAgICAgICAgZDogaW5kZXgsCgkgICAgICAgICAgcDogZ2VvRGF0YS5wLAoKCSAgICAgICAgICAvKm46Z2VvRGF0YS5uLCovCgkgICAgICAgICAgdTogZ2VvRGF0YS51LAoJICAgICAgICAgIGk6IGdlb0RhdGEuaQoJICAgICAgICB9LCBbZ2VvRGF0YS5wLmJ1ZmZlciwKCSAgICAgICAgLypnZW9EYXRhLm4uYnVmZmVyLCovCgkgICAgICAgIGdlb0RhdGEudS5idWZmZXIsIGdlb0RhdGEuaS5idWZmZXJdKTsKCSAgICAgICAgbG9hZGluZ1tpbmRleF0gPSB1bmRlZmluZWQ7CgkgICAgICB9LCBmdW5jdGlvbiAobSkge30sIGZ1bmN0aW9uIChtKSB7CgkgICAgICAgIGxvYWRpbmdbaW5kZXhdID0gdW5kZWZpbmVkOwoJICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKCSAgICAgICAgICB4OiBpbmRleAoJICAgICAgICB9KTsKCSAgICAgIH0pOwoJICAgICAgbHIuZW5kID0gZmFsc2U7CgkgICAgICBsci5pbmRleCA9IGluZGV4OwoJICAgICAgbG9hZGluZ1tpbmRleF0gPSBscjsKCSAgICAgIGJyZWFrOwoKCSAgICBjYXNlICJjYW5jZWwiOgoJICAgICAgdmFyIGNpbmRleCA9IGV2dC5kYXRhLmRhdGE7CgoJICAgICAgZm9yICh2YXIgX2kgPSAwLCBjID0gY2luZGV4Lmxlbmd0aDsgX2kgPCBjOyBfaSsrKSB7CgkgICAgICAgIHZhciBzZCA9IGNpbmRleFtfaV07CgoJICAgICAgICBpZiAobG9hZGluZ1tzZF0gJiYgIWxvYWRpbmdbc2RdLmVuZCkgewoJICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewoJICAgICAgICAgICAgeDogbG9hZGluZ1tzZF0uaW5kZXgKCSAgICAgICAgICB9KTsKCSAgICAgICAgICBsb2FkaW5nW3NkXS5hYm9ydCgpOwoJICAgICAgICAgIGxvYWRpbmdbc2RdID0gdW5kZWZpbmVkOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgYnJlYWs7CgkgIH0KCX07Cgp9KCkpOwoK",null,!1),Ag="load",lg="init",cg="detect",hg="cancel";function ug(e){var t=this;this.scene=e,this.loadNum=3,this.loadMaxPT=2,this.currentNum=0,this.pLoadMaxPT=3,this.detectNum=1,this.loadWorkers=[],this.detectWorkers=[],this.todol=[],this.todod=[];for(var n=this,i=function(e){var i=new sg;i.isLoader=!0,i.num=0,i.onmessage=function(e){n.currentNum--,i.num--,n.loadEnd&&e.data&&(void 0!==e.data.d?n.loadEnd(e.data):void 0!==e.data.x&&(n.scene.loading[e.data.x]=void 0))},i.sendMessage=function(e){n.currentNum++,i.num++,i.postMessage(e)},t.loadWorkers.push(i)},r=0;r<this.loadNum;r++)i();for(var a=function(e){var i=new og;i.isDetect=!0,i.running=!1,i.onmessage=function(e){i.running=!1,n.detectEnd&&n.detectEnd(e.data)},i.sendMessage=function(e){e.type==cg&&(i.running=!0),i.postMessage(e)},t.detectWorkers.push(i)},o=0;o<this.detectNum;o++)a();this.setTask=function(e){switch(e.type){case lg:case cg:this.todod=[e];break;case Ag:this.todol=e.data;break;case hg:for(var t=0;t<this.loadNum;t++)this.loadWorkers[t].postMessage(e)}},this.setLoadEnd=function(e){this.loadEnd=e},this.setDetectEnd=function(e){this.detectEnd=e},this.update=function(){if(this.todol.length>0)for(var e=0;e<this.loadNum;e++)if(this.loadWorkers[e].num<this.loadMaxPT){var t=this.todol.pop();if(!t)break;this.scene.loading[t.index]={},this.loadWorkers[e].sendMessage(t),t.murl=null,t=null}if(this.todod.length>0)for(var n=0;n<this.detectNum;n++)if(!this.detectWorkers[n].running){var i=this.todod.pop();if(!i)break;this.detectWorkers[n].sendMessage(i),i.pos=null,i.state=null,i=null}}}var dg={};function fg(e){this.pathUtil=e}function pg(e,t,n,i){this.scene=e,this.manager=t,this.pathUtil=n,this.root=i}function mg(){this.GlobalParams={cbase:"http://172.16.10.37:8002/Data/ACFData/",tbase:"http://172.16.10.37:8002/Data/ACFData/",mbase:"http://172.16.10.37:8002/Data/ACFData/"}}dg.mflag=!1,dg.lflag=!1,dg.pflag=!1,dg.renderBefore=[],dg.renderAfter=[],dg.renderExtra=[],dg.renderBeforeCount=0,dg.renderAfterCount=0,dg.renderExtraCount=0,dg.resize=function(e){dg.renderer.domElement.getBoundingClientRect(),dg.lflag=!0},dg.init=function(e,t,n){dg.renderer=e,dg.scene=t,dg.camera=n,e.domElement.addEventListener("wheel",(function(e){e.preventDefault(),dg.lflag=!0}),!1),e.domElement.addEventListener("mousedown",(function(e){e.preventDefault(),dg.mflag=!0}),!1),e.domElement.addEventListener("touchstart",(function(e){e.preventDefault(),dg.mflag=!0}),!1),e.domElement.addEventListener("mouseup",(function(e){e.preventDefault(),dg.mflag=!1}),!1),e.domElement.addEventListener("touchend",(function(e){e.preventDefault(),dg.mflag=!1}),!1),window.addEventListener("resize",dg.resize,!1),dg.resize()},dg.addBefore=function(e){dg.renderBefore.push(e),dg.renderBeforeCount=dg.renderBefore.length},dg.addAfter=function(e){dg.renderAfter.push(e),dg.renderAfterCount=dg.renderAfter.length},dg.addExtra=function(e){dg.renderExtra.push(e),dg.renderExtraCount=dg.renderExtra.length},dg.render=function(){for(var e=0;e<dg.renderExtraCount;e++)dg.renderExtra[e]()},fg.prototype=Object.assign(fg.prototype,{constructor:fg,load:function(e){var t=this.parse(e);return(new KA).load(this.parseTextureUrl(e),(function(e){t&&t.material?(t.material.color.setRGB(1,1,1),t.material.map=e,t.material.transparent=!1,t.material.opacity=1,t.material.needsUpdate=!0,dg.lflag=!0):e&&(e.dispose(),e=null)})),t},parse:function(e){var t=this.parseGeometry(e),n=new kn;n.color.setHex(738436),n.transparent=!0,n.opacity=.2,n.side=2;var i=new xi(t,n);return i.mid=e.a,i.level=e.b,i.index=e.d,i.ticket=0,e.c.length>0&&i.applyMatrix4((new vt).fromArray(e.c)),i},parseTextureUrl:function(e){return this.pathUtil.generatePicturePath(e.b,e.a)},parseGeometry:function(e){var t=new ni;return t.name=e.a,t.setAttribute("position",new Wn(e.p,3)),t.setAttribute("uv",new Wn(e.u,2)),t.setIndex(new Wn(e.i,1)),t.clearGroups(),t.addGroup(0,e.i.length,0),t}}),pg.prototype=Object.assign(pg.prototype,{constructor:pg,load:function(e){for(var t=0;t<this.scene.loading.length;t++)this.scene.loading[t]&&(this.scene.loading[t].keep=!1);for(var n=0;n<this.scene.loaded.length;n++)this.scene.loaded[n]&&(this.scene.loaded[n].keep=!1);for(var i=0,r=e.length;i<r;i++)this.scene.loaded[e[i].v]?this.scene.loaded[e[i].v].keep=!0:this.scene.loading[e[i].v]?this.scene.loading[e[i].v].keep=!0:e[i].load=!0;var a={};a.type=hg,a.data=[];for(var o=0;o<this.scene.loading.length;o++)this.scene.loading[o]&&(this.scene.loading[o].keep||a.data.push(o));a.data.length>0&&this.manager.setTask(a);var s={};s.type=Ag,s.data=[];var A=this.pathUtil;this.scene.toload=[];for(var l=0;l<e.length;l++)if(e[l].load){var c={};c.type=Ag,c.level=e[l].l,c.index=e[l].v,c.murl=A.generateModelPath(c.level,e[l].i),s.data.push(c),this.scene.toload[e[l].v]=1}this.manager.setTask(s);for(var h=0;h<this.scene.loaded.length;h++)if(this.scene.loaded[h]&&!this.scene.loaded[h].keep){for(var u=!1,d=this.scene.levels[h];d.pid;){if(this.scene.toload[d.pid]){u=!0;break}d=this.scene.levels[d.pid]}if(u)continue;if((d=this.scene.levels[h]).cid){for(var f=[],p=0;p<d.cid.length;p++)f.push(d.cid[p]);for(;f.length>0;){for(var m=[],g=0,v=f.length;g<v;g++){if(this.scene.toload[f[g]]){u=!0;break}if(this.scene.levels[f[g]].cid)for(var y=0,w=this.scene.levels[f[g]].cid.length;y<w;y++)m.push(this.scene.levels[f[g]].cid[y])}if(u){m=[],f=[];break}f=[];for(var x=0,b=m.length;x<b;x++)f.push(m[x])}}u||(this.root.remove(this.scene.loaded[h]),this.scene.loaded[h].material.map&&(this.scene.loaded[h].material.map.dispose(),this.scene.loaded[h].material.map=null),this.scene.loaded[h].material.dispose(),this.scene.loaded[h].geometry.dispose(),this.scene.loaded[h].geometry.attributes.position.array=null,this.scene.loaded[h].geometry.attributes.uv.array=null,this.scene.loaded[h].geometry.index.array=null,this.scene.loaded[h].geometry=null,this.scene.loaded[h].material=null,this.scene.loaded[h]=void 0)}}}),mg.prototype={config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isLocal=t,(e.mb||e.cb||e.tb)&&(e.mb?this.GlobalParams.mbase=e.mb:e.cb?this.GlobalParams.mbase=e.cb:e.tb&&(this.GlobalParams.mbase=e.tb),e.cb?this.GlobalParams.cbase=e.cb:e.mb?this.GlobalParams.cbase=e.mb:e.tb&&(this.GlobalParams.cbase=e.tb),e.tb?this.GlobalParams.tbase=e.tb:e.mb?this.GlobalParams.tbase=e.mb:e.cb&&(this.GlobalParams.tbase=e.cb)),this},generateModelPath:function(e,t){return this.GlobalParams.mbase+e+"/"+t+(this.isLocal?".json":".json.gz")},generatePicturePath:function(e,t){return this.GlobalParams.tbase+e+"/maps/"+t+".jpg"},generateConfigPath:function(e){return this.GlobalParams.cbase+e}},new Pc;var gg=new vt,vg=new zi,yg=function(){function e(t){r(this,e),this.baseUrl=t}return o(e,[{key:"init",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.viewer=e,this.scene=e.scene,this.camera=e.camera,this.renderer=e.renderer,this.sceneGroup=n.root,this.render=e.render,this.initCamera=n.initCamera,this.center={x:0,y:0,z:0},this.pathUtil=(new mg).config(this.baseUrl,n.isLocal||!1),this.sources={loaded:[],loading:[],nlp:[],levels:[]},this.currCount=0,this.currLoaded=0;var i=new ug(this.sources);this.workerManager=i,n&&(dg.pflag=void 0!==n.preloading&&n.preloading,i.loadNum=void 0!==n.concurrency?n.concurrency:i.loadNum,i.loadMaxPT=void 0!==n.capacity?n.capacity:i.loadMaxPT),i.setLoadEnd((function(e){if(t.currLoaded++,t.currLoaded>=t.currCount&&t.loadEnd&&t.loadEnd(),t.initLoad&&(t.initLoad(),t.initLoad=null),t.sources.loaded[e.d]);else{var n=new fg(t.pathUtil).load(e),i=t.sources,r=t.center.y;n.position.y=-r,n.keep=!0,t.sceneGroup.add(n),i.loading[n.index]=void 0,i.loaded[n.index]=n;for(var a=!1,o=i.levels[n.index];o.pid;){if(i.loaded[o.pid]&&!i.loaded[o.pid].keep){for(var s=[],A=0;A<i.levels[o.pid].cid.length;A++)i.levels[o.pid].cid[A]!=n.index&&s.push(i.levels[o.pid].cid[A]);for(;s.length>0;){for(var l=[],c=0,h=s.length;c<h;c++){if(!i.loaded[s[c]]&&i.toload[s[c]]){a=!0;break}if(i.levels[s[c]].cid)for(var u=0,d=i.levels[s[c]].cid.length;u<d;u++)i.levels[s[c]].cid[u]!=n.index&&(l.push(i.levels[s[c]].cid[u]),void 0===i.levels[s[c]].cid[u]&&(console.log(i.levels[s[c]]),console.log(u,c,s[c])))}if(a){l=[],s=[];break}s=[];for(var f=0,p=l.length;f<p;f++)s.push(l[f])}a||(t.sceneGroup.remove(i.loaded[o.pid]),i.loaded[o.pid].material.map&&(i.loaded[o.pid].material.map.dispose(),i.loaded[o.pid].material.map=null),i.loaded[o.pid].material.dispose(),i.loaded[o.pid].geometry.dispose(),i.loaded[o.pid].geometry.attributes.position.array=null,i.loaded[o.pid].geometry.attributes.uv.array=null,i.loaded[o.pid].geometry.index.array=null,i.loaded[o.pid].geometry=null,i.loaded[o.pid].material=null,i.loaded[o.pid]=void 0)}o=i.levels[o.pid]}if((o=i.levels[n.index]).cid){for(var m=[],g=0;g<o.cid.length;g++)m.push(o.cid[g]);for(;m.length>0;){for(var v=[],y=0,w=m.length;y<w;y++)if(i.loaded[m[y]]&&!i.loaded[m[y]].keep)t.sceneGroup.remove(i.loaded[m[y]]),i.loaded[m[y]].material.map&&(i.loaded[m[y]].material.map.dispose(),i.loaded[m[y]].material.map=null),i.loaded[m[y]].material.dispose(),i.loaded[m[y]].geometry.dispose(),i.loaded[m[y]].geometry.attributes.position.array=null,i.loaded[m[y]].geometry.attributes.uv.array=null,i.loaded[m[y]].geometry.index.array=null,i.loaded[m[y]].geometry=null,i.loaded[m[y]].material=null,i.loaded[m[y]]=void 0;else if(i.levels[m[y]].cid)for(var x=0,b=i.levels[m[y]].cid.length;x<b;x++)v.push(i.levels[m[y]].cid[x]);m=[];for(var C=0,M=v.length;C<M;C++)m.push(v[C])}}}})),i.setDetectEnd((function(e){t.currLoaded=0,t.currCount=e.length,new pg(t.sources,i,t.pathUtil,t.sceneGroup).load(e)})),dg.init(this.renderer,this.scene,this.camera),dg.addExtra((function(){t.workerManager.update()})),dg.pflag&&dg.addExtra((function(){i.preloading=!dg.mflag&&!dg.lflag&&0==i.currentNum}))}},{key:"load",value:function(e,t){var n=this;this.initLoad=t,this.levelLoader=new tg,this.levelLoader.root=this.sceneGroup,this.levelLoader.load(this.pathUtil.generateConfigPath(e),(function(e){var t=e.levels,i=e.center;n.center=i,n.sources.levels=t,n.sources.center={x:0,y:0,z:0};var r={};if(r.type=lg,r.data=n.sources.levels,r.center=n.sources.center,n.workerManager.setTask(r),!n.viewer.isGISViewer){var a=new ag(n.camera).focusLevels(n.sources.levels);n.initCamera&&(n.viewer.controls.target.copy(a),n.viewer.controls.update(),n.viewer.camera.position.x=a.x,n.viewer.camera.position.z=a.z)}dg.lflag=!0,dg.render(!1),n.viewer.render(),rg.initLevelDetect(n.viewer.map?n.viewer.map.canvas:n.renderer.domElement,(function(){n.detect()})),n.workerManager.update(),n.viewer.controls.update(),setTimeout((function(){n.detect()}),100)}))}},{key:"updateLevels",value:function(){var e=this.levelLoader.parse().levels,t=this.sceneGroup.getWorldScale().x;e.map((function(e){e.radius=e.radius*t})),this.sources.levels=e;var n={};n.type=lg,n.data=this.sources.levels,n.center=this.sources.center,this.workerManager.setTask(n)}},{key:"detect",value:function(){var e={};e.type=cg,e.pos=this.camera.position.toArray(),gg.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),e.state=vg.setFromMatrix(gg).toArray(),this.workerManager.setTask(e)}},{key:"renderBefore",value:function(){for(var e=0;e<dg.renderBeforeCount;e++)dg.renderBefore[e]()}},{key:"renderAfter",value:function(){for(var e=0;e<dg.renderAfterCount;e++)dg.renderAfter[e]();dg.lflag&&(dg.lflag=!1);for(var t=0;t<dg.renderExtraCount;t++)dg.renderExtra[t]()}}]),e}(),wg=function(){function e(t){r(this,e),void 0===t&&console.error("viewer"),this.viewer=t,this.initialize()}return o(e,[{key:"initialize",value:function(){var e=this;this.largeSceneGroup=this.viewer.modelGroup,this.loaders=[],this.viewer.addEventListener("update",(function(){e.loaders.map((function(e){e&&e.renderBefore()})),e.loaders.map((function(e){e&&e.renderAfter()}))}))}},{key:"load",value:function(e,t,n){var i=new Dt;i.path=e,i.isLargeScene=!0,void 0===this.viewer.isMapViewer&&this.largeSceneGroup.add(i),e=e.endsWith("/")?e:e+"/";var r=new yg({cb:e});return r.init(this.viewer,{initCamera:!0,root:i,isLocal:n}),this.loaders.push(r),i.loader=r,r.load(n?"level.json":"level.json.gz",(function(){t&&t(i)})),i}}]),e}(),xg=function(){function e(t,n){r(this,e),this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===n||n}return o(e,[{key:"getOffset",value:function(){return this.offset}},{key:"setOffset",value:function(e){this.offset=e}},{key:"size",value:function(){return this.dv.buffer.byteLength}},{key:"skip",value:function(e){this.offset+=e}},{key:"getBoolean",value:function(){return 1==(1&this.getUint8())}},{key:"getBooleanArray",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t}},{key:"getUint8",value:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}},{key:"getUint8Array",value:function(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.getUint8();return t}},{key:"getInt16",value:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}},{key:"getUint16",value:function(e){if(null!=e)return this.dv.getUint16(e,this.littleEndian);var t=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}},{key:"getUint16Array",value:function(e){for(var t=new Uint16Array(e),n=0;n<e;n++)t[n]=this.getUint16();return t}},{key:"getInt32",value:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt32Array",value:function(e){for(var t=new Int32Array(e),n=0;n<e;n++)t[n]=this.getInt32();return t}},{key:"getUint32",value:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getUint32Array",value:function(e){for(var t=new Uint32Array(e),n=0;n<e;n++)t[n]=this.getUint32();return t}},{key:"getMatrix4",value:function(){for(var e=new Matrix4,t=0;t<16;t++)e.elements[t]=this.getFloat32();return e}},{key:"getVector3",value:function(){for(var e=new tt,t=0;t<3;t++)e.setComponent(t,this.getFloat32());return e}},{key:"getArray3",value:function(){for(var e=[],t=0;t<3;t++)e.push(this.getFloat32());return e}},{key:"getVector2",value:function(){for(var e=new Je,t=0;t<2;t++)e.setComponent(t,this.getFloat32());return e}},{key:"getArray2",value:function(){for(var e=[],t=0;t<2;t++)e.push(this.getFloat32());return e}},{key:"getInt64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}},{key:"getInt64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t}},{key:"getUint64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}},{key:"getFloat32",value:function(e){if(null!=e)return this.dv.getFloat32(e,this.littleEndian);var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}},{key:"getFloat32Array",value:function(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=this.getFloat32();return t}},{key:"getFloat64",value:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}},{key:"getFloat64Array",value:function(e){for(var t=new Float64Array(e),n=0;n<e;n++)t[n]=this.getFloat64();return t}},{key:"getArrayBuffer",value:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}},{key:"getString",value:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),LoaderUtils.decodeText(new Uint8Array(t))}}]),e}(),bg=ad("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgfQoKICB2YXIgbG9hZGluZyQxID0ge307CgogIGZ1bmN0aW9uIEZpbGVMb2FkZXIoKSB7fQoKICBGaWxlTG9hZGVyLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oRmlsZUxvYWRlci5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiBGaWxlTG9hZGVyLAogICAgbG9hZDogZnVuY3Rpb24gbG9hZCh1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvcikgewogICAgICBpZiAobG9hZGluZyQxW3VybF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGxvYWRpbmckMVt1cmxdLnB1c2goewogICAgICAgICAgb25Mb2FkOiBvbkxvYWQsCiAgICAgICAgICBvblByb2dyZXNzOiBvblByb2dyZXNzLAogICAgICAgICAgb25FcnJvcjogb25FcnJvcgogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgbG9hZGluZyQxW3VybF0gPSBbXTsKICAgICAgbG9hZGluZyQxW3VybF0ucHVzaCh7CiAgICAgICAgb25Mb2FkOiBvbkxvYWQsCiAgICAgICAgb25Qcm9ncmVzczogb25Qcm9ncmVzcywKICAgICAgICBvbkVycm9yOiBvbkVycm9yCiAgICAgIH0pOwogICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyAvL2NvbnNvbGUubG9nKHVybCk7CgogICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciByZXNwb25zZSA9IHRoaXMucmVzcG9uc2U7CiAgICAgICAgdmFyIGNhbGxiYWNrcyA9IGxvYWRpbmckMVt1cmxdOwogICAgICAgIGRlbGV0ZSBsb2FkaW5nJDFbdXJsXTsKCiAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSAyMDAgfHwgdGhpcy5zdGF0dXMgPT09IDApIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGNhbGxiYWNrc1tpXTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLm9uTG9hZCkgY2FsbGJhY2sub25Mb2FkKHJlc3BvbnNlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwogICAgICAgICAgICBpZiAoY2FsbGJhY2sub25FcnJvcikgY2FsbGJhY2sub25FcnJvcihldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXF1ZXN0LmVuZCA9IHRydWU7CiAgICAgIH0sIGZhbHNlKTsKICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciBjYWxsYmFja3MgPSBsb2FkaW5nJDFbdXJsXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgIHZhciBjYWxsYmFjayA9IGNhbGxiYWNrc1tpXTsKICAgICAgICAgIGlmIChjYWxsYmFjay5vblByb2dyZXNzKSBjYWxsYmFjay5vblByb2dyZXNzKGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0sIGZhbHNlKTsKICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciBjYWxsYmFja3MgPSBsb2FkaW5nJDFbdXJsXTsKICAgICAgICBkZWxldGUgbG9hZGluZyQxW3VybF07CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBjYWxsYmFja3NbaV07CiAgICAgICAgICBpZiAoY2FsbGJhY2sub25FcnJvcikgY2FsbGJhY2sub25FcnJvcihldmVudCk7CiAgICAgICAgfQoKICAgICAgICByZXF1ZXN0LmVuZCA9IHRydWU7CiAgICAgIH0sIGZhbHNlKTsKICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciBjYWxsYmFja3MgPSBsb2FkaW5nJDFbdXJsXTsKICAgICAgICBkZWxldGUgbG9hZGluZyQxW3VybF07CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBjYWxsYmFja3NbaV07CiAgICAgICAgICBpZiAoY2FsbGJhY2sub25FcnJvcikgY2FsbGJhY2sub25FcnJvcihldmVudCk7CiAgICAgICAgfQoKICAgICAgICByZXF1ZXN0LmVuZCA9IHRydWU7CiAgICAgIH0sIGZhbHNlKTsKICAgICAgaWYgKHRoaXMucmVzcG9uc2VUeXBlICE9PSB1bmRlZmluZWQpIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gdGhpcy5yZXNwb25zZVR5cGU7CiAgICAgIHJlcXVlc3Quc2VuZChudWxsKTsKICAgICAgcmV0dXJuIHJlcXVlc3Q7CiAgICB9LAogICAgc2V0UmVzcG9uc2VUeXBlOiBmdW5jdGlvbiBzZXRSZXNwb25zZVR5cGUodmFsdWUpIHsKICAgICAgdGhpcy5yZXNwb25zZVR5cGUgPSB2YWx1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSk7CgogIHZhciBNcmJzTG9hZGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIE1yYnNMb2FkZXIoKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNcmJzTG9hZGVyKTsKCiAgICAgIHRoaXMuTUVTSF9GTEFHX0lTX0hBVkVfVEVYVFVSRSA9IDEgPDwgMDsgLy8g5piv5ZCm5pyJ6LS05Zu+CgogICAgICB0aGlzLk1FU0hfRkxBR19URVhUVVJFX1NBVkVfQVNfRklMRSA9IDEgPDwgMTsgLy8g6LS05Zu+5piv5ZCm5L+d5a2Y5Li65paH5Lu2CgogICAgICB0aGlzLk1FU0hfRkxBR19JU19DT01QT1NFID0gMSA8PCAyOyAvLyDmmK/lkKblvIDlkK/mlbDmja7ljovnvKkKCiAgICAgIHRoaXMuTUVTSF9GTEFHX0lTX09QRUNJVFkgPSAxIDw8IDM7IC8vIOaYr+WQpuaciemAj+aYjui0tOWbvgogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhNcmJzTG9hZGVyLCBbewogICAgICBrZXk6ICJsb2FkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWQodXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIHBhdGggPSBzZWxmLnBhdGggPT09ICcnID8gTG9hZGVyVXRpbHMuZXh0cmFjdFVybEJhc2UodXJsKSA6IHNlbGYucGF0aDsKICAgICAgICB2YXIgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIodGhpcy5tYW5hZ2VyKTsgLy9sb2FkZXIuc2V0UGF0aCggc2VsZi5wYXRoICk7CgogICAgICAgIGxvYWRlci5zZXRSZXNwb25zZVR5cGUoJ2FycmF5YnVmZmVyJyk7CiAgICAgICAgdmFyIHJlcSA9IGxvYWRlci5sb2FkKHVybCwgZnVuY3Rpb24gKGJ1ZmZlcikgewogICAgICAgICAgLy9pZih1cmwuaW5kZXhPZignMV84XzE0MS5tcmJzJykgIT09IC0xKQogICAgICAgICAgLy8gICAgZGVidWdnZXIKICAgICAgICAgIHJlcS5lbmQgPSB0cnVlOwogICAgICAgICAgdmFyIGRhdGE7IC8vb25Mb2FkKCBzZWxmLnBhcnNlKCBidWZmZXIsIHBhdGggKSApOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmRlY29kZU1yYnNGaWxlKGJ1ZmZlciwgcGF0aCwgb25Mb2FkKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImRlY29kZU1yYnNGaWxlIGZhaWxlZCEhISBGaWxlOiAiICsgdXJsKTsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB9CgogICAgICAgICAgb25Mb2FkKGRhdGEpOwogICAgICAgIH0sIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpOwogICAgICAgIHJldHVybiByZXE7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZGVjb2RlTXJic0ZpbGUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGVjb2RlTXJic0ZpbGUoYnVmZmVyLCBwYXRoKSB7CiAgICAgICAgdmFyIHJldERhdGEgPSB7fTsKCiAgICAgICAgaWYgKHRoaXMuaXNNcmJzRm9ybWF0QmluYXJ5KGJ1ZmZlcikpIHsKICAgICAgICAgIHZhciBzdGF0aXN0aWNhbGREYXRhU2l6ZSA9IDA7CiAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEJpbmFyeVJlYWRlcihidWZmZXIpOwogICAgICAgICAgcmVhZGVyLnNraXAoNCk7CiAgICAgICAgICByZWFkZXIuZ2V0VWludDMyKCk7IC8vIOeJiOacrOWPtwoKICAgICAgICAgIHZhciBsb2ROdW0gPSByZWFkZXIuZ2V0VWludDMyKCk7IC8vIGxvZOaVsOmHjwoKICAgICAgICAgIHN0YXRpc3RpY2FsZERhdGFTaXplICs9IDEyOyAvLyAvLyDmqKHlnovnu5PmnoQgICBpZC0+bWVzaAoKICAgICAgICAgIHZhciBsb2RMaXN0ID0gW107CiAgICAgICAgICB2YXIgdGV4dHVyZUxpc3QgPSBbXTsKICAgICAgICAgIHZhciBzaGFyZUxpc3QgPSBbXTsgLy8g6K+75Y+W5ZCE5Liq5Z2XCgogICAgICAgICAgZm9yICh2YXIgbG9kSW54ID0gMDsgbG9kSW54IDwgbG9kTnVtOyBsb2RJbngrKykgewogICAgICAgICAgICB2YXIgY2h1bmtTaXplID0gcmVhZGVyLmdldFVpbnQzMigpOwogICAgICAgICAgICB2YXIgbG9kU3RhcnRPZmZzZXQgPSByZWFkZXIuZ2V0T2Zmc2V0KCk7CiAgICAgICAgICAgIHZhciBsb2RNZXNoID0ge307CiAgICAgICAgICAgIGxvZE1lc2guZ2VvbWV0cnlzID0gW107CgogICAgICAgICAgICB3aGlsZSAoY2h1bmtTaXplIC0gKHJlYWRlci5nZXRPZmZzZXQoKSAtIGxvZFN0YXJ0T2Zmc2V0KSA+IDQpIHsKICAgICAgICAgICAgICB2YXIgZ2VvbWV0cnlOdW0gPSByZWFkZXIuZ2V0VWludDMyKCk7CgogICAgICAgICAgICAgIGZvciAodmFyIGdlb0lueCA9IDA7IGdlb0lueCA8IGdlb21ldHJ5TnVtOyBnZW9JbngrKykgewogICAgICAgICAgICAgICAgdmFyIGdlbyA9IHt9OwogICAgICAgICAgICAgICAgcmVhZGVyLmdldFVpbnQzMigpOwogICAgICAgICAgICAgICAgdmFyIG1lc2hGbGFnID0gcmVhZGVyLmdldFVpbnQzMigpOwogICAgICAgICAgICAgICAgdmFyIGJVc2VDb21wb3NlID0gbWVzaEZsYWcgJiB0aGlzLk1FU0hfRkxBR19JU19DT01QT1NFOyAvL+aYr+WQpuW8gOWQr+aVsOaNruWOi+e8qQoKICAgICAgICAgICAgICAgIGlmIChiVXNlQ29tcG9zZSkgewogICAgICAgICAgICAgICAgICAvLyBhbGVydCgi5q2k54mI5pys5pqC5LiN5pSv5oyB5q2k5qih5Z6L5Yqg6L29LCDor7fljYfnuqdTREvniYjmnKzliLDmnIDmlrDniYjmnKwhIik7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+atpOeJiOacrOaaguS4jeaUr+aMgeatpOaooeWei+WKoOi9vSwg6K+35Y2H57qnU0RL54mI5pys5Yiw5pyA5paw54mI5pysIScpOwogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+atpOeJiOacrOaaguS4jeaUr+aMgeatpOaooeWei+WKoOi9vSwg6K+35Y2H57qnU0RL54mI5pys5Yiw5pyA5paw54mI5pysIScpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGdlby5iSGFzT3BlY2l0eSA9IG1lc2hGbGFnICYgdGhpcy5NRVNIX0ZMQUdfSVNfT1BFQ0lUWTsgLy/mmK/lkKbmnInpgI/mmI7otLTlm74KICAgICAgICAgICAgICAgIC8vIOmhtueCuQoKICAgICAgICAgICAgICAgIGdlby52ZXJ0ZXhOdW0gPSByZWFkZXIuZ2V0VWludDMyKCk7CiAgICAgICAgICAgICAgICBnZW8udmVydGV4cyA9IHJlYWRlci5nZXRGbG9hdDMyQXJyYXkoZ2VvLnZlcnRleE51bSAqIDMpOwogICAgICAgICAgICAgICAgaWYgKGdlby52ZXJ0ZXhzLmJ1ZmZlcikgc2hhcmVMaXN0LnB1c2goZ2VvLnZlcnRleHMuYnVmZmVyKTsgLy8g6Z2i57Si5byVCgogICAgICAgICAgICAgICAgZ2VvLnN1Yk1lc2hOdW0gPSByZWFkZXIuZ2V0VWludDMyKCk7CiAgICAgICAgICAgICAgICBnZW8uc3ViTWVzaHMgPSBbXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBzbUlueCA9IDA7IHNtSW54IDwgZ2VvLnN1Yk1lc2hOdW07IHNtSW54KyspIHsKICAgICAgICAgICAgICAgICAgZ2VvLnN1Yk1lc2hzW3NtSW54XSA9IHt9OwogICAgICAgICAgICAgICAgICBnZW8uc3ViTWVzaHNbc21JbnhdLml0ZW1CeXRlTnVtID0gcmVhZGVyLmdldFVpbnQzMigpOwogICAgICAgICAgICAgICAgICBnZW8uc3ViTWVzaHNbc21JbnhdLmZhY2VOdW0gPSByZWFkZXIuZ2V0VWludDMyKCk7CgogICAgICAgICAgICAgICAgICBpZiAoZ2VvLnN1Yk1lc2hzW3NtSW54XS5pdGVtQnl0ZU51bSA9PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgZ2VvLnN1Yk1lc2hzW3NtSW54XS5mYWNlcyA9IHJlYWRlci5nZXRVaW50MzJBcnJheShnZW8uc3ViTWVzaHNbc21JbnhdLmZhY2VOdW0gKiAzKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnZW8uc3ViTWVzaHNbc21JbnhdLml0ZW1CeXRlTnVtID09IDIpIHsKICAgICAgICAgICAgICAgICAgICBnZW8uc3ViTWVzaHNbc21JbnhdLmZhY2VzID0gcmVhZGVyLmdldFVpbnQxNkFycmF5KGdlby5zdWJNZXNoc1tzbUlueF0uZmFjZU51bSAqIDMpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdlby5zdWJNZXNoc1tzbUlueF0uaXRlbUJ5dGVOdW0gPT0gMSkgewogICAgICAgICAgICAgICAgICAgIGdlby5zdWJNZXNoc1tzbUlueF0uZmFjZXMgPSByZWFkZXIuZ2V0VWludDhBcnJheShnZW8uc3ViTWVzaHNbc21JbnhdLmZhY2VOdW0gKiAzKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGdlby5zdWJNZXNoc1tzbUlueF0uZmFjZXMuYnVmZmVyKSBzaGFyZUxpc3QucHVzaChnZW8uc3ViTWVzaHNbc21JbnhdLmZhY2VzLmJ1ZmZlcik7CiAgICAgICAgICAgICAgICB9IC8vIHV25ZKM6LS05Zu+CgoKICAgICAgICAgICAgICAgIGdlby5iSGF2ZVRleHR1cmUgPSBtZXNoRmxhZyAmIDEgPDwgMDsKICAgICAgICAgICAgICAgIGdlby5iVGV4dHVyZUZpbGUgPSBtZXNoRmxhZyAmIDEgPDwgMTsKCiAgICAgICAgICAgICAgICBpZiAoZ2VvLmJIYXZlVGV4dHVyZSkgewogICAgICAgICAgICAgICAgICBnZW8udXZOdW0gPSByZWFkZXIuZ2V0VWludDMyKCk7CiAgICAgICAgICAgICAgICAgIGdlby51dnMgPSByZWFkZXIuZ2V0RmxvYXQzMkFycmF5KGdlby51dk51bSAqIDIpOwogICAgICAgICAgICAgICAgICBpZiAoZ2VvLnV2cy5idWZmZXIpIHNoYXJlTGlzdC5wdXNoKGdlby51dnMuYnVmZmVyKTsKCiAgICAgICAgICAgICAgICAgIGlmIChnZW8uYlRleHR1cmVGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9uYW1lTGVuID0gcmVhZGVyLmdldFVpbnQ4KCk7CgogICAgICAgICAgICAgICAgICAgIGdlby50ZXh0dXJlRmlsZSA9IHJlYWRlci5nZXRTdHJpbmcoX25hbWVMZW4pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOWGheW1jOi0tOWbvuaVsOaNrgogICAgICAgICAgICAgICAgICAgIHZhciBfbmFtZUxlbjIgPSByZWFkZXIuZ2V0VWludDgoKTsKCiAgICAgICAgICAgICAgICAgICAgZ2VvLnRleHR1cmVGaWxlID0gcmVhZGVyLmdldFN0cmluZyhfbmFtZUxlbjIpOwogICAgICAgICAgICAgICAgICAgIHZhciB0ZXhGbGFnID0gcmVhZGVyLmdldFVpbnQzMigpOwogICAgICAgICAgICAgICAgICAgIHZhciBiSGF2ZVRleENodW5rID0gdGV4RmxhZyAmIDEgPDwgMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGJIYXZlVGV4Q2h1bmspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXhEYXRhU2l6ZSA9IHJlYWRlci5nZXRVaW50MzIoKTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4RGF0YVNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXhEYXRhID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIHRleERhdGEuaW1hZ2UgPSBnZW8udGV4dHVyZUZpbGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZURhdGEgPSByZWFkZXIuZ2V0QXJyYXlCdWZmZXIodGV4RGF0YVNpemUpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJyYXkgPSBuZXcgVWludDhBcnJheShpbWFnZURhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyYXkuYnVmZmVyKSBzaGFyZUxpc3QucHVzaChhcnJheS5idWZmZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB0ZXhEYXRhLmltYWdlQXJyYXkgPSBhcnJheTsgLy90ZXhEYXRhLmltYWdlQmxvYiA9IG5ldyBCbG9iKCBbIHRleERhdGEuaW1hZ2VBcnJheSBdLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9ICk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGV4RGF0YS5pbWFnZVVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoIHRleERhdGEuaW1hZ2VCbG9iICk7CgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlTGlzdC5wdXNoKHRleERhdGEpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxvZE1lc2guZ2VvbWV0cnlzLnB1c2goZ2VvKTsKICAgICAgICAgICAgICAgIHRoaXMucmVhZFBhZGRpbmdCeXRlcyhyZWFkZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5yZWFkUGFkZGluZ0J5dGVzKHJlYWRlcik7CiAgICAgICAgICAgIGxvZExpc3QucHVzaChsb2RNZXNoKTsKICAgICAgICAgICAgc3RhdGlzdGljYWxkRGF0YVNpemUgKz0gNDsKICAgICAgICAgICAgc3RhdGlzdGljYWxkRGF0YVNpemUgKz0gY2h1bmtTaXplOwogICAgICAgICAgICByZWFkZXIuc2V0T2Zmc2V0KHN0YXRpc3RpY2FsZERhdGFTaXplKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXREYXRhLmxvZHMgPSBsb2RMaXN0OwogICAgICAgICAgcmV0RGF0YS50ZXhzID0gdGV4dHVyZUxpc3Q7CiAgICAgICAgICByZXREYXRhLnNoYXJlID0gc2hhcmVMaXN0OwogICAgICAgIH0gZWxzZSBjb25zb2xlLmxvZygibXJicyBmaWxlIGZvcm1hdCBlcnJvciEhISEhISEhIik7CgogICAgICAgIHJldHVybiByZXREYXRhOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImlzTXJic0Zvcm1hdEJpbmFyeSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc01yYnNGb3JtYXRCaW5hcnkoYnVmZmVyKSB7CiAgICAgICAgdmFyIENPUlJFQ1QgPSAnbXJicyc7IC8vIOWbm+S4quWtl+iKggoKICAgICAgICB2YXIgbWFnaWNMZW4gPSA0OwogICAgICAgIHZhciBmaWxlTWFnaWMgPSB0aGlzLmNvbnZlcnRBcnJheUJ1ZmZlclRvU3RyaW5nKGJ1ZmZlciwgMCwgbWFnaWNMZW4pOwogICAgICAgIHJldHVybiBidWZmZXIuYnl0ZUxlbmd0aCA+PSBtYWdpY0xlbiAmJiBDT1JSRUNUID09PSBmaWxlTWFnaWM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVhZFBhZGRpbmdCeXRlcyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZWFkUGFkZGluZ0J5dGVzKHJlYWRlcikgewogICAgICAgIHZhciBfcGFkZGluZ0xlbiA9IHJlYWRlci5nZXRVaW50OCgpOwoKICAgICAgICByZWFkZXIuZ2V0U3RyaW5nKF9wYWRkaW5nTGVuKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJjb252ZXJ0QXJyYXlCdWZmZXJUb1N0cmluZyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0QXJyYXlCdWZmZXJUb1N0cmluZyhidWZmZXIsIGZyb20sIHRvKSB7CiAgICAgICAgaWYgKGZyb20gPT09IHVuZGVmaW5lZCkgZnJvbSA9IDA7CiAgICAgICAgaWYgKHRvID09PSB1bmRlZmluZWQpIHRvID0gYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAgICAgcmV0dXJuIExvYWRlclV0aWxzLmRlY29kZVRleHQobmV3IFVpbnQ4QXJyYXkoYnVmZmVyLCBmcm9tLCB0bykpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIE1yYnNMb2FkZXI7CiAgfSgpOwogIHZhciBMb2FkZXJVdGlscyA9IHsKICAgIGRlY29kZVRleHQ6IGZ1bmN0aW9uIGRlY29kZVRleHQoYXJyYXkpIHsKICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGFycmF5KTsKICAgICAgfSAvLyBBdm9pZCB0aGUgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBhcnJheSkgc2hvcnRjdXQsIHdoaWNoCiAgICAgIC8vIHRocm93cyBhICJtYXhpbXVtIGNhbGwgc3RhY2sgc2l6ZSBleGNlZWRlZCIgZXJyb3IgZm9yIGxhcmdlIGFycmF5cy4KCgogICAgICB2YXIgcyA9ICcnOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgIC8vIEltcGxpY2l0bHkgYXNzdW1lcyBsaXR0bGUtZW5kaWFuLgogICAgICAgIHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShhcnJheVtpXSk7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgLy8gbWVyZ2VzIG11bHRpLWJ5dGUgdXRmLTggY2hhcmFjdGVycy4KICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShzKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBzZWUgIzE2MzU4CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0KICAgIH0sCiAgICBleHRyYWN0VXJsQmFzZTogZnVuY3Rpb24gZXh0cmFjdFVybEJhc2UodXJsKSB7CiAgICAgIHZhciBpbmRleCA9IHVybC5sYXN0SW5kZXhPZignLycpOwogICAgICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm4gJy4vJzsKICAgICAgcmV0dXJuIHVybC5zdWJzdHIoMCwgaW5kZXggKyAxKTsKICAgIH0KICB9OyAvLyDkuozov5vliLbpmIXor7vlmagKCiAgZnVuY3Rpb24gQmluYXJ5UmVhZGVyKGJ1ZmZlciwgbGl0dGxlRW5kaWFuKSB7CiAgICB0aGlzLmR2ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICB0aGlzLm9mZnNldCA9IDA7CiAgICB0aGlzLmxpdHRsZUVuZGlhbiA9IGxpdHRsZUVuZGlhbiAhPT0gdW5kZWZpbmVkID8gbGl0dGxlRW5kaWFuIDogdHJ1ZTsKICB9CgogIEJpbmFyeVJlYWRlci5wcm90b3R5cGUgPSB7CiAgICBjb25zdHJ1Y3RvcjogQmluYXJ5UmVhZGVyLAogICAgZ2V0T2Zmc2V0OiBmdW5jdGlvbiBnZXRPZmZzZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLm9mZnNldDsKICAgIH0sCiAgICBzZXRPZmZzZXQ6IGZ1bmN0aW9uIHNldE9mZnNldChvZmYpIHsKICAgICAgdGhpcy5vZmZzZXQgPSBvZmY7CiAgICB9LAogICAgc2l6ZTogZnVuY3Rpb24gc2l6ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZHYuYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICB9LAogICAgc2tpcDogZnVuY3Rpb24gc2tpcChsZW5ndGgpIHsKICAgICAgdGhpcy5vZmZzZXQgKz0gbGVuZ3RoOwogICAgfSwKICAgIC8vIHNlZW1zIGxpa2UgdHJ1ZS9mYWxzZSByZXByZXNlbnRhdGlvbiBkZXBlbmRzIG9uIGV4cG9ydGVyLgogICAgLy8gdHJ1ZTogMSBvciAnWScoPTB4NTkpLCBmYWxzZTogMCBvciAnVCcoPTB4NTQpCiAgICAvLyB0aGVuIHNlZXMgTFNCLgogICAgZ2V0Qm9vbGVhbjogZnVuY3Rpb24gZ2V0Qm9vbGVhbigpIHsKICAgICAgcmV0dXJuICh0aGlzLmdldFVpbnQ4KCkgJiAxKSA9PT0gMTsKICAgIH0sCiAgICBnZXRCb29sZWFuQXJyYXk6IGZ1bmN0aW9uIGdldEJvb2xlYW5BcnJheShzaXplKSB7CiAgICAgIHZhciBhID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgIGEucHVzaCh0aGlzLmdldEJvb2xlYW4oKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGdldFVpbnQ4OiBmdW5jdGlvbiBnZXRVaW50OCgpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5kdi5nZXRVaW50OCh0aGlzLm9mZnNldCk7CiAgICAgIHRoaXMub2Zmc2V0ICs9IDE7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0sCiAgICBnZXRVaW50OEFycmF5OiBmdW5jdGlvbiBnZXRVaW50OEFycmF5KHNpemUpIHsKICAgICAgdmFyIGEgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgYS5wdXNoKHRoaXMuZ2V0VWludDgoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGdldEludDE2OiBmdW5jdGlvbiBnZXRJbnQxNigpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5kdi5nZXRJbnQxNih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwogICAgICB0aGlzLm9mZnNldCArPSAyOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgZ2V0VWludDE2OiBmdW5jdGlvbiBnZXRVaW50MTYob2Zmc2V0KSB7CiAgICAgIGlmIChvZmZzZXQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5kdi5nZXRVaW50MTYob2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfdmFsdWUgPSB0aGlzLmR2LmdldFVpbnQxNih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKICAgICAgICB0aGlzLm9mZnNldCArPSAyOwogICAgICAgIHJldHVybiBfdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBnZXRVaW50MTZBcnJheTogZnVuY3Rpb24gZ2V0VWludDE2QXJyYXkoc2l6ZSkgewogICAgICB2YXIgYSA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICBhLnB1c2godGhpcy5nZXRVaW50MTYoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGdldEludDMyOiBmdW5jdGlvbiBnZXRJbnQzMigpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5kdi5nZXRJbnQzMih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwogICAgICB0aGlzLm9mZnNldCArPSA0OwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgZ2V0SW50MzJBcnJheTogZnVuY3Rpb24gZ2V0SW50MzJBcnJheShzaXplKSB7CiAgICAgIHZhciBhID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgIGEucHVzaCh0aGlzLmdldEludDMyKCkpOwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBnZXRVaW50MzI6IGZ1bmN0aW9uIGdldFVpbnQzMigpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5kdi5nZXRVaW50MzIodGhpcy5vZmZzZXQsIHRoaXMubGl0dGxlRW5kaWFuKTsKICAgICAgdGhpcy5vZmZzZXQgKz0gNDsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSwKICAgIGdldFVpbnQzMkFycmF5OiBmdW5jdGlvbiBnZXRVaW50MzJBcnJheShzaXplKSB7CiAgICAgIHZhciBhID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgIGEucHVzaCh0aGlzLmdldFVpbnQzMigpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgZ2V0TWF0cml4NDogZnVuY3Rpb24gZ2V0TWF0cml4NCgpIHsKICAgICAgdmFyIHZhbHVlID0gbmV3IE1hdHJpeDQoKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykgewogICAgICAgIHZhbHVlLmVsZW1lbnRzW2ldID0gdGhpcy5nZXRGbG9hdDMyKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0sCiAgICBnZXRWZWN0b3IzOiBmdW5jdGlvbiBnZXRWZWN0b3IzKCkgewogICAgICB2YXIgdmFsdWUgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgdmFsdWUucHVzaCh0aGlzLmdldEZsb2F0MzIoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0sCiAgICBnZXRWZWN0b3IyOiBmdW5jdGlvbiBnZXRWZWN0b3IyKCkgewogICAgICB2YXIgdmFsdWUgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgdmFsdWUucHVzaCh0aGlzLmdldEZsb2F0MzIoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0sCiAgICAvLyBKYXZhU2NyaXB0IGRvZXNuJ3Qgc3VwcG9ydCA2NC1iaXQgaW50ZWdlciBzbyBjYWxjdWxhdGUgdGhpcyBoZXJlCiAgICAvLyAxIDw8IDMyIHdpbGwgcmV0dXJuIDEgc28gdXNpbmcgbXVsdGlwbHkgb3BlcmF0aW9uIGluc3RlYWQgaGVyZS4KICAgIC8vIFRoZXJlJ3MgYSBwb3NzaWJpbGl0eSB0aGF0IHRoaXMgbWV0aG9kIHJldHVybnMgd3JvbmcgdmFsdWUgaWYgdGhlIHZhbHVlCiAgICAvLyBpcyBvdXQgb2YgdGhlIHJhbmdlIGJldHdlZW4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgYW5kIE51bWJlci5NSU5fU0FGRV9JTlRFR0VSLgogICAgLy8gVE9ETzogc2FmZWx5IGhhbmRsZSA2NC1iaXQgaW50ZWdlcgogICAgZ2V0SW50NjQ6IGZ1bmN0aW9uIGdldEludDY0KCkgewogICAgICB2YXIgbG93LCBoaWdoOwoKICAgICAgaWYgKHRoaXMubGl0dGxlRW5kaWFuKSB7CiAgICAgICAgbG93ID0gdGhpcy5nZXRVaW50MzIoKTsKICAgICAgICBoaWdoID0gdGhpcy5nZXRVaW50MzIoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBoaWdoID0gdGhpcy5nZXRVaW50MzIoKTsKICAgICAgICBsb3cgPSB0aGlzLmdldFVpbnQzMigpOwogICAgICB9IC8vIGNhbGN1bGF0ZSBuZWdhdGl2ZSB2YWx1ZQoKCiAgICAgIGlmIChoaWdoICYgMHg4MDAwMDAwMCkgewogICAgICAgIGhpZ2ggPSB+aGlnaCAmIDB4RkZGRkZGRkY7CiAgICAgICAgbG93ID0gfmxvdyAmIDB4RkZGRkZGRkY7CiAgICAgICAgaWYgKGxvdyA9PT0gMHhGRkZGRkZGRikgaGlnaCA9IGhpZ2ggKyAxICYgMHhGRkZGRkZGRjsKICAgICAgICBsb3cgPSBsb3cgKyAxICYgMHhGRkZGRkZGRjsKICAgICAgICByZXR1cm4gLShoaWdoICogMHgxMDAwMDAwMDAgKyBsb3cpOwogICAgICB9CgogICAgICByZXR1cm4gaGlnaCAqIDB4MTAwMDAwMDAwICsgbG93OwogICAgfSwKICAgIGdldEludDY0QXJyYXk6IGZ1bmN0aW9uIGdldEludDY0QXJyYXkoc2l6ZSkgewogICAgICB2YXIgYSA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICBhLnB1c2godGhpcy5nZXRJbnQ2NCgpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgLy8gTm90ZTogc2VlIGdldEludDY0KCkgY29tbWVudAogICAgZ2V0VWludDY0OiBmdW5jdGlvbiBnZXRVaW50NjQoKSB7CiAgICAgIHZhciBsb3csIGhpZ2g7CgogICAgICBpZiAodGhpcy5saXR0bGVFbmRpYW4pIHsKICAgICAgICBsb3cgPSB0aGlzLmdldFVpbnQzMigpOwogICAgICAgIGhpZ2ggPSB0aGlzLmdldFVpbnQzMigpOwogICAgICB9IGVsc2UgewogICAgICAgIGhpZ2ggPSB0aGlzLmdldFVpbnQzMigpOwogICAgICAgIGxvdyA9IHRoaXMuZ2V0VWludDMyKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBoaWdoICogMHgxMDAwMDAwMDAgKyBsb3c7CiAgICB9LAogICAgZ2V0RmxvYXQzMjogZnVuY3Rpb24gZ2V0RmxvYXQzMihvZmZzZXQpIHsKICAgICAgaWYgKG9mZnNldCAhPSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmR2LmdldEZsb2F0MzIob2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfdmFsdWUyID0gdGhpcy5kdi5nZXRGbG9hdDMyKHRoaXMub2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CgogICAgICAgIHRoaXMub2Zmc2V0ICs9IDQ7CiAgICAgICAgcmV0dXJuIF92YWx1ZTI7CiAgICAgIH0KICAgIH0sCiAgICBnZXRGbG9hdDMyQXJyYXk6IGZ1bmN0aW9uIGdldEZsb2F0MzJBcnJheShzaXplKSB7CiAgICAgIHZhciBhID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgIGEucHVzaCh0aGlzLmdldEZsb2F0MzIoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGdldEZsb2F0NjQ6IGZ1bmN0aW9uIGdldEZsb2F0NjQoKSB7CiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZHYuZ2V0RmxvYXQ2NCh0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwogICAgICB0aGlzLm9mZnNldCArPSA4OwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgZ2V0RmxvYXQ2NEFycmF5OiBmdW5jdGlvbiBnZXRGbG9hdDY0QXJyYXkoc2l6ZSkgewogICAgICB2YXIgYSA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICBhLnB1c2godGhpcy5nZXRGbG9hdDY0KCkpOwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBnZXRBcnJheUJ1ZmZlcjogZnVuY3Rpb24gZ2V0QXJyYXlCdWZmZXIoc2l6ZSkgewogICAgICB2YXIgdmFsdWUgPSB0aGlzLmR2LmJ1ZmZlci5zbGljZSh0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyBzaXplKTsKICAgICAgdGhpcy5vZmZzZXQgKz0gc2l6ZTsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSwKICAgIGdldFN0cmluZzogZnVuY3Rpb24gZ2V0U3RyaW5nKHNpemUpIHsKICAgICAgLy8gbm90ZTogc2FmYXJpIDkgZG9lc24ndCBzdXBwb3J0IFVpbnQ4QXJyYXkuaW5kZXhPZjsgY3JlYXRlIGludGVybWVkaWF0ZSBhcnJheSBpbnN0ZWFkCiAgICAgIHZhciBhID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgIGFbaV0gPSB0aGlzLmdldFVpbnQ4KCk7CiAgICAgIH0KCiAgICAgIHZhciBudWxsQnl0ZSA9IGEuaW5kZXhPZigwKTsKICAgICAgaWYgKG51bGxCeXRlID49IDApIGEgPSBhLnNsaWNlKDAsIG51bGxCeXRlKTsKICAgICAgcmV0dXJuIExvYWRlclV0aWxzLmRlY29kZVRleHQobmV3IFVpbnQ4QXJyYXkoYSkpOwogICAgfQogIH07CgogIHZhciBsb2FkaW5nID0ge307CgogIHNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2dCkgewogICAgc3dpdGNoIChldnQuZGF0YS50eXBlKSB7CiAgICAgIGNhc2UgImxvYWQiOgogICAgICAgIC8vY29uc29sZS5sb2coZXZ0LmRhdGEpOwogICAgICAgIHZhciBsciA9IG5ldyBNcmJzTG9hZGVyKCkubG9hZChldnQuZGF0YS5tdXJsLCBmdW5jdGlvbiAoZ2VvRGF0YSkgewogICAgICAgICAgLy9jb25zb2xlLmxvZyhnZW9EYXRhKQogICAgICAgICAgaWYgKGdlb0RhdGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBsb2FkaW5nW2V2dC5kYXRhLmZpbGVdID0gdW5kZWZpbmVkOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBzdWNjOiBmYWxzZSwKICAgICAgICAgICAgICBmaWxlOiBldnQuZGF0YS5maWxlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChnZW9EYXRhLmxvZHMpIHsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgc3VjYzogdHJ1ZSwKICAgICAgICAgICAgICBmaWxlOiBldnQuZGF0YS5maWxlLAogICAgICAgICAgICAgIHJldERhdGE6IHsKICAgICAgICAgICAgICAgIGxvZHM6IGdlb0RhdGEubG9kcywKICAgICAgICAgICAgICAgIHRleHM6IGdlb0RhdGEudGV4cwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgZ2VvRGF0YS5zaGFyZSk7CiAgICAgICAgICAgIGxvYWRpbmdbZXZ0LmRhdGEuZmlsZV0gPSB1bmRlZmluZWQ7CiAgICAgICAgICB9CiAgICAgICAgfSwgZnVuY3Rpb24gKG0pIHt9LCBmdW5jdGlvbiAobSkgewogICAgICAgICAgbG9hZGluZ1tldnQuZGF0YS5maWxlXSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzdWNjOiBmYWxzZSwKICAgICAgICAgICAgZmlsZTogZXZ0LmRhdGEuZmlsZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgbHIuZW5kID0gZmFsc2U7IC8vbHIuZmlsZSA9IGV2dC5kYXRhLmZpbGU7CgogICAgICAgIGxvYWRpbmdbZXZ0LmRhdGEuZmlsZV0gPSBscjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgImNhbmNlbCI6CiAgICAgICAgaWYgKGxvYWRpbmdbZXZ0LmRhdGEuZmlsZV0gJiYgIWxvYWRpbmdbZXZ0LmRhdGEuZmlsZV0uZW5kKSB7CiAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc3VjYzogZmFsc2UsCiAgICAgICAgICAgIGZpbGU6IGV2dC5kYXRhLmZpbGUKICAgICAgICAgIH0pOwogICAgICAgICAgbG9hZGluZ1tldnQuZGF0YS5maWxlXS5hYm9ydCgpOwogICAgICAgICAgbG9hZGluZ1tldnQuZGF0YS5maWxlXSA9IHVuZGVmaW5lZDsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQogIH07Cgp9KCkpOwoK",null,!1),Cg=1,Mg=2,Bg=3,Ig=4;var Eg,Sg,Tg,Lg=function(){function e(t){var n=this;r(this,e),this.sceneManager=t,this.path="",this.loadingTasks={},this.currentNum=0,this.loadNum=3,this.loadMaxPT=2,this.loadWorkers=[],this.basisLoader=void 0,this.haveNewLoadTaskFlag=!1,this.cachePrioLoadTaskList=[];for(var i=this,a=function(e){var t=new bg;t.isLoader=!0,t.num=0,t.onmessage=function(e){if(i.currentNum--,t.num--,e.data.succ)i.loadingTasks[e.data.file]=void 0,i.onReceiveMessageFromWebworker(e.data.file,e.data);else{var n=i.loadingTasks[e.data.file];void 0!==n&&n.state===Bg&&(n.state=Cg)}},t.sendMessage=function(e){i.currentNum++,t.num++,t.postMessage(e)},n.loadWorkers.push(t)},o=0;o<this.loadNum;o++)a()}return o(e,[{key:"setPath",value:function(e){this.path=e}},{key:"AddLoadTask",value:function(e){this.loadingTasks[e.file]=e,this.haveNewLoadTaskFlag=!0}},{key:"RefreshLoadFlag",value:function(){this.haveNewLoadTaskFlag=!0}},{key:"onReceiveMessageFromWebworker",value:function(e,t){var n=this,i=t.retData.texs.length,r=0;i>0?t.retData.texs.forEach((function(a){void 0===n.basisLoader&&(n.basisLoader=new Mf,n.basisLoader.setTranscoderPath(function(){var e="js/";if(document.getElementById("AMRT")){var t=document.getElementById("AMRT").src;e=t.slice(0,t.lastIndexOf("/"))+"/"}else for(var n=0;n<document.scripts.length;n++){var i=document.scripts[n];i.src&&"app.js"===i.src.slice(i.src.lastIndexOf("/")+1)&&(e=i.src.slice(0,i.src.lastIndexOf("/"))+"/")}return e}())),n.basisLoader.detectSupport(n.sceneManager.viewer.renderManager.getRenderer()).loadFromBuffer(a.imageArray.buffer,(function(o){a.imageArray=void 0,o.generateMipmaps=!0,a.tex=o,++r>=i&&n.sceneManager.onCompleteFileLoad(t.retData,e)}),(function(e){console.log("Error: Load basisu texture failed!!! errorCode: "+e)}))})):this.sceneManager.onCompleteFileLoad(t.retData,e)}},{key:"HandleFrameFileLoad",value:function(){var e=this;if(this.haveNewLoadTaskFlag){for(var t in this.haveNewLoadTaskFlag=!1,this.cachePrioLoadTaskList=[],this.loadingTasks){var n=this.loadingTasks[t];void 0!==n&&(n.state!==Ig&&(n.priority=this.sceneManager.GetFilePriority(t,n.bReplace),n.state===Mg?(n.priority,Number.MAX_VALUE):n.state===Cg?n.priority===Number.MAX_VALUE&&this.loadingTasks[t].level>0&&this.sceneManager.CheckIsFixedCamera()?this.sceneManager.CancelLoadingTask(t):this.cachePrioLoadTaskList.push(n):n.state===Bg&&this.sceneManager.CancelLoadingTask(t)))}this.cachePrioLoadTaskList.sort((function(e,t){return t.priority-e.priority}))}if([].forEach((function(t){var n={type:"cancel"};n.file=t.file,t.state=Bg,e.loadWorkers[t.loaderInx].postMessage(n)})),this.cachePrioLoadTaskList.length>0)for(var i=0;i<this.loadNum;i++)if(this.loadWorkers[i].num<this.loadMaxPT){var r=this.cachePrioLoadTaskList.pop();if(!r)break;if(r.state===Bg)this.sceneManager.CancelLoadingTask(r.file);else{var a={};a.murl=this.path+r.chunkIndex+"/"+r.level+"/"+r.file+".mrbs",a.file=r.file,a.type="load",r.state=Mg,r.loaderInx=i,this.loadWorkers[i].sendMessage(a)}}}}]),e}(),Fg=0,_g=1,Ug=2,Pg=new Jt(new tt(1/0,1/0,1/0),new tt(-1/0,-1/0,-1/0)),kg=new vt,Dg=new tt,Rg=new vt,Og=function(){function e(t,n){var i=this;r(this,e),this.viewer=t,this.frustum=new zi,this.camera=t.camera,this.scene=t.scene,this.root=new Dt,this.renderer=t.renderManager.getRenderer(),this.needsUpdate=!1,this.maxShowLevel=void 0!==n?n:100,t.addEventListener(Xu.UPDATE,(function(){i.updateFrustum(),i.loaderManager.HandleFrameFileLoad()})),this.clock=new ic,this.path="",this.rootMrbsFiles=[],this.sceneNodeTree={},this.lodScale=1,this.sceneBoundBox=new Jt,this.hideDeltaTime=.2,this.DestroyDeltaTime=5,this.updateChildListDeltaTime=4.5,this.lastFileNodeDestroyTime=0,this.framesActiveList=[],this.activeFileList=[],this.frameActive={},this.curFrameTime=this.clock.getElapsedTime(),this.loaderManager=new Lg(this),this.bFixedCamera=!1,setInterval((function(){i.update()}),100)}return o(e,[{key:"load",value:function(e,t,n,i){var r=this;this.path=Ul.extractUrlBase(e),this.loaderManager.setPath(this.path);var a=new VA;a.setResponseType("arraybuffer"),a.load(e,(function(e){try{r.parseTreeFile(e,r.path),t&&t()}catch(e){i&&i(e)}}),n,i)}},{key:"loadConfig",value:function(e,t){var n=this;(new VA).load(e,(function(e){var i=JSON.parse(e);i.pos&&n.root.position.set(i.pos[0],0,i.pos[1]),t&&t()}),null,(function(){t&&t()}))}},{key:"projectBoundingSphere",value:function(e,t,n,i){var r=new tt;r.copy(e),r.applyMatrix4(n);var a=t*t,o=r.z*r.z,s=r.lengthSq();return-Math.PI*i*i*a*Math.sqrt(Math.abs((s-a)/(a-o)))/(a-o)}},{key:"computeRangePixels",value:function(e,t){var n=this.camera.fov;return 2*Math.atan(t/e)*180/Math.PI/(Math.max(n,1e-17)/window.innerHeight)}},{key:"GetChildListInNeedForLod",value:function(e){var t=this,n=[];e.isReshowlist=this.InformChildrenLodLoading(e,n),e.reshowlist=n,n.forEach((function(e){e.lastActiveTime=t.curFrameTime})),e.refChildNum=n.length,e.lastShowChildTime=this.curFrameTime,e.fileNode.totalRefChildNum=0,e.fileNode.lods.forEach((function(e){e.refChildNum&&(e.fileNode.totalRefChildNum+=e.refChildNum)}))}},{key:"GetChildListInNeed",value:function(e){var t=this,n=0;e.lods.forEach((function(e){var i=[];e.isReshowlist=t.InformChildrenLodLoading(e,i),e.reshowlist=i,i.forEach((function(e){e.lastActiveTime=t.curFrameTime})),n+=i.length,e.lastShowChildTime=t.curFrameTime})),e.totalRefChildNum=n}},{key:"removeChildListInNeed",value:function(e){e.lods.forEach((function(e){e.isReshowlist=!1,e.reshowlist=void 0,e.lastShowChildTime=void 0})),e.totalRefChildNum=0}},{key:"ShowChildListInNeed",value:function(e){var t=this;(!e.lastShowChildTime||this.curFrameTime-e.lastShowChildTime>=this.updateChildListDeltaTime)&&this.GetChildListInNeedForLod(e);var n=e.isReshowlist;return e.reshowlist&&e.reshowlist.length>0&&e.reshowlist.forEach((function(e){2===e.state&&e.lods.forEach((function(e){t.ShowLod(e)}))})),n}},{key:"traverseMrbsFile",value:function(e){for(var t=this,n=[e],i=[];n.length>0;){var r=n.pop(),a=this.sceneNodeTree[r];if(a)if(a.traverseTwice){a.traverseTwice=!1;for(var o=a.lods.length,s=function(e){var n=a.lods[e],i=0;n.children.forEach((function(e){var n=t.sceneNodeTree[e.file];n&&n.traverseState&&(n.traverseState>i&&(i=n.traverseState),n.traverseState=void 0)})),i!==Fg&&(2===a.state?i===Ug?(t.ShowLod(n),t.AddShowedFileNode(a)):(t.HideLod(n),t.UpdateLod(n)):(!a.traverseState||i>a.traverseState)&&(a.traverseState=i))},A=0;A<o;A++)s(A)}else{if(0===a.level)a.parentOkLevel=-1;else{var l=a.parentLod.fileNode;a.parentOkLevel=2===l.state?l.level:l.parentOkLevel}a.traverseState=Fg,void 0===a||void 0===a.lods||0===a.lods.length||a.level>=this.maxShowLevel?(a.traverseState=Ug,this.AddShowedFileNode(a)):function(){for(var e=[],o=a.lods.length,s=0,A=0;A<o;A++){var l=a.lods[A],c=l.center.distanceTo(t.camera.position);if(s=t.maxShowLevel===a.level+1?l.range.x:0===l.computeType?c*t.lodScale:t.computeRangePixels(c,l.radius),l.range.x<=s&&s<l.range.y){var h=!1;if(3===a.state||1===a.state){t.cancelChildFileLoad(a);var u=t.CheckLodIsInFrustum(l);if(3===a.state&&(u?(t.loadMrbsFile(r,a.level),h=!0):-1===a.parentOkLevel&&i.push(a)),u||-1===a.parentOkLevel)if(-1!==a.parentOkLevel&&a.level-a.parentOkLevel<=2)a.traverseState=Ug;else if(t.ShowChildListInNeed(l))h=!0;else if(-1!==a.parentOkLevel){var d=t.CheckLodIsInFrustumTruly(l);a.traverseState=d?Ug:_g}else a.traverseState=_g;else a.traverseState=_g}else t.ShowLod(l),h=!0;h&&t.AddShowedFileNode(a)}else l.children.forEach((function(t){t.range.x<=s&&s<t.range.y&&e.push(t.file)}))}e.length>0&&(a.traverseTwice?console.log("Error: sceneTreeFileNode.traverseTwice"):(a.traverseTwice=!0,n.push(r),e.forEach((function(e){n.push(e)})),e=void 0))}()}}i.forEach((function(e){t.LoadReplaceFileNode(e)}))}},{key:"updateFileMaxLoaded",value:function(e,t){e.lods.forEach((function(e){e.maxLoadedLevel<t&&(e.maxLoadedLevel=t)})),this.updateLodMaxLoaded(e.parentLod,t)}},{key:"updateLodMaxLoaded",value:function(e,t){for(;e&&e.maxLoadedLevel<t;)e.maxLoadedLevel=t,e=e.fileNode.parentLod}},{key:"AddShowedFileNode",value:function(e){for(;e;)e.lastTraverseShowTime=this.curFrameTime,e=e.parentLod?e.parentLod.fileNode:void 0}},{key:"LoadReplaceFileNode",value:function(e){e.fileName;for(var t=e;e&&e.lastTraverseShowTime!==this.curFrameTime;)t=e,e=e.parentLod?e.parentLod.fileNode:void 0;t&&this.loadMrbsFileByNode(t,t.level,!0)}},{key:"ShowLod",value:function(e){e.subMeshs.forEach((function(e){e.visible=!0})),this.UpdateLod(e)}},{key:"HideLod",value:function(e){e.subMeshs.forEach((function(e){e.visible=!1}))}},{key:"UpdateLod",value:function(e){e.lastActiveTime=this.curFrameTime,this.frameActive.activeLods.push(e),e.fileNode.lastActiveTime=this.curFrameTime}},{key:"updateFrustum",value:function(){Rg.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.frustum.setFromMatrix(Rg)}},{key:"update",value:function(){this.updateFrustum(),this.curFrameTime=this.clock.getElapsedTime(),this.frameActive={},this.frameActive.time=this.curFrameTime,this.frameActive.activeLods=[];for(var e=this.rootMrbsFiles.length,t=0;t<e;t++)this.traverseMrbsFile(this.rootMrbsFiles[t],0,-1);this.framesActiveList.push(this.frameActive);for(var n=this.framesActiveList.length,i=0;i<n&&!(this.curFrameTime-this.framesActiveList[i].time<=this.hideDeltaTime);){for(var r=this.framesActiveList[i].activeLods,a=r.length,o=0;o<a;o++){var s=r[o];this.curFrameTime-s.lastActiveTime>this.hideDeltaTime&&(this.HideLod(s),r.splice(o,1),o--,a--)}this.framesActiveList.splice(i,1),n--}this.DestroyTimeoutFileNode()}},{key:"traverseFileNodeForDestroy",value:function(e){for(var t=this,n=[e];n.length>0;){var i=n.pop(),r=this.sceneNodeTree[i];if(void 0===r||void 0===r.lods||r.level>=this.maxShowLevel)return;var a=r.lods.length;if(2===r.state&&this.curFrameTime-r.lastActiveTime>=this.DestroyDeltaTime){for(var o=0;o<a;o++){var s=r.lods[o];s.subMeshs.forEach((function(e){t.root.remove(e),e.geometry.dispose(),e.geometry=void 0,e.material.map&&(e.material.map.dispose(),e.material.map.image=void 0,e.material.map=void 0),e.material.dispose(),e.material=void 0,e=void 0})),s.subMeshs=[]}r.state=3}for(var A=0;A<a;A++){var l=r.lods[A];l.maxLoadedLevel>l.fileNode.level&&l.children.forEach((function(e){n.push(e.file)}))}}}},{key:"DestroyTimeoutFileNode",value:function(){if(this.curFrameTime-this.lastFileNodeDestroyTime>=10){for(var e=this.rootMrbsFiles.length,t=0;t<e;t++)this.traverseFileNodeForDestroy(this.rootMrbsFiles[t]);this.lastFileNodeDestroyTime=this.curFrameTime}}},{key:"InformChildrenLodLoading",value:function(e,t){for(var n=this,i=!0,r=[e];r.length>0;){var a=r.pop();a.maxLoadedLevel<=a.fileNode.level?i=!1:a.children.length>0?a.children.forEach((function(e){var a=n.sceneNodeTree[e.file];void 0===a||void 0===a.lods||a.level>=n.maxShowLevel?i=!1:2===a.state?t.push(a):a.lods.forEach((function(e){r.push(e)}))})):i=!1}return i}},{key:"InformChildrenHaveParentLoading",value:function(e,t){var n=this,i=this.sceneNodeTree[e];if(void 0===i||void 0===i.lods||i.level>=this.maxShowLevel)return!1;var r=!0;return 2===i.state?(t.push(i),r=!0):i.lods.forEach((function(e){n.InformChildrenLodLoading(e,t)||(r=!1)})),r}},{key:"CheckLodIsInFrustum",value:function(e){var t={center:e.center,radius:2*e.radius};return this.frustum.containsPoint(e.center)||this.frustum.intersectsSphere(t)}},{key:"CheckLodIsInFrustumTruly",value:function(e){var t={center:e.center,radius:1.5*e.radius};return this.frustum.containsPoint(e.center)||this.frustum.intersectsSphere(t)}},{key:"CancelLoadingTask",value:function(e){var t=this.sceneNodeTree[e];t.state=3,t.checkedChildLoad=!1,this.loaderManager.loadingTasks[e]=void 0}},{key:"GetFilePriority",value:function(e,t){var n=this.sceneNodeTree[e],i=Number.MAX_VALUE;if(!t)//!treeFileNode.totalRefChildNum || treeFileNode.totalRefChildNum < parent_file_ref_child_filenode_limit)
{for(var r=!1,a=n.lods.length,o=0;o<a;o++){var s=n.lods[o];if(this.CheckLodIsInFrustum(s)){r=!0;break}}if(!r)return i}return n.lods.forEach((function(e){Dg.copy(e.center),Dg.applyMatrix4(Rg),Dg.z=0;var t=Dg.lengthSq();i=Math.min(i,t)})),0===n.level&&(i*=1e-7),n.totalRefChildNum&&(i/=n.totalRefChildNum),i}},{key:"CheckIsFixedCamera",value:function(){return this.bFixedCamera}},{key:"InitRootMatrixAndCamera",value:function(){var e=this,t=Pg.getCenter();this.root.rotateX(-Math.PI/2);var n=Pg;for(var i in this.viewer.isGISViewer?(this.root.position.x-=t.x,this.root.position.y-=t.z,this.root.position.z+=t.y,this.root.position.y=Math.abs(t.z)/2,this.root.updateMatrixWorld(),Pg.applyMatrix4(this.root.matrixWorld),kg=this.root.matrixWorld):(this.root.updateMatrix(),n=Pg.clone().applyMatrix4(this.root.matrix),kg=this.root.matrix),this.isFocus&&this.viewer.fitCamera(this.root,n),setTimeout((function(){e.update()}),1e3),this.viewer.camera.near=1,this.viewer.camera.updateProjectionMatrix(),this.bFixedCamera=!0,this.loaderManager.RefreshLoadFlag(),this.sceneNodeTree){this.sceneNodeTree[i].lods.forEach((function(e){e.center.applyMatrix4(kg)}))}}},{key:"onCompleteFileLoad",value:function(e,t,n){for(var i=this.sceneNodeTree[t],r={},a=e.texs.length,o=0;o<a;o++)r[e.texs[o].image]=e.texs[o].tex;for(var s=e.lods.length,A=0;A<s;A++){var l=e.lods[A],c=i.lods[A];if(void 0===c)return void console.log("Error: "+t+" not find lod "+A);c.subMeshs=[],c.lastActiveTime=this.curFrameTime;for(var h=l.geometrys.length,u=0;u<h;u++)for(var d=l.geometrys[u],f=new Vn(d.vertexs,3),p=new Vn(d.uvs,2),m=d.subMeshs.length,g=0;g<m;g++){var v=new ni;v.setAttribute("position",f),v.setAttribute("uv",p);var y=void 0,w=d.subMeshs[g];4==w.itemByteNum?y=new zn(w.faces,1):2==w.itemByteNum?y=new Qn(w.faces,1):1==w.itemByteNum&&(y=new On(w.faces,1)),v.setIndex(y),v.clearGroups(),v.addGroup(0,w.faces.length,0);var x=new kn({map:r[d.textureFile]});x.side=2,x.alphaTest=.7;var b=new xi(v,x);c.subMeshs.push(b),b.name=t+":"+A+":"+g,b.castShadow=!1,b.receiveShadow=!1,b.visible=!1,b.matrixAutoUpdate=!1,this.root.add(b),this.bFixedCamera||this.InitRootMatrixAndCamera()}}this.bFixedCamera||this.InitRootMatrixAndCamera(),i.state=2,i.checkedChildLoad=!1,this.removeChildListInNeed(i),this.updateFileMaxLoaded(i,i.level)}},{key:"loadMrbsFileByNode",value:function(e,t,n){if(!(1===e.state||2===e.state||e.level>=this.maxShowLevel)){e.state,e.state=1,e.lastActiveTime=this.curFrameTime;var i={};i.chunkIndex=e.chunkIndex,i.level=e.level,i.state=Cg,i.file=e.fileName,i.bReplace=!!n,this.loaderManager.AddLoadTask(i)}}},{key:"loadMrbsFile",value:function(e,t){var n=this.sceneNodeTree[e];this.loadMrbsFileByNode(n,t)}},{key:"cancelChildFileLoad",value:function(e){if(!e.checkedChildLoad){e.checkedChildLoad=!0;var t=[];for(e.lods.forEach((function(e){e.children.forEach((function(e){t.push(e.file)}))}));t.length>0;){var n=t.pop(),i=this.sceneNodeTree[n];if(i&&e.level<this.maxShowLevel){var r=this.loaderManager.loadingTasks[n];r&&r.state===Cg&&(r.state=Bg),i.lods.forEach((function(e){e.children.forEach((function(e){t.push(e.file)}))}))}}}}},{key:"convertArrayBufferToString",value:function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),Ul.decodeText(new Uint8Array(e,t,n))}},{key:"isBscbFormatBinary",value:function(e){var t=this.convertArrayBufferToString(e,0,4);return e.byteLength>=4&&"bscb"===t}},{key:"parseTreeFile",value:function(e,t){var n=this;if(this.isBscbFormatBinary(e)){this.rootMrbsFiles=[];var i=new xg(e);i.skip(4),i.getUint32();for(var r=i.getUint32(),a=0;a<r;a++)for(var o=i.getUint32(),s=i.getUint32(),A=0;A<s;A++)for(var l=i.getInt32(),c=i.getUint32(),h=0;h<c;h++){var u=o+"_"+l+"_"+h,d={};d.chunkIndex=o,d.level=l,d.state=3,d.lastTraverseShowTime=0,d.fileName=u,d.lods=[];for(var f=i.getUint32(),p=0;p<f;p++){var m={};m.center=i.getVector3(),m.radius=i.getFloat32(),m.range=i.getVector2(),m.computeType=i.getUint16(),m.subMeshs=[];var g=i.getUint16();m.children=[];for(var v=l+1,y=0;y<g;y++){var w={};w.range=i.getVector2();var x=i.getInt32();-1!==x&&(w.file=0===o&&A==s-1?x+"_"+v+"_0":o+"_"+v+"_"+x,m.children.push(w))}0===m.children.length&&(m.range.x=0,m.range.y=Number.MAX_VALUE),d.lods.push(m)}this.sceneNodeTree[u]=d,0===l&&this.rootMrbsFiles.push(u)}}var b=function(e){var t=n.sceneNodeTree[e];t.lods.forEach((function(e){e.children.forEach((function(t){n.sceneNodeTree[t.file]&&(n.sceneNodeTree[t.file].parentLod=e)})),e.fileNode=t,e.maxLoadedLevel=0}))};for(var C in this.sceneNodeTree)b(C);this.computeRootBox(),this.rootMrbsFiles.forEach((function(e){n.loadMrbsFile(e,0)}))}},{key:"computeRootBox",value:function(){var e,t=this,n=[];this.rootMrbsFiles.forEach((function(e){var i=t.sceneNodeTree[e];0===i.level&&i.lods.map((function(e){e.radius<9999999?n.push({radius:e.radius,center:e.center}):!isNaN(e.center.x)&&isFinite(e.center.x)&&Math.abs(e.center.x)<9999999&&n.push({radius:99,center:e.center})}))}));for(var i=0;i<n.length;i++)(e=n[i]).center.x-e.radius<Pg.min.x&&(Pg.min.x=e.center.x-e.radius),e.center.y-e.radius<Pg.min.y&&(Pg.min.y=e.center.y-e.radius),e.center.z-e.radius<Pg.min.z&&(Pg.min.z=e.center.z-e.radius),e.center.x+e.radius>Pg.max.x&&(Pg.max.x=e.center.x+e.radius),e.center.y+e.radius>Pg.max.y&&(Pg.max.y=e.center.y+e.radius),e.center.z+e.radius>Pg.max.z&&(Pg.max.z=e.center.z+e.radius)}}]),e}(),Ng=function(){function e(t){r(this,e),void 0===t&&console.error("viewer"),this.viewer=t,this.loaders=[],this.largeSceneGroup=this.viewer.modelGroup}return o(e,[{key:"load",value:function(e,t,n){var i=t.focus||void 0===t.focus,r=t.onload,a=new Og(this.viewer,n);a.isFocus=i;var o=new Dt;return o.path=e,o.isLargeScene=!0,this.loaders.push(a),o.loader=a,o.add(a.root),this.largeSceneGroup.add(o),a.load(e+"/conf.mrcb",(function(){r&&r(o)})),o}}]),e}(),Gg=0,Qg=function(e){A(n,e);var t=p(n);function n(e){var i;r(this,n),(i=t.call(this,e)).enabled=!0,i.viewer=e,i.camera=e.camera,i.viewer.camera.controller=d(i),xf.isMobile?i.dblClickHandler=function(e){1===e.touches.length&&(e.timeStamp-Gg<250&&this._dblClickHandler(e.touches[0]),Gg=e.timeStamp)}.bind(d(i)):i.dblClickHandler=i._dblClickHandler.bind(d(i)),e.container.addEventListener("dblclick",i.dblClickHandler),e.container.addEventListener("touchstart",i.dblClickHandler),e.container.position="relative";var a=e.containerRect,o=a.width,s=a.height;return(Eg=new Image).src="data:image/png;base64,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",Eg.style.position="absolute",Eg.style.width="30px",Eg.style.height="30px",Eg.style.top=s/2-15+"px",Eg.style.left=o/2-15+"px",Eg.style.display="none",(Sg=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAAwCAYAAACmCaIKAAAAAXNSR0IArs4c6QAAAT5JREFUaEPtWsENwjAMvFuHXeAHI/BjBmAFeMEK/GAoxjCKKKgfmrqiVpRcX0i9ND2f7ZrYBAAzOwHYpd8jrw3J20js7DAz2wK4ODZ6kFzRzO4AlgAOYxeTPI7FRuHMbO/YK3E9J/KWiJdIyEHGBe0MdRB5KV9gHLt82QGW26c8p4SnbF/et9sRxi6oYr4X80WVqy4ZJ4A/5TAnrK1michXI6WTiJR3GqwauJSvRkonkVDlzWwNYDHwjk+SVyeHyfBo8unUaPAiGfZOYRslxkP/IL/1tsjn/OM/96X8f+yYf4rc/sfBiWL+bZiwUAzbqJftm/3UtVvk5FNiLCLU7WOp5XcT+byN6kRI+Tp1zbNqW/mu3m6zaaEurbq06tLmU2QFCLWoNZaiIURNYBY3TztXbu0nvHYHj7uztSZHzl/kIiMOWht+IQAAAABJRU5ErkJggg==",Sg.style.position="absolute",Sg.style.width="30px",Sg.style.height="30px",Sg.style.top=s/2-15+"px",Sg.style.left=o/2-15+"px",Sg.style.display="none",e.container.appendChild(Eg),e.container.appendChild(Sg),e.container.addEventListener(xf.isMobile?"touchstart":"mousedown",(function(e){i.enabled&&(0===e.button||e.touches&&1===e.touches.length)&&(Tg&&clearTimeout(Tg),Tg=setTimeout((function(){Eg.style.display="block"}),200))})),e.container.addEventListener(xf.isMobile?"touchend":"mouseup",(function(e){i.enabled&&(0===e.button||e.touches)&&(Tg&&(clearTimeout(Tg),Tg=null),Eg.style.display="none")})),window.addEventListener("resize",(function(){if(i.enabled){var e=i.viewer.container.getBoundingClientRect(),t=e.width,n=e.height;Eg.style.top=n/2+"px",Eg.style.left=t/2+"px"}})),i}return o(n,[{key:"update",value:function(){this.enabled&&this._update()}},{key:"_dblClickHandler",value:function(e){var t=this;if(this.enabled){var n=v(this.viewer.picker.rayIntersect(e),1)[0];if(n){var i=n.point,r=this.viewer.picker.vectorToScreen(i),a=(new tt).subVectors(this.camera.position,this.target);a=(new tt).addScaledVector(a,.8);var o=(new tt).addVectors(i,a);this.tween&&this.tween.stop();var s={tx:this.target.x,ty:this.target.y,tz:this.target.z,px:this.camera.position.x,py:this.camera.position.y,pz:this.camera.position.z,cx:r.x-15,cy:r.y-15};this.tween=new Ku.Tween(s).to({tx:i.x,ty:i.y,tz:i.z,px:o.x,py:o.y,pz:o.z,cx:this.viewer.containerRect.width/2-15,cy:this.viewer.containerRect.height/2-15},1e3).onUpdate((function(){t.target.set(s.tx,s.ty,s.tz),t.camera.position.set(s.px,s.py,s.pz),Sg.style.top=s.cy+"px",Sg.style.left=s.cx+"px"})).easing(Ku.Easing.Cubic.InOut).onComplete((function(){Sg.style.display="none"})).repeat(0).start(),Sg.style.display="block"}}}},{key:"setPosition",value:function(e,t,n){this.object.position.set(e,t,n),this.dispatchEvent("change")}},{key:"setTarget",value:function(e,t,n){this.target.set(e,t,n),this.dispatchEvent("change")}}]),n}(zf),Hg=function(){function e(t,n,i,a){var o=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:50,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:50;r(this,e),this.viewer=t,this.camera=new El(i/-2,i/2,a/2,a/-2,.1,1e3),this.camera.position.set(0,0,1),this.bottom=s,this.left=A;var l=(new KA).load(n,(function(){l.wrapT=l.wrapS=G,l.repeat.multiplyScalar(.994),o.planeWidth=176,o.planeHeight=60;var e=new Ki(o.planeWidth,o.planeHeight);o.plane=new xi(e,new kn({map:l,transparent:!0})),o.fitCamera(),o.camera.position.y=-a/2+o.bottom+o.planeHeight/2,o.camera.position.x=-i/2+o.left}));this.viewer.renderManager.getRenderer().autoClear=!1,this.viewer.renderManager.addBeforeRenderTask((function(e,t,n){o.onBeforeRender(e,t,n)})),this.viewer.renderManager.addAfterRenderTask((function(e,t,n){o.onAfterRender(e,t,n)}))}return o(e,[{key:"onBeforeRender",value:function(e,t,n){this.viewer.renderManager.getRenderer().clear(),this.plane&&e.domElement.width/e.domElement.height!==this.camera.aspect&&this.onResize(e.domElement.width,e.domElement.height)}},{key:"onAfterRender",value:function(){this.plane&&this.viewer.renderManager.getRenderer().render(this.plane,this.camera)}},{key:"fitCamera",value:function(){var e,t=(new Jt).setFromObject(this.plane).getSize(new tt),n=this.planeWidth/t.x,i=this.planeHeight/t.y;t.x>=t.y?(e=n)*t.y>this.planeHeight&&(e=i):(e=i)*t.x>this.planeWidth&&(e=n),this.camera.zoom=e,this.camera.updateProjectionMatrix()}},{key:"onResize",value:function(e,t){this.camera.aspect=e/t,this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix(),this.camera.position.y=-t/2+this.bottom+this.planeHeight/2,this.camera.position.x=e/2-this.left-this.planeWidth/2}}]),e}(),zg=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),(i=t.call(this,e,a))._hotSpotManager=null,i._effectManager=null,i._largeSceneLoader=null,i._largeSceneLoader2=null,i._largeSceneControls=null,i._controls=null,i}return o(n,[{key:"hotSpotManager",get:function(){return this._hotSpotManager||(this._hotSpotManager=new om(this)),this._hotSpotManager}},{key:"effectManager",get:function(){return this._effectManager||(this._effectManager=new eg(this)),this._effectManager}},{key:"largeSceneLoader",get:function(){return this._largeSceneLoader||(this._largeSceneLoader=new wg(this)),this._largeSceneLoader}},{key:"largeSceneLoader2",get:function(){return this._largeSceneLoader2||(this._largeSceneLoader2=new Ng(this)),this._largeSceneLoader2}},{key:"enableLargeSceneControls",get:function(){return this._enableLargeSceneControls||!1},set:function(e){e!=this._enableLargeSceneControls&&(e?(this._controls=this.controls,this._controls.enabled=!1,this._largeSceneControls||(this._largeSceneControls=new Qg(this),this.renderManager.addAfterRenderTask(this._largeSceneControls.update.bind(this._largeSceneControls))),this._largeSceneControls.enabled=!0,this.controls=this._largeSceneControls):(this.controls=this._controls,this._controls.enabled=!0,this._largeSceneControls.enabled=!1))}},{key:"addWatermark",value:function(e){new Hg(this,e,this.containerRect.width,this.containerRect.height)}}]),n}(em);var Vg=6378137,jg=.0066943799901413165,Wg=484813681109536e-20,Xg=Math.PI/2,Zg=1e-10,Yg=.017453292519943295,Kg=57.29577951308232,Jg=Math.PI/4,qg=2*Math.PI,$g=3.14159265359,ev={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},tv={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},nv=/[\s_\-\/\(\)]/g;function iv(e,t){if(e[t])return e[t];for(var n,i=Object.keys(e),r=t.toLowerCase().replace(nv,""),a=-1;++a<i.length;)if((n=i[a]).toLowerCase().replace(nv,"")===r)return e[n]}function rv(e){var t,n,i,r={},a=e.split("+").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var n=t.split("=");return n.push(!0),e[n[0].toLowerCase()]=n[1],e}),{}),o={proj:"projName",datum:"datumCode",rf:function(e){r.rf=parseFloat(e)},lat_0:function(e){r.lat0=e*Yg},lat_1:function(e){r.lat1=e*Yg},lat_2:function(e){r.lat2=e*Yg},lat_ts:function(e){r.lat_ts=e*Yg},lon_0:function(e){r.long0=e*Yg},lon_1:function(e){r.long1=e*Yg},lon_2:function(e){r.long2=e*Yg},alpha:function(e){r.alpha=parseFloat(e)*Yg},gamma:function(e){r.rectified_grid_angle=parseFloat(e)},lonc:function(e){r.longc=e*Yg},x_0:function(e){r.x0=parseFloat(e)},y_0:function(e){r.y0=parseFloat(e)},k_0:function(e){r.k0=parseFloat(e)},k:function(e){r.k0=parseFloat(e)},a:function(e){r.a=parseFloat(e)},b:function(e){r.b=parseFloat(e)},r_a:function(){r.R_A=!0},zone:function(e){r.zone=parseInt(e,10)},south:function(){r.utmSouth=!0},towgs84:function(e){r.datum_params=e.split(",").map((function(e){return parseFloat(e)}))},to_meter:function(e){r.to_meter=parseFloat(e)},units:function(e){r.units=e;var t=iv(tv,e);t&&(r.to_meter=t.to_meter)},from_greenwich:function(e){r.from_greenwich=e*Yg},pm:function(e){var t=iv(ev,e);r.from_greenwich=(t||parseFloat(e))*Yg},nadgrids:function(e){"@null"===e?r.datumCode="none":r.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(r.axis=e)},approx:function(){r.approx=!0}};for(t in a)n=a[t],t in o?"function"==typeof(i=o[t])?i(n):r[i]=n:r[t]=n;return"string"==typeof r.datumCode&&"WGS84"!==r.datumCode&&(r.datumCode=r.datumCode.toLowerCase()),r}var av=/\s/,ov=/[A-Za-z]/,sv=/[A-Za-z84_]/,Av=/[,\]]/,lv=/[\d\.E\-\+]/;function cv(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function hv(e,t,n){Array.isArray(t)&&(n.unshift(t),t=null);var i=t?{}:e,r=n.reduce((function(e,t){return uv(t,e),e}),i);t&&(e[t]=r)}function uv(e,t){if(Array.isArray(e)){var n=e.shift();if("PARAMETER"===n&&(n=e.shift()),1===e.length)return Array.isArray(e[0])?(t[n]={},void uv(e[0],t[n])):void(t[n]=e[0]);if(e.length)if("TOWGS84"!==n){if("AXIS"===n)return n in t||(t[n]=[]),void t[n].push(e);var i;switch(Array.isArray(n)||(t[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[n]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&uv(e[2],t[n]));case"SPHEROID":case"ELLIPSOID":return t[n]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&uv(e[3],t[n]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void hv(t,n,e);default:for(i=-1;++i<e.length;)if(!Array.isArray(e[i]))return uv(e,t[n]);return hv(t,n,e)}}else t[n]=e;else t[n]=!0}else t[e]=!0}cv.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;av.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case 1:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},cv.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(Av.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},cv.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},cv.prototype.number=function(e){if(!lv.test(e)){if(Av.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},cv.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},cv.prototype.keyword=function(e){if(sv.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=1)}if(!Av.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},cv.prototype.neutral=function(e){if(ov.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(lv.test(e))return this.word=e,void(this.state=3);if(!Av.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},cv.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function dv(e){return.017453292519943295*e}function fv(e){var t=new cv(e).output(),n=t.shift(),i=t.shift();t.unshift(["name",i]),t.unshift(["type",n]);var r={};return uv(t,r),function(e){if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var t="",n=0,i=e.AXIS.length;n<i;++n){var r=[e.AXIS[n][0].toLowerCase(),e.AXIS[n][1].toLowerCase()];-1!==r[0].indexOf("north")||("y"===r[0]||"lat"===r[0])&&"north"===r[1]?t+="n":-1!==r[0].indexOf("south")||("y"===r[0]||"lat"===r[0])&&"south"===r[1]?t+="s":-1!==r[0].indexOf("east")||("x"===r[0]||"lon"===r[0])&&"east"===r[1]?t+="e":-1===r[0].indexOf("west")&&("x"!==r[0]&&"lon"!==r[0]||"west"!==r[1])||(t+="w")}2===t.length&&(t+="u"),3===t.length&&(e.axis=t)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var a=e.GEOGCS;function o(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(a=e),a&&(a.DATUM?e.datumCode=a.DATUM.name.toLowerCase():e.datumCode=a.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(e.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=a.DATUM.SPHEROID.a,e.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(e.datum_params=a.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",dv],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",dv],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",dv],["lat0","latitude_of_origin",dv],["lat0","standard_parallel_1",dv],["lat1","standard_parallel_1",dv],["lat2","standard_parallel_2",dv],["azimuth","Azimuth"],["alpha","azimuth",dv],["srsCode","name"]].forEach((function(t){return function(e,t){var n=t[0],i=t[1];!(n in e)&&i in e&&(e[n]=e[i],3===t.length&&(e[n]=t[2](e[n])))}(e,t)})),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=dv(e.lat1>0?90:-90),e.lat_ts=e.lat1)}(r),r}function pv(e){var t=this;if(2===arguments.length){var n=arguments[1];"string"==typeof n?"+"===n.charAt(0)?pv[e]=rv(arguments[1]):pv[e]=fv(arguments[1]):pv[e]=n}else if(1===arguments.length){if(Array.isArray(e))return e.map((function(e){Array.isArray(e)?pv.apply(t,e):pv(e)}));if("string"==typeof e){if(e in pv)return pv[e]}else"EPSG"in e?pv["EPSG:"+e.EPSG]=e:"ESRI"in e?pv["ESRI:"+e.ESRI]=e:"IAU2000"in e?pv["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(pv);var mv=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var gv=["3857","900913","3785","102113"];function vv(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in pv}(e))return pv[e];if(function(e){return mv.some((function(t){return e.indexOf(t)>-1}))}(e)){var t=fv(e);if(function(e){var t=iv(e,"authority");if(t){var n=iv(t,"epsg");return n&&gv.indexOf(n)>-1}}(t))return pv["EPSG:3857"];var n=function(e){var t=iv(e,"extension");if(t)return iv(t,"proj4")}(t);return n?rv(n):t}return function(e){return"+"===e[0]}(e)?rv(e):void 0}function yv(e,t){var n,i;if(e=e||{},!t)return e;for(i in t)void 0!==(n=t[i])&&(e[i]=n);return e}function wv(e,t,n){var i=e*t;return n/Math.sqrt(1-i*i)}function xv(e){return e<0?-1:1}function bv(e){return Math.abs(e)<=$g?e:e-xv(e)*qg}function Cv(e,t,n){var i=e*n,r=.5*e;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(Xg-t))/i}function Mv(e,t){for(var n,i,r=.5*e,a=Xg-2*Math.atan(t),o=0;o<=15;o++)if(n=e*Math.sin(a),a+=i=Xg-2*Math.atan(t*Math.pow((1-n)/(1+n),r))-a,Math.abs(i)<=1e-10)return a;return-9999}function Bv(e){return e}var Iv=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=wv(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,n,i=e.x,r=e.y;if(r*Kg>90&&r*Kg<-90&&i*Kg>180&&i*Kg<-180)return null;if(Math.abs(Math.abs(r)-Xg)<=Zg)return null;if(this.sphere)t=this.x0+this.a*this.k0*bv(i-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(Jg+.5*r));else{var a=Math.sin(r),o=Cv(this.e,r,a);t=this.x0+this.a*this.k0*bv(i-this.long0),n=this.y0-this.a*this.k0*Math.log(o)}return e.x=t,e.y=n,e},inverse:function(e){var t,n,i=e.x-this.x0,r=e.y-this.y0;if(this.sphere)n=Xg-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var a=Math.exp(-r/(this.a*this.k0));if(-9999===(n=Mv(this.e,a)))return null}return t=bv(this.long0+i/(this.a*this.k0)),e.x=t,e.y=n,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Bv,inverse:Bv,names:["longlat","identity"]}],Ev={},Sv=[];function Tv(e,t){var n=Sv.length;return e.names?(Sv[n]=e,e.names.forEach((function(e){Ev[e.toLowerCase()]=n})),this):(console.log(t),!0)}var Lv={start:function(){Iv.forEach(Tv)},add:Tv,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==Ev[t]&&Sv[Ev[t]]?Sv[Ev[t]]:void 0}},Fv={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},_v=Fv.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Fv.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Uv={};Uv.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Uv.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Uv.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Uv.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Uv.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Uv.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Uv.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Uv.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},Uv.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Uv.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Uv.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Uv.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Uv.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Uv.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Uv.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Uv.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Uv.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var Pv={};function kv(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:Pv[e]||null,isNull:!1}}function Dv(e){return e/3600*Math.PI/180}function Rv(e,t,n){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,n)))}function Ov(e){return e.map((function(e){return[Dv(e.longitudeShift),Dv(e.latitudeShift)]}))}function Nv(e,t,n){return{name:Rv(e,t+8,t+16).trim(),parent:Rv(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,n),upperLatitude:e.getFloat64(t+88,n),lowerLongitude:e.getFloat64(t+104,n),upperLongitude:e.getFloat64(t+120,n),latitudeInterval:e.getFloat64(t+136,n),longitudeInterval:e.getFloat64(t+152,n),gridNodeCount:e.getInt32(t+168,n)}}function Gv(e,t,n,i){for(var r=t+176,a=[],o=0;o<n.gridNodeCount;o++){var s={latitudeShift:e.getFloat32(r+16*o,i),longitudeShift:e.getFloat32(r+16*o+4,i),latitudeAccuracy:e.getFloat32(r+16*o+8,i),longitudeAccuracy:e.getFloat32(r+16*o+12,i)};a.push(s)}return a}function Qv(e,t){if(!(this instanceof Qv))return new Qv(e);t=t||function(e){if(e)throw e};var n=vv(e);if("object"==typeof n){var i=Qv.projections.get(n.projName);if(i){if(n.datumCode&&"none"!==n.datumCode){var r=iv(Uv,n.datumCode);r&&(n.datum_params=n.datum_params||(r.towgs84?r.towgs84.split(","):null),n.ellps=r.ellipse,n.datumName=r.datumName?r.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84",n.lat1=n.lat1||n.lat0;var a=function(e,t,n,i,r){if(!e){var a=iv(Fv,i);a||(a=_v),e=a.a,t=a.b,n=a.rf}return n&&!t&&(t=(1-1/n)*e),(0===n||Math.abs(e-t)<Zg)&&(r=!0,t=e),{a:e,b:t,rf:n,sphere:r}}(n.a,n.b,n.rf,n.ellps,n.sphere),o=function(e,t,n,i){var r=e*e,a=t*t,o=(r-a)/r,s=0;return i?(r=(e*=1-o*(.16666666666666666+o*(.04722222222222222+.022156084656084655*o)))*e,o=0):s=Math.sqrt(o),{es:o,e:s,ep2:(r-a)/a}}(a.a,a.b,a.rf,n.R_A),s=function(e){return void 0===e?null:e.split(",").map(kv)}(n.nadgrids),A=n.datum||function(e,t,n,i,r,a,o){var s={};return s.datum_type=void 0===e||"none"===e?5:4,t&&(s.datum_params=t.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=1),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=2,s.datum_params[3]*=Wg,s.datum_params[4]*=Wg,s.datum_params[5]*=Wg,s.datum_params[6]=s.datum_params[6]/1e6+1))),o&&(s.datum_type=3,s.grids=o),s.a=n,s.b=i,s.es=r,s.ep2=a,s}(n.datumCode,n.datum_params,a.a,a.b,o.es,o.ep2,s);yv(this,n),yv(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=A,this.init(),t(null,this)}else t(e)}else t(e)}function Hv(e,t,n){var i,r,a,o,s=e.x,A=e.y,l=e.z?e.z:0;if(A<-Xg&&A>-1.001*Xg)A=-Xg;else if(A>Xg&&A<1.001*Xg)A=Xg;else{if(A<-Xg)return{x:-1/0,y:-1/0,z:e.z};if(A>Xg)return{x:1/0,y:1/0,z:e.z}}return s>Math.PI&&(s-=2*Math.PI),r=Math.sin(A),o=Math.cos(A),a=r*r,{x:((i=n/Math.sqrt(1-t*a))+l)*o*Math.cos(s),y:(i+l)*o*Math.sin(s),z:(i*(1-t)+l)*r}}function zv(e,t,n,i){var r,a,o,s,A,l,c,h,u,d,f,p,m,g,v,y=1e-12,w=e.x,x=e.y,b=e.z?e.z:0;if(r=Math.sqrt(w*w+x*x),a=Math.sqrt(w*w+x*x+b*b),r/n<y){if(g=0,a/n<y)return Xg,v=-i,{x:e.x,y:e.y,z:e.z}}else g=Math.atan2(x,w);o=b/a,h=(s=r/a)*(1-t)*(A=1/Math.sqrt(1-t*(2-t)*s*s)),u=o*A,m=0;do{m++,l=t*(c=n/Math.sqrt(1-t*u*u))/(c+(v=r*h+b*u-c*(1-t*u*u))),p=(f=o*(A=1/Math.sqrt(1-l*(2-l)*s*s)))*h-(d=s*(1-l)*A)*u,h=d,u=f}while(p*p>1e-24&&m<30);return{x:g,y:Math.atan(f/Math.abs(d)),z:v}}function Vv(e){return 1===e||2===e}function jv(e,t,n){if(function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t))return n;if(5===e.datum_type||5===t.datum_type)return n;var i=e.a,r=e.es;if(3===e.datum_type){if(0!==Wv(e,!1,n))return;i=Vg,r=jg}var a=t.a,o=t.b,s=t.es;if(3===t.datum_type&&(a=Vg,o=6356752.314,s=jg),r===s&&i===a&&!Vv(e.datum_type)&&!Vv(t.datum_type))return n;if((n=Hv(n,r,i),Vv(e.datum_type)&&(n=function(e,t,n){if(1===t)return{x:e.x+n[0],y:e.y+n[1],z:e.z+n[2]};if(2===t){var i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],A=n[5],l=n[6];return{x:l*(e.x-A*e.y+s*e.z)+i,y:l*(A*e.x+e.y-o*e.z)+r,z:l*(-s*e.x+o*e.y+e.z)+a}}}(n,e.datum_type,e.datum_params)),Vv(t.datum_type)&&(n=function(e,t,n){if(1===t)return{x:e.x-n[0],y:e.y-n[1],z:e.z-n[2]};if(2===t){var i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],A=n[5],l=n[6],c=(e.x-i)/l,h=(e.y-r)/l,u=(e.z-a)/l;return{x:c+A*h-s*u,y:-A*c+h+o*u,z:s*c-o*h+u}}}(n,t.datum_type,t.datum_params)),n=zv(n,s,a,o),3===t.datum_type)&&0!==Wv(t,!0,n))return;return n}function Wv(e,t,n){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;for(var i={x:-n.x,y:n.y},r={x:Number.NaN,y:Number.NaN},a=[],o=0;o<e.grids.length;o++){var s=e.grids[o];if(a.push(s.name),s.isNull){r=i;break}if(s.mandatory,null!==s.grid){var A=s.grid.subgrids[0],l=(Math.abs(A.del[1])+Math.abs(A.del[0]))/1e4,c=A.ll[0]-l,h=A.ll[1]-l,u=A.ll[0]+(A.lim[0]-1)*A.del[0]+l,d=A.ll[1]+(A.lim[1]-1)*A.del[1]+l;if(!(h>i.y||c>i.x||d<i.y||u<i.x||(r=Xv(i,t,A),isNaN(r.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Kg+" "+i.y*Kg+" tried: '"+a+"'"),-1):(n.x=-r.x,n.y=r.y,0)}function Xv(e,t,n){var i={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return i;var r={x:e.x,y:e.y};r.x-=n.ll[0],r.y-=n.ll[1],r.x=bv(r.x-Math.PI)+Math.PI;var a=Zv(r,n);if(t){if(isNaN(a.x))return i;a.x=r.x-a.x,a.y=r.y-a.y;var o,s,A=9;do{if(s=Zv(a,n),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}o={x:r.x-(s.x+a.x),y:r.y-(s.y+a.y)},a.x+=o.x,a.y+=o.y}while(A--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(A<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=bv(a.x+n.ll[0]),i.y=a.y+n.ll[1]}else isNaN(a.x)||(i.x=e.x+a.x,i.y=e.y+a.y);return i}function Zv(e,t){var n,i={x:e.x/t.del[0],y:e.y/t.del[1]},r=Math.floor(i.x),a=Math.floor(i.y),o=i.x-1*r,s=i.y-1*a,A={x:Number.NaN,y:Number.NaN};if(r<0||r>=t.lim[0])return A;if(a<0||a>=t.lim[1])return A;n=a*t.lim[0]+r;var l=t.cvs[n][0],c=t.cvs[n][1];n++;var h=t.cvs[n][0],u=t.cvs[n][1];n+=t.lim[0];var d=t.cvs[n][0],f=t.cvs[n][1];n--;var p=t.cvs[n][0],m=t.cvs[n][1],g=o*s,v=o*(1-s),y=(1-o)*(1-s),w=(1-o)*s;return A.x=y*l+v*h+w*p+g*d,A.y=y*c+v*u+w*m+g*f,A}function Yv(e,t,n){var i,r,a,o=n.x,s=n.y,A=n.z||0,l={};for(a=0;a<3;a++)if(!t||2!==a||void 0!==n.z)switch(0===a?(i=o,r=-1!=="ew".indexOf(e.axis[a])?"x":"y"):1===a?(i=s,r=-1!=="ns".indexOf(e.axis[a])?"y":"x"):(i=A,r="z"),e.axis[a]){case"e":l[r]=i;break;case"w":l[r]=-i;break;case"n":l[r]=i;break;case"s":l[r]=-i;break;case"u":void 0!==n[r]&&(l.z=i);break;case"d":void 0!==n[r]&&(l.z=-i);break;default:return null}return l}function Kv(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function Jv(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function qv(e,t,n,i){var r;if(Array.isArray(n)&&(n=Kv(n)),function(e){Jv(e.x),Jv(e.y)}(n),e.datum&&t.datum&&function(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(n=qv(e,r=new Qv("WGS84"),n,i),e=r),i&&"enu"!==e.axis&&(n=Yv(e,!1,n)),"longlat"===e.projName)n={x:n.x*Yg,y:n.y*Yg,z:n.z||0};else if(e.to_meter&&(n={x:n.x*e.to_meter,y:n.y*e.to_meter,z:n.z||0}),!(n=e.inverse(n)))return;if(e.from_greenwich&&(n.x+=e.from_greenwich),n=jv(e.datum,t.datum,n))return t.from_greenwich&&(n={x:n.x-t.from_greenwich,y:n.y,z:n.z||0}),"longlat"===t.projName?n={x:n.x*Kg,y:n.y*Kg,z:n.z||0}:(n=t.forward(n),t.to_meter&&(n={x:n.x/t.to_meter,y:n.y/t.to_meter,z:n.z||0})),i&&"enu"!==t.axis?Yv(t,!0,n):n}Qv.projections=Lv,Qv.projections.start();var $v=Qv("WGS84");function ey(e,t,n,i){var r,a,o;return Array.isArray(n)?(r=qv(e,t,n,i)||{x:NaN,y:NaN},n.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(n.splice(3)):[r.x,r.y,n[2]].concat(n.splice(3)):[r.x,r.y].concat(n.splice(2)):[r.x,r.y]):(a=qv(e,t,n,i),2===(o=Object.keys(n)).length||o.forEach((function(i){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===i||"y"===i||"z"===i)return}else if("x"===i||"y"===i)return;a[i]=n[i]})),a)}function ty(e){return e instanceof Qv?e:e.oProj?e.oProj:Qv(e)}function ny(e,t,n){e=ty(e);var i,r=!1;return void 0===t?(t=e,e=$v,r=!0):(void 0!==t.x||Array.isArray(t))&&(n=t,t=e,e=$v,r=!0),t=ty(t),n?ey(e,t,n):(i={forward:function(n,i){return ey(e,t,n,i)},inverse:function(n,i){return ey(t,e,n,i)}},r&&(i.oProj=t),i)}var iy="AJSAJS",ry="AFAFAF",ay=65,oy=73,sy=79,Ay=86,ly=90,cy={forward:hy,inverse:function(e){var t=py(vy(e.toUpperCase()));if(t.lat&&t.lon)return[t.lon,t.lat,t.lon,t.lat];return[t.left,t.bottom,t.right,t.top]},toPoint:uy};function hy(e,t){return t=t||5,function(e,t){var n="00000"+e.easting,i="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(d=e.easting,f=e.northing,p=e.zoneNumber,m=gy(p),g=Math.floor(d/1e5),v=Math.floor(f/1e5)%20,r=g,a=v,o=m,s=o-1,A=iy.charCodeAt(s),l=ry.charCodeAt(s),c=A+r-1,h=l+a,u=!1,c>ly&&(c=c-ly+ay-1,u=!0),(c===oy||A<oy&&c>oy||(c>oy||A<oy)&&u)&&c++,(c===sy||A<sy&&c>sy||(c>sy||A<sy)&&u)&&++c===oy&&c++,c>ly&&(c=c-ly+ay-1),h>Ay?(h=h-Ay+ay-1,u=!0):u=!1,(h===oy||l<oy&&h>oy||(h>oy||l<oy)&&u)&&h++,(h===sy||l<sy&&h>sy||(h>sy||l<sy)&&u)&&++h===oy&&h++,h>Ay&&(h=h-Ay+ay-1),String.fromCharCode(c)+String.fromCharCode(h))+n.substr(n.length-5,t)+i.substr(i.length-5,t);var r,a,o,s,A,l,c,h,u;var d,f,p,m,g,v}(function(e){var t,n,i,r,a,o,s,A,l=e.lat,c=e.lon,h=6378137,u=.00669438,d=.9996,f=dy(l),p=dy(c);A=Math.floor((c+180)/6)+1,180===c&&(A=60);l>=56&&l<64&&c>=3&&c<12&&(A=32);l>=72&&l<84&&(c>=0&&c<9?A=31:c>=9&&c<21?A=33:c>=21&&c<33?A=35:c>=33&&c<42&&(A=37));s=dy(6*(A-1)-180+3),t=u/(1-u),n=h/Math.sqrt(1-u*Math.sin(f)*Math.sin(f)),i=Math.tan(f)*Math.tan(f),r=t*Math.cos(f)*Math.cos(f),a=Math.cos(f)*(p-s),o=h*((1-u/4-3*u*u/64-5*u*u*u/256)*f-(3*u/8+3*u*u/32+45*u*u*u/1024)*Math.sin(2*f)+(15*u*u/256+45*u*u*u/1024)*Math.sin(4*f)-35*u*u*u/3072*Math.sin(6*f));var m=d*n*(a+(1-i+r)*a*a*a/6+(5-18*i+i*i+72*r-58*t)*a*a*a*a*a/120)+5e5,g=d*(o+n*Math.tan(f)*(a*a/2+(5-i+9*r+4*r*r)*a*a*a*a/24+(61-58*i+i*i+600*r-330*t)*a*a*a*a*a*a/720));l<0&&(g+=1e7);return{northing:Math.round(g),easting:Math.round(m),zoneNumber:A,zoneLetter:my(l)}}({lat:e[1],lon:e[0]}),t)}function uy(e){var t=py(vy(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function dy(e){return e*(Math.PI/180)}function fy(e){return e/Math.PI*180}function py(e){var t=e.northing,n=e.easting,i=e.zoneLetter,r=e.zoneNumber;if(r<0||r>60)return null;var a,o,s,A,l,c,h,u,d,f=.9996,p=6378137,m=.00669438,g=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),v=n-5e5,y=t;i<"N"&&(y-=1e7),h=6*(r-1)-180+3,a=.006739496752268451,d=(u=y/f/6367449.145945056)+(3*g/2-27*g*g*g/32)*Math.sin(2*u)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*u)+151*g*g*g/96*Math.sin(6*u),o=p/Math.sqrt(1-m*Math.sin(d)*Math.sin(d)),s=Math.tan(d)*Math.tan(d),A=a*Math.cos(d)*Math.cos(d),l=.99330562*p/Math.pow(1-m*Math.sin(d)*Math.sin(d),1.5),c=v/(o*f);var w=d-o*Math.tan(d)/l*(c*c/2-(5+3*s+10*A-4*A*A-9*a)*c*c*c*c/24+(61+90*s+298*A+45*s*s-1.6983531815716497-3*A*A)*c*c*c*c*c*c/720);w=fy(w);var x,b=(c-(1+2*s+A)*c*c*c/6+(5-2*A+28*s-3*A*A+8*a+24*s*s)*c*c*c*c*c/120)/Math.cos(d);if(b=h+fy(b),e.accuracy){var C=py({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});x={top:C.lat,right:C.lon,bottom:w,left:b}}else x={lat:w,lon:b};return x}function my(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function gy(e){var t=e%6;return 0===t&&(t=6),t}function vy(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,n=e.length,i=null,r="",a=0;!/[A-Z]/.test(t=e.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+e;r+=t,a++}var o=parseInt(r,10);if(0===a||a+3>n)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(a++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;i=e.substring(a,a+=2);for(var A=gy(o),l=function(e,t){var n=iy.charCodeAt(t-1),i=1e5,r=!1;for(;n!==e.charCodeAt(0);){if(++n===oy&&n++,n===sy&&n++,n>ly){if(r)throw"Bad character: "+e;n=ay,r=!0}i+=1e5}return i}(i.charAt(0),A),c=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;var n=ry.charCodeAt(t-1),i=0,r=!1;for(;n!==e.charCodeAt(0);){if(++n===oy&&n++,n===sy&&n++,n>Ay){if(r)throw"Bad character: "+e;n=ay,r=!0}i+=1e5}return i}(i.charAt(1),A);c<yy(s);)c+=2e6;var h=n-a;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var u,d,f,p=h/2,m=0,g=0;return p>0&&(u=1e5/Math.pow(10,p),d=e.substring(a,a+p),m=parseFloat(d)*u,f=e.substring(a+p),g=parseFloat(f)*u),{easting:m+l,northing:g+c,zoneLetter:s,zoneNumber:o,accuracy:u}}function yy(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function wy(e,t,n){if(!(this instanceof wy))return new wy(e,t,n);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var i=e.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=e,this.y=t,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}wy.fromMGRS=function(e){return new wy(uy(e))},wy.prototype.toMGRS=function(e){return hy([this.x,this.y],e)};var xy=.046875,by=.01953125,Cy=.01068115234375;function My(e){var t=[];t[0]=1-e*(.25+e*(xy+e*(by+e*Cy))),t[1]=e*(.75-e*(xy+e*(by+e*Cy)));var n=e*e;return t[2]=n*(.46875-e*(.013020833333333334+.007120768229166667*e)),n*=e,t[3]=n*(.3645833333333333-.005696614583333333*e),t[4]=n*e*.3076171875,t}function By(e,t,n,i){return n*=t,t*=t,i[0]*e-n*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}function Iy(e,t,n){for(var i=1/(1-t),r=e,a=20;a;--a){var o=Math.sin(r),s=1-t*o*o;if(r-=s=(By(r,o,Math.cos(r),n)-e)*(s*Math.sqrt(s))*i,Math.abs(s)<Zg)return r}return r}var Ey={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=My(this.es),this.ml0=By(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,n,i,r=e.x,a=e.y,o=bv(r-this.long0),s=Math.sin(a),A=Math.cos(a);if(this.es){var l=A*o,c=Math.pow(l,2),h=this.ep2*Math.pow(A,2),u=Math.pow(h,2),d=Math.abs(A)>Zg?Math.tan(a):0,f=Math.pow(d,2),p=Math.pow(f,2);t=1-this.es*Math.pow(s,2),l/=Math.sqrt(t);var m=By(a,s,A,this.en);n=this.a*(this.k0*l*(1+c/6*(1-f+h+c/20*(5-18*f+p+14*h-58*f*h+c/42*(61+179*p-p*f-479*f)))))+this.x0,i=this.a*(this.k0*(m-this.ml0+s*o*l/2*(1+c/12*(5-f+9*h+4*u+c/30*(61+p-58*f+270*h-330*f*h+c/56*(1385+543*p-p*f-3111*f))))))+this.y0}else{var g=A*Math.sin(o);if(Math.abs(Math.abs(g)-1)<Zg)return 93;if(n=.5*this.a*this.k0*Math.log((1+g)/(1-g))+this.x0,i=A*Math.cos(o)/Math.sqrt(1-Math.pow(g,2)),(g=Math.abs(i))>=1){if(g-1>Zg)return 93;i=0}else i=Math.acos(i);a<0&&(i=-i),i=this.a*this.k0*(i-this.lat0)+this.y0}return e.x=n,e.y=i,e},inverse:function(e){var t,n,i,r,a=(e.x-this.x0)*(1/this.a),o=(e.y-this.y0)*(1/this.a);if(this.es)if(n=Iy(t=this.ml0+o/this.k0,this.es,this.en),Math.abs(n)<Xg){var s=Math.sin(n),A=Math.cos(n),l=Math.abs(A)>Zg?Math.tan(n):0,c=this.ep2*Math.pow(A,2),h=Math.pow(c,2),u=Math.pow(l,2),d=Math.pow(u,2);t=1-this.es*Math.pow(s,2);var f=a*Math.sqrt(t)/this.k0,p=Math.pow(f,2);i=n-(t*=l)*p/(1-this.es)*.5*(1-p/12*(5+3*u-9*c*u+c-4*h-p/30*(61+90*u-252*c*u+45*d+46*c-p/56*(1385+3633*u+4095*d+1574*d*u)))),r=bv(this.long0+f*(1-p/6*(1+2*u+c-p/20*(5+28*u+24*d+8*c*u+6*c-p/42*(61+662*u+1320*d+720*d*u))))/A)}else i=Xg*xv(o),r=0;else{var m=Math.exp(a/this.k0),g=.5*(m-1/m),v=this.lat0+o/this.k0,y=Math.cos(v);t=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(g,2))),i=Math.asin(t),o<0&&(i=-i),r=0===g&&0===y?0:bv(Math.atan2(g,y)+this.long0)}return e.x=r,e.y=i,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Sy(e){var t=Math.exp(e);return t=(t-1/t)/2}function Ty(e,t){e=Math.abs(e),t=Math.abs(t);var n=Math.max(e,t),i=Math.min(e,t)/(n||1);return n*Math.sqrt(1+Math.pow(i,2))}function Ly(e){var t=Math.abs(e);return t=function(e){var t=1+e,n=t-1;return 0===n?e:e*Math.log(t)/n}(t*(1+t/(Ty(1,t)+1))),e<0?-t:t}function Fy(e,t){for(var n,i=2*Math.cos(2*t),r=e.length-1,a=e[r],o=0;--r>=0;)n=i*a-o+e[r],o=a,a=n;return t+n*Math.sin(2*t)}function _y(e,t,n){for(var i,r,a=Math.sin(t),o=Math.cos(t),s=Sy(n),A=function(e){var t=Math.exp(e);return(t+1/t)/2}(n),l=2*o*A,c=-2*a*s,h=e.length-1,u=e[h],d=0,f=0,p=0;--h>=0;)i=f,r=d,u=l*(f=u)-i-c*(d=p)+e[h],p=c*f-r+l*d;return[(l=a*A)*u-(c=o*s)*p,l*p+c*u]}var Uy={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ey.init.apply(this),this.forward=Ey.forward,this.inverse=Ey.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),n=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),n*=t,this.cgb[1]=n*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=n*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),n*=t,this.cgb[2]=n*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=n*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),n*=t,this.cgb[3]=n*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=n*(1237/630+t*(t*(-24832/14175)-2.4)),n*=t,this.cgb[4]=n*(4174/315+t*(-144838/6237)),this.cbg[4]=n*(-734/315+t*(109598/31185)),n*=t,this.cgb[5]=n*(601676/22275),this.cbg[5]=n*(444337/155925),n=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=n*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=n*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),n*=t,this.utg[2]=n*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=n*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),n*=t,this.utg[3]=n*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=n*(49561/161280+t*(-179/168+t*(6601661/7257600))),n*=t,this.utg[4]=n*(-4583/161280+t*(108847/3991680)),this.gtu[4]=n*(34729/80640+t*(-3418889/1995840)),n*=t,this.utg[5]=n*(-20648693/638668800),this.gtu[5]=.6650675310896665*n;var i=Fy(this.cbg,this.lat0);this.Zb=-this.Qn*(i+function(e,t){for(var n,i=2*Math.cos(t),r=e.length-1,a=e[r],o=0;--r>=0;)n=i*a-o+e[r],o=a,a=n;return Math.sin(t)*n}(this.gtu,2*i))},forward:function(e){var t=bv(e.x-this.long0),n=e.y;n=Fy(this.cbg,n);var i=Math.sin(n),r=Math.cos(n),a=Math.sin(t),o=Math.cos(t);n=Math.atan2(i,o*r),t=Math.atan2(a*r,Ty(i,r*o)),t=Ly(Math.tan(t));var s,A,l=_y(this.gtu,2*n,2*t);return n+=l[0],t+=l[1],Math.abs(t)<=2.623395162778?(s=this.a*(this.Qn*t)+this.x0,A=this.a*(this.Qn*n+this.Zb)+this.y0):(s=1/0,A=1/0),e.x=s,e.y=A,e},inverse:function(e){var t,n,i=(e.x-this.x0)*(1/this.a),r=(e.y-this.y0)*(1/this.a);if(r=(r-this.Zb)/this.Qn,i/=this.Qn,Math.abs(i)<=2.623395162778){var a=_y(this.utg,2*r,2*i);r+=a[0],i+=a[1],i=Math.atan(Sy(i));var o=Math.sin(r),s=Math.cos(r),A=Math.sin(i),l=Math.cos(i);r=Math.atan2(o*l,Ty(A,l*s)),t=bv((i=Math.atan2(A,l*s))+this.long0),n=Fy(this.cgb,r)}else t=1/0,n=1/0;return e.x=t,e.y=n,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};var Py={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(bv(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*Yg,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Uy.init.apply(this),this.forward=Uy.forward,this.inverse=Uy.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function ky(e,t){return Math.pow((1-e)/(1+e),t)}var Dy={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Jg)/(Math.pow(Math.tan(.5*this.lat0+Jg),this.C)*ky(this.e*e,this.ratexp))},forward:function(e){var t=e.x,n=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+Jg),this.C)*ky(this.e*Math.sin(n),this.ratexp))-Xg,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,n=e.y,i=Math.pow(Math.tan(.5*n+Jg)/this.K,1/this.C),r=20;r>0&&(n=2*Math.atan(i*ky(this.e*Math.sin(e.y),-.5*this.e))-Xg,!(Math.abs(n-e.y)<1e-14));--r)e.y=n;return r?(e.x=t,e.y=n,e):null},names:["gauss"]};var Ry={init:function(){Dy.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,n,i,r;return e.x=bv(e.x-this.long0),Dy.forward.apply(this,[e]),t=Math.sin(e.y),n=Math.cos(e.y),i=Math.cos(e.x),r=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*i),e.x=r*n*Math.sin(e.x),e.y=r*(this.cosc0*t-this.sinc0*n*i),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,n,i,r,a;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,a=Math.sqrt(e.x*e.x+e.y*e.y)){var o=2*Math.atan2(a,this.R2);t=Math.sin(o),n=Math.cos(o),r=Math.asin(n*this.sinc0+e.y*t*this.cosc0/a),i=Math.atan2(e.x*t,a*this.cosc0*n-e.y*this.sinc0*t)}else r=this.phic0,i=0;return e.x=i,e.y=r,Dy.inverse.apply(this,[e]),e.x=bv(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var Oy={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Zg&&(this.k0=.5*(1+xv(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Zg&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Zg&&(this.k0=.5*this.cons*wv(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Cv(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=wv(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Xg,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,n,i,r,a,o,s=e.x,A=e.y,l=Math.sin(A),c=Math.cos(A),h=bv(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=Zg&&Math.abs(A+this.lat0)<=Zg?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*l+this.coslat0*c*Math.cos(h)),e.x=this.a*t*c*Math.sin(h)+this.x0,e.y=this.a*t*(this.coslat0*l-this.sinlat0*c*Math.cos(h))+this.y0,e):(n=2*Math.atan(this.ssfn_(A,l,this.e))-Xg,r=Math.cos(n),i=Math.sin(n),Math.abs(this.coslat0)<=Zg?(a=Cv(this.e,A*this.con,this.con*l),o=2*this.a*this.k0*a/this.cons,e.x=this.x0+o*Math.sin(s-this.long0),e.y=this.y0-this.con*o*Math.cos(s-this.long0),e):(Math.abs(this.sinlat0)<Zg?(t=2*this.a*this.k0/(1+r*Math.cos(h)),e.y=t*i):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*i+this.cosX0*r*Math.cos(h))),e.y=t*(this.cosX0*i-this.sinX0*r*Math.cos(h))+this.y0),e.x=t*r*Math.sin(h)+this.x0,e))},inverse:function(e){var t,n,i,r,a;e.x-=this.x0,e.y-=this.y0;var o=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var s=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,n=this.lat0,o<=Zg?(e.x=t,e.y=n,e):(n=Math.asin(Math.cos(s)*this.sinlat0+e.y*Math.sin(s)*this.coslat0/o),t=Math.abs(this.coslat0)<Zg?this.lat0>0?bv(this.long0+Math.atan2(e.x,-1*e.y)):bv(this.long0+Math.atan2(e.x,e.y)):bv(this.long0+Math.atan2(e.x*Math.sin(s),o*this.coslat0*Math.cos(s)-e.y*this.sinlat0*Math.sin(s))),e.x=t,e.y=n,e)}if(Math.abs(this.coslat0)<=Zg){if(o<=Zg)return n=this.lat0,t=this.long0,e.x=t,e.y=n,e;e.x*=this.con,e.y*=this.con,i=o*this.cons/(2*this.a*this.k0),n=this.con*Mv(this.e,i),t=this.con*bv(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else r=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=Zg?a=this.X0:(a=Math.asin(Math.cos(r)*this.sinX0+e.y*Math.sin(r)*this.cosX0/o),t=bv(this.long0+Math.atan2(e.x*Math.sin(r),o*this.cosX0*Math.cos(r)-e.y*this.sinX0*Math.sin(r)))),n=-1*Mv(this.e,Math.tan(.5*(Xg+a)));return e.x=t,e.y=n,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,n){return t*=n,Math.tan(.5*(Xg+e))*Math.pow((1-t)/(1+t),.5*n)}};var Ny={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,i=1/this.rf,r=2*i-Math.pow(i,2),a=this.e=Math.sqrt(r);this.R=this.k0*n*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),A=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*s+this.alpha*a/2*A},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),i=-this.alpha*(t+n)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),s=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*o+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,n=e.y-this.y0,i=t/this.R,r=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),o=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),s=this.lambda0+o/this.alpha,A=0,l=a,c=-1e3,h=0;Math.abs(l-c)>1e-7;){if(++h>20)return;A=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),c=l,l=2*Math.atan(Math.exp(A))-Math.PI/2}return e.x=s,e.y=l,e},names:["somerc"]},Gy=1e-7;var Qy={init:function(){var e,t,n,i,r,a,o,s,A,l,c,h,u,d=0,f=0,p=0,m=0,g=0,v=0,y=0;this.no_off=(u="object"==typeof(h=this).PROJECTION?Object.keys(h.PROJECTION)[0]:h.PROJECTION,"no_uoff"in h||"no_off"in h||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(u)),this.no_rot="no_rot"in this;var w=!1;"alpha"in this&&(w=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),w&&(y=this.alpha),x&&(d=this.rectified_grid_angle*Yg),w||x)f=this.longc;else if(p=this.long1,g=this.lat1,m=this.long2,v=this.lat2,Math.abs(g-v)<=Gy||(e=Math.abs(g))<=Gy||Math.abs(e-Xg)<=Gy||Math.abs(Math.abs(this.lat0)-Xg)<=Gy||Math.abs(Math.abs(v)-Xg)<=Gy)throw new Error;var b=1-this.es;t=Math.sqrt(b),Math.abs(this.lat0)>Zg?(s=Math.sin(this.lat0),n=Math.cos(this.lat0),e=1-this.es*s*s,this.B=n*n,this.B=Math.sqrt(1+this.es*this.B*this.B/b),this.A=this.B*this.k0*t/e,(r=(i=this.B*t/(n*Math.sqrt(e)))*i-1)<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Cv(this.e,this.lat0,s),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=r=1),w||x?(w?(c=Math.asin(Math.sin(y)/i),x||(d=y)):(c=d,y=Math.asin(i*Math.sin(c))),this.lam0=f-Math.asin(.5*(r-1/r)*Math.tan(c))/this.B):(a=Math.pow(Cv(this.e,g,Math.sin(g)),this.B),o=Math.pow(Cv(this.e,v,Math.sin(v)),this.B),r=this.E/a,A=(o-a)/(o+a),l=((l=this.E*this.E)-o*a)/(l+o*a),(e=p-m)<-Math.pi?m-=qg:e>Math.pi&&(m+=qg),this.lam0=bv(.5*(p+m)-Math.atan(l*Math.tan(.5*this.B*(p-m))/A)/this.B),c=Math.atan(2*Math.sin(this.B*bv(p-this.lam0))/(r-1/r)),d=y=Math.asin(i*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(y))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(Jg-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(Jg+r))},forward:function(e){var t,n,i,r,a,o,s,A,l={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-Xg)>Zg){if(t=.5*((a=this.E/Math.pow(Cv(this.e,e.y,Math.sin(e.y)),this.B))-(o=1/a)),n=.5*(a+o),r=Math.sin(this.B*e.x),i=(t*this.singam-r*this.cosgam)/n,Math.abs(Math.abs(i)-1)<Zg)throw new Error;A=.5*this.ArB*Math.log((1-i)/(1+i)),o=Math.cos(this.B*e.x),s=Math.abs(o)<Gy?this.A*e.x:this.ArB*Math.atan2(t*this.cosgam+r*this.singam,o)}else A=e.y>0?this.v_pole_n:this.v_pole_s,s=this.ArB*e.y;return this.no_rot?(l.x=s,l.y=A):(s-=this.u_0,l.x=A*this.cosrot+s*this.sinrot,l.y=s*this.cosrot-A*this.sinrot),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l},inverse:function(e){var t,n,i,r,a,o,s,A={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(n=e.y,t=e.x):(n=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),r=.5*((i=Math.exp(-this.BrA*n))-1/i),a=.5*(i+1/i),s=((o=Math.sin(this.BrA*t))*this.cosgam+r*this.singam)/a,Math.abs(Math.abs(s)-1)<Zg)A.x=0,A.y=s<0?-Xg:Xg;else{if(A.y=this.E/Math.sqrt((1+s)/(1-s)),A.y=Mv(this.e,Math.pow(A.y,1/this.B)),A.y===1/0)throw new Error;A.x=-this.rB*Math.atan2(r*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return A.x+=this.lam0,A},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};var Hy={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Zg)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),i=wv(this.e,t,n),r=Cv(this.e,this.lat1,t),a=Math.sin(this.lat2),o=Math.cos(this.lat2),s=wv(this.e,a,o),A=Cv(this.e,this.lat2,a),l=Cv(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Zg?this.ns=Math.log(i/s)/Math.log(r/A):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,n=e.y;Math.abs(2*Math.abs(n)-Math.PI)<=Zg&&(n=xv(n)*(Xg-2e-10));var i,r,a=Math.abs(Math.abs(n)-Xg);if(a>Zg)i=Cv(this.e,n,Math.sin(n)),r=this.a*this.f0*Math.pow(i,this.ns);else{if((a=n*this.ns)<=0)return null;r=0}var o=this.ns*bv(t-this.long0);return e.x=this.k0*(r*Math.sin(o))+this.x0,e.y=this.k0*(this.rh-r*Math.cos(o))+this.y0,e},inverse:function(e){var t,n,i,r,a,o=(e.x-this.x0)/this.k0,s=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+s*s),n=1):(t=-Math.sqrt(o*o+s*s),n=-1);var A=0;if(0!==t&&(A=Math.atan2(n*o,n*s)),0!==t||this.ns>0){if(n=1/this.ns,i=Math.pow(t/(this.a*this.f0),n),-9999===(r=Mv(this.e,i)))return null}else r=-Xg;return a=bv(A/this.ns+this.long0),e.x=a,e.y=r,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};var zy={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,n,i,r,a,o,s,A=e.x,l=e.y,c=bv(A-this.long0);return t=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/t)-this.s45),i=-c*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),a=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(r)),o=this.n*a,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),e.y=s*Math.cos(o)/1,e.x=s*Math.sin(o)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,n,i,r,a,o,s,A=e.x;e.x=e.y,e.y=A,this.czech||(e.y*=-1,e.x*=-1),a=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.atan2(e.y,e.x)/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),n=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(t)),e.x=this.long0-n/this.alfa,o=t,s=0;var l=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(s=1),o=e.y,l+=1}while(0===s&&l<15);return l>=15?null:e},names:["Krovak","krovak"]};function Vy(e,t,n,i,r){return e*r-t*Math.sin(2*r)+n*Math.sin(4*r)-i*Math.sin(6*r)}function jy(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function Wy(e){return.375*e*(1+.25*e*(1+.46875*e))}function Xy(e){return.05859375*e*e*(1+.75*e)}function Zy(e){return e*e*e*(35/3072)}function Yy(e,t,n){var i=t*n;return e/Math.sqrt(1-i*i)}function Ky(e){return Math.abs(e)<Xg?e:e-xv(e)*Math.PI}function Jy(e,t,n,i,r){var a,o;a=e/t;for(var s=0;s<15;s++)if(a+=o=(e-(t*a-n*Math.sin(2*a)+i*Math.sin(4*a)-r*Math.sin(6*a)))/(t-2*n*Math.cos(2*a)+4*i*Math.cos(4*a)-6*r*Math.cos(6*a)),Math.abs(o)<=1e-10)return a;return NaN}var qy={init:function(){this.sphere||(this.e0=jy(this.es),this.e1=Wy(this.es),this.e2=Xy(this.es),this.e3=Zy(this.es),this.ml0=this.a*Vy(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,n,i=e.x,r=e.y;if(i=bv(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(r)*Math.sin(i)),n=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var a=Math.sin(r),o=Math.cos(r),s=Yy(this.a,this.e,a),A=Math.tan(r)*Math.tan(r),l=i*Math.cos(r),c=l*l,h=this.es*o*o/(1-this.es);t=s*l*(1-c*A*(1/6-(8-A+8*h)*c/120)),n=this.a*Vy(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+s*a/o*c*(.5+(5-A+6*h)*c/24)}return e.x=t+this.x0,e.y=n+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,n,i=e.x/this.a,r=e.y/this.a;if(this.sphere){var a=r+this.lat0;t=Math.asin(Math.sin(a)*Math.cos(i)),n=Math.atan2(Math.tan(i),Math.cos(a))}else{var o=Jy(this.ml0/this.a+r,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Xg)<=Zg)return e.x=this.long0,e.y=Xg,r<0&&(e.y*=-1),e;var s=Yy(this.a,this.e,Math.sin(o)),A=s*s*s/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(o),2),c=i*this.a/s,h=c*c;t=o-s*Math.tan(o)/A*c*c*(.5-(1+3*l)*c*c/24),n=c*(1-h*(l/3+(1+3*l)*l*h/15))/Math.cos(o)}return e.x=bv(n+this.long0),e.y=Ky(t),e},names:["Cassini","Cassini_Soldner","cass"]};function $y(e,t){var n;return e>1e-7?(1-e*e)*(t/(1-(n=e*t)*n)-.5/e*Math.log((1-n)/(1+n))):2*t}var ew=.3333333333333333,tw=.17222222222222222,nw=.10257936507936508,iw=.06388888888888888,rw=.0664021164021164,aw=.016415012942191543;var ow={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-Xg)<Zg?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<Zg?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=$y(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,n=[];return n[0]=e*ew,t=e*e,n[0]+=t*tw,n[1]=t*iw,t*=e,n[0]+=t*nw,n[1]+=t*rw,n[2]=t*aw,n}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=$y(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,n,i,r,a,o,s,A,l,c,h=e.x,u=e.y;if(h=bv(h-this.long0),this.sphere){if(a=Math.sin(u),c=Math.cos(u),i=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((n=this.mode===this.EQUIT?1+c*i:1+this.sinph0*a+this.cosph0*c*i)<=Zg)return null;t=(n=Math.sqrt(2/n))*c*Math.sin(h),n*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(u+this.lat0)<Zg)return null;n=Jg-.5*u,t=(n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(h),n*=i}}else{switch(s=0,A=0,l=0,i=Math.cos(h),r=Math.sin(h),a=Math.sin(u),o=$y(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=o/this.qp,A=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:l=1+this.sinb1*s+this.cosb1*A*i;break;case this.EQUIT:l=1+A*i;break;case this.N_POLE:l=Xg+u,o=this.qp-o;break;case this.S_POLE:l=u-Xg,o=this.qp+o}if(Math.abs(l)<Zg)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),n=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*s-this.sinb1*A*i):(l=Math.sqrt(2/(1+A*i)))*s*this.ymf,t=this.xmf*l*A*r;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(l=Math.sqrt(o))*r,n=i*(this.mode===this.S_POLE?l:-l)):t=n=0}}return e.x=this.a*t+this.x0,e.y=this.a*n+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,n,i,r,a,o,s,A,l,c,h=e.x/this.a,u=e.y/this.a;if(this.sphere){var d,f=0,p=0;if((n=.5*(d=Math.sqrt(h*h+u*u)))>1)return null;switch(n=2*Math.asin(n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(p=Math.sin(n),f=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(d)<=Zg?0:Math.asin(u*p/d),h*=p,u=f*d;break;case this.OBLIQ:n=Math.abs(d)<=Zg?this.lat0:Math.asin(f*this.sinph0+u*p*this.cosph0/d),h*=p*this.cosph0,u=(f-Math.sin(n)*this.sinph0)*d;break;case this.N_POLE:u=-u,n=Xg-n;break;case this.S_POLE:n-=Xg}t=0!==u||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,u):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,u*=this.dd,(o=Math.sqrt(h*h+u*u))<Zg)return e.x=this.long0,e.y=this.lat0,e;r=2*Math.asin(.5*o/this.rq),i=Math.cos(r),h*=r=Math.sin(r),this.mode===this.OBLIQ?(s=i*this.sinb1+u*r*this.cosb1/o,a=this.qp*s,u=o*this.cosb1*i-u*this.sinb1*r):(s=u*r/o,a=this.qp*s,u=o*i)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),!(a=h*h+u*u))return e.x=this.long0,e.y=this.lat0,e;s=1-a/this.qp,this.mode===this.S_POLE&&(s=-s)}t=Math.atan2(h,u),A=Math.asin(s),l=this.apa,c=A+A,n=A+l[0]*Math.sin(c)+l[1]*Math.sin(c+c)+l[2]*Math.sin(c+c+c)}return e.x=bv(this.long0+t),e.y=n,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function sw(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}var Aw={init:function(){Math.abs(this.lat1+this.lat2)<Zg||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=wv(this.e3,this.sin_po,this.cos_po),this.qs1=$y(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=wv(this.e3,this.sin_po,this.cos_po),this.qs2=$y(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=$y(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>Zg?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var i=$y(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,a=this.ns0*bv(t-this.long0),o=r*Math.sin(a)+this.x0,s=this.rh-r*Math.cos(a)+this.y0;return e.x=o,e.y=s,e},inverse:function(e){var t,n,i,r,a,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),i=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),i=-1),r=0,0!==t&&(r=Math.atan2(i*e.x,i*e.y)),i=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-i*i)/(2*this.ns0)):(n=(this.c-i*i)/this.ns0,o=this.phi1z(this.e3,n)),a=bv(r/this.ns0+this.long0),e.x=a,e.y=o,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var n,i,r,a,o=sw(.5*t);if(e<Zg)return o;for(var s=e*e,A=1;A<=25;A++)if(o+=a=.5*(r=1-(i=e*(n=Math.sin(o)))*i)*r/Math.cos(o)*(t/(1-s)-n/r+.5/e*Math.log((1-i)/(1+i))),Math.abs(a)<=1e-7)return o;return null}};var lw={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,n,i,r,a,o,s,A=e.x,l=e.y;return i=bv(A-this.long0),t=Math.sin(l),n=Math.cos(l),r=Math.cos(i),1,(a=this.sin_p14*t+this.cos_p14*n*r)>0||Math.abs(a)<=Zg?(o=this.x0+1*this.a*n*Math.sin(i)/a,s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*r)/a):(o=this.x0+this.infinity_dist*n*Math.sin(i),s=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*r)),e.x=o,e.y=s,e},inverse:function(e){var t,n,i,r,a,o;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(r=Math.atan2(t,this.rc),n=Math.sin(r),o=sw((i=Math.cos(r))*this.sin_p14+e.y*n*this.cos_p14/t),a=Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n),a=bv(this.long0+a)):(o=this.phic0,a=0),e.x=a,e.y=o,e},names:["gnom"]};var cw={init:function(){this.sphere||(this.k0=wv(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,n,i=e.x,r=e.y,a=bv(i-this.long0);if(this.sphere)t=this.x0+this.a*a*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var o=$y(this.e,Math.sin(r));t=this.x0+this.a*this.k0*a,n=this.y0+this.a*o*.5/this.k0}return e.x=t,e.y=n,e},inverse:function(e){var t,n;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=bv(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(n=function(e,t){var n=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-n)<1e-6)return t<0?-1*Xg:Xg;for(var i,r,a,o,s=Math.asin(.5*t),A=0;A<30;A++)if(r=Math.sin(s),a=Math.cos(s),o=e*r,s+=i=Math.pow(1-o*o,2)/(2*a)*(t/(1-e*e)-r/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),Math.abs(i)<=1e-10)return s;return NaN}(this.e,2*e.y*this.k0/this.a),t=bv(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=n,e},names:["cea"]};var hw={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,n=e.y,i=bv(t-this.long0),r=Ky(n-this.lat0);return e.x=this.x0+this.a*i*this.rc,e.y=this.y0+this.a*r,e},inverse:function(e){var t=e.x,n=e.y;return e.x=bv(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Ky(this.lat0+(n-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var uw={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jy(this.es),this.e1=Wy(this.es),this.e2=Xy(this.es),this.e3=Zy(this.es),this.ml0=this.a*Vy(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,n,i,r=e.x,a=e.y,o=bv(r-this.long0);if(i=o*Math.sin(a),this.sphere)Math.abs(a)<=Zg?(t=this.a*o,n=-1*this.a*this.lat0):(t=this.a*Math.sin(i)/Math.tan(a),n=this.a*(Ky(a-this.lat0)+(1-Math.cos(i))/Math.tan(a)));else if(Math.abs(a)<=Zg)t=this.a*o,n=-1*this.ml0;else{var s=Yy(this.a,this.e,Math.sin(a))/Math.tan(a);t=s*Math.sin(i),n=this.a*Vy(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+s*(1-Math.cos(i))}return e.x=t+this.x0,e.y=n+this.y0,e},inverse:function(e){var t,n,i,r,a,o,s,A,l;if(i=e.x-this.x0,r=e.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=Zg)t=bv(i/this.a+this.long0),n=0;else{var c;for(o=this.lat0+r/this.a,s=i*i/this.a/this.a+o*o,A=o,a=20;a;--a)if(A+=l=-1*(o*(A*(c=Math.tan(A))+1)-A-.5*(A*A+s)*c)/((A-o)/c-1),Math.abs(l)<=Zg){n=A;break}t=bv(this.long0+Math.asin(i*Math.tan(A)/this.a)/Math.sin(n))}else if(Math.abs(r+this.ml0)<=Zg)n=0,t=bv(this.long0+i/this.a);else{var h,u,d,f,p;for(o=(this.ml0+r)/this.a,s=i*i/this.a/this.a+o*o,A=o,a=20;a;--a)if(p=this.e*Math.sin(A),h=Math.sqrt(1-p*p)*Math.tan(A),u=this.a*Vy(this.e0,this.e1,this.e2,this.e3,A),d=this.e0-2*this.e1*Math.cos(2*A)+4*this.e2*Math.cos(4*A)-6*this.e3*Math.cos(6*A),A-=l=(o*(h*(f=u/this.a)+1)-f-.5*h*(f*f+s))/(this.es*Math.sin(2*A)*(f*f+s-2*o*f)/(4*h)+(o-f)*(h*d-2/Math.sin(2*A))-d),Math.abs(l)<=Zg){n=A;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),t=bv(this.long0+Math.asin(i*h/this.a)/Math.sin(n))}return e.x=t,e.y=n,e},names:["Polyconic","poly"]};var dw={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,n=e.x,i=e.y-this.lat0,r=n-this.long0,a=i/Wg*1e-5,o=r,s=1,A=0;for(t=1;t<=10;t++)s*=a,A+=this.A[t]*s;var l,c=A,h=o,u=1,d=0,f=0,p=0;for(t=1;t<=6;t++)l=d*c+u*h,u=u*c-d*h,d=l,f=f+this.B_re[t]*u-this.B_im[t]*d,p=p+this.B_im[t]*u+this.B_re[t]*d;return e.x=p*this.a+this.x0,e.y=f*this.a+this.y0,e},inverse:function(e){var t,n,i=e.x,r=e.y,a=i-this.x0,o=(r-this.y0)/this.a,s=a/this.a,A=1,l=0,c=0,h=0;for(t=1;t<=6;t++)n=l*o+A*s,A=A*o-l*s,l=n,c=c+this.C_re[t]*A-this.C_im[t]*l,h=h+this.C_im[t]*A+this.C_re[t]*l;for(var u=0;u<this.iterations;u++){var d,f=c,p=h,m=o,g=s;for(t=2;t<=6;t++)d=p*c+f*h,f=f*c-p*h,p=d,m+=(t-1)*(this.B_re[t]*f-this.B_im[t]*p),g+=(t-1)*(this.B_im[t]*f+this.B_re[t]*p);f=1,p=0;var v=this.B_re[1],y=this.B_im[1];for(t=2;t<=6;t++)d=p*c+f*h,f=f*c-p*h,p=d,v+=t*(this.B_re[t]*f-this.B_im[t]*p),y+=t*(this.B_im[t]*f+this.B_re[t]*p);var w=v*v+y*y;c=(m*v+g*y)/w,h=(g*v-m*y)/w}var x=c,b=h,C=1,M=0;for(t=1;t<=9;t++)C*=x,M+=this.D[t]*C;var B=this.lat0+M*Wg*1e5,I=this.long0+b;return e.x=I,e.y=B,e},names:["New_Zealand_Map_Grid","nzmg"]};var fw={init:function(){},forward:function(e){var t=e.x,n=e.y,i=bv(t-this.long0),r=this.x0+this.a*i,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return e.x=r,e.y=a,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=bv(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=n,e},names:["Miller_Cylindrical","mill"]};var pw={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=My(this.es)},forward:function(e){var t,n,i=e.x,r=e.y;if(i=bv(i-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(r),o=20;o;--o){var s=(this.m*r+Math.sin(r)-a)/(this.m+Math.cos(r));if(r-=s,Math.abs(s)<Zg)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;t=this.a*this.C_x*i*(this.m+Math.cos(r)),n=this.a*this.C_y*r}else{var A=Math.sin(r),l=Math.cos(r);n=this.a*By(r,A,l,this.en),t=this.a*i*l/Math.sqrt(1-this.es*A*A)}return e.x=t,e.y=n,e},inverse:function(e){var t,n,i;return e.x-=this.x0,n=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,n/=this.C_x*(this.m+Math.cos(t)),this.m?t=sw((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=sw(Math.sin(t)/this.n)),n=bv(n+this.long0),t=Ky(t)):(t=Iy(e.y/this.a,this.es,this.en),(i=Math.abs(t))<Xg?(i=Math.sin(t),n=bv(this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)))):i-Zg<Xg&&(n=this.long0)),e.x=n,e.y=t,e},names:["Sinusoidal","sinu"]};var mw={init:function(){},forward:function(e){for(var t=e.x,n=e.y,i=bv(t-this.long0),r=n,a=Math.PI*Math.sin(n);;){var o=-(r+Math.sin(r)-a)/(1+Math.cos(r));if(r+=o,Math.abs(o)<Zg)break}r/=2,Math.PI/2-Math.abs(n)<Zg&&(i=0);var s=.900316316158*this.a*i*Math.cos(r)+this.x0,A=1.4142135623731*this.a*Math.sin(r)+this.y0;return e.x=s,e.y=A,e},inverse:function(e){var t,n;e.x-=this.x0,e.y-=this.y0,n=e.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),t=Math.asin(n);var i=bv(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),n=(2*t+Math.sin(2*t))/Math.PI,Math.abs(n)>1&&(n=1);var r=Math.asin(n);return e.x=i,e.y=r,e},names:["Mollweide","moll"]};var gw={init:function(){Math.abs(this.lat1+this.lat2)<Zg||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jy(this.es),this.e1=Wy(this.es),this.e2=Xy(this.es),this.e3=Zy(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=wv(this.e,this.sinphi,this.cosphi),this.ml1=Vy(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Zg?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=wv(this.e,this.sinphi,this.cosphi),this.ml2=Vy(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Vy(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,n=e.x,i=e.y;if(this.sphere)t=this.a*(this.g-i);else{var r=Vy(this.e0,this.e1,this.e2,this.e3,i);t=this.a*(this.g-r)}var a=this.ns*bv(n-this.long0),o=this.x0+t*Math.sin(a),s=this.y0+this.rh-t*Math.cos(a);return e.x=o,e.y=s,e},inverse:function(e){var t,n,i,r;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(n=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(n=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var a=0;return 0!==n&&(a=Math.atan2(t*e.x,t*e.y)),this.sphere?(r=bv(this.long0+a/this.ns),i=Ky(this.g-n/this.a),e.x=r,e.y=i,e):(i=Jy(this.g-n/this.a,this.e0,this.e1,this.e2,this.e3),r=bv(this.long0+a/this.ns),e.x=r,e.y=i,e)},names:["Equidistant_Conic","eqdc"]};var vw={init:function(){this.R=this.a},forward:function(e){var t,n,i=e.x,r=e.y,a=bv(i-this.long0);Math.abs(r)<=Zg&&(t=this.x0+this.R*a,n=this.y0);var o=sw(2*Math.abs(r/Math.PI));(Math.abs(a)<=Zg||Math.abs(Math.abs(r)-Xg)<=Zg)&&(t=this.x0,n=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*o):this.y0+Math.PI*this.R*-Math.tan(.5*o));var s=.5*Math.abs(Math.PI/a-a/Math.PI),A=s*s,l=Math.sin(o),c=Math.cos(o),h=c/(l+c-1),u=h*h,d=h*(2/l-1),f=d*d,p=Math.PI*this.R*(s*(h-f)+Math.sqrt(A*(h-f)*(h-f)-(f+A)*(u-f)))/(f+A);a<0&&(p=-p),t=this.x0+p;var m=A+h;return p=Math.PI*this.R*(d*m-s*Math.sqrt((f+A)*(A+1)-m*m))/(f+A),n=r>=0?this.y0+p:this.y0-p,e.x=t,e.y=n,e},inverse:function(e){var t,n,i,r,a,o,s,A,l,c,h,u;return e.x-=this.x0,e.y-=this.y0,h=Math.PI*this.R,a=(i=e.x/h)*i+(r=e.y/h)*r,h=3*(r*r/(A=-2*(o=-Math.abs(r)*(1+a))+1+2*r*r+a*a)+(2*(s=o-2*r*r+i*i)*s*s/A/A/A-9*o*s/A/A)/27)/(l=(o-s*s/3/A)/A)/(c=2*Math.sqrt(-l/3)),Math.abs(h)>1&&(h=h>=0?1:-1),u=Math.acos(h)/3,n=e.y>=0?(-c*Math.cos(u+Math.PI/3)-s/3/A)*Math.PI:-(-c*Math.cos(u+Math.PI/3)-s/3/A)*Math.PI,t=Math.abs(i)<Zg?this.long0:bv(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(i*i-r*r)+a*a))/2/i),e.x=t,e.y=n,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var yw={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,n,i,r,a,o,s,A,l,c,h,u,d,f,p,m,g,v,y,w,x,b,C=e.x,M=e.y,B=Math.sin(e.y),I=Math.cos(e.y),E=bv(C-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Zg?(e.x=this.x0+this.a*(Xg-M)*Math.sin(E),e.y=this.y0-this.a*(Xg-M)*Math.cos(E),e):Math.abs(this.sin_p12+1)<=Zg?(e.x=this.x0+this.a*(Xg+M)*Math.sin(E),e.y=this.y0+this.a*(Xg+M)*Math.cos(E),e):(v=this.sin_p12*B+this.cos_p12*I*Math.cos(E),g=(m=Math.acos(v))?m/Math.sin(m):1,e.x=this.x0+this.a*g*I*Math.sin(E),e.y=this.y0+this.a*g*(this.cos_p12*B-this.sin_p12*I*Math.cos(E)),e):(t=jy(this.es),n=Wy(this.es),i=Xy(this.es),r=Zy(this.es),Math.abs(this.sin_p12-1)<=Zg?(a=this.a*Vy(t,n,i,r,Xg),o=this.a*Vy(t,n,i,r,M),e.x=this.x0+(a-o)*Math.sin(E),e.y=this.y0-(a-o)*Math.cos(E),e):Math.abs(this.sin_p12+1)<=Zg?(a=this.a*Vy(t,n,i,r,Xg),o=this.a*Vy(t,n,i,r,M),e.x=this.x0+(a+o)*Math.sin(E),e.y=this.y0+(a+o)*Math.cos(E),e):(s=B/I,A=Yy(this.a,this.e,this.sin_p12),l=Yy(this.a,this.e,B),c=Math.atan((1-this.es)*s+this.es*A*this.sin_p12/(l*I)),y=0===(h=Math.atan2(Math.sin(E),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(E)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(h)-Math.PI)<=Zg?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(E)*Math.cos(c)/Math.sin(h)),u=this.e*this.sin_p12/Math.sqrt(1-this.es),m=A*y*(1-(w=y*y)*(p=(d=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*d)*(1-p)/6+(x=w*y)/8*(f=u*d)*(1-2*p)+(b=x*y)/120*(p*(4-7*p)-3*u*u*(1-7*p))-b*y/48*f),e.x=this.x0+m*Math.sin(h),e.y=this.y0+m*Math.cos(h),e))},inverse:function(e){var t,n,i,r,a,o,s,A,l,c,h,u,d,f,p,m,g,v,y,w,x,b,C;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*Xg*this.a)return;return n=t/this.a,i=Math.sin(n),r=Math.cos(n),a=this.long0,Math.abs(t)<=Zg?o=this.lat0:(o=sw(r*this.sin_p12+e.y*i*this.cos_p12/t),s=Math.abs(this.lat0)-Xg,a=Math.abs(s)<=Zg?this.lat0>=0?bv(this.long0+Math.atan2(e.x,-e.y)):bv(this.long0-Math.atan2(-e.x,e.y)):bv(this.long0+Math.atan2(e.x*i,t*this.cos_p12*r-e.y*this.sin_p12*i))),e.x=a,e.y=o,e}return A=jy(this.es),l=Wy(this.es),c=Xy(this.es),h=Zy(this.es),Math.abs(this.sin_p12-1)<=Zg?(o=Jy(((u=this.a*Vy(A,l,c,h,Xg))-(t=Math.sqrt(e.x*e.x+e.y*e.y)))/this.a,A,l,c,h),a=bv(this.long0+Math.atan2(e.x,-1*e.y)),e.x=a,e.y=o,e):Math.abs(this.sin_p12+1)<=Zg?(u=this.a*Vy(A,l,c,h,Xg),o=Jy(((t=Math.sqrt(e.x*e.x+e.y*e.y))-u)/this.a,A,l,c,h),a=bv(this.long0+Math.atan2(e.x,e.y)),e.x=a,e.y=o,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),p=Math.atan2(e.x,e.y),d=Yy(this.a,this.e,this.sin_p12),m=Math.cos(p),v=-(g=this.e*this.cos_p12*m)*g/(1-this.es),y=3*this.es*(1-v)*this.sin_p12*this.cos_p12*m/(1-this.es),b=1-v*(x=(w=t/d)-v*(1+v)*Math.pow(w,3)/6-y*(1+3*v)*Math.pow(w,4)/24)*x/2-w*x*x*x/6,f=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*m),a=bv(this.long0+Math.asin(Math.sin(p)*Math.sin(x)/Math.cos(f))),C=Math.sin(f),o=Math.atan2((C-this.es*b*this.sin_p12)*Math.tan(f),C*(1-this.es)),e.x=a,e.y=o,e)},names:["Azimuthal_Equidistant","aeqd"]};var ww={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,n,i,r,a,o,s,A=e.x,l=e.y;return i=bv(A-this.long0),t=Math.sin(l),n=Math.cos(l),r=Math.cos(i),1,((a=this.sin_p14*t+this.cos_p14*n*r)>0||Math.abs(a)<=Zg)&&(o=1*this.a*n*Math.sin(i),s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*r)),e.x=o,e.y=s,e},inverse:function(e){var t,n,i,r,a,o,s;return e.x-=this.x0,e.y-=this.y0,n=sw((t=Math.sqrt(e.x*e.x+e.y*e.y))/this.a),i=Math.sin(n),r=Math.cos(n),o=this.long0,Math.abs(t)<=Zg?(s=this.lat0,e.x=o,e.y=s,e):(s=sw(r*this.sin_p14+e.y*i*this.cos_p14/t),a=Math.abs(this.lat0)-Xg,Math.abs(a)<=Zg?(o=this.lat0>=0?bv(this.long0+Math.atan2(e.x,-e.y)):bv(this.long0-Math.atan2(-e.x,e.y)),e.x=o,e.y=s,e):(o=bv(this.long0+Math.atan2(e.x*i,t*this.cos_p14*r-e.y*this.sin_p14*i)),e.x=o,e.y=s,e))},names:["ortho"]},xw=1,bw=2,Cw=3,Mw=4,Bw=5,Iw=6,Ew=1,Sw=2,Tw=3,Lw=4;function Fw(e,t,n,i){var r;return e<Zg?(i.value=Ew,r=0):(r=Math.atan2(t,n),Math.abs(r)<=Jg?i.value=Ew:r>Jg&&r<=Xg+Jg?(i.value=Sw,r-=Xg):r>Xg+Jg||r<=-(Xg+Jg)?(i.value=Tw,r=r>=0?r-$g:r+$g):(i.value=Lw,r+=Xg)),r}function _w(e,t){var n=e+t;return n<-$g?n+=qg:n>+$g&&(n-=qg),n}var Uw={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Xg-Jg/2?this.face=Bw:this.lat0<=-(Xg-Jg/2)?this.face=Iw:Math.abs(this.long0)<=Jg?this.face=xw:Math.abs(this.long0)<=Xg+Jg?this.face=this.long0>0?bw:Mw:this.face=Cw,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,n,i,r,a,o,s={x:0,y:0},A={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,n=e.x,this.face===Bw)r=Xg-t,n>=Jg&&n<=Xg+Jg?(A.value=Ew,i=n-Xg):n>Xg+Jg||n<=-(Xg+Jg)?(A.value=Sw,i=n>0?n-$g:n+$g):n>-(Xg+Jg)&&n<=-Jg?(A.value=Tw,i=n+Xg):(A.value=Lw,i=n);else if(this.face===Iw)r=Xg+t,n>=Jg&&n<=Xg+Jg?(A.value=Ew,i=-n+Xg):n<Jg&&n>=-Jg?(A.value=Sw,i=-n):n<-Jg&&n>=-(Xg+Jg)?(A.value=Tw,i=-n-Xg):(A.value=Lw,i=n>0?-n+$g:-n-$g);else{var l,c,h,u,d,f;this.face===bw?n=_w(n,+Xg):this.face===Cw?n=_w(n,+$g):this.face===Mw&&(n=_w(n,-Xg)),u=Math.sin(t),d=Math.cos(t),f=Math.sin(n),l=d*Math.cos(n),c=d*f,h=u,this.face===xw?i=Fw(r=Math.acos(l),h,c,A):this.face===bw?i=Fw(r=Math.acos(c),h,-l,A):this.face===Cw?i=Fw(r=Math.acos(-l),h,-c,A):this.face===Mw?i=Fw(r=Math.acos(-c),h,l,A):(r=i=0,A.value=Ew)}return o=Math.atan(12/$g*(i+Math.acos(Math.sin(i)*Math.cos(Jg))-Xg)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(i))))),A.value===Sw?o+=Xg:A.value===Tw?o+=$g:A.value===Lw&&(o+=1.5*$g),s.x=a*Math.cos(o),s.y=a*Math.sin(o),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,e.x=s.x,e.y=s.y,e},inverse:function(e){var t,n,i,r,a,o,s,A,l,c,h,u,d={lam:0,phi:0},f={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,n=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?f.value=Ew:e.y>=0&&e.y>=Math.abs(e.x)?(f.value=Sw,t-=Xg):e.x<0&&-e.x>=Math.abs(e.y)?(f.value=Tw,t=t<0?t+$g:t-$g):(f.value=Lw,t+=Xg),l=$g/12*Math.tan(t),a=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),o=Math.atan(a),(s=1-(i=Math.cos(t))*i*(r=Math.tan(n))*r*(1-Math.cos(Math.atan(1/Math.cos(o)))))<-1?s=-1:s>1&&(s=1),this.face===Bw)A=Math.acos(s),d.phi=Xg-A,f.value===Ew?d.lam=o+Xg:f.value===Sw?d.lam=o<0?o+$g:o-$g:f.value===Tw?d.lam=o-Xg:d.lam=o;else if(this.face===Iw)A=Math.acos(s),d.phi=A-Xg,f.value===Ew?d.lam=-o+Xg:f.value===Sw?d.lam=-o:f.value===Tw?d.lam=-o-Xg:d.lam=o<0?-o-$g:-o+$g;else{var p,m,g;l=(p=s)*p,m=(l+=(g=l>=1?0:Math.sqrt(1-l)*Math.sin(o))*g)>=1?0:Math.sqrt(1-l),f.value===Sw?(l=m,m=-g,g=l):f.value===Tw?(m=-m,g=-g):f.value===Lw&&(l=m,m=g,g=-l),this.face===bw?(l=p,p=-m,m=l):this.face===Cw?(p=-p,m=-m):this.face===Mw&&(l=p,p=m,m=-l),d.phi=Math.acos(-g)-Xg,d.lam=Math.atan2(m,p),this.face===bw?d.lam=_w(d.lam,-Xg):this.face===Cw?d.lam=_w(d.lam,-$g):this.face===Mw&&(d.lam=_w(d.lam,+Xg))}return 0!==this.es&&(c=d.phi<0?1:0,h=Math.tan(d.phi),u=this.b/Math.sqrt(h*h+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-u*u)/(this.one_minus_f*u)),c&&(d.phi=-d.phi)),d.lam+=this.long0,e.x=d.lam,e.y=d.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Pw=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],kw=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Dw=.8487,Rw=1.3523,Ow=Kg/5,Nw=18,Gw=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};var Qw={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=bv(e.x-this.long0),n=Math.abs(e.y),i=Math.floor(n*Ow);i<0?i=0:i>=Nw&&(i=17);var r={x:Gw(Pw[i],n=Kg*(n-.08726646259971647*i))*t,y:Gw(kw[i],n)};return e.y<0&&(r.y=-r.y),r.x=r.x*this.a*Dw+this.x0,r.y=r.y*this.a*Rw+this.y0,r},inverse:function(e){var t={x:(e.x-this.x0)/(this.a*Dw),y:Math.abs(e.y-this.y0)/(this.a*Rw)};if(t.y>=1)t.x/=Pw[18][0],t.y=e.y<0?-Xg:Xg;else{var n=Math.floor(t.y*Nw);for(n<0?n=0:n>=Nw&&(n=17);;)if(kw[n][0]>t.y)--n;else{if(!(kw[n+1][0]<=t.y))break;++n}var i=kw[n],r=5*(t.y-i[0])/(kw[n+1][0]-i[0]);r=function(e,t,n,i){for(var r=t;i;--i){var a=e(r);if(r-=a,Math.abs(a)<n)break}return r}((function(e){return(Gw(i,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(i,e)}),r,Zg,100),t.x/=Gw(Pw[n],r),t.y=(5*n+r)*Yg,e.y<0&&(t.y=-t.y)}return t.x=bv(t.x+this.long0),t},names:["Robinson","robin"]};var Hw={init:function(){this.name="geocent"},forward:function(e){return Hv(e,this.es,this.a)},inverse:function(e){return zv(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},zw=0,Vw=1,jw=2,Ww=3,Xw={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var Zw={init:function(){if(Object.keys(Xw).forEach(function(e){if(void 0===this[e])this[e]=Xw[e].def;else{if(Xw[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Xw[e].num&&(this[e]=parseFloat(this[e]))}Xw[e].degrees&&(this[e]=this[e]*Yg)}.bind(this)),Math.abs(Math.abs(this.lat0)-Xg)<Zg?this.mode=this.lat0<0?Vw:zw:Math.abs(this.lat0)<Zg?this.mode=jw:(this.mode=Ww,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,n,i,r,a=Math.sin(e.y),o=Math.cos(e.y),s=Math.cos(e.x);switch(this.mode){case Ww:n=this.sinph0*a+this.cosph0*o*s;break;case jw:n=o*s;break;case Vw:n=-a;break;case zw:n=a}switch(t=(n=this.pn1/(this.p-n))*o*Math.sin(e.x),this.mode){case Ww:n*=this.cosph0*a-this.sinph0*o*s;break;case jw:n*=a;break;case zw:n*=-o*s;break;case Vw:n*=o*s}return r=1/((i=n*this.cg+t*this.sg)*this.sw*this.h1+this.cw),t=(t*this.cg-n*this.sg)*this.cw*r,n=i*r,e.x=t*this.a,e.y=n*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t,n,i,r={x:e.x,y:e.y};i=1/(this.pn1-e.y*this.sw),t=this.pn1*e.x*i,n=this.pn1*e.y*this.cw*i,e.x=t*this.cg+n*this.sg,e.y=n*this.cg-t*this.sg;var a=Ty(e.x,e.y);if(Math.abs(a)<Zg)r.x=0,r.y=e.y;else{var o,s;switch(s=1-a*a*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/a+a/this.pn1),o=Math.sqrt(1-s*s),this.mode){case Ww:r.y=Math.asin(o*this.sinph0+e.y*s*this.cosph0/a),e.y=(o-this.sinph0*Math.sin(r.y))*a,e.x*=s*this.cosph0;break;case jw:r.y=Math.asin(e.y*s/a),e.y=o*a,e.x*=s;break;case zw:r.y=Math.asin(o),e.y=-e.y;break;case Vw:r.y=-Math.asin(o)}r.x=Math.atan2(e.x,e.y)}return e.x=r.x+this.long0,e.y=r.y,e},names:["Tilted_Perspective","tpers"]};var Yw={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(e){var t,n,i,r,a=e.x,o=e.y;if(a-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var s=this.radius_p/Ty(this.radius_p*Math.cos(o),Math.sin(o));if(n=s*Math.cos(a)*Math.cos(o),i=s*Math.sin(a)*Math.cos(o),r=s*Math.sin(o),(this.radius_g-n)*n-i*i-r*r*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;t=this.radius_g-n,this.flip_axis?(e.x=this.radius_g_1*Math.atan(i/Ty(r,t)),e.y=this.radius_g_1*Math.atan(r/t)):(e.x=this.radius_g_1*Math.atan(i/t),e.y=this.radius_g_1*Math.atan(r/Ty(i,t)))}else"sphere"===this.shape&&(t=Math.cos(o),n=Math.cos(a)*t,i=Math.sin(a)*t,r=Math.sin(o),t=this.radius_g-n,this.flip_axis?(e.x=this.radius_g_1*Math.atan(i/Ty(r,t)),e.y=this.radius_g_1*Math.atan(r/t)):(e.x=this.radius_g_1*Math.atan(i/t),e.y=this.radius_g_1*Math.atan(r/Ty(i,t))));return e.x=e.x*this.a,e.y=e.y*this.a,e},inverse:function(e){var t,n,i,r,a=-1,o=0,s=0;if(e.x=e.x/this.a,e.y=e.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),o=Math.tan(e.x/this.radius_g_1)*Ty(1,s)):(o=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*Ty(1,o));var A=s/this.radius_p;if(t=o*o+A*A+a*a,(i=(n=2*this.radius_g*a)*n-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;r=(-n-Math.sqrt(i))/(2*t),a=this.radius_g+r*a,o*=r,s*=r,e.x=Math.atan2(o,a),e.y=Math.atan(s*Math.cos(e.x)/a),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),o=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+s*s)):(o=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+o*o)),t=o*o+s*s+a*a,(i=(n=2*this.radius_g*a)*n-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;r=(-n-Math.sqrt(i))/(2*t),a=this.radius_g+r*a,o*=r,s*=r,e.x=Math.atan2(o,a),e.y=Math.atan(s*Math.cos(e.x)/a)}return e.x=e.x+this.long0,e},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};function Kw(e){return e.startsWith("TMS")}function Jw(e){return e.startsWith("EPSG")}function qw(e){return Jw(e)?e:"EPSG:".concat(e.match(/\d+/)[0])}ny.defaultDatum="WGS84",ny.Proj=Qv,ny.WGS84=new ny.Proj("WGS84"),ny.Point=wy,ny.toPoint=Kv,ny.defs=pv,ny.nadgrid=function(e,t){var n=new DataView(t),i=function(e){var t=e.getInt32(8,!1);if(11===t)return!1;11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(n),r=function(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:Rv(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}(n,i);r.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var a={header:r,subgrids:function(e,t,n){for(var i=176,r=[],a=0;a<t.nSubgrids;a++){var o=Nv(e,i,n),s=Gv(e,i,o,n),A=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),l=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);r.push({ll:[Dv(o.lowerLongitude),Dv(o.lowerLatitude)],del:[Dv(o.longitudeInterval),Dv(o.latitudeInterval)],lim:[A,l],count:o.gridNodeCount,cvs:Ov(s)})}return r}(n,r,i)};return Pv[e]=a,a},ny.transform=qv,ny.mgrs=cy,ny.version="__VERSION__",function(e){e.Proj.projections.add(Ey),e.Proj.projections.add(Uy),e.Proj.projections.add(Py),e.Proj.projections.add(Ry),e.Proj.projections.add(Oy),e.Proj.projections.add(Ny),e.Proj.projections.add(Qy),e.Proj.projections.add(Hy),e.Proj.projections.add(zy),e.Proj.projections.add(qy),e.Proj.projections.add(ow),e.Proj.projections.add(Aw),e.Proj.projections.add(lw),e.Proj.projections.add(cw),e.Proj.projections.add(hw),e.Proj.projections.add(uw),e.Proj.projections.add(dw),e.Proj.projections.add(fw),e.Proj.projections.add(pw),e.Proj.projections.add(mw),e.Proj.projections.add(gw),e.Proj.projections.add(vw),e.Proj.projections.add(yw),e.Proj.projections.add(ww),e.Proj.projections.add(Uw),e.Proj.projections.add(Qw),e.Proj.projections.add(Hw),e.Proj.projections.add(Zw),e.Proj.projections.add(Yw)}(ny),ny.defs("EPSG:4978","+proj=geocent +datum=WGS84 +units=m +no_defs");var $w={DEGREE:1,METER:2};function ex(e){return"EPSG:4326"===e}function tx(e){switch(e){case"EPSG:4326":return $w.DEGREE;case"EPSG:4978":return $w.METER;default:var t=ny.defs(qw(e));if(!t)return;return"degrees"===(n=t.units)?$w.DEGREE:"m"===n?$w.METER:void 0}var n}function nx(e){var t=tx(e);if(void 0===e||void 0===t)throw new Error("Invalid crs parameter value '".concat(e,"'"));return t}var ix={UNIT:$w,isValid:function(e){nx(e)},isGeographic:function(e){return nx(e)==$w.DEGREE},isMetricUnit:function(e){return tx(e)==$w.METER},toUnit:tx,is4326:ex,reasonnableEpsilon:function(e){return ex(e)?.01:.001},formatToEPSG:qw,formatToTms:function(e){return Kw(e)?e:"TMS:".concat(e.match(/\d+/)[0])},isTms:Kw,isEpsg:Jw,tms_3857:"TMS:3857",tms_4326:"TMS:4326",defs:function(e,t){return ny.defs(e,t)}},rx=new tt(ny.WGS84.a,ny.WGS84.a,ny.WGS84.b),ax=new tt,ox=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rx;r(this,e),this.size=new tt,this._radiiSquared=new tt,this._invRadiiSquared=new tt,this.setSize(t)}return o(e,[{key:"geodeticSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tt;return e.toVector3(t).multiply(this._invRadiiSquared).normalize()}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tt,n=Oh.degToRad(e.longitude),i=Oh.degToRad(e.latitude),r=Math.cos(i);return t.set(r*Math.cos(n),r*Math.sin(n),Math.sin(i))}},{key:"setSize",value:function(e){this.size.set(e.x,e.y,e.z),this._radiiSquared.multiplyVectors(e,e),this._invRadiiSquared.x=0==e.x?0:1/this._radiiSquared.x,this._invRadiiSquared.y=0==e.y?0:1/this._radiiSquared.y,this._invRadiiSquared.z=0==e.z?0:1/this._radiiSquared.z}},{key:"cartographicToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tt;ax.copy(e.geodesicNormal),t.multiplyVectors(this._radiiSquared,ax);var n=Math.sqrt(ax.dot(t));return t.divideScalar(n),ax.multiplyScalar(e.altitude),t.add(ax)}},{key:"cartesianToCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ux("EPSG:4326",0,0,0),n=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),i=this.size.x,r=this.size.z,a=Math.abs((i*i-r*r)/(i*i)),o=1-Math.sqrt(1-a),s=Math.sqrt(e.x*e.x+e.y*e.y),A=Math.atan2(e.y,e.x),l=Math.atan(e.z/s*(1-o+a*i/n)),c=Math.sin(l),h=Math.cos(l),u=Math.atan((e.z*(1-o)+a*i*c*c*c)/((1-o)*(s-a*i*h*h*h))),d=s*Math.cos(u)+e.z*Math.sin(u)-i*Math.sqrt(1-a*Math.sin(u)*Math.sin(u));return t.setFromValues(Oh.radToDeg(A),Oh.radToDeg(u),d)}},{key:"cartographicToCartesianArray",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(this.cartographicToCartesian(e[n]));return t}},{key:"intersection",value:function(e){var t=1e-4,n=e.origin,i=e.direction,r=i.x*i.x*this._invRadiiSquared.x+i.y*i.y*this._invRadiiSquared.y+i.z*i.z*this._invRadiiSquared.z,a=2*n.x*i.x*this._invRadiiSquared.x+2*n.y*i.y*this._invRadiiSquared.y+2*n.z*i.z*this._invRadiiSquared.z,o=n.x*n.x*this._invRadiiSquared.x+n.y*n.y*this._invRadiiSquared.y+n.z*n.z*this._invRadiiSquared.z-1,s=a*a-4*r*o;if(s<0||0===r||0===a||0===o)return!1;var A=(-a+(s=Math.sqrt(s)))/(2*r),l=(-a-s)/(2*r);if(A<=t&&l<=t)return!1;var c=0;if((c=A<=t?l:l<=t||A<l?A:l)<t)return!1;var h=new tt;return h.addVectors(e.origin,i.clone().setLength(c)),h}},{key:"computeDistance",value:function(e,t){var n=Oh.degToRad(e.longitude),i=Oh.degToRad(e.latitude),r=Oh.degToRad(t.longitude),a=Oh.degToRad(t.latitude),o=Math.acos(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(r-n)),s=this.size.x,A=this.size.z,l=Math.sqrt((s*s-A*A)/(s*s)),c=(i+a)/2,h=s*(1-l*l)/Math.sqrt(1-l*l*Math.sin(c)*Math.sin(c)),u=s/Math.sqrt(1-l*l*Math.sin(c)*Math.sin(c));return o*Math.sqrt(h*u)}}]),e}();ny.defs("EPSG:4978","+proj=geocent +datum=WGS84 +units=m +no_defs");var sx=new ox,Ax={};function lx(e,t){return Ax[e]||(Ax[e]={}),Ax[e][t]||(Ax[e][t]=ny(e,t)),Ax[e][t]}var cx,hx,ux=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r(this,e),this.isCoordinates=!0,ix.isValid(t),this.crs=t,this.x=0,this.y=0,this.z=0,this._normal=new tt,n.length>0?this.setFromArray(n):n.isVector3||n.isCoordinates?this.setFromVector3(n):this.setFromValues(n,i,a),this._normalNeedsUpdate=!0}return o(e,[{key:"setFromValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.x=null==e?0:e,this.y=null==t?0:t,this.z=null==n?0:n,this._normalNeedsUpdate=!0,this}},{key:"setFromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.setFromValues(e[t],e[t+1],e[t+2])}},{key:"setFromVector3",value:function(e){return this.setFromValues(e.x,e.y,e.z)}},{key:"clone",value:function(){return new e(this.crs,this)}},{key:"copy",value:function(e){return this.crs=e.crs,this.setFromVector3(e)}},{key:"longitude",get:function(){return this.x}},{key:"latitude",get:function(){return this.y}},{key:"altitude",get:function(){return this.z},set:function(e){this.z=e}},{key:"geodesicNormal",get:function(){return this._normalNeedsUpdate&&(this._normalNeedsUpdate=!1,ix.is4326(this.crs)?sx.geodeticSurfaceNormalCartographic(this,this._normal):"EPSG:4978"==this.crs?sx.geodeticSurfaceNormal(this,this._normal):this._normal.set(0,0,1)),this._normal}},{key:"toVector3",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tt;return e.copy(this)}},{key:"applyMatrix4",value:function(e){return tt.prototype.applyMatrix4.call(this,e)}},{key:"as",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e(t);return this.crs==t?n.copy(this):(ix.is4326(this.crs)&&"EPSG:3857"==t&&(this.y=Oh.clamp(this.y,-89.999999,89.999999)),n.setFromArray(lx(this.crs,t).forward([this.x,this.y,this.z]))),n.crs=t,n}}]),e}(),dx=new Je,fx=new Je,px=new Je,mx=new Je,gx=new Je,vx=new Je(2,2),yx={row:0,col:0,invDiff:0};function wx(e,t){var n=e.zoom-t,i=Math.pow(2,n);return yx.invDiff=1/i,yx.row=(e.row-e.row%i)*yx.invDiff,yx.col=(e.col-e.col%i)*yx.invDiff,yx}for(var xx=new Array(8),bx=xx.length-1;bx>=0;bx--)xx[bx]=new ux("EPSG:4326",0,0,0,0);var Cx=new ux("EPSG:4326",0,0),Mx=new Map,Bx=new Map;function Ix(e){var t=ix.formatToEPSG(e),n=Mx.get(t),i=n.dimensions(fx),r=ix.formatToTms(e);return{epsg:t,globalExtent:n,globalDimension:i,sTs:Bx.get(r)||Bx.get("default"),isInverted:!r.includes(":NI")}}function Ex(e,t){var n=Bx.get(ix.formatToTms(e))||Bx.get("default"),i=Math.pow(2,t);return px.set(i,i).multiply(n),px}var Sx=function(){function e(t,n,i,a,o){r(this,e),this.isExtent=!0,this.crs=t,this.zoom=0,ix.isTms(this.crs)?(this.row=0,this.col=0):(this.west=0,this.east=0,this.south=0,this.north=0),this.set(n,i,a,o)}return o(e,[{key:"clone",value:function(){return ix.isTms(this.crs)?new e(this.crs,this.zoom,this.row,this.col):new e(this.crs,this.west,this.east,this.south,this.north)}},{key:"tiledCovering",value:function(t){if("EPSG:4326"==this.crs&&t==ix.tms_3857){var n=[],i=cx.copy(this).as(ix.formatToEPSG(t),hx),r=Ix(ix.formatToEPSG(t)),a=r.globalExtent,o=r.globalDimension,s=r.sTs;i.clampByExtent(a),i.dimensions(gx);var A=this.zoom+1||Math.floor(Math.log2(Math.round(o.x/(gx.x*s.x)))),l=Ex(t,A),c=i.center(Cx);mx.x=c.x-a.west,mx.y=a.north-i.north,mx.divide(o).multiply(l).floor();for(var h=Math.ceil((a.north-i.south)/o.x*l.y)-1;h>=mx.y;h--)n.push(new e(t,A,h,mx.x));return n}var u=new e(t,0,0,0),d=Ix(this.crs),f=d.globalExtent,p=d.globalDimension,m=d.sTs,g=d.isInverted,v=this.center(Cx);this.dimensions(gx);var y=Math.floor(Math.log2(Math.round(p.x/(gx.x*m.x)))),w=Ex(t,y);return mx.x=v.x-f.west,mx.y=g?f.north-v.y:v.y-f.south,mx.divide(p).multiply(w).floor(),u.set(y,mx.y,mx.x),[u]}},{key:"as",value:function(t,n){if(ix.isValid(t),n=n||new e("EPSG:4326",[0,0,0,0]),ix.isTms(this.crs)){var i=Ix(this.crs),r=i.epsg,a=i.globalExtent,o=i.globalDimension,s=Ex(this.crs,this.zoom);return gx.set(1,1).divide(s).multiply(o),n.west=a.west+(o.x-gx.x*(s.x-this.col)),n.east=n.west+gx.x,n.south=a.south+gx.y*(s.y-this.row-1),n.north=n.south+gx.y,n.crs=r,n.zoom=this.zoom,t==r?n:n.as(t,n)}if(ix.isEpsg(t)){if(this.crs!=t){var A=this.center(Cx);xx[0].setFromValues(this.west,this.north),xx[1].setFromValues(A.x,this.north),xx[2].setFromValues(this.east,this.north),xx[3].setFromValues(this.east,A.y),xx[4].setFromValues(this.east,this.south),xx[5].setFromValues(A.x,this.south),xx[6].setFromValues(this.west,this.south),xx[7].setFromValues(this.west,A.y),n.set(1/0,-1/0,1/0,-1/0);for(var l=0;l<xx.length;l++)xx[l].crs=this.crs,xx[l].as(t,Cx),n.north=Math.max(n.north,Cx.y),n.south=Math.min(n.south,Cx.y),n.east=Math.max(n.east,Cx.x),n.west=Math.min(n.west,Cx.x);return n.zoom=this.zoom,n.crs=t,n}return n.crs=t,n.zoom=this.zoom,n.set(this.west,this.east,this.south,this.north),n}}},{key:"center",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ux(this.crs);if(ix.isTms(this.crs))throw new Error("Invalid operation for WMTS bbox");return this.dimensions(dx),e.crs=this.crs,e.setFromValues(this.west+.5*dx.x,this.south+.5*dx.y),e}},{key:"dimensions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Je;return e.x=Math.abs(this.east-this.west),e.y=Math.abs(this.north-this.south),e}},{key:"isPointInside",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.crs==e.crs?Cx.copy(e):e.as(this.crs,Cx),Cx.x<=this.east+t&&Cx.x>=this.west-t&&Cx.y<=this.north+t&&Cx.y>=this.south-t}},{key:"isInside",value:function(e,t){return ix.isTms(this.crs)?this.zoom==e.zoom?this.row==e.row&&this.col==e.col:!(this.zoom<e.zoom)&&(wx(this,e.zoom),yx.row==e.row&&yx.col==e.col):(e.as(this.crs,cx),t=null==t?ix.reasonnableEpsilon(this.crs):t,this.east-cx.east<=t&&cx.west-this.west<=t&&this.north-cx.north<=t&&cx.south-this.south<=t)}},{key:"offsetToParent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new At;if(this.crs!=e.crs)throw new Error("unsupported mix");if(ix.isTms(this.crs))return wx(this,e.zoom),t.set(this.col*yx.invDiff-yx.col,this.row*yx.invDiff-yx.row,yx.invDiff,yx.invDiff);e.dimensions(dx),this.dimensions(fx);var n=(this.west-e.west)/dx.x,i=(e.north-this.north)/dx.y,r=fx.x/dx.x,a=fx.y/dx.y;return t.set(n,i,r,a)}},{key:"tiledExtentParent",value:function(t){return t&&t<this.zoom?(wx(this,t),new e(this.crs,t,yx.row,yx.col)):this}},{key:"intersectsExtent",value:function(e){var t=e.crs==this.crs?e:e.as(this.crs,cx);return!(this.west>=t.east||this.east<=t.west||this.south>=t.north||this.north<=t.south)}},{key:"intersect",value:function(t){return this.intersectsExtent(t)?(t.crs!=this.crs&&(t=t.as(this.crs,cx)),new e(this.crs,Math.max(this.west,t.west),Math.min(this.east,t.east),Math.max(this.south,t.south),Math.min(this.north,t.north))):new e(this.crs,0,0,0,0)}},{key:"set",value:function(e,t,n,i){if(null==e)throw new Error("No values to set in the extent");return e.isExtent&&(ix.isTms(e.crs)?(t=e.row,n=e.col,e=e.zoom):(t=e.east,n=e.south,i=e.north,e=e.west)),ix.isTms(this.crs)?(this.zoom=e,this.row=t,this.col=n):e.isCoordinates?(this.west=e.x,this.east=t.x,this.south=e.y,this.north=t.y):void 0!==e.west?(this.west=e.west,this.east=e.east,this.south=e.south,this.north=e.north):4==e.length?(this.west=e[0],this.east=e[1],this.south=e[2],this.north=e[3]):void 0!==i&&(this.west=e,this.east=t,this.south=n,this.north=i),this}},{key:"copy",value:function(e){return this.crs=e.crs,this.set(e)}},{key:"union",value:function(e){if(e.crs!=this.crs)throw new Error("unsupported union between 2 diff crs");if(this.west===1/0)this.copy(e);else{var t=e.west;t<this.west&&(this.west=t);var n=e.east;n>this.east&&(this.east=n);var i=e.south;i<this.south&&(this.south=i);var r=e.north;r>this.north&&(this.north=r)}}},{key:"expandByCoordinates",value:function(e){var t=e.crs==this.crs?e:e.as(this.crs,Cx);this.expandByValuesCoordinates(t.x,t.y)}},{key:"expandByValuesCoordinates",value:function(e,t){e<this.west&&(this.west=e),e>this.east&&(this.east=e),t<this.south&&(this.south=t),t>this.north&&(this.north=t)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return ix.isTms(this.crs)?"".concat(this.zoom).concat(e).concat(this.row).concat(e).concat(this.col):"".concat(this.east).concat(e).concat(this.north).concat(e).concat(this.west).concat(e).concat(this.south)}},{key:"subdivision",value:function(){return this.subdivisionByScheme()}},{key:"subdivisionByScheme",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vx,n=[],i=this.dimensions(dx).divide(t),r=t.x-1;r>=0;r--)for(var a=t.y-1;a>=0;a--){var o=this.west+r*i.x,s=this.south+a*i.y;n.push(new e(this.crs,o,o+i.x,s,s+i.y))}return n}},{key:"transformedCopy",value:function(e,t,n){if(!ix.isTms(n.crs)){if(this.crs=n.crs,this.zoom=n.zoom,this.west=(n.west+e.x)*t.x,this.east=(n.east+e.x)*t.x,this.west>this.east){var i=this.west;this.west=this.east,this.east=i}if(this.south=(n.south+e.y)*t.y,this.north=(n.north+e.y)*t.y,this.south>this.north){var r=this.south;this.south=this.north,this.north=r}}}},{key:"clampSouthNorth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.south,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.north;return this.south=Math.max(this.south,e),this.north=Math.min(this.north,t),this}},{key:"clampWestEast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.west,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.east;return this.west=Math.max(this.west,e),this.east=Math.min(this.east,t),this}},{key:"clampByExtent",value:function(e){return this.clampSouthNorth(e.south,e.north),this.clampWestEast(e.west,e.east)}}],[{key:"fromBox3",value:function(t,n){return new e(t,{west:n.min.x,east:n.max.x,south:n.min.y,north:n.max.y})}}]),e}();cx=new Sx("EPSG:4326",[0,0,0,0]),hx=new Sx("EPSG:4326",[0,0,0,0]),Mx.set("EPSG:4326",new Sx("EPSG:4326",-180,180,-90,90));var Tx=Mx.get("EPSG:4326").as("EPSG:3857");Tx.clampSouthNorth(Tx.west,Tx.east),Mx.set("EPSG:3857",Tx),Bx.set("default",new Je(1,1)),Bx.set(ix.tms_3857,Bx.get("default")),Bx.set(ix.tms_4326,new Je(2,1));var Lx={v:new tt,coord1:new ux("EPSG:4978"),coord2:new ux("EPSG:4978"),offset:new Je};function Fx(e,t,n,i,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,l=s||new ux(i);o.worldFromLocal?l.setFromVector3(Lx.v.copy(r).applyMatrix4(o.worldFromLocal)):l.setFromVector3(r);var c=Ux.getTerrainObjectAt(e,l,t,n,A);if(c)return c.coord.z+=a,c.coord.as(i,Lx.coord2).toVector3(r),o.localFromWorld&&r.applyMatrix4(o.localFromWorld),{id:c.texture.id,version:c.texture.version,tile:c.tile}}var _x,Ux={getElevationValueAt:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,r=zx(e,n,t,i||e.level0Nodes);if(r)return r.coord.z},getTerrainObjectAt:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return zx(e,n,t,i||e.level0Nodes,r)},FAST_READ_Z:0,PRECISE_READ_Z:1,placeObjectOnGround:function(e,t,n){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;if(console.warn("placeObjectOnGround has been deprecated because it needs review and test"),i=a?a.concat(e.level0Nodes):e.level0Nodes,r.modifyGeometry){var o={worldFromLocal:n.matrixWorld,localFromWorld:(new vt).copy(n.matrixWorld).invert()},s=n.geometry;if(s.vertices){r.cache&&(r.cache.length=s.vertices.length);for(var A=!0,l=new ux(t),c=0;c<s.vertices.length;c++){var h=r.cache?r.cache[c]:void 0,u=Fx(e,r.method||Ux.FAST_READ_Z,i,t,s.vertices[c],r.offset||0,o,l,h);r.cache&&(r.cache[c]=u),u||(A=!1)}return s.verticesNeedUpdate=!0,A}if(s.isBufferGeometry){r.cache&&(r.cache.length=s.attributes.position.count);for(var d=!0,f=new tt,p=new ux(t),m=0;m<s.attributes.position.count;m++){var g=r.cache?r.cache[m]:void 0;f.fromBufferAttribute(s.attributes.position,m);var v=f.z,y=Fx(e,r.method||Ux.FAST_READ_Z,i,t,f,r.offset||0,o,p,g);r.cache&&(r.cache[m]=y),y||(d=!1),v!=f.z&&(s.attributes.position.needsUpdate=!0),s.attributes.position.setXYZ(m,f.x,f.y,f.z)}return d}}else{r.cache&&(r.cache.length=1);var w={worldFromLocal:n.parent?n.parent.matrixWorld:void 0,localFromWorld:n.parent?(new vt).copy(n.parent.matrixWorld).invert():void 0},x=Fx(e,r.method||Ux.FAST_READ_Z,i,t,n.position,r.offset||0,w,void 0,r.cache?r.cache[0]:void 0);if(x)return r.cache&&(r.cache[0]=x),n.updateMatrix(),n.updateMatrixWorld(),!0}}};function Px(e,t){if(t.extent){if(!t.extent.isPointInside(e))return;for(var n=0;n<t.children.length;n++){var i=Px(e,t.children[n]);if(i)return i}var r=t.material.getElevationLayer();return r&&r.level>=0?t:void 0}}function kx(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];for(var a=0;a<i.length;a+=2)i[a]=Oh.clamp(i[a],0,t.image.width-1),i[a+1]=Oh.clamp(i[a+1],0,t.image.height-1);if(t.image.data){if(2===i.length){var o=t.image.data[i[1]*t.image.width+i[0]];return o!=e.noDataValue?o:void 0}for(var s=[],A=0;A<i.length;A+=2){var l=t.image.data[i[A+1]*t.image.width+i[A]];s.push(l!=e.noDataValue?l:void 0)}return s}_x||((_x=document.createElement("canvas")).width=2,_x.height=2);for(var c=1/0,h=1/0,u=-1/0,d=-1/0,f=0;f<i.length;f+=2)c=Math.min(i[f],c),h=Math.min(i[f+1],h),u=Math.max(i[f],u),d=Math.max(i[f+1],d);var p=u-c+1,m=d-h+1;_x.width=Math.max(_x.width,p),_x.height=Math.max(_x.height,m);var g=_x.getContext("2d");g.drawImage(t.image,c,h,p,m,0,0,p,m);for(var v=g.getImageData(0,0,p,m),y=[],w=0;w<i.length;w+=2){var x=i[w]-c,b=i[w+1]-h,C=Oh.lerp(e.colorTextureElevationMinZ,e.colorTextureElevationMaxZ,v.data[4*b*p+4*x]/255);y.push(C!=e.noDataValue?C:void 0)}return 2===i.length?y[0]:y}function Dx(e,t,n){var i=e.image.width,r=e.image.height,a=Math.max(0,t*i-.5),o=Math.max(0,n*r-.5),s=Math.floor(a),A=Math.ceil(a),l=Math.floor(o);return{u1:s,u2:A,v1:l,v2:Math.ceil(o),wu:a-s,wv:o-l}}function Rx(e,t,n){return null==e?t:null==t?e:Oh.lerp(e,t,n)}function Ox(e,t,n,i){var r=Dx(t,n,i),a=v(kx(e,t,r.u1,r.v1,r.u2,r.v1,r.u1,r.v2,r.u2,r.v2),4),o=a[0],s=a[1],A=a[2],l=a[3],c=Rx(o,s,r.wu),h=Rx(A,l,r.wu);return Rx(c,h,r.wv)}function Nx(e,t,n){return function(e,t,n,i){var r=Dx(t,n,i);return kx(e,t,r.wu<=0?r.u1:r.u2,r.wv<=0?r.v1:r.v2)}(e.attachedLayers.filter((function(e){return e.isElevationLayer}))[0],t,n.x,n.y)}var Gx=new tt;var Qx={v:new tt,coord1:new ux("EPSG:4978"),coord2:new ux("EPSG:4978"),offset:new Je},Hx=new Je;function zx(e,t,n,i,r){var a=n.as(e.extent.crs,Qx.coord1),o=null;r&&r.tile&&r.tile.material&&(o=Px(a,r.tile));for(var s=0;!o&&s<i.length;s++)o=Px(a,i[s]);if(o){var A=o,l=A.material.getElevationLayer(),c=l.textures[0];if(r&&r.id===c.id&&r.version===c.version)return{coord:a,texture:c,tile:A};for(var h=Math.round(Math.log2(1/l.offsetScales[0].z)),u=0;u<h;u++)o=o.parent;return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Je;if(e.crs!=t.crs)throw new Error("Unsupported mix: ".concat(e.crs," and ").concat(t.crs));t.dimensions(Hx);var i=(e.x-t.west)/Hx.x,r=(t.north-e.y)/Hx.y;n.set(i,r)}(a,o.extent,Qx.offset),a.z=1==t?function(e,t,n,i,r){var a=i.x/r.x/16,o=Math.floor(n.x/a)*a,s=Math.floor(n.y/a)*a;1==o&&(o-=a),1==s&&(s-=a);var A=o,l=o+a,c=s,h=s+a,u=(n.x-o)/a,d=(n.y-s)/a,f=1==d||u/(1-d)>=1,p=new Mn(new tt(A,h),new tt(l,c),f?new tt(l,h):new tt(A,c));p.getBarycoord(new tt(n.x,n.y),Gx);var m=e.attachedLayers.filter((function(e){return e.isElevationLayer}))[0],g=Ox(m,t,p.a.x,p.a.y),v=Ox(m,t,p.b.x,p.b.y),y=Ox(m,t,p.c.x,p.c.y);return g*Gx.x+v*Gx.y+y*Gx.z}(e,c,Qx.offset,A.extent.dimensions(),o.extent.dimensions()):Nx(e,c,Qx.offset),null!=a.z?{coord:a,texture:c,tile:A}:void 0}}var Vx=0,jx=1,Wx={frustum:new zi,matrix:new vt,box3:new Jt},Xx=new Jt(new tt(-1,-1,-1),new tt(1,1,1));function Zx(e,t,n){if(e.camera3D.isOrthographicCamera)e._preSSE=t;else{var i=Oh.degToRad(n);e._preSSE=t/(2*Math.tan(.5*i))}}var Yx=function(){function e(t,n,i){var a=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r(this,e),this.crs=t,o.isCamera)console.warn("options.camera parameter is deprecated. Use options.camera.cameraThree to place a custom camera as a parameter. See the documentation of Camera."),this.camera3D=o;else if(o.cameraThree)this.camera3D=o.cameraThree;else switch(o.type){case jx:this.camera3D=new El;break;case Vx:default:this.camera3D=new Di(30)}if(this.camera3D.aspect=void 0!==this.camera3D.aspect?this.camera3D.aspect:1,this._viewMatrix=new vt,this.width=n,this.height=i,this._viewMatrixNeedsUpdate=!0,this.resize(n,i),this._preSSE=1/0,this.camera3D.isPerspectiveCamera){var s=this.camera3D.fov;Object.defineProperty(this.camera3D,"fov",{get:function(){return s},set:function(e){s=e,Zx(a,a.height,s)}})}}return o(e,[{key:"resize",value:function(e,t){var n=e/t;if(this.camera3D.aspect!==n){if(this.camera3D.isOrthographicCamera){this.camera3D.zoom*=this.width/e;var i=this.camera3D.top*this.camera3D.aspect/n;this.camera3D.bottom=-i,this.camera3D.top=i}else this.camera3D.isPerspectiveCamera&&(this.camera3D.fov=2*Ke.radToDeg(Math.atan(t/this.height*Math.tan(Ke.degToRad(this.camera3D.fov)/2))));this.camera3D.aspect=n}this.width=e,this.height=t,Zx(this,this.height,this.camera3D.fov),this.camera3D.updateProjectionMatrix&&(this.camera3D.updateProjectionMatrix(),this._viewMatrixNeedsUpdate=!0)}},{key:"update",value:function(){this.camera3D.updateMatrixWorld(),this._viewMatrixNeedsUpdate=!0}},{key:"position",value:function(e){return new ux(this.crs,this.camera3D.position).as(e||this.crs)}},{key:"setPosition",value:function(e){this.camera3D.position.copy(e.as(this.crs))}},{key:"isBox3Visible",value:function(e,t){return this.box3SizeOnScreen(e,t).intersectsBox(Xx)}},{key:"isSphereVisible",value:function(e,t){return this._viewMatrixNeedsUpdate&&(this._viewMatrix.multiplyMatrices(this.camera3D.projectionMatrix,this.camera3D.matrixWorldInverse),this._viewMatrixNeedsUpdate=!1),t?(Wx.matrix.multiplyMatrices(this._viewMatrix,t),Wx.frustum.setFromProjectionMatrix(Wx.matrix)):Wx.frustum.setFromProjectionMatrix(this._viewMatrix),Wx.frustum.intersectsSphere(e)}},{key:"box3SizeOnScreen",value:function(e,t){var n=function(e,t,n){var i=e.camera3D.matrixWorldInverse;n&&(i=Wx.matrix.multiplyMatrices(e.camera3D.matrixWorldInverse,n));Kx[0].set(t.min.x,t.min.y,t.min.z).applyMatrix4(i),Kx[1].set(t.min.x,t.min.y,t.max.z).applyMatrix4(i),Kx[2].set(t.min.x,t.max.y,t.min.z).applyMatrix4(i),Kx[3].set(t.min.x,t.max.y,t.max.z).applyMatrix4(i),Kx[4].set(t.max.x,t.min.y,t.min.z).applyMatrix4(i),Kx[5].set(t.max.x,t.min.y,t.max.z).applyMatrix4(i),Kx[6].set(t.max.x,t.max.y,t.min.z).applyMatrix4(i),Kx[7].set(t.max.x,t.max.y,t.max.z).applyMatrix4(i);for(var r=!1,a=0;a<8;a++)Kx[a].z<=-e.camera3D.near?r=!0:Kx[a].z=-e.camera3D.near;return r?Kx:void 0}(this,e,t);if(!n)return Wx.box3.makeEmpty();for(var i=0;i<8;i++)n[i].applyMatrix4(this.camera3D.projectionMatrix);return Wx.box3.setFromPoints(n)}},{key:"adjustAltitudeToAvoidCollisionWithLayer",value:function(e,t,n){var i=e.camera.position().as("EPSG:4326");if(void 0!==t){var r=Ux.getElevationValueAt(t,i);if(void 0!==r)i.altitude-(r+n)<0&&(i.altitude=r+n,e.camera.camera3D.position.copy(i.as(e.referenceCrs)),e.notifyChange(this.camera3D))}}}]),e}(),Kx=[new tt,new tt,new tt,new tt,new tt,new tt,new tt,new tt];var Jx="update_start",qx="before_camera_update",$x="after_camera_update",eb="before_layer_update",tb="after_layer_update",nb="before_render",ib="after_render",rb="update_end";function ab(e,t){this.renderingState=0,this.needsRedraw=!1,this.scheduler=e,this.gfxEngine=t,this._updateLoopRestarted=!0}function ob(e,t,n){if(n){var i,r=C(n);try{for(r.s();!(i=r.n()).done;){var a=i.value,o=t.update(e,t,a),s=t.getObjectToUpdateForAttachedLayers(a);if(s)if(s.element){if(__DEBUG__&&!s.element.isObject3D)throw new Error("\n                            Invalid object for attached layer to update.\n                            Must be a THREE.Object and have a THREE.Material");var A,l=C(t.attachedLayers);try{for(l.s();!(A=l.n()).done;){var c=A.value;c.ready&&(c.update(e,c,s.element,s.parent),c.cache.flush())}}catch(e){l.e(e)}finally{l.f()}}else if(s.elements)for(var h=0;h<s.elements.length;h++){if(!s.elements[h].isObject3D)throw new Error("\n                            Invalid object for attached layer to update.\n                            Must be a THREE.Object and have a THREE.Material");var u,d=C(t.attachedLayers);try{for(d.s();!(u=d.n()).done;){var f=u.value;f.ready&&(f.update(e,f,s.elements[h],s.parent),f.cache.flush())}}catch(e){d.e(e)}finally{d.f()}}ob(e,t,o)}}catch(e){r.e(e)}finally{r.f()}}}function sb(e,t){var n=!1,i=new Set;return e.forEach((function(e){e===t||e.isCamera?(t.info.clear(),n=!0):e.layer===t&&i.add(e)})),n?new Set([t]):i}ab.prototype=Object.create(Xe.prototype),ab.prototype.constructor=ab,ab.prototype.scheduleViewUpdate=function(e,t){var n=this;this.needsRedraw|=t,1!==this.renderingState&&(this.renderingState=1,__DEBUG__&&(document.title+=" "),this.animationFrame=requestAnimationFrame((function(t){n._step(e,t)})))},ab.prototype._update=function(e,t,n){var i={camera:e.camera,engine:this.gfxEngine,scheduler:this.scheduler,view:e};t.forEach((function(e){var n=e.layer||e;n.isLayer&&n.parent&&t.add(n.parent)}));var r,a=C(e.getLayers((function(e,t){return!t})));try{for(a.s();!(r=a.n()).done;){var o=r.value;if(i.geometryLayer=o,o.ready&&o.visible&&!o.frozen){e.execFrameRequesters(eb,n,this._updateLoopRestarted,o);var s=sb(t,o);if(s.size>0){var A,l=C(o.attachedLayers);try{for(l.s();!(A=l.n()).done;){var c=A.value;c.ready&&c.preUpdate&&c.preUpdate(i,s)}}catch(e){l.e(e)}finally{l.f()}var h=o.preUpdate(i,s);ob(i,o,h),o.postUpdate(i,o,t)}o.cache.flush(),e.execFrameRequesters(tb,n,this._updateLoopRestarted,o)}}}catch(e){a.e(e)}finally{a.f()}},ab.prototype._step=function(e,t){var n=t-this._lastTimestamp;e._executeFrameRequestersRemovals(),e.execFrameRequesters(Jx,n,this._updateLoopRestarted);var i=this.needsRedraw;this._lastTimestamp=t,this.needsRedraw=!1,this.renderingState=0;var r=new Set(e._changeSources);e._changeSources.clear();var a=this.gfxEngine.getWindowSize();e.execFrameRequesters(qx,n,this._updateLoopRestarted),e.camera.update(a.x,a.y),e.execFrameRequesters($x,n,this._updateLoopRestarted);var o=e.camera.camera3D.matrixAutoUpdate;e.camera.camera3D.matrixAutoUpdate=!1,this._update(e,r,n),0==this.scheduler.commandsWaitingExecutionCount()&&this.dispatchEvent({type:"command-queue-empty"}),i&&this._renderView(e,n),this._updateLoopRestarted=0===this.renderingState,__DEBUG__&&(document.title=document.title.substr(0,document.title.length-2)),e.camera.camera3D.matrixAutoUpdate=o,e.execFrameRequesters(rb,n,this._updateLoopRestarted)},ab.prototype._renderView=function(e,t){e.execFrameRequesters(nb,t,this._updateLoopRestarted),e.render?e.render():this.gfxEngine.renderView(e),e.execFrameRequesters(ib,t,this._updateLoopRestarted)},ab.prototype.dispose=function(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)};var Ab=!1,lb=8;function cb(e,t,n){var i=e.getContext(),r=i.createShader(t);return i.shaderSource(r,n),i.compileShader(r),r}function hb(){return navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes("firefox")}var ub=function(){return Ab},db=function(){return!!document.documentMode},fb=function(){return lb},pb=function(e){var t=e.getContext();lb=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t.getParameter(t.MAX_TEXTURE_SIZE);var n=t.createProgram(),i=cb(e,t.VERTEX_SHADER,"\nvoid main() {\n    gl_Position = vec4( 0.0, 0.0, 0.0, 1.0 );\n}\n"),r="#define SAMPLE ".concat(lb,"\n");r+="\nuniform sampler2D uni[SAMPLE];\nvoid main() {\n    gl_FragColor += texture2D(uni[SAMPLE-1], vec2(0));\n}\n";var a=cb(e,t.FRAGMENT_SHADER,r);if(t.attachShader(n,i),t.attachShader(n,a),t.linkProgram(n),!1===t.getProgramParameter(n,t.LINK_STATUS)){if(!(lb>16))throw new Error("The GPU capabilities could not be determined accurately.\n                    Impossible to link a shader with the Maximum texture units ".concat(lb));var o=t.getProgramInfoLog(n);console.warn("".concat(o,": using a maximum of 16 texture units instead of the reported value (").concat(lb,")")),hb()&&console.warn("It can come from a Mesa/Firefox bug;\n                        the shader compiles to an error when using more than 16 sampler uniforms,\n                        see https://bugzilla.mozilla.org/show_bug.cgi?id=777028"),lb=16}t.deleteProgram(n),t.deleteShader(i),t.deleteShader(a),Ab=e.capabilities.logarithmicDepthBuffer},mb="\n#include <itowns/WebGL2_pars_vertex>\n#include <itowns/precision_qualifier>\n#include <common>\n#include <itowns/project_pars_vertex>\n#include <itowns/elevation_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nattribute vec2      uv_0;\n#if NUM_CRS > 1\nattribute float     uv_1;\n#endif\nattribute vec3      normal;\n\nuniform mat4 modelMatrix;\nuniform bool lightingEnabled;\nvarying vec2 vHighPrecisionZW;\n\n#if MODE == MODE_FINAL\n#include <fog_pars_vertex>\nvarying vec3        vUv;\nvarying vec3        vNormal;\n#endif\nvoid main() {\n        vec2 uv = vec2(uv_0.x, 1.0 - uv_0.y);\n\n        #include <begin_vertex>\n        #include <itowns/elevation_vertex>\n        #include <project_vertex>\n        #include <logdepthbuf_vertex>\n        vHighPrecisionZW = gl_Position.zw;\n#if MODE == MODE_FINAL\n        #include <fog_vertex>\n        #if NUM_CRS > 1\n        vUv = vec3(uv_0, (uv_1 > 0.) ? uv_1 : uv_0.y); // set uv_1 = uv_0 if uv_1 is undefined\n        #else\n        vUv = vec3(uv_0, 0.0);\n        #endif\n        vNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n#endif\n}\n",gb="\n#include <itowns/WebGL2_pars_fragment>\n#include <itowns/precision_qualifier>\n#include <logdepthbuf_pars_fragment>\n#include <itowns/pitUV>\n#include <itowns/color_layers_pars_fragment>\n#if MODE == MODE_FINAL\n#include <itowns/fog_pars_fragment>\n#include <itowns/overlay_pars_fragment>\n#include <itowns/lighting_pars_fragment>\n#endif\n#include <itowns/mode_pars_fragment>\n\nuniform vec3        diffuse;\nuniform float       opacity;\nvarying vec3        vUv; // uv_0.x/uv_1.x, uv_0.y, uv_1.y\nvarying vec2        vHighPrecisionZW;\n\nvoid main() {\n    #include <logdepthbuf_fragment>\n\n#if MODE == MODE_ID\n\n    #include <itowns/mode_id_fragment>\n\n#elif MODE == MODE_DEPTH\n\n    #include <itowns/mode_depth_fragment>\n\n#else\n\n    gl_FragColor = vec4(diffuse, opacity);\n\n    uvs[0] = vec3(vUv.xy, 0.);\n\n#if NUM_CRS > 1\n    uvs[1] = vec3(vUv.x, fract(vUv.z), floor(vUv.z));\n#endif\n\n    vec4 color;\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_FS_TEXTURES; i ++ ) {\n        color = getLayerColor( i , colorTextures[ i ], colorOffsetScales[ i ], colorLayers[ i ]);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, color.rgb, color.a);\n    }\n\n  #if defined(DEBUG)\n    if (showOutline) {\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_CRS; i ++) {\n            color = getOutlineColor( outlineColors[ i ], uvs[ i ].xy);\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, color.rgb, color.a);\n        }\n    }\n  #endif\n\n    #include <itowns/fog_fragment>\n    #include <itowns/lighting_fragment>\n    #include <itowns/overlay_fragment>\n\n#endif\n}\n",vb=new RegExp("gl_Position.*(?![^]*gl_Position)"),yb=new RegExp("[^\\w]*main[^\\w]*(void)?[^\\w]*{"),wb=function(e){if(!e.vertexShader.includes("USE_LOGDEPTHBUF")&&!e.vertexShader.includes("logdepthbuf_pars_vertex")){e.vertexShader="#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n".concat(e.vertexShader);var t=vb.exec(e.vertexShader),n=t[0].length+t.index;e.vertexShader="".concat(e.vertexShader.slice(0,n),"\n#include <logdepthbuf_vertex>\n").concat(e.vertexShader.slice(n)),e.fragmentShader="#include <itowns/precision_qualifier\n".concat(e.fragmentShader),e.fragmentShader="#include <logdepthbuf_pars_fragment>\n".concat(e.fragmentShader),n=(t=yb.exec(e.fragmentShader))[0].length+t.index,e.fragmentShader="".concat(e.fragmentShader.slice(0,n),"\n#include <logdepthbuf_fragment>\n").concat(e.fragmentShader.slice(n)),e.defines={USE_LOGDEPTHBUF:1,USE_LOGDEPTHBUF_EXT:1}}},xb=function(e,t){return e.replace(/#pragma unroll_loop\s+for\s*\(\s*int\s+i\s*=\s*([\w\d]+);\s*i\s+<\s+([\w\d]+);\s*i\s*\+\+\s*\)\s*\{\n([^}]*)\}/g,(function(e,n,i,r){var a="";n=n in t?t[n]:parseInt(n,10),i=i in t?t[i]:parseInt(i,10);for(var o=n;o<i;o++)a+=r.replace(/\bi\b/g," ".concat(o," "));return a}))},bb={FINAL:0,DEPTH:1,ID:2};var Cb={MODES:bb,push:function(e,t){var n=void 0!==e.mode?e.mode:bb.FINAL;if(n==t)return function(){};var i=function(e){return function(t){var n=t.material;n&&(n.mode=e)}};return e.traverse(i(t)),function(){e.traverse(i(n))}}},Mb=function(e,t,n){Object.keys(n).forEach((function(i){e.defines["".concat(t,"_").concat(i)]=n[i]}))},Bb=function(e,t,n,i){e.defines[n]=i,Object.defineProperty(e,t,{get:function(){return e.defines[n]},set:function(t){e.defines[n]!=t&&(e.defines[n]=t,e.needsUpdate=!0)}})},Ib=function(e,t,n){e.uniforms[t]=new _c(n),Object.defineProperty(e,t,{get:function(){return e.uniforms[t].value},set:function(n){e.uniforms[t].value!=n&&(e.uniforms[t].value=n)}})},Eb=new At(0,0,1,1),Sb=new st,Tb=255/256,Lb=new At(5.9371814131736755e-8,Tb/65536,.0038909912109375,Tb);function Fb(e,t){return t?Lb.dot(e)*t:Lb.dot(e)}function _b(){var e=fb();return Math.min(e-1,15)}var Ub={bias:0,zmin:0,zmax:0,scale:0,mode:0,textureOffset:0,opacity:0,crs:0,effect:0};function Pb(e,t,n){var i,r=e.layers.value,a=e.textures.value,o=e.offsetScales.value,s=e.textureCount,A=0,l=C(t);try{for(l.s();!(i=l.n()).done;){var c=i.value;c.textureOffset=A;for(var h=0,u=c.textures.length;h<u;++h,++A)A<n&&(o[A]=c.offsetScales[h],a[A]=c.textures[h],r[A]=c)}}catch(e){l.e(e)}finally{l.f()}A>n&&console.warn("LayeredMaterial: Not enough texture units (".concat(n," < ").concat(A,"), excess textures have been discarded.")),s.value=A;for(var d=A;d<a.length;d++)a[d]=Sb,o[d]=Eb,r[d]=Ub}var kb,Db={RGBA:0,COLOR:1,DATA:2},Rb=[],Ob=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;if(r(this,n),e=t.call(this,i),kb=kb||[1,_b()],e.defines.NUM_VS_TEXTURES=kb[0],e.defines.NUM_FS_TEXTURES=kb[1],e.defines.USE_FOG=1,e.defines.NUM_CRS=a,Mb(d(e),"ELEVATION",Db),Mb(d(e),"MODE",Cb.MODES),Bb(d(e),"mode","MODE",Cb.MODES.FINAL),__DEBUG__){e.defines.DEBUG=1;var o=[new tt(1,0,0)];a>1&&o.push(new tt(1,.5,0)),Ib(d(e),"showOutline",!0),Ib(d(e),"outlineWidth",.008),Ib(d(e),"outlineColors",o)}ub()&&(e.defines.USE_LOGDEPTHBUF=1,e.defines.USE_LOGDEPTHBUF_EXT=1),e.vertexShader=mb,Rb[a]=Rb[a]||xb(gb,e.defines),e.fragmentShader=Rb[a],Ib(d(e),"diffuse",new Sn(.04,.23,.35)),Ib(d(e),"opacity",e.opacity),Ib(d(e),"lightingEnabled",!1),Ib(d(e),"lightPosition",new tt(-.5,0,1)),Ib(d(e),"fogDistance",1e9),Ib(d(e),"fogColor",new Sn(.76,.85,1)),Ib(d(e),"overlayAlpha",0),Ib(d(e),"overlayColor",new Sn(1,.3,0)),Ib(d(e),"objectId",0),Ib(d(e),"minBorderDistance",-.01),e.layers=[],e.elevationLayerIds=[],e.colorLayerIds=[],e.uniforms.elevationLayers=new _c(new Array(kb[0]).fill(Ub)),e.uniforms.elevationTextures=new _c(new Array(kb[0]).fill(Sb)),e.uniforms.elevationOffsetScales=new _c(new Array(kb[0]).fill(Eb)),e.uniforms.elevationTextureCount=new _c(0),e.uniforms.colorLayers=new _c(new Array(kb[1]).fill(Ub)),e.uniforms.colorTextures=new _c(new Array(kb[1]).fill(Sb)),e.uniforms.colorOffsetScales=new _c(new Array(kb[1]).fill(Eb)),e.uniforms.colorTextureCount=new _c(0);var s=e.visible;return Object.defineProperty(d(e),"visible",{get:function(){return s},set:function(e){s!=e&&(s=e,this.dispatchEvent({type:e?"shown":"hidden"}))}}),e}return o(n,[{key:"onBeforeCompile",value:function(e,t){t.capabilities.isWebGL2&&(this.defines.WEBGL2=!0,e.glslVersion="300 es")}},{key:"getUniformByType",value:function(e){return{layers:this.uniforms["".concat(e,"Layers")],textures:this.uniforms["".concat(e,"Textures")],offsetScales:this.uniforms["".concat(e,"OffsetScales")],textureCount:this.uniforms["".concat(e,"TextureCount")]}}},{key:"updateLayersUniforms",value:function(){var e=this,t=this.layers.filter((function(t){return e.colorLayerIds.includes(t.id)&&t.visible&&t.opacity>0}));if(t.sort((function(t,n){return e.colorLayerIds.indexOf(t.id)-e.colorLayerIds.indexOf(n.id)})),Pb(this.getUniformByType("color"),t,this.defines.NUM_FS_TEXTURES),this.elevationLayerIds.some((function(t){return e.getLayer(t)}))||this.uniforms.elevationTextureCount.value&&!this.elevationLayerIds.length){var n=this.getElevationLayer()?[this.getElevationLayer()]:[];Pb(this.getUniformByType("elevation"),n,this.defines.NUM_VS_TEXTURES)}this.layersNeedUpdate=!1}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"}),this.layers.forEach((function(e){return e.dispose(!0)})),this.layers.length=0,this.layersNeedUpdate=!0}},{key:"setSequence",value:function(e){this.colorLayerIds=e,this.layersNeedUpdate=!0}},{key:"setSequenceElevation",value:function(e){this.elevationLayerIds[0]=e,this.layersNeedUpdate=!0}},{key:"removeLayer",value:function(e){var t=this.layers.findIndex((function(t){return t.id===e}));if(t>-1){this.layers[t].dispose(),this.layers.splice(t,1);var n=this.colorLayerIds.indexOf(e);n>-1?this.colorLayerIds.splice(n,1):this.elevationLayerIds=[]}}},{key:"addLayer",value:function(e){e.layer.id in this.layers&&console.warn('The "{layer.id}" layer was already present in the material, overwritting.'),this.layers.push(e)}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayers",value:function(e){return this.layers.filter((function(t){return e.includes(t.id)}))}},{key:"getElevationLayer",value:function(){var e=this;return this.layers.find((function(t){return t.id===e.elevationLayerIds[0]}))}},{key:"setElevationScale",value:function(e){this.elevationLayerIds.length&&(this.getElevationLayer().scale=e)}}]),n}(uA);function Nb(e,t,n){var i=e.image,r=i.width,a=i.height,o=i.data;if(!o)return{min:null,max:null};var s=function(e,t,n){var i=t.x,r=t.y,a=t.z,o=[Ox({noDataValue:n},e,i,r),Ox({noDataValue:n},e,i+a,r),Ox({noDataValue:n},e,i+a,r+a),Ox({noDataValue:n},e,i,r+a)].filter((function(e){return null!=e&&e>-10}));if(o.length)return{min:Math.min.apply(Math,y(o)),max:Math.max.apply(Math,y(o))}}(e,t,n)||{max:-1/0,min:1/0},A=s.min,l=s.max,c=Math.floor(t.z*r);if(c>2)for(var h=Math.floor(t.z*a),u=Math.floor(t.x*r),d=Math.floor(t.y*a),f=Math.max(Math.floor(c/32),2),p=d+h,m=d;m<p;m+=f)for(var g=m*(r||0)+u,v=g+c;g<v;g+=f){var w=o[g];w>-10&&w!=n&&(l=Math.max(l,w),A=Math.min(A,w))}return l===-1/0||A===1/0?{min:null,max:null}:{min:A,max:l}}function Gb(e,t,n){var i=e%n/n,r=Math.floor(e/n)/n,a=t.x+i*t.z,o=t.y+r*t.w;return Math.floor(o*n)*n+Math.floor(a*n)}var Qb=new At,Hb=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this)).layer=i,a.crs=i.parent.tileMatrixSets.indexOf(ix.formatToTms(i.crs)),-1==a.crs&&console.error("Unknown crs:",i.crs),a.textures=[],a.offsetScales=[],a.level=-1,a.material=e,a._handlerCBEvent=function(){a.material.layersNeedUpdate=!0},i.addEventListener("visible-property-changed",a._handlerCBEvent),a}return o(n,[{key:"id",get:function(){return this.layer.id}},{key:"opacity",get:function(){return this.layer.opacity}},{key:"visible",get:function(){return this.layer.visible}},{key:"initFromParent",value:function(e,t){if(e&&e.level>this.level){var n,i=0,r=C(t);try{for(r.s();!(n=r.n()).done;){var a,o=n.value,s=C(e.textures);try{for(s.s();!(a=s.n()).done;){var A=a.value;if(o.isInside(A.extent)){this.setTexture(i++,A,o.offsetToParent(A.extent));break}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){r.e(e)}finally{r.f()}__DEBUG__&&i!=t.length&&console.error("non-coherent result ".concat(i," vs ").concat(t.length,"."),t)}}},{key:"dispose",value:function(e){e&&(this.layer.removeEventListener("visible-property-changed",this._handlerCBEvent),this._listeners={});var t,n=C(this.textures);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.isTexture&&i.dispose()}}catch(e){n.e(e)}finally{n.f()}this.level=-1,this.textures=[],this.offsetScales=[],this.material.layersNeedUpdate=!0}},{key:"setTexture",value:function(e,t,n){this.level=t&&0==e?t.extent.zoom:this.level,this.textures[e]=t||null,this.offsetScales[e]=n,this.material.layersNeedUpdate=!0}},{key:"setTextures",value:function(e,t){this.dispose(!1);for(var n=0,i=e.length;n<i;++n)this.setTexture(n,e[n],t[n])}}]),n}(Xe),zb=function(e){A(n,e);var t=p(n);function n(){return r(this,n),t.apply(this,arguments)}return o(n,[{key:"effect",get:function(){return this.layer.fx}}]),n}(Hb),Vb=function(e){A(n,e);var t=p(n);function n(e,i){var a;r(this,n),a=t.call(this,e,i);var o={bias:0,scale:1,mode:Db.DATA,zmin:0,zmax:1/0},s=1;if(i.useRgbaTextureElevation)throw o.mode=Db.RGBA,o.zmax=5e3,new Error("Restore this feature");return i.useColorTextureElevation?(s=i.colorTextureElevationMaxZ-i.colorTextureElevationMinZ,o.mode=Db.COLOR,o.bias=i.colorTextureElevationMinZ,a.min=a.layer.colorTextureElevationMinZ,a.max=a.layer.colorTextureElevationMaxZ):(a.min=0,a.max=0),a.bias=i.bias||o.bias,a.scale=(i.scale||o.scale)*s,a.mode=i.mode||o.mode,a.zmin=i.zmin||o.zmin,a.zmax=i.zmax||o.zmax,a}return o(n,[{key:"initFromParent",value:function(e,t){g(l(n.prototype),"initFromParent",this).call(this,e,t),this.updateMinMaxElevation()}},{key:"setTextures",value:function(e,t){this.replaceNoDataValueFromTexture(e[0]),g(l(n.prototype),"setTextures",this).call(this,e,t),this.updateMinMaxElevation()}},{key:"updateMinMaxElevation",value:function(){if(this.textures[0]&&!this.layer.useColorTextureElevation){var e=Nb(this.textures[0],this.offsetScales[0],this.layer.noDataValue),t=e.min,n=e.max;this.min==t&&this.max==n||(this.min=t,this.max=n,this.dispatchEvent({type:"updatedElevation",node:this}))}}},{key:"replaceNoDataValueFromTexture",value:function(e){var t=this.layer.noDataValue;if(null!=t){var n,i,r,a=this.textures[0],o=a&&a.image&&a.image.data,s=e.image&&e.image.data;!s||!o||(i=t,r=(n=s).length,n[0]>i&&n[r-1]>i&&n[Math.sqrt(r)-1]>i&&n[r-Math.sqrt(r)]>i)||(e.extent.offsetToParent(a.extent,Qb),function(e,t,n,i){for(var r=0,a=e.length;r<a;++r)e[r]===n&&(e[r]=t[Gb(r,i,256)])}(s,o,t,Qb))}}}]),n}(Hb);function jb(e,t,n){return e.pendingSubdivision?n:t}function Wb(e,t){var n=t.groups.filter((function(t){return t<=e}));return n.length?n[n.length-1]:t.groups[0]}function Xb(e,t,n){return Math.min(e,t+(n.increment||1))}function Zb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return-1==t?n.zoom?n.zoom.min:0:Math.min(e,Math.ceil((t+e)/2))}function Yb(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.level,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=a.source.zoom?a.source.zoom.max:1/0;if(o.lowestLevelError!=1/0)n=Zb(o.lowestLevelError,r,a.source),n=o.lowestLevelError==n?n-1:n,1==e&&(n=Wb(n,a.updateStrategy.options));else{switch(e){case 1:n=Wb(i,a.updateStrategy.options);break;case 2:n=Xb(i,r,a.updateStrategy.options);break;case 3:n=Zb(i,r,a.source);break;case 0:default:n=jb(t,i,r)}n=Math.min(n,s)}return n}var Kb,Jb=function(){function e(t){r(this,e),this.layer=t}return o(e,[{key:"clear",value:function(){}},{key:"update",value:function(){}}]),e}(),qb=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).displayed={tiles:new Set},Object.defineProperty(i.displayed,"layers",{get:function(){var e=[];return i.displayed.tiles.forEach((function(t){var n=t.material;e=y(new Set([].concat(y(e),y(n.colorLayerIds.filter((function(e){return n.getLayer(e)}))),y(n.elevationLayerIds))))})),i.layer.attachedLayers.filter((function(t){return e.includes(t.id)}))}}),Object.defineProperty(i.displayed,"extent",{get:function(){var e=new Sx(i.layer.extent.crs,1/0,-1/0,1/0,-1/0);return e.min=1/0,e.max=-1/0,i.displayed.tiles.forEach((function(t){e.union(t.extent),e.min=Math.min(t.obb.z.min,e.min),e.max=Math.max(t.obb.z.max,e.max)})),e}}),i}return o(n,[{key:"clear",value:function(){this.displayed.tiles.clear()}},{key:"update",value:function(e){e.material.visible?this.displayed.tiles.add(e):this.displayed.tiles.delete(e)}}]),n}(Jb),$b={INFINITE:1/0,TEXTURE:9e5,GEOMETRY:9e5},eC=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$b.INFINITE;r(this,e),this.lifeTime=t,this.lastTimeFlush=Date.now(),this.data=new Map}return o(e,[{key:"getByArray",value:function(e){return this.get(e[0],e[1],e[2])}},{key:"setByArray",value:function(e,t){return this.set(e,t[0],t[1],t[2])}},{key:"get",value:function(e,t,n){var i=this.data.get(e);if(null!=i){if(null!=i.lastTimeUsed)Kb=i;else{var r=i.get(t);if(null==r)return;if(null!=r.lastTimeUsed)Kb=r;else{var a=r.get(n);if(null==a)return;Kb=a}}return Kb.value?(Kb.lastTimeUsed=Date.now(),Kb.value):void 0}}},{key:"set",value:function(e,t,n,i){if(Kb={value:e,lastTimeUsed:Date.now()},null==n)return this.data.set(t,Kb),e;this.data.get(t)||this.data.set(t,new Map);var r=this.data.get(t);return null==i?(r.set(n,Kb),e):(r.get(n)||r.set(n,new Map),r.get(n).set(i,Kb),e)}},{key:"delete",value:function(e,t,n){var i=this.data.get(e);if(void 0!==i)if(null!=i.lastTimeUsed)this.data.get(e),this.data.delete(e);else{var r=i.get(t);if(void 0===r)return;if(null!=r.lastTimeUsed)i.get(t),i.delete(t),0==i.size&&this.data.delete(e);else{if(void 0===r.get(n))return;r.get(n),r.delete(n),0==r.size&&(i.delete(t),0==i.size&&this.data.delete(e))}}}},{key:"clear",value:function(){this.data.clear()}},{key:"flush",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();this.lifeTime==$b.INFINITE||this.lifeTime>t-this.lastTimeFlush||!this.data.size||(this.lastTimeFlush=1/0,this.data.forEach((function(n,i){e.lifeTime<t-n.lastTimeUsed?(e.data.get(i),e.data.delete(i)):(n.forEach((function(i,r){e.lifeTime<t-i.lastTimeUsed?(n.get(r),n.delete(r)):(i.forEach((function(n,r){e.lifeTime<t-n.lastTimeUsed?(i.get(r),i.delete(r)):e.lastTimeFlush=Math.min(e.lastTimeFlush,n.lastTimeUsed)})),i.size||(n.get(r),n.delete(r)))})),n.size||(e.data.get(i),e.data.delete(i)))})),0==this.data.size&&(this.lastTimeFlush=Date.now()))}}]),e}(),tC=new KA,nC=256;function iC(e){if(!e.ok){var t=new Error("Error loading ".concat(e.url,": status ").concat(e.status));throw t.response=e,t}}var rC=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,t).then((function(e){return iC(e),e.arrayBuffer()}))};function aC(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=new Gi(e,nC,nC,ue,q);return n.internalFormat="R32F",n}return new Gi(e,nC,nC,re,q)}var oC={text:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(fetch)return fetch(e,t).then((function(e){return iC(e),e.text()}));console.log("fetch is not defind")},json:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(fetch)return fetch(e,t).then((function(e){return iC(e),e.json()}));console.log("fetch is not defind")},xml:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(fetch)return fetch(e,t).then((function(e){return iC(e),e.text()})).then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")}));console.log("fetch is not defind")},texture:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};tC.crossOrigin=i.crossOrigin;var r=new Promise((function(e,i){t=e,n=i}));return tC.load(e,t,(function(){}),n),r},arrayBuffer:rC,textureFloat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rC(e,t).then((function(e){return aC(new Float32Array(e),t.isWebGL2)}))},multiple:function(e,t){var n,i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[];for(var o in t){if(!this[o])throw new Error("".concat(o," is not a valid Fetcher method."));var s,A=C(t[o]);try{var l=function(){var t=s.value;n="".concat(e,".").concat(t),a.push(i[o](n,r).then((function(e){return{type:t,result:e}})))};for(A.s();!(s=A.n()).done;)l()}catch(e){A.e(e)}finally{A.f()}}return Promise.all(a).then((function(e){var t,n={},i=C(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r.type]=r.result}}catch(e){i.e(e)}finally{i.f()}return Promise.resolve(n)}))}},sC=new eC,AC={};function lC(e,t,n,i){n[e]=n[e]||{};var r,a=C(AC[e]);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=hC(t[e][o],i);void 0!==s&&(n[e][o]=s)}}catch(e){a.e(e)}finally{a.f()}}function cC(e){if(!e)return{};if(e.stops||e.expression)return{color:e};if("string"==typeof e){var t=e.match(/(?:((hsl|rgb)a? *\(([\d.%]+(?:deg|g?rad|turn)?)[ ,]*([\d.%]+)[ ,]*([\d.%]+)[ ,/]*([\d.%]*)\))|(#((?:[\d\w]{3}){1,2})([\d\w]{1,2})?))/i);if(!t)return{color:e,opacity:1};if(t[7]){var n=1;return t[9]&&(n=.00392156862745098*parseInt(1==t[9].length?"".concat(t[9]).concat(t[9]):t[9],16)),{color:"#".concat(t[8]),opacity:n}}if(t[0])return{color:"".concat(t[2],"(").concat(t[3],",").concat(t[4],",").concat(t[5],")"),opacity:Number(t[6])||1}}}function hC(e,t){if(null!=e){if(e.expression)return e.expression.evaluate(t);if(e.stops){for(var n=e.stops.length-1;n>=0;n--){var i=e.stops[n];if(t.globals.zoom>=i[0])return i[1]}return e.stops[0][1]}return e}}function uC(e,t){var n=document.createElement("img"),i=document.createElement("canvas");if("string"==typeof e)n.src=e;else if(e&&e[t]){var r=e[t];i.width=r.width,i.height=r.height,i.getContext("2d").drawImage(e.img,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.src=i.toDataURL("image/png")}return n}var dC={left:[0,-.5],right:[-1,-.5],top:[-.5,0],bottom:[-.5,-1],"top-right":[-1,0],"bottom-left":[0,-1],"bottom-right":[-1,-1],center:[-.5,-.5],"top-left":[0,0]};function fC(e,t,n,i,r){var a;Object.defineProperty(e[t],n,{enumerable:!0,get:function(){return void 0===a?e.parent[t][n]||r:a},set:function(e){a=e}}),e[t][n]=i}var pC=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;r(this,e),this.isStyle=!0,this.order=0,this.parent=i||{zoom:{},fill:{},stroke:{},point:{},text:{}},n.zoom=n.zoom||{},n.fill=n.fill||{},n.stroke=n.stroke||{},n.point=n.point||{},n.text=n.text||{},this.zoom={},fC(this,"zoom","min",n.zoom.min),fC(this,"zoom","max",n.zoom.max),this.fill={},fC(this,"fill","color",n.fill.color),fC(this,"fill","opacity",n.fill.opacity,1),fC(this,"fill","pattern",n.fill.pattern),"string"==typeof this.fill.pattern&&oC.texture(this.fill.pattern).then((function(e){t.fill.pattern=e.image})),this.stroke={},fC(this,"stroke","color",n.stroke.color),fC(this,"stroke","opacity",n.stroke.opacity,1),fC(this,"stroke","width",n.stroke.width,1),fC(this,"stroke","dasharray",n.stroke.dasharray,[]),this.point={},fC(this,"point","color",n.point.color),fC(this,"point","line",n.point.line),fC(this,"point","opacity",n.point.opacity,1),fC(this,"point","radius",n.point.radius,2),fC(this,"point","width",n.point.width,0),this.text={},fC(this,"text","field",n.text.field),fC(this,"text","zOrder",n.text.zOrder,"auto"),fC(this,"text","color",n.text.color,"#000000"),fC(this,"text","anchor",n.text.anchor,"center"),fC(this,"text","offset",n.text.offset,[0,0]),fC(this,"text","padding",n.text.padding,2),fC(this,"text","size",n.text.size,16),fC(this,"text","placement",n.text.placement,"point"),fC(this,"text","rotation",n.text.rotation,"auto"),fC(this,"text","wrap",n.text.wrap,10),fC(this,"text","spacing",n.text.spacing,0),fC(this,"text","transform",n.text.transform,"none"),fC(this,"text","justify",n.text.justify,"center"),fC(this,"text","opacity",n.text.opacity,1),fC(this,"text","font",n.text.font,["Open Sans Regular","Arial Unicode MS Regular","sans-serif"]),fC(this,"text","haloColor",n.text.haloColor,"#000000"),fC(this,"text","haloWidth",n.text.haloWidth,0),fC(this,"text","haloBlur",n.text.haloBlur,0)}return o(e,[{key:"drawingStylefromContext",value:function(e){var t={};if((this.fill.color||this.fill.pattern)&&lC("fill",this,t,e),this.stroke.color&&lC("stroke",this,t,e),this.point.color&&lC("point",this,t,e),Object.keys(t).length)return t}},{key:"symbolStylefromContext",value:function(t){var n=new e;return lC("text",this,n,t),this.icon&&lC("icon",this,n,t),n}},{key:"copy",value:function(e){return Object.assign(this.fill,e.fill),Object.assign(this.stroke,e.stroke),Object.assign(this.point,e.point),Object.assign(this.text,e.text),this}},{key:"clone",value:function(){var t=new e;return t.copy(this)}},{key:"setFromGeojsonProperties",value:function(e,t){return t===bC.POINT?(this.point.color=e.fill,this.point.opacity=e["fill-opacity"],this.point.line=e.stroke,this.point.radius=e.radius,this.text.color=e["label-color"],this.text.opacity=e["label-opacity"],this.text.size=e["label-size"],e.icon&&(this.icon={image:e.icon,size:1})):(this.stroke.color=e.stroke,this.stroke.width=e["stroke-width"],this.stroke.opacity=e["stroke-opacity"],t!==bC.LINE&&(this.fill.color=e.fill,this.fill.opacity=e["fill-opacity"])),this}},{key:"setFromVectorTileLayer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.layout=e.layout||{},e.paint=e.paint||{},this.order=n,"fill"!==e.type||this.fill.color)if("line"!==e.type||this.stroke.color){if("circle"===e.type||i){var r=cC(void e.paint["circle-color"]),a=r.color,o=r.opacity;this.point.color=a,this.point.opacity=o,this.point.radius=void e.paint["circle-radius"]}else if("symbol"===e.type){this.text.zOrder=void e.layout["symbol-z-order"],"auto"==this.text.zOrder?this.text.zOrder=void e.layout["symbol-sort-key"]||"Y":"viewport-y"==this.text.zOrder?this.text.zOrder="Y":"source"==this.text.zOrder&&(this.text.zOrder=0),this.text.anchor=void e.layout["text-anchor"],this.text.offset=void e.layout["text-offset"],this.text.padding=void e.layout["text-padding"],this.text.size=void e.layout["text-size"],this.text.placement=void e.layout["symbol-placement"],this.text.rotation=void e.layout["text-rotation-alignment"],this.text.field=void e.layout["text-field"],this.text.wrap=void e.layout["text-max-width"],this.text.spacing=void e.layout["text-letter-spacing"],this.text.transform=void e.layout["text-transform"],this.text.justify=void e.layout["text-justify"];var s=cC(void e.paint["text-color"]),A=s.color,l=s.opacity;this.text.color=A,this.text.opacity=void e.paint["text-opacity"]||void 0!==l&&l,this.text.font=void e.layout["text-font"];var c=void e.paint["text-halo-color"];c&&(this.text.haloColor=c.color||c,this.text.haloWidth=void e.paint["text-halo-width"],this.text.haloBlur=void e.paint["text-halo-blur"]);var h=void e.layout["icon-image"];h&&(this.icon={key:h},this.icon.size=void e.layout["icon-size"]||1)}}else{var u=void e.paint["line-color"],d=cC(u),f=d.color,p=d.opacity;this.stroke.dasharray=void e.paint["line-dasharray"],this.stroke.color=f,this.stroke.lineCap=e.layout["line-cap"],this.stroke.width=void e.paint["line-width"],this.stroke.opacity=void e.paint["line-opacity"]||p}else{var m=cC(void(e.paint["fill-color"]||e.paint["fill-pattern"])),g=m.color,v=m.opacity;if(this.fill.color=g,this.fill.opacity=void e.paint["fill-opacity"]||v,e.paint["fill-pattern"]&&t&&(this.fill.pattern=uC(t,e.paint["fill-pattern"])),e.paint["fill-outline-color"]){var y=cC(void e.paint["fill-outline-color"]),w=y.color,x=y.opacity;this.stroke.color=w,this.stroke.opacity=x,this.stroke.width=1,this.stroke.dasharray=[]}}return this}},{key:"applyToHTML",value:function(e,t){var n=this;if(e.style.padding="".concat(this.text.padding,"px"),e.style.maxWidth="".concat(this.text.wrap,"em"),e.style.color=this.text.color,this.text.size>0&&(e.style.fontSize="".concat(this.text.size,"px")),e.style.fontFamily=this.text.font.join(","),e.style.textTransform=this.text.transform,e.style.letterSpacing="".concat(this.text.spacing,"em"),e.style.textAlign=this.text.justify,e.style["white-space"]="pre-line",this.text.haloWidth>0&&(e.style.setProperty("--text_stroke_display","block"),e.style.setProperty("--text_stroke_width","".concat(this.text.haloWidth,"px")),e.style.setProperty("--text_stroke_color",this.text.haloColor),e.setAttribute("data-before",e.textContent)),this.icon){var i=this.icon.image,r=this.icon.size,a=this.icon.key,o=sC.get(i||a,r);o||((o=a&&t?uC(t,a):uC(i)).style.position="absolute",sC.set(o,i||a,r));var s=function t(){var i=o.cloneNode();switch(i.width*=r,i.height*=r,n.text.anchor){case"left":i.style.right="calc(100% - ".concat(.5*i.width,"px)"),i.style.top="calc(50% - ".concat(.5*i.height,"px)");break;case"right":i.style.top="calc(50% - ".concat(.5*i.height,"px)");break;case"top":i.style.right="calc(50% - ".concat(.5*i.width,"px)");break;case"bottom":i.style.top="calc(100% - ".concat(.5*i.height,"px)"),i.style.right="calc(50% - ".concat(.5*i.width,"px)");break;case"bottom-left":i.style.top="calc(100% - ".concat(.5*i.height,"px)"),i.style.right="calc(100% - ".concat(.5*i.width,"px)");break;case"bottom-right":i.style.top="calc(100% - ".concat(.5*i.height,"px)");break;case"top-left":i.style.right="calc(100% - ".concat(.5*i.width,"px)");break;case"top-right":break;case"center":default:i.style.top="calc(50% - ".concat(.5*i.height,"px)"),i.style.right="calc(50% - ".concat(.5*i.width,"px)")}i.style["z-index"]=-1,e.appendChild(i),o.removeEventListener("load",t)};o.complete?s():o.addEventListener("load",s)}}},{key:"getTextAnchorPosition",value:function(){return dC[this.text.anchor]}},{key:"getTextFromProperties",value:function(e){return this.text.field.expression?hC(this.text.field,e):this.text.field.replace(/\{(.+?)\}/g,(function(t,n){return e.properties()[n]||""})).trim()}}]),e}(),mC={itowns_stroke_single_before:".itowns-stroke-single:before {\n    display: var(--text_stroke_display);\n    content: attr(data-before);\n    opacity: 1;\n    position: absolute;\n    -webkit-text-stroke-width: var(--text_stroke_width);\n    -webkit-text-stroke-color: var(--text_stroke_color);\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n    z-index: -1;\n    white-space: inherit;\n    overflow-wrap: inherit;\n    letter-spacing: inherit;\n    text-align: inherit;\n    padding: inherit;\n    font-family: inherit;\n    text-transform: inherit;\n    max-width: inherit;\n    font-size: inherit;\n}\n"},gC=document.createElement("style");gC.type="text/css",Object.keys(mC).forEach((function(e){gC.innerHTML+="".concat(mC[e],"\n\n")})),document.getElementsByTagName("head")[0].appendChild(gC);var vC=new pC;function yC(e){return new Sx(e,1/0,-1/0,1/0,-1/0)}AC.fill=Object.keys(vC.fill),AC.stroke=Object.keys(vC.stroke),AC.point=Object.keys(vC.point),AC.text=Object.keys(vC.text),AC.icon=["image","size","key"];var wC=new ux("EPSG:4326",0,0,0),xC=new tt(0,0,1),bC={POINT:0,LINE:1,POLYGON:2},CC=function(){function e(t){r(this,e),this.indices=[],this.properties={},this.size=t.size,t.extent&&(this.extent=yC(t.extent.crs),this._currentExtent=yC(t.extent.crs))}return o(e,[{key:"startSubGeometry",value:function(e,t){var n=this.indices.length-1,i=this.extent?yC(this.extent.crs):void 0,r=n>-1?this.indices[n].offset+this.indices[n].count:t.vertices.length/this.size;this.indices.push({offset:r,count:e,extent:i}),this._currentExtent=i,function(e,t){e.vertices.length+=t*e.size,e.normals&&(e.normals.length=e.vertices.length)}(t,e)}},{key:"closeSubGeometry",value:function(e,t){var n=this.indices.length-1,i=n>-1?this.indices[n].offset+this.indices[n].count:t.vertices.length/this.size-e;this.indices.push({offset:i,count:e,extent:this._currentExtent}),this.extent&&(this.extent.union(this._currentExtent),this._currentExtent=yC(this.extent.crs))}},{key:"getLastSubGeometry",value:function(){var e=this.indices.length-1;return this.indices[e]}},{key:"pushCoordinates",value:function(e,t){e.as(t.crs,wC),t.normals&&wC.geodesicNormal.toArray(t.normals,t._pos),t._pushValues(wC.x,wC.y,wC.z),this._currentExtent&&this._currentExtent.expandByCoordinates(t.useCrsOut?wC:e)}},{key:"pushCoordinatesValues",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xC;e.normals&&r.toArray(e.normals,e._pos),e._pushValues(t,n,i),this._currentExtent&&this._currentExtent.expandByValuesCoordinates(t,n,i)}},{key:"updateExtent",value:function(){if(this.extent){var e=this.indices[this.indices.length-1];e&&this.extent.union(e.extent)}}}]),e}();function MC(e,t){this.vertices[this._pos++]=e,this.vertices[this._pos++]=t}function BC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.vertices[this._pos++]=e,this.vertices[this._pos++]=t,this.vertices[this._pos++]=n}var IC=function(){function e(t,n){if(r(this,e),!Object.keys(bC).find((function(e){return bC[e]===t})))throw new Error("Unsupported Feature type: ".concat(t));this.type=t,this.geometries=[],this.vertices=[],this.crs=n.crs,this.size=n.size,this.normals=3==n.size?[]:void 0,n.extent&&(this.extent=yC(n.extent.crs),this.useCrsOut=!n.forceExtentCrs),this._pos=0,this._pushValues=(3===this.size?BC:MC).bind(this),this.style=new pC({},n.style)}return o(e,[{key:"bindNewGeometry",value:function(){var e=new CC(this);return this.geometries.push(e),e}},{key:"updateExtent",value:function(e){this.extent&&this.extent.union(e.extent)}},{key:"geometryCount",get:function(){return this.geometries.length}}]),e}(),EC=function(){function e(t){r(this,e),this.isFeatureCollection=!0,this.crs=ix.formatToEPSG(t.crs),this.features=[],this.mergeFeatures=void 0===t.mergeFeatures||t.mergeFeatures,this.extent=t.buildExtent?yC(t.forcedExtentCrs||this.crs):void 0,this.translation=new tt,this.scale=new tt(1,1,1),this.size="3d"==t.structure?3:2,this.filterExtent=t.filterExtent,this.overrideAltitudeInToZero=t.overrideAltitudeInToZero,this.style=t.style}return o(e,[{key:"updateExtent",value:function(e){if(this.extent){var t,n=C(e?[e]:this.features.map((function(e){return e.extent})));try{for(n.s();!(t=n.n()).done;){var i=t.value;this.extent.union(i)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"removeEmptyFeature",value:function(){this.features=this.features.filter((function(e){return e.geometries.length}))}},{key:"pushFeature",value:function(e){this.features.push(e),this.updateExtent(e.extent)}},{key:"requestFeature",value:function(e,t){var n=this.features.find(t);if(n&&this.mergeFeatures)return n;var i=new IC(e,this);return this.features.push(i),i}},{key:"requestFeatureByType",value:function(e){return this.requestFeature(e,(function(t){return t.type===e}))}},{key:"requestFeatureById",value:function(e,t){return this.requestFeature(t,(function(t){return t.id===e}))}},{key:"newFeatureByReference",value:function(e){var t=new IC(e.type,this);return t.extent=e.extent,t.geometries=e.geometries,t.normals=e.normals,t.size=e.size,t.vertices=e.vertices,t._pos=e._pos,this.features.push(t),t}},{key:"transformCoordinates",value:function(e){return e.x=e.x/this.scale.x-this.translation.x,e.y=e.y/this.scale.y-this.translation.y,e.z=e.z/this.scale.z-this.translation.z,e}},{key:"setParentStyle",value:function(e){e&&this.features.forEach((function(t){t.style.parent=e}))}}]),e}(),SC=function(e){if(e.crsOut||e.crsIn){console.warn("Parsing options with crsIn and crsOut are deprecates, use { in, out } structure.");var t={in:{},out:{}};return t.in.crs=e.crsIn,t.in.isInverted=e.isInverted,t.in.styles=e.styles,t.in.layers=e.layers,t.in.filter=e.filter,t.out.crs=e.crsOut,t.out.mergeFeatures=e.mergeFeatures,t.out.withNormal=e.withNormal,t.out.withAltitude=e.withAltitude,e.out.withAltitude&&e.out.withNormal?t.structure="3d":t.structure="2d",t.out.filteringExtent=e.filteringExtent,t.out.style=e.style,t.out.overrideAltitudeInToZero=e.overrideAltitudeInToZero,t.out.filter=e.filter,t}return!e.out||void 0===e.out.withAltitude&&void 0===e.out.withNormal||(console.warn("Parsing options out.withAltitude and out.withNormal are deprecates, use out.structure: 2d or 3d."),e.out.withAltitude&&e.out.withNormal?e.structure="3d":e.structure="2d"),e};function TC(e){if(e.crs){if("epsg"==e.crs.type.toLowerCase())return"EPSG:".concat(e.crs.properties.code);if("name"==e.crs.type.toLowerCase()){var t=e.crs.properties.name.toLowerCase().indexOf("epsg:");if(t>=0){var n=e.crs.properties.name.indexOf(":",t+5);if(n>0)return"EPSG:".concat(e.crs.properties.name.substr(n+1))}}throw new Error("Unsupported CRS type '".concat(e.crs,"'"))}return"EPSG:4326"}var LC=new ux("EPSG:4978",0,0,0),FC=function(e,t,n){return LC.crs=n,LC.setFromArray(t[0]),!e.isPointInside(LC)},_C={populateGeometry:function(e,t,n,i,r){n.startSubGeometry(t.length,r);var a,o=!i.overrideAltitudeInToZero&&3==i.size&&"number"==typeof t[0][2],s=C(t);try{for(s.s();!(a=s.n()).done;){var A=a.value;LC.crs=e,LC.setFromValues(A[0],A[1],o?A[2]:0),n.pushCoordinates(LC,r)}}catch(e){s.e(e)}finally{s.f()}n.updateExtent()},point:function(e,t,n,i,r){this.default(e,t,[n],i,r)},default:function(e,t,n,i,r){if(!i.filterExtent||!FC(i.filterExtent,n,t)){var a=e.bindNewGeometry();a.properties=r,a.properties.style=new pC({},e.style).setFromGeojsonProperties(r,e.type),this.populateGeometry(t,n,a,i,e),e.updateExtent(a)}},polygon:function(e,t,n,i,r){if(!i.filterExtent||!FC(i.filterExtent,n[0],t)){var a=e.bindNewGeometry();a.properties=r,a.properties.style=new pC({},e.style).setFromGeojsonProperties(r,e.type);for(var o=0;o<n.length;o++)this.populateGeometry(t,n[o],a,i,e);e.updateExtent(a)}},multi:function(e,t,n,i,r,a){var o,s=C(i);try{for(s.s();!(o=s.n()).done;){var A=o.value;this[e](t,n,A,r,a)}}catch(e){s.e(e)}finally{s.f()}}};var UC=["type","geometry","properties"];function PC(e,t,n){for(var i=t.geometry.type.toLowerCase(),r=function(e){switch(e){case"point":case"multipoint":return bC.POINT;case"linestring":case"multilinestring":return bC.LINE;case"polygon":case"multipolygon":return bC.POLYGON;case"geometrycollection":default:throw new Error("Unhandled geometry type ".concat(e))}}(i),a=n.requestFeatureByType(r),o="point"!=i?t.geometry.coordinates:[t.geometry.coordinates],s=t.properties||{},A=0,l=Object.keys(t);A<l.length;A++){var c=l[A];UC.includes(c.toLowerCase())||(s.geojson=s.geojson||{},s.geojson[c]=t[c])}return function(e,t,n,i,r,a){if(0!=i.length)switch(e){case"point":case"linestring":return _C.default(t,n,i,r,a);case"multipoint":return _C.multi("point",t,n,i,r,a);case"multilinestring":return _C.multi("default",t,n,i,r,a);case"polygon":return _C.polygon(t,n,i,r,a);case"multipolygon":return _C.multi("polygon",t,n,i,r,a);case"geometrycollection":default:throw new Error("Unhandled geojson type ".concat(t.type))}}(i,a,e,o,n,s),a}function kC(e,t,n){var i,r=new EC(n),a=n.filter||function(){return!0},o=C(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;a(s.properties,s.geometry)&&PC(e,s,r)}}catch(e){o.e(e)}finally{o.f()}return r.removeEmptyFeature(),r.updateExtent(),r}var DC={parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(t=SC(t)).in=t.in||{};var n=t.out,i=t.in;switch("string"==typeof e&&(e=JSON.parse(e)),i.crs=i.crs||TC(e),n.filteringExtent&&("boolean"==typeof n.filteringExtent?n.filterExtent=e.extent.as(i.crs):n.filteringExtent.isExtent&&(n.filterExtent=n.filteringExtent)),e.type.toLowerCase()){case"featurecollection":return Promise.resolve(kC(i.crs,e.features,n));case"feature":return Promise.resolve(kC(i.crs,[e],n));default:throw new Error("Unsupported GeoJSON type: '".concat(e.type))}}};function RC(e,t){return Array.from(e.getElementsByTagName(t))}function OC(e){return"#"===e[0]?e:`#${e}`}function NC(e){return e?.normalize(),e&&e.textContent||""}function GC(e,t,n){const i=e.getElementsByTagName(t),r=i.length?i[0]:null;return r&&n&&n(r),r}function QC(e,t,n){const i={};if(!e)return i;const r=e.getElementsByTagName(t),a=r.length?r[0]:null;return a&&n?n(a,i):i}function HC(e,t,n){const i=NC(GC(e,t));return i&&n&&n(i)||{}}function zC(e,t,n){const i=parseFloat(NC(GC(e,t)));if(!isNaN(i))return i&&n&&n(i)||{}}function VC(e,t,n){const i=parseFloat(NC(GC(e,t)));if(!isNaN(i))return i&&n&&n(i),i}function jC(e,t){const n={};for(const i of t)HC(e,i,(e=>{n[i]=e}));return n}function WC(e){return 1===e?.nodeType}function XC(e){return QC(e,"line",(e=>Object.assign({},HC(e,"color",(e=>({stroke:`#${e}`}))),zC(e,"opacity",(e=>({"stroke-opacity":e}))),zC(e,"width",(e=>({"stroke-width":96*e/25.4}))))))}function ZC(e){let t=[];if(null===e)return t;for(const n of Array.from(e.childNodes)){if(!WC(n))continue;const e=YC(n.nodeName);if("gpxtpx:TrackPointExtension"===e)t=t.concat(ZC(n));else{const i=NC(n);t.push([e,KC(i)])}}return t}function YC(e){return["heart","gpxtpx:hr","hr"].includes(e)?"heart":e}function KC(e){const t=parseFloat(e);return isNaN(t)?e:t}function JC(e){const t=[parseFloat(e.getAttribute("lon")||""),parseFloat(e.getAttribute("lat")||"")];if(isNaN(t[0])||isNaN(t[1]))return null;VC(e,"ele",(e=>{t.push(e)}));const n=GC(e,"time");return{coordinates:t,time:n?NC(n):null,extendedValues:ZC(GC(e,"extensions"))}}function qC(e){const t=jC(e,["name","cmt","desc","type","time","keywords"]),n=Array.from(e.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*"));for(const i of n)i.parentNode?.parentNode===e&&(t[i.tagName.replace(":","_")]=NC(i));const i=RC(e,"link");return i.length&&(t.links=i.map((e=>Object.assign({href:e.getAttribute("href")},jC(e,["text","type"]))))),t}function $C(e,t){const n=RC(e,t),i=[],r=[],a={};for(let e=0;e<n.length;e++){const t=JC(n[e]);if(t){i.push(t.coordinates),t.time&&r.push(t.time);for(const[i,r]of t.extendedValues){const t="heart"===i?i:i.replace("gpxtpx:","")+"s";a[t]||(a[t]=Array(n.length).fill(null)),a[t][e]=r}}}if(!(i.length<2))return{line:i,times:r,extendedValues:a}}function eM(e){const t=$C(e,"rtept");if(t)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},qC(e),XC(GC(e,"extensions"))),geometry:{type:"LineString",coordinates:t.line}}}function tM(e){const t=RC(e,"trkseg"),n=[],i=[],r=[];for(const e of t){const t=$C(e,"trkpt");t&&(r.push(t),t.times&&t.times.length&&i.push(t.times))}if(0===r.length)return null;const a=r.length>1,o=Object.assign({_gpxType:"trk"},qC(e),XC(GC(e,"extensions")),i.length?{coordinateProperties:{times:a?i:i[0]}}:{});for(const e of r){n.push(e.line),o.coordinateProperties||(o.coordinateProperties={});const t=o.coordinateProperties,i=Object.entries(e.extendedValues);for(let e=0;e<i.length;e++){const[n,o]=i[e];a?(t[n]||(t[n]=r.map((e=>new Array(e.line.length).fill(null)))),t[n][e]=o):t[n]=o}}return{type:"Feature",properties:o,geometry:a?{type:"MultiLineString",coordinates:n}:{type:"LineString",coordinates:n[0]}}}function nM(e){const t=Object.assign(qC(e),jC(e,["sym"])),n=JC(e);return n?{type:"Feature",properties:t,geometry:{type:"Point",coordinates:n.coordinates}}:null}function*iM(e){for(const t of RC(e,"trk")){const e=tM(t);e&&(yield e)}for(const t of RC(e,"rte")){const e=eM(t);e&&(yield e)}for(const t of RC(e,"wpt")){const e=nM(t);e&&(yield e)}}function rM(e,t){const n={},i="stroke"==t||"fill"===t?t:t+"-color";return"#"===e[0]&&(e=e.substring(1)),6===e.length||3===e.length?n[i]="#"+e:8===e.length&&(n[t+"-opacity"]=parseInt(e.substring(0,2),16)/255,n[i]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),n}function aM(e,t,n){const i={};return VC(e,t,(e=>{i[n]=e})),i}function oM(e,t){return QC(e,"color",(e=>rM(NC(e),t)))}function sM(e){return Object.assign({},function(e){return QC(e,"PolyStyle",((e,t)=>Object.assign(t,QC(e,"color",(e=>rM(NC(e),"fill"))),HC(e,"fill",(e=>{if("0"===e)return{"fill-opacity":0}})),HC(e,"outline",(e=>{if("0"===e)return{"stroke-opacity":0}})))))}(e),function(e){return QC(e,"LineStyle",(e=>Object.assign(oM(e,"stroke"),aM(e,"width","stroke-width"))))}(e),function(e){return QC(e,"LabelStyle",(e=>Object.assign(oM(e,"label"),aM(e,"scale","label-scale"))))}(e),function(e){return QC(e,"IconStyle",(e=>Object.assign(oM(e,"icon"),aM(e,"scale","icon-scale"),aM(e,"heading","icon-heading"),QC(e,"hotSpot",(e=>{const t=parseFloat(e.getAttribute("x")||""),n=parseFloat(e.getAttribute("y")||""),i=e.getAttribute("xunits")||"",r=e.getAttribute("yunits")||"";return isNaN(t)||isNaN(n)?{}:{"icon-offset":[t,n],"icon-offset-units":[i,r]}})),QC(e,"Icon",((e,t)=>(HC(e,"href",(e=>{t.icon=e})),t))))))}(e))}const AM=/\s*/g,lM=/^\s*|\s*$/g,cM=/\s+/;function hM(e){return e.replace(AM,"").split(",").map(parseFloat).filter((e=>!isNaN(e))).slice(0,3)}function uM(e){return e.replace(lM,"").split(cM).map(hM).filter((e=>e.length>=2))}function dM(e){let t=RC(e,"coord");var n,i,r;0===t.length&&(n=e,i="coord",r="*",t=Array.from(n.getElementsByTagNameNS(r,i)));const a=t.map((e=>NC(e).split(" ").map(parseFloat)));return 0===a.length?null:{geometry:a.length>2?{type:"LineString",coordinates:a}:{type:"Point",coordinates:a[0]},times:RC(e,"when").map((e=>NC(e)))}}function fM(e){if(0===e.length)return e;const t=e[0],n=e[e.length-1];let i=!0;for(let e=0;e<Math.max(t.length,n.length);e++)if(t[e]!==n[e]){i=!1;break}return i?e:e.concat([e[0]])}const pM=["Polygon","LineString","Point","Track","gx:Track"];function mM(e){return NC(GC(e,"coordinates"))}function gM(e){const t=[],n=[];for(const t of["MultiGeometry","MultiTrack","gx:MultiTrack"]){const n=GC(e,t);if(n)return gM(n)}for(const i of pM)for(const r of RC(e,i))switch(i){case"Point":{const e=hM(mM(r));e.length>=2&&t.push({type:"Point",coordinates:e});break}case"LineString":{const e=uM(mM(r));e.length>=2&&t.push({type:"LineString",coordinates:e});break}case"Polygon":{const e=[];for(const t of RC(r,"LinearRing")){const n=fM(uM(mM(t)));n.length>=4&&e.push(n)}e.length&&t.push({type:"Polygon",coordinates:e});break}case"Track":case"gx:Track":{const e=dM(r);if(!e)break;const{times:i,geometry:a}=e;t.push(a),i.length&&n.push(i);break}}return{geometries:t,coordTimes:n}}function vM(e){return QC(e,"ExtendedData",((e,t)=>{for(const n of RC(e,"Data"))t[n.getAttribute("name")||""]=NC(GC(n,"value"));for(const n of RC(e,"SimpleData"))t[n.getAttribute("name")||""]=NC(n);return t}))}function yM(e){return 0===e.length?null:1===e.length?e[0]:{type:"GeometryCollection",geometries:e}}function wM(e){return QC(e,"TimeSpan",(e=>({timespan:{begin:NC(GC(e,"begin")),end:NC(GC(e,"end"))}})))}function xM(e){return QC(e,"TimeStamp",(e=>({timestamp:NC(GC(e,"when"))})))}function bM(e,t){return HC(e,"styleUrl",(e=>(e=OC(e),t[e]?Object.assign({styleUrl:e},t[e]):{styleUrl:e})))}function CM(e){const t=GC(e,"description");for(const e of Array.from(t?.childNodes||[]))if(4===e.nodeType)return{description:{"@type":"html",value:NC(e)}};return{}}function MM(e,t){const{coordTimes:n,geometries:i}=gM(e),r={type:"Feature",geometry:yM(i),properties:Object.assign(jC(e,["name","address","visibility","open","phoneNumber","description"]),CM(e),bM(e,t),sM(e),vM(e),wM(e),xM(e),n.length?{coordinateProperties:{times:1===n.length?n[0]:n}}:{})},a=e.getAttribute("id");return null!==a&&""!==a&&(r.id=a),r}function BM(e){let t=e.getAttribute("id");const n=e.parentNode;return!t&&WC(n)&&"CascadingStyle"===n.localName&&(t=n.getAttribute("kml:id")||n.getAttribute("id")),OC(t||"")}function*IM(e){const t=function(e){const t={};for(const n of RC(e,"Style"))t[BM(n)]=sM(n);for(const n of RC(e,"StyleMap")){const e=OC(n.getAttribute("id")||"");HC(n,"styleUrl",(n=>{n=OC(n),t[n]&&(t[e]=t[n])}))}return t}(e);for(const n of RC(e,"Placemark")){const e=MM(n,t);e&&(yield e)}}var EM={parse:function(e,t){return t=SC(t),DC.parse((n=e,{type:"FeatureCollection",features:Array.from(IM(n))}),t);var n}},SM={parse:function(e,t){return t=SC(t),DC.parse((n=e,{type:"FeatureCollection",features:Array.from(iM(n))}),t);var n}},TM=function(e,t,n,i,r){var a,o,s=8*r-i-1,A=(1<<s)-1,l=A>>1,c=-7,h=n?r-1:0,u=n?-1:1,d=e[t+h];for(h+=u,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=u,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+e[t+h],h+=u,c-=8);if(0===a)a=1-l;else{if(a===A)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),a-=l}return(d?-1:1)*o*Math.pow(2,a-i)},LM=function(e,t,n,i,r,a){var o,s,A,l=8*a-r-1,c=(1<<l)-1,h=c>>1,u=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,f=i?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(A=Math.pow(2,-o))<1&&(o--,A*=2),(t+=o+h>=1?u/A:u*Math.pow(2,1-h))*A>=2&&(o++,A/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*A-1)*Math.pow(2,r),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;e[n+d]=255&s,d+=f,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;e[n+d]=255&o,d+=f,o/=256,l-=8);e[n+d-f]|=128*p},FM=_M;function _M(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}_M.Varint=0,_M.Fixed64=1,_M.Bytes=2,_M.Fixed32=5;var UM=4294967296,PM=1/UM,kM="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function DM(e){return e.type===_M.Bytes?e.readVarint()+e.pos:e.pos+1}function RM(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function OM(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function NM(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function GM(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function QM(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function HM(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function zM(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function VM(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function jM(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function WM(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function XM(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function ZM(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function YM(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function KM(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}_M.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,e(r,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=ZM(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=KM(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=ZM(this.buf,this.pos)+ZM(this.buf,this.pos+4)*UM;return this.pos+=8,e},readSFixed64:function(){var e=ZM(this.buf,this.pos)+KM(this.buf,this.pos+4)*UM;return this.pos+=8,e},readFloat:function(){var e=TM(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=TM(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,a=n.buf;if(r=a[n.pos++],i=(112&r)>>4,r<128)return RM(e,i,t);if(r=a[n.pos++],i|=(127&r)<<3,r<128)return RM(e,i,t);if(r=a[n.pos++],i|=(127&r)<<10,r<128)return RM(e,i,t);if(r=a[n.pos++],i|=(127&r)<<17,r<128)return RM(e,i,t);if(r=a[n.pos++],i|=(127&r)<<24,r<128)return RM(e,i,t);if(r=a[n.pos++],i|=(1&r)<<31,r<128)return RM(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&kM?function(e,t,n){return kM.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var i="",r=t;for(;r<n;){var a,o,s,A=e[r],l=null,c=A>239?4:A>223?3:A>191?2:1;if(r+c>n)break;1===c?A<128&&(l=A):2===c?128==(192&(a=e[r+1]))&&(l=(31&A)<<6|63&a)<=127&&(l=null):3===c?(a=e[r+1],o=e[r+2],128==(192&a)&&128==(192&o)&&((l=(15&A)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=e[r+1],o=e[r+2],s=e[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((l=(15&A)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==_M.Bytes)return e.push(this.readVarint(t));var n=DM(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==_M.Bytes)return e.push(this.readSVarint());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==_M.Bytes)return e.push(this.readBoolean());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==_M.Bytes)return e.push(this.readFloat());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==_M.Bytes)return e.push(this.readDouble());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==_M.Bytes)return e.push(this.readFixed32());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==_M.Bytes)return e.push(this.readSFixed32());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==_M.Bytes)return e.push(this.readFixed64());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==_M.Bytes)return e.push(this.readSFixed64());var t=DM(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===_M.Varint)for(;this.buf[this.pos++]>127;);else if(t===_M.Bytes)this.pos=this.readVarint()+this.pos;else if(t===_M.Fixed32)this.pos+=4;else{if(t!==_M.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),YM(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),YM(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),YM(this.buf,-1&e,this.pos),YM(this.buf,Math.floor(e*PM),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),YM(this.buf,-1&e,this.pos),YM(this.buf,Math.floor(e*PM),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,a=0;a<t.length;a++){if((i=t.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&OM(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),LM(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),LM(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&OM(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,_M.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,NM,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,GM,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,zM,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,QM,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,HM,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,VM,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jM,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,WM,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,XM,t)},writeBytesField:function(e,t){this.writeTag(e,_M.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,_M.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,_M.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,_M.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,_M.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,_M.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,_M.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,_M.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,_M.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,_M.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var JM=qM;function qM(e,t){this.x=e,this.y=t}qM.prototype={clone:function(){return new qM(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=i,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.x+n*(this.x-t.x)-i*(this.y-t.y),a=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=r,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},qM.convert=function(e){return e instanceof qM?e:Array.isArray(e)?new qM(e[0],e[1]):e};var $M=eB;function eB(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(tB,this,t)}function tB(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){var n=e.readVarint()+e.pos;for(;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function nB(e){for(var t,n,i=0,r=0,a=e.length,o=a-1;r<a;o=r++)t=e[r],i+=((n=e[o]).x-t.x)*(t.y+n.y);return i}eB.types=["Unknown","Point","LineString","Polygon"],eB.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,r=0,a=0,o=0,s=[];e.pos<n;){if(r<=0){var A=e.readVarint();i=7&A,r=A>>3}if(r--,1===i||2===i)a+=e.readSVarint(),o+=e.readSVarint(),1===i&&(t&&s.push(t),t=[]),t.push(new JM(a,o));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&s.push(t),s},eB.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,a=0,o=1/0,s=-1/0,A=1/0,l=-1/0;e.pos<t;){if(i<=0){var c=e.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=e.readSVarint())<A&&(A=a),a>l&&(l=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,A,s,l]},eB.prototype.toGeoJSON=function(e,t,n){var i,r,a=this.extent*Math.pow(2,n),o=this.extent*e,s=this.extent*t,A=this.loadGeometry(),l=eB.types[this.type];function c(e){for(var t=0;t<e.length;t++){var n=e[t],i=180-360*(n.y+s)/a;e[t]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<A.length;i++)h[i]=A[i][0];c(A=h);break;case 2:for(i=0;i<A.length;i++)c(A[i]);break;case 3:for(A=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],a=0;a<t;a++){var o=nB(e[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}n&&r.push(n);return r}(A),i=0;i<A.length;i++)for(r=0;r<A[i].length;r++)c(A[i][r])}1===A.length?A=A[0]:l="Multi"+l;var u={type:"Feature",geometry:{type:l,coordinates:A},properties:this.properties};return"id"in this&&(u.id=this.id),u};var iB=rB;function rB(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(aB,this,t),this.length=this._features.length}function aB(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){var t=null,n=e.readVarint()+e.pos;for(;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}function oB(e,t,n){if(3===e){var i=new iB(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}rB.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new $M(this._pbf,t,this.extent,this._keys,this._values)};var sB=function(e,t){this.layers=e.readFields(oB,{},t)},AB=Mx.get("EPSG:3857").dimensions(),lB=new tt(AB.x,AB.y,1),cB=new Je,hB=new Je;function uB(e,t){t.out=t.out||{};var n=new sB(new FM(e)),i=Object.keys(n.layers);if(!(i.length<1)){var r=e.extent.col,a=e.extent.zoom,o=t.in.isInverted?e.extent.row:(1<<a)-e.extent.row-1;t.out.buildExtent=!0,t.out.mergeFeatures=!0,t.out.structure="2d";var s=new EC(t.out),A=n.layers[i[0]],l=A.extent*Math.pow(2,a),c=-.5*l;return s.scale.set(l,-l,1).divide(lB),s.translation.set(-(A.extent*r+c),-(A.extent*o+c),0).divide(s.scale),i.forEach((function(e){if(t.in.layers[e])for(var i=n.layers[e],r=function(n){var r,o=i.feature(n),A=t.in.layers[e].filter((function(e){return e.filterExpression.filter({zoom:a},o)&&a>=e.zoom.min&&a<e.zoom.max})),l=void 0,c=C(A);try{var h=function(){var e=r.value;l?s.features.find((function(t){return t.id===e.id}))||((l=s.newFeatureByReference(l)).id=e.id,l.order=e.order,l.style=t.in.styles[l.id]):((l=s.requestFeatureById(e.id,o.type-1)).id=e.id,l.order=e.order,l.style=t.in.styles[l.id],function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.bindNewGeometry();n=n&&t.type===bC.POLYGON,i.properties=e.properties;var r=e._pbf;r.pos=e._geometry;for(var a=r.readVarint()+r.pos,o=1,s=0,A=0,l=0,c=0,h=0;r.pos<a;){if(s<=0){var u=r.readVarint();o=7&u,s=u>>3}if(s--,1===o||2===o)A+=r.readSVarint(),l+=r.readSVarint(),1===o&&(c&&(n&&h>0&&i.indices.length>0&&(t.updateExtent(i),(i=t.bindNewGeometry()).properties=e.properties),i.closeSubGeometry(c,t),i.getLastSubGeometry().ccw=h<0),c=0,h=0),c++,i.pushCoordinatesValues(t,A,l),1==c?(hB.set(A,l),cB.set(A,l)):n&&c>1&&(h+=(cB.x-A)*(cB.y+l),cB.set(A,l));else{if(7!==o)throw new Error("unknown command ".concat(o));c&&(c++,i.pushCoordinatesValues(t,hB.x,hB.y),n&&(h+=(cB.x-hB.x)*(cB.y+hB.y)))}}c&&(n&&h>0&&i.indices.length>0&&(t.updateExtent(i),(i=t.bindNewGeometry()).properties=e.properties),i.closeSubGeometry(c,t),i.getLastSubGeometry().ccw=h<0),t.updateExtent(i)}(o,l))};for(c.s();!(r=c.n()).done;)h()}catch(e){c.e(e)}finally{c.f()}},o=i.length-1;o>=0;o--)r(o)})),s.removeEmptyFeature(),s.features.sort((function(e,t){return e.order-t.order})),s.updateExtent(),s.extent=e.extent,Promise.resolve(s)}}var dB={parse:function(e,t){return t=SC(t),Promise.resolve(uB(e,t))}},fB=new Map([["image/x-bil;bits=32",oC.textureFloat],["geojson",oC.json],["application/json",oC.json],["application/kml",oC.xml],["application/gpx",oC.xml],["application/x-protobuf;type=mapbox-vector",oC.arrayBuffer]]),pB=new Map([["geojson",DC.parse],["application/json",DC.parse],["application/kml",EM.parse],["application/gpx",SM.parse],["application/x-protobuf;type=mapbox-vector",dB.parse]]),mB={getByArray:function(){},setByArray:function(e){return e},clear:function(){}};var gB=0,vB=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),(i=t.call(this,e)).isSource=!0,!e.url)throw new Error("New Source: url is required");return i.uid=gB++,i.url=e.url,i.format=e.format,i.fetcher=e.fetcher||fB.get(e.format)||oC.texture,i.parser=e.parser||pB.get(e.format)||function(e){return e},i.isVectorSource=null!=(e.parser||pB.get(e.format)),i.networkOptions=e.networkOptions||{crossOrigin:"anonymous"},i.attribution=e.attribution,i.whenReady=Promise.resolve(),i._featuresCaches={},e.extent&&!e.extent.isExtent?i.extent=new Sx(i.crs,e.extent):i.extent=e.extent,i}return o(n,[{key:"handlingError",value:function(e){throw new Error(e)}},{key:"urlFromExtent",value:function(e){throw new Error("In extended Source, you have to implement the method urlFromExtent!")}},{key:"requestToKey",value:function(e){return[e.zoom,e.row,e.col]}},{key:"loadData",value:function(e,t){var n=this,i=this._featuresCaches[t.crs],r=this.requestToKey(e),a=i.getByArray(r);return a||(a=i.setByArray(function(e,t){var n=e.urlFromExtent(t);return e.fetcher(n,e.networkOptions).then((function(e){return e.extent=t,e}),(function(t){return e.handlingError(t)}))}(this,e).then((function(e){return n.parser(e,{out:t,in:n})}),(function(e){return n.handlingError(e)})),r),this.onParsedFile&&a.then((function(e){return n.onParsedFile(e),console.warn("Source.onParsedFile was deprecated"),e}))),a}},{key:"onLayerAdded",value:function(e){this._featuresCaches[e.out.crs]||(this._featuresCaches[e.out.crs]=this.isVectorSource?new eC:mB)}},{key:"onLayerRemoved",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._featuresCaches[e.unusedCrs];t&&(t.clear(),delete this._featuresCaches[e.unusedCrs])}},{key:"extentInsideLimit",value:function(e){throw new Error("In extented Source, you have to implement the method extentInsideLimit!")}}]),n}((function e(t){r(this,e),t.projection&&(console.warn("Source projection parameter is deprecated, use crs instead."),t.crs=t.crs||t.projection),this.crs=t.crs})),yB=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,n),a.projection&&(console.warn("Layer projection parameter is deprecated, use crs instead."),a.crs=a.crs||a.projection),void 0===a.source||!0===a.source)throw new Error("Layer ".concat(e," needs Source"));return(i=t.call(this)).isLayer=!0,Object.assign(d(i),a),Object.defineProperty(d(i),"id",{value:e,writable:!1}),i.options=a.options||{},i.updateStrategy||(i.updateStrategy={type:0,options:{}}),i.defineLayerProperty("frozen",!1),a.zoom?(i.zoom={max:a.zoom.max,min:a.zoom.min||0},null==i.zoom.max&&(i.zoom.max=1/0)):i.zoom={max:1/0,min:0},i.info=new Jb(d(i)),i.source=i.source||new vB({url:"none"}),i.ready=!1,i._promises=[],i.whenReady=new Promise((function(e,t){i._resolve=e,i._reject=t})).then((function(){return i.ready=!0,i.source.onLayerAdded({out:d(i)}),d(i)})),i._promises.push(i.source.whenReady),i.cache=new eC(a.cacheLifeTime),i.mergeFeatures=void 0===i.mergeFeatures||a.mergeFeatures,i.filter=i.filter||i.source.filter,i}return o(n,[{key:"addInitializationStep",value:function(){var e;return this._promises.push(new Promise((function(t){e=t}))),e}},{key:"defineLayerProperty",value:function(e,t,n){var i=this,r=Object.getOwnPropertyDescriptor(this,e);if(!r||!r.set){var a=null==this[e]?t:this[e];Object.defineProperty(this,e,{get:function(){return a},set:function(t){if(a!==t){var r={type:"".concat(e,"-property-changed"),previous:{},new:{}};r.previous[e]=a,r.new[e]=t,a=t,n&&n(i,e),i.dispatchEvent(r)}}})}}},{key:"convert",value:function(e){return e}},{key:"getData",value:function(e,t){var n=this,i=this.source.requestToKey(this.source.isVectorSource?t:e),r=this.cache.getByArray(i);return r||(r=this.source.loadData(e,this).then((function(e){return n.convert(e,t)}),(function(e){throw e})),this.cache.setByArray(r,i)),r}},{key:"isValidData",value:function(e){}},{key:"delete",value:function(){console.warn("Function delete doesn't exist for this layer")}}]),n}(Xe),wB=function(e){var t=Array.from(e);return t.sort((function(e,t){return e.sequence-t.sequence})),t.map((function(e){return e.id}))},xB=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},bB=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},CB=function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',i=document.createElement("div");return i.id="webglmessage",i.style.fontFamily="monospace",i.style.fontSize="13px",i.style.fontWeight="normal",i.style.textAlign="center",i.style.background="#fff",i.style.color="#000",i.style.padding="1.5em",i.style.width="400px",i.style.margin="5em auto 0",n=(n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),i.innerHTML=n,i};function MB(e,t){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}var BB=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;r(this,e),this.x=t,this.y=n,this.grid=[],this.hidden=[],this.visible=[],this.resize(),this.reset(),this.width=i,this.height=a}return o(e,[{key:"reset",value:function(){for(var e=0;e<this.x;e++)for(var t=0;t<this.y;t++)this.grid[e][t].splice(0,this.grid[e][t].length);this.hidden=[],this.visible=[]}},{key:"resize",value:function(){for(var e=0;e<this.x;e++){this.grid[e]||(this.grid[e]=[]);for(var t=0;t<this.y;t++)this.grid[e][t]||(this.grid[e][t]=[])}}},{key:"insert",value:function(e){for(var t=Math.max(0,Math.floor(e.boundaries.left/this.width*this.x)),n=Math.min(this.x-1,Math.floor(e.boundaries.right/this.width*this.x)),i=Math.max(0,Math.floor(e.boundaries.top/this.height*this.y)),r=Math.min(this.y-1,Math.floor(e.boundaries.bottom/this.height*this.y)),a=t;a<=n;a++)for(var o=i;o<=r;o++)if(this.grid[a][o].length>0&&this.grid[a][o].some((function(t){return MB(t.boundaries,e.boundaries)})))return this.hidden.push(e),!1;for(var s=t;s<=n;s++)for(var A=i;A<=r;A++)this.grid[s][A].push(e);return!0}}]),e}(),IB=new vt,EB=new tt,SB=function(){function e(){r(this,e),this.domElement=document.createElement("div"),this.domElement.style.overflow="hidden",this.domElement.style.position="absolute",this.domElement.style.height="100%",this.domElement.style.width="100%",this.domElement.style.zIndex=1,this.garbage=document.createElement("div"),this.garbage.style.display="none",this.domElement.appendChild(this.garbage),this.halfWidth=0,this.halfHeight=0,this.grid=new BB,this.infoTileLayer=void 0}return o(e,[{key:"setSize",value:function(e,t){this.domElement.style.width="".concat(e),this.domElement.style.height="".concat(t),this.halfWidth=e/2,this.halfHeight=t/2,this.grid.width=e,this.grid.height=t,this.grid.x=Math.ceil(e/20),this.grid.y=Math.ceil(t/20),this.grid.resize()}},{key:"registerLayer",value:function(e){this.domElement.appendChild(e.domElement)}},{key:"render",value:function(e,t){var n=this;this.infoTileLayer&&this.infoTileLayer.layer.attachedLayers.find((function(e){return e.isLabelLayer&&e.visible}))&&(this.grid.reset(),IB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this.culling(e,this.infoTileLayer.displayed.extent),this.grid.visible.sort((function(e,t){var n=t.order-e.order;return 0==n?!e.visible&&t.visible?1:-1:n})),this.grid.visible.forEach((function(e){n.grid.insert(e)&&(e.visible=!0,e.updateCSSPosition())})),this.grid.hidden.forEach((function(e){e.visible=!1})))}},{key:"culling",value:function(e,t){var n=this;if(e.isLabel)!t.isPointInside(e.coordinates)||function(e){var t=e.parent;return t.material&&!t.material.visible&&t.children.find((function(e){return e.isTileMesh&&e.children.find((function(e){return e.isLabel}))}))}(e)||e.parent.level<4&&e.parent.layer.horizonCulling&&e.parent.layer.horizonCulling(e.horizonCullingPoint)?this.grid.hidden.push(e):(EB.setFromMatrixPosition(e.matrixWorld),EB.applyMatrix4(IB),e.updateProjectedPosition(EB.x*this.halfWidth+this.halfWidth,-EB.y*this.halfHeight+this.halfHeight),this.grid.visible.some((function(t){return t.projectedPosition.x==e.projectedPosition.x&&t.projectedPosition.y==e.projectedPosition.y&&t.baseContent==e.baseContent}))?(e.parent.remove(e),this.grid.hidden.push(e)):this.grid.visible.push(e));else{if(!e.visible)return void this.hideNodeDOM(e);if(e.extent&&!e.extent.intersectsExtent(t))return void this.hideNodeDOM(e);this.showNodeDOM(e),e.children.forEach((function(e){return n.culling(e,t)}))}}},{key:"removeLabelDOM",value:function(e){this.garbage.appendChild(e.content),this.garbage.innerHTML=""}},{key:"hideNodeDOM",value:function(e){var t=this;if(e.domElements){var n=Object.values(e.domElements);n.length>0?n.forEach((function(e){1==e.visible&&(e.dom.style.display="none",e.visible=!1)})):e.children.filter((function(e){return e.isTileMesh})).forEach((function(e){return t.hideNodeDOM(e)}))}}},{key:"showNodeDOM",value:function(e){e.domElements&&Object.values(e.domElements).forEach((function(e){0==e.visible&&(e.dom.style.display="block",e.visible=!0)}))}}]),e}(),TB=new At,LB=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=!db();void 0===n.antialias&&(n.antialias=!0),void 0===n.alpha&&(n.alpha=!0),void 0===n.logarithmicDepthBuffer&&(n.logarithmicDepthBuffer=this.gLDebug||i),void 0===n.isWebGL2&&(n.isWebGL2=!0);var a=t.domElement?t:void 0,o=a?a.domElement:t;this.width=o.clientWidth,this.height=o.clientHeight,this.positionBuffer=null,this._nextThreejsLayer=1,this.fullSizeRenderTarget=new lt(this.width,this.height),this.fullSizeRenderTarget.texture.minFilter=W,this.fullSizeRenderTarget.texture.magFilter=z,this.fullSizeRenderTarget.depthBuffer=!0,this.fullSizeRenderTarget.depthTexture=new Jo,this.fullSizeRenderTarget.depthTexture.type=K,this.renderView=function(e){this.renderer.clear(),this.renderer.render(e.scene,e.camera.camera3D),this.label2dRenderer.render(e.scene,e.camera.camera3D)}.bind(this),this.onWindowResize=function(e,t){this.width=e,this.height=t,this.fullSizeRenderTarget.setSize(this.width,this.height),this.renderer.setSize(this.width,this.height),this.label2dRenderer.setSize(this.width,this.height)}.bind(this);try{this.label2dRenderer=new SB,this.label2dRenderer.setSize(this.width,this.height),o.appendChild(this.label2dRenderer.domElement),this.renderer=a||new(n.isWebGL2,Ka)({canvas:document.createElement("canvas"),antialias:n.antialias,alpha:n.alpha,logarithmicDepthBuffer:n.logarithmicDepthBuffer}),this.renderer.domElement.style.position="relative",this.renderer.domElement.style.zIndex=0,this.renderer.domElement.style.top=0}catch(e){var s=n.isWebGL2?"2":"1";console.error("Failed to create WebGLRenderer webGL ".concat(s,".")),this.renderer=null}if(!this.renderer)throw xB()?bB()||o.appendChild(CB(2)):o.appendChild(CB(1)),new Error("WebGL unsupported");!a&&n.logarithmicDepthBuffer&&(this.renderer.capabilities.isWebGL2||this.renderer.extensions.get("EXT_frag_depth")||(this.renderer.dispose(),this.renderer=new(n.isWebGL2,Ka)({canvas:document.createElement("canvas"),antialias:n.antialias,alpha:n.alpha,logarithmicDepthBuffer:!1}))),-1===this.renderer.domElement.tabIndex&&(this.renderer.domElement.tabIndex=-1),pb(this.renderer),this.renderer.setClearColor(197896),this.renderer.sortObjects=!0,this.renderer.debug.checkShaderErrors=__DEBUG__,a||(this.renderer.setPixelRatio(o.devicePixelRatio),this.renderer.setSize(o.clientWidth,o.clientHeight),o.appendChild(this.renderer.domElement))}return o(e,[{key:"getWindowSize",value:function(){return new Je(this.width,this.height)}},{key:"getRenderer",value:function(){return this.renderer}},{key:"renderViewToBuffer",value:function(e,t){return t||(t={x:0,y:0,width:this.width,height:this.height}),t.buffer=t.buffer||new Uint8Array(4*t.width*t.height),this.renderViewToRenderTarget(e,this.fullSizeRenderTarget,t),this.renderer.readRenderTargetPixels(this.fullSizeRenderTarget,t.x,this.height-(t.y+t.height),t.width,t.height,t.buffer),t.buffer}},{key:"renderViewToRenderTarget",value:function(e,t,n){t||(t=this.fullSizeRenderTarget);var i=this.renderer.getRenderTarget();return n&&(this.fullSizeRenderTarget.scissor.set(n.x,t.height-(n.y+n.height),n.width,n.height),this.fullSizeRenderTarget.scissorTest=!0),this.renderer.setRenderTarget(t),this.renderer.clear(!0,!0,!1),this.renderer.render(e.scene,e.camera.camera3D),this.renderer.setRenderTarget(i),console.log("renderViewToRenderTarget"),this.fullSizeRenderTarget.scissorTest=!1,t}},{key:"bufferToImage",value:function(e,t,n){var i=document.createElement("canvas"),r=i.getContext("2d");i.width=t,i.height=n;var a=r.getImageData(0,0,t,n);a.data.set(e),r.putImageData(a,0,0);var o=new Image;return o.src=i.toDataURL(),o}},{key:"getUniqueThreejsLayer",value:function(){return this._nextThreejsLayer>31&&(console.warn("Too much three.js layers. Starting from now all of them will use layerMask = 31"),this._nextThreejsLayer=31),this._nextThreejsLayer++}},{key:"depthBufferRGBAValueToOrthoZ",value:function(e,t){if(TB.fromArray(e).divideScalar(255),ub()&&"PerspectiveCamera"==t.type){var n=Fb(TB),i=2/(Math.log(t.far+1)/Math.LN2);return Math.pow(2,2*n/i)}var r=Fb(TB);return r=2*r-1}},{key:"onRender",value:function(){}}]),e}();function FB(e,t,n,i,r,a,o){if(t==bC.LINE&&function(e,t,n,i,r,a){for(var o=e.x,s=e.y,A=i+a,l=i;A<i+r;l=A,A+=a){var c=t[A],h=t[A+1],u=t[l],d=t[l+1],f=o-c,p=s-h,m=u-c,g=d-h,v=Math.sqrt(m*m+g*g),y=(f*m+p*g)/v;if(y>=-n&&y<=v+n&&Math.abs(g*o-m*s+u*h-d*c)/v<=n)return!0}return!1}(e,n,i,r,a,o))return!0;if(t==bC.POLYGON&&function(e,t,n,i,r){for(var a=e.x,o=e.y,s=!1,A=n,l=n+i-r;A<n+i;l=A,A+=r){var c=t[A],h=t[A+1],u=t[l],d=t[l+1];h>o!=d>o&&a<(u-c)*(o-h)/(d-h)+c&&(s=!s)}return s}(e,n,r,a,o))return!0;if(t==bC.POINT){var s=function(e,t,n,i,r,a){for(var o,s=e.x,A=e.y,l=n*n,c=i;c<i+r;c+=a){var h=s-t[c],u=A-t[c+1],d=h*h+u*u;d<l&&(o=[t[c],t[c+1]],l=d)}return o}(e,n,i,r,a,o);if(s)return{coordinates:s}}}function _B(e,t,n,i){var r,a=e.as(t.crs),o=C(t.geometries);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(null==s.extent||s.extent.isPointInside(a,n)){var A=s.indices[0].offset*t.size,l=s.indices[0].count*t.size,c=FB(a,t.type,t.vertices,n,A,l,t.size);c&&i.push({type:t.type,geometry:s,coordinates:c.coordinates,style:t.style})}}}catch(e){o.e(e)}finally{o.f()}}var UB=new Sx("EPSG:4326",0,0,0,0),PB=new ux("EPSG:4326",0,0,0),kB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=[];if(PB.copy(e),t.extent){if(PB.as(ix.formatToEPSG(t.extent.crs),PB),t.extent.as(PB.crs,UB),!UB.isPointInside(PB,n))return i;(t.isFeatureCollection&&1!=t.scale.x&&1!=t.scale.y||0!=t.translation.x&&0!=t.translation.y)&&(PB.x=(PB.x+t.translation.x)*t.scale.x,PB.y=(PB.y+t.translation.y)*t.scale.y,1!=t.scale.x&&1!=t.scale.y&&(n*=Math.sqrt(Math.pow(t.scale.x,2)+Math.pow(t.scale.y,2))))}if(t.isFeatureCollection){var r,a=C(t.features);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.extent&&!o.extent.isPointInside(PB,n)||_B(PB,o,n,i)}}catch(e){a.e(e)}finally{a.f()}}else t.geometries&&_B(PB,t,n,i);return i},DB={executeCommand:function(e){var t=e.layer,n=e.extentsSource,i=e.extentsDestination||n;return Promise.all(n.map((function(e,n){return t.getData(e,i[n])})))}},RB=function(){function e(t){r(this,e),this.command=t,this.isCancelledCommandException=!0}return o(e,[{key:"toString",value:function(){return"Cancelled command ".concat(this.command.requester.id,"/").concat(this.command.layer.id)}}]),e}(),OB={executeCommand:function(e){var t=[],n=e.layer,i=e.requester,r=e.extentsSource;if(i&&!i.material)return Promise.reject(new RB(e));for(var a=0,o=r.length;a<o;a++)t.push(n.convert(i,r[a]));return Promise.all(t)}},NB=function(){function e(e){QA.call(this,e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new o(e)})),this.register((function(e){return new A(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new s(e)})),this.register((function(e){return new r(e)})),this.register((function(e){return new c(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(QA.prototype),{constructor:e,load:function(e,t,n,i){var r,a=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Ul.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new VA(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{a.parse(n,r,(function(n){t(n),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),n,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,r){var o,s={},A={};if("string"==typeof e)o=e;else if(Ul.decodeText(new Uint8Array(e,0,4))===h){try{s[n.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(r&&r(e))}o=s[n.KHR_BINARY_GLTF].content}else o=Ul.decodeText(new Uint8Array(e));var l=JSON.parse(o);if(void 0===l.asset||l.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var c=new q(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(var u=0;u<this.pluginCallbacks.length;u++){var d=this.pluginCallbacks[u](c);A[d.name]=d,s[d.name]=!0}if(l.extensionsUsed)for(u=0;u<l.extensionsUsed.length;++u){var g=l.extensionsUsed[u],w=l.extensionsRequired||[];switch(g){case n.KHR_MATERIALS_UNLIT:s[g]=new a;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[g]=new v;break;case n.KHR_DRACO_MESH_COMPRESSION:s[g]=new p(l,this.dracoLoader);break;case n.KHR_TEXTURE_TRANSFORM:s[g]=new m;break;case n.KHR_MESH_QUANTIZATION:s[g]=new y;break;default:w.indexOf(g)>=0&&void 0===A[g]&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}c.setExtensions(s),c.setPlugins(A),c.parse(i,r)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function r(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function a(){this.name=n.KHR_MATERIALS_UNLIT}function o(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function s(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function A(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function l(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function c(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}r.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}},r.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var r,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new Sn(16777215);void 0!==o.color&&s.fromArray(o.color);var A=void 0!==o.range?o.range:0;switch(o.type){case"directional":(r=new Tl(s)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new Il(s)).distance=A;break;case"spot":(r=new Ml(s)).distance=A,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,r.angle=o.spot.outerConeAngle,r.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return r.position.set(0,0,0),r.decay=2,void 0!==o.intensity&&(r.intensity=o.intensity),r.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(r),t.cache.add(n,i),i},r.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))},a.prototype.getMaterialType=function(){return kn},a.prototype.extendParams=function(e,t,n){var i=[];e.color=new Sn(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var a=r.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)},o.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?fA:null},o.prototype.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Je(o,-o)}return Promise.all(r)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?fA:null},s.prototype.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)},A.prototype.loadTexture=function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var r=i.extensions[this.name],a=n.images[r.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)},l.prototype.loadTexture=function(e){var t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;var a=r.extensions[t],o=i.images[a.source],s=n.textureLoader;if(o.uri){var A=n.options.manager.getHandler(o.uri);null!==A&&(s=A)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},l.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},c.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,a.ready]).then((function(e){var t=i.byteOffset||0,n=i.byteLength||0,r=i.count,o=i.byteStride,s=new ArrayBuffer(r*o),A=new Uint8Array(e[0],t,n);return a.decodeGltfBuffer(new Uint8Array(s),r,o,A,i.mode,i.filter),s}))}return null};var h="glTF",u=1313821514,d=5130562;function f(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:Ul.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,r=new DataView(e,12),a=0;a<i;){var o=r.getUint32(a,!0);a+=4;var s=r.getUint32(a,!0);if(a+=4,s===u){var A=new Uint8Array(e,12+a,o);this.content=Ul.decodeText(A)}else if(s===d){var l=12+a;this.body=e.slice(l,l+o)}a+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function p(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function m(){this.name=n.KHR_TEXTURE_TRANSFORM}function g(e){dA.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new Sn).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var s in o)e.uniforms[s]=o[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function v(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return g},extendParams:function(e,t,n){var i=t.extensions[this.name];e.color=new Sn(1,1,1),e.opacity=1;var r=[];if(Array.isArray(i.diffuseFactor)){var a=i.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new Sn(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new Sn(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var o=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",o)),r.push(n.assignTexture(e,"specularMap",o))}return Promise.all(r)},createMaterial:function(e){var t=new g(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function y(){this.name=n.KHR_MESH_QUANTIZATION}function w(e,t,n,i){BA.call(this,e,t,n,i)}p.prototype.decodePrimitive=function(e,t){var n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},A={};for(var l in a){var c=_[l]||l.toLowerCase();o[c]=a[l]}for(l in e.attributes){c=_[l]||l.toLowerCase();if(void 0!==a[l]){var h=n.accessors[e.attributes[l]],u=S[h.componentType];A[c]=u,s[c]=!0===h.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var n in e.attributes){var i=e.attributes[n],r=s[n];void 0!==r&&(i.normalized=r)}t(e)}),o,A)}))}))},m.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},g.prototype=Object.create(dA.prototype),g.prototype.constructor=g,g.prototype.copy=function(e){return dA.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},w.prototype=Object.create(BA.prototype),w.prototype.constructor=w,w.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i,a=0;a!==i;a++)t[a]=n[r+a];return t},w.prototype.beforeStart_=w.prototype.copySampleValue_,w.prototype.afterEnd_=w.prototype.copySampleValue_,w.prototype.interpolate_=function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,A=3*o,l=i-t,c=(n-t)/l,h=c*c,u=h*c,d=e*A,f=d-A,p=-2*u+3*h,m=u-h,g=1-p,v=m-h+c,y=0;y!==o;y++){var w=a[f+y+o],x=a[f+y+s]*l,b=a[d+y+o],C=a[d+y]*l;r[y]=g*w+v*x+p*b+m*C}return r};var x=0,b=1,C=2,M=3,B=4,I=5,E=6,S={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},T={9728:z,9729:W,9984:V,9985:X,9986:j,9987:Z},L={33071:Q,33648:H,10497:G},F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex",_BATCHID:"_BATCHID"},U={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:void 0,LINEAR:Te,STEP:Se},k="OPAQUE",D="MASK",R="BLEND";function O(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function N(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Y(e,t){void 0!==t.extras&&("object"===i(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function K(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(n=0,i=r.length;n<i;n++)e.morphTargetDictionary[r[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function J(e){for(var t="",n=Object.keys(e).sort(),i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function q(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new zl(this.options.manager):this.textureLoader=new KA(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new VA(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function $(e,t,n){var i=t.attributes,r=[];function a(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(var o in i){var s=_[o]||o.toLowerCase();s in e.attributes||r.push(a(i[o],s))}if(void 0!==t.indices&&!e.index){var A=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(A)}return Y(e,t),function(e,t,n){var i=t.attributes,r=new Jt;if(void 0!==i.POSITION){var a=(u=n.json.accessors[i.POSITION]).min,o=u.max;if(void 0!==a&&void 0!==o){r.set(new tt(a[0],a[1],a[2]),new tt(o[0],o[1],o[2]));var s=t.targets;if(void 0!==s){for(var A=new tt,l=new tt,c=0,h=s.length;c<h;c++){var u,d=s[c];if(void 0!==d.POSITION)a=(u=n.json.accessors[d.POSITION]).min,o=u.max,void 0!==a&&void 0!==o?(l.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),l.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),l.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),A.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}r.expandByVector(A)}e.boundingBox=r;var f=new en;r.getCenter(f.center),f.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,r=!1,a=0,o=t.length;a<o&&(void 0!==(l=t[a]).POSITION&&(i=!0),void 0!==l.NORMAL&&(r=!0),!i||!r);a++);if(!i&&!r)return Promise.resolve(e);var s=[],A=[];for(a=0,o=t.length;a<o;a++){var l=t[a];if(i){var c=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;s.push(c)}r&&(c=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal,A.push(c))}return Promise.all([Promise.all(s),Promise.all(A)]).then((function(t){var n=t[0],a=t[1];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function ee(e,t){var n=e.getIndex();if(null===n){var i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<r.count;a++)i.push(a);e.setIndex(i),n=e.getIndex()}var o=n.count-2,s=[];if(2===t)for(a=1;a<=o;a++)s.push(n.getX(0)),s.push(n.getX(a)),s.push(n.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(n.getX(a)),s.push(n.getX(a+1)),s.push(n.getX(a+2))):(s.push(n.getX(a+2)),s.push(n.getX(a+1)),s.push(n.getX(a)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var A=e.clone();return A.setIndex(s),A}return q.prototype.setExtensions=function(e){this.extensions=e},q.prototype.setPlugins=function(e){this.plugins=e},q.prototype.parse=function(e,t){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};N(r,a,i),Y(a,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)},q.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,r=t.length;i<r;i++)for(var a=t[i].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var A=0,l=e.length;A<l;A++){var c=e[A];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},q.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},q.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var i=n.clone();return i.name+="_instance_"+e.uses[t]++,i},q.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}},q.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var r=e(t[i]);r&&n.push(r)}return n},q.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},q.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t},q.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,n){i.load(O(t.uri,r.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},q.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))},q.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){var r,a=e[0],o=F[i.type],s=S[i.componentType],A=s.BYTES_PER_ELEMENT,l=A*o,c=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;if(h&&h!==l){var d=Math.floor(c/h),f="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+d+":"+i.count,p=t.cache.get(f);p||(p=new $a(new s(a,d*h,i.count*h/A),h/A),t.cache.add(f,p)),r=new eo(p,o,c%h/A,u)}else r=new Dn(null===a?new s(i.count*o):new s(a,c,i.count*o),o,u);if(void 0!==i.sparse){var m=F.SCALAR,g=S[i.sparse.indices.componentType],v=i.sparse.indices.byteOffset||0,y=i.sparse.values.byteOffset||0,w=new g(e[1],v,i.sparse.count*m),x=new s(e[2],y,i.sparse.count*o);null!==a&&(r=new Dn(r.array.slice(),r.itemSize,r.normalized));for(var b=0,C=w.length;b<C;b++){var M=w[b];if(r.setX(M,x[b*o]),o>=2&&r.setY(M,x[b*o+1]),o>=3&&r.setZ(M,x[b*o+2]),o>=4&&r.setW(M,x[b*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r}))},q.prototype.loadTexture=function(e){var t=this.json,n=this.options,i=t.textures[e],r=t.images[i.source],a=this.textureLoader;if(r.uri){var o=n.manager.getHandler(r.uri);null!==o&&(a=o)}return this.loadTextureImage(e,r,a)},q.prototype.loadTextureImage=function(e,t,n){var i=this,r=this.json,a=this.options,o=r.textures[e],s=self.URL||self.webkitURL,A=t.uri,l=!1,c=!0;if("image/jpeg"===t.mimeType&&(c=!1),void 0!==t.bufferView)A=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);c=6===n||4===n||3===n}l=!0;var i=new Blob([e],{type:t.mimeType});return A=s.createObjectURL(i)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(A).then((function(e){return new Promise((function(t,i){var r=t;!0===n.isImageBitmapLoader&&(r=function(e){t(new Ko(e))}),n.load(O(e,a.path),r,void 0,i)}))})).then((function(t){!0===l&&s.revokeObjectURL(A),t.flipY=!1,o.name&&(t.name=o.name),c||(t.format=ae);var n=(r.samplers||{})[o.sampler]||{};return t.magFilter=T[n.magFilter]||W,t.minFilter=T[n.minFilter]||Z,t.wrapS=L[n.wrapS]||G,t.wrapT=L[n.wrapT]||G,i.associations.set(t,{type:"textures",index:e}),t}))},q.prototype.assignTexture=function(e,t,i){var r=this;return this.getDependency("texture",i.index).then((function(a){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),r.extensions[n.KHR_TEXTURE_TRANSFORM]){var o=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=r.associations.get(a);a=r.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,s)}}e[t]=a}))},q.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=void 0!==t.attributes.tangent,r=void 0!==t.attributes.color,a=void 0===t.attributes.normal,o=!0===e.isSkinnedMesh,s=Object.keys(t.morphAttributes).length>0,A=s&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+n.uuid,c=this.cache.get(l);c||(c=new Ho,Pn.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(l,c)),n=c}else if(e.isLine){l="LineBasicMaterial:"+n.uuid;var h=this.cache.get(l);h||(h=new Fo,Pn.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(i||r||a||o||s){l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),o&&(l+="skinning:"),i&&(l+="vertex-tangents:"),r&&(l+="vertex-colors:"),a&&(l+="flat-shading:"),s&&(l+="morph-targets:"),A&&(l+="morph-normals:");var u=this.cache.get(l);u||(u=n.clone(),o&&(u.skinning=!0),r&&(u.vertexColors=!0),a&&(u.flatShading=!0),s&&(u.morphTargets=!0),A&&(u.morphNormals=!0),i&&(u.vertexTangents=!0,u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(l,u),this.associations.set(u,this.associations.get(n))),n=u}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n},q.prototype.getMaterialType=function(){return dA},q.prototype.loadMaterial=function(e){var t,i=this,r=this.json,a=this.extensions,o=r.materials[e],s={},A=o.extensions||{},l=[];if(A[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),l.push(c.extendParams(s,o,i))}else if(A[n.KHR_MATERIALS_UNLIT]){var h=a[n.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),l.push(h.extendParams(s,o,i))}else{var u=o.pbrMetallicRoughness||{};if(s.color=new Sn(1,1,1),s.opacity=1,Array.isArray(u.baseColorFactor)){var d=u.baseColorFactor;s.color.fromArray(d),s.opacity=d[3]}void 0!==u.baseColorTexture&&l.push(i.assignTexture(s,"map",u.baseColorTexture)),s.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,s.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture&&(l.push(i.assignTexture(s,"metalnessMap",u.metallicRoughnessTexture)),l.push(i.assignTexture(s,"roughnessMap",u.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===o.doubleSided&&(s.side=2);var f=o.alphaMode||k;return f===R?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,f===D&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==kn&&(l.push(i.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new Je(1,-1),void 0!==o.normalTexture.scale&&s.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==kn&&(l.push(i.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==kn&&(s.emissive=(new Sn).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==kn&&l.push(i.assignTexture(s,"emissiveMap",o.emissiveTexture)),Promise.all(l).then((function(){var r;return r=t===g?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),o.name&&(r.name=o.name),r.map&&(r.map.encoding=ke),r.emissiveMap&&(r.emissiveMap.encoding=ke),Y(r,o),i.associations.set(r,{type:"materials",index:e}),o.extensions&&N(a,r,o),r}))},q.prototype.createUniqueName=function(e){for(var t=Sc.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n},q.prototype.loadGeometries=function(e){var t=this,i=this.extensions,r=this.primitiveCache;function a(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return $(n,e,t)}))}for(var o,s,A=[],l=0,c=e.length;l<c;l++){var h,u=e[l],d=(s=void 0,(s=(o=u).extensions&&o.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+J(s.attributes):o.indices+":"+J(o.attributes)+":"+o.mode),f=r[d];if(f)A.push(f.promise);else h=u.extensions&&u.extensions[n.KHR_DRACO_MESH_COMPRESSION]?a(u):$(new ni,u,t),r[d]={primitive:u,promise:h},A.push(h)}return Promise.all(A)},q.prototype.loadMesh=function(e){for(var t,n=this,i=this.json,r=this.extensions,a=i.meshes[e],o=a.primitives,s=[],A=0,l=o.length;A<l;A++){var c=void 0===o[A].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new dA({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),t.DefaultMaterial):this.getDependency("material",o[A].material);s.push(c)}return s.push(n.loadGeometries(o)),Promise.all(s).then((function(t){for(var i=t.slice(0,t.length-1),s=t[t.length-1],A=[],l=0,c=s.length;l<c;l++){var h,u=s[l],d=o[l],f=i[l];if(d.mode===B||d.mode===I||d.mode===E||void 0===d.mode)!0!==(h=!0===a.isSkinnedMesh?new wo(u,f):new xi(u,f)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===I?h.geometry=ee(h.geometry,1):d.mode===E&&(h.geometry=ee(h.geometry,2));else if(d.mode===b)h=new Go(u,f);else if(d.mode===M)h=new Ro(u,f);else if(d.mode===C)h=new Qo(u,f);else{if(d.mode!==x)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new Xo(u,f)}Object.keys(h.geometry.morphAttributes).length>0&&K(h,a),h.name=n.createUniqueName(a.name||"mesh_"+e),Y(h,a),d.extensions&&N(r,h,d),n.assignFinalMaterial(h),A.push(h)}if(1===A.length)return A[0];var p=new Ha;for(l=0,c=A.length;l<c;l++)p.add(A[l]);return p}))},q.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Di(Oh.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new El(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Y(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},q.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},q.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],r=[],a=[],o=[],s=0,A=t.channels.length;s<A;s++){var l=t.channels[s],c=t.samplers[l.sampler],h=l.target,u=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[c.input]:c.input,f=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",d)),r.push(this.getDependency("accessor",f)),a.push(c),o.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(o)]).then((function(n){for(var i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],A=[],l=0,c=i.length;l<c;l++){var h=i[l],u=r[l],d=a[l],f=o[l],p=s[l];if(void 0!==h){var m;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,U[p.path]){case U.weights:m=_A;break;case U.rotation:m=PA;break;case U.position:case U.scale:default:m=DA}var g=h.name?h.name:h.uuid,v=void 0!==f.interpolation?P[f.interpolation]:Te,y=[];U[p.path]===U.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&y.push(e.name?e.name:e.uuid)})):y.push(g);var x=d.array;if(d.normalized){var b;if(x.constructor===Int8Array)b=1/127;else if(x.constructor===Uint8Array)b=1/255;else if(x.constructor==Int16Array)b=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");b=1/65535}for(var C=new Float32Array(x.length),M=0,B=x.length;M<B;M++)C[M]=x[M]*b;x=C}for(M=0,B=y.length;M<B;M++){var I=new m(y[M]+"."+U[p.path],u.array,x,v);"CUBICSPLINE"===f.interpolation&&(I.createInterpolant=function(e){return new w(this.times,this.values,this.getValueSize()/3,e)},I.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),A.push(I)}}}return new RA(t.name?t.name:"animation_"+e,void 0,A)}))},q.prototype.loadNode=function(e){var t,n=this.json,i=this.extensions,r=this,a=n.nodes[e],o=a.name?r.createUniqueName(a.name):"";return(t=[],void 0!==a.mesh&&t.push(r.getDependency("mesh",a.mesh).then((function(e){var t=r._getNodeRef(r.meshCache,a.mesh,e);return void 0!==a.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=a.weights.length;t<n;t++)e.morphTargetInfluences[t]=a.weights[t]})),t}))),void 0!==a.camera&&t.push(r.getDependency("camera",a.camera).then((function(e){return r._getNodeRef(r.cameraCache,a.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===a.isBone?new Mo:t.length>1?new Ha:1===t.length?t[0]:new Dt)!==t[0])for(var s=0,A=t.length;s<A;s++)n.add(t[s]);if(a.name&&(n.userData.name=a.name,n.name=o),Y(n,a),a.extensions&&N(i,n,a),void 0!==a.matrix){var l=new vt;l.fromArray(a.matrix),n.applyMatrix4(l)}else void 0!==a.translation&&n.position.fromArray(a.translation),void 0!==a.rotation&&n.quaternion.fromArray(a.rotation),void 0!==a.scale&&n.scale.fromArray(a.scale);return r.associations.set(n,{type:"nodes",index:e}),n}))},q.prototype.loadScene=function(){function e(t,n,i,r){var a=i.nodes[t];return r.getDependency("node",t).then((function(e){return void 0===a.skin?e:r.getDependency("skin",a.skin).then((function(e){for(var n=[],i=0,a=(t=e).joints.length;i<a;i++)n.push(r.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],r=[],a=0,o=n.length;a<o;a++){var s=n[a];if(s){i.push(s);var A=new vt;void 0!==t.inverseBindMatrices&&A.fromArray(t.inverseBindMatrices.array,16*a),r.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new Co(i,r),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var o=[];if(a.children)for(var s=a.children,A=0,l=s.length;A<l;A++){var c=s[A];o.push(e(c,t,i,r))}return Promise.all(o)}))}return function(t){var n=this.json,i=this.extensions,r=this.json.scenes[t],a=new Ha;r.name&&(a.name=this.createUniqueName(r.name)),Y(a,r),r.extensions&&N(i,a,r);for(var o=r.nodes||[],s=[],A=0,l=o.length;A<l;A++)s.push(e(o[A],a,n,this));return Promise.all(s).then((function(){return a}))}}(),e}(),GB=function(e){QA.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};GB.prototype=Object.assign(Object.create(QA.prototype),{constructor:GB,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,i){var r=this,a=new VA(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var n={attributeIDs:r.defaultAttributeIDs,attributeTypes:r.defaultAttributeTypes,useUniqueIDs:!1};r.decodeGeometry(e,n).then(t).catch(i)}),n,i)},decodeDracoFile:function(e,t,n,i){var r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)},decodeGeometry:function(e,t){var n=this;for(var i in t.attributeTypes){var r=t.attributeTypes[i];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[i]=r.name)}var a,o=JSON.stringify(t);if(GB.taskCache.has(e)){var s=GB.taskCache.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var A=this.workerNextTaskID++,l=e.byteLength,c=this._getWorker(A,l).then((function(n){return a=n,new Promise((function(n,i){a._callbacks[A]={resolve:n,reject:i},a.postMessage({type:"decode",id:A,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return c.catch((function(){return!0})).then((function(){a&&A&&n._releaseTask(a,A)})),GB.taskCache.set(e,{key:o,promise:c}),c},_createGeometry:function(e){var t=new ni;e.index&&t.setIndex(new Dn(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],r=i.name,a=i.array,o=i.itemSize;t.setAttribute(r,new Dn(a,o))}return t},_loadLibrary:function(e,t){var n=new VA(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,i){n.load(e,t,void 0,i)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==("undefined"==typeof WebAssembly?"undefined":i(WebAssembly))||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var i=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var r=GB.DRACOWorker.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending},_getWorker:function(e,t){var n=this;return this._initDecoder().then((function(){var i;n.workerPool.length<n.workerLimit?((i=new Worker(n.workerSourceURL))._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)):n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(i=n.workerPool[n.workerPool.length-1])._taskCosts[e]=t,i._taskLoad+=t,i}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),GB.DRACOWorker=function(){var e,t;function n(e,t,n,i,r,a){var o=a.num_components(),s=n.num_points()*o,A=s*r.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),c=e._malloc(A);t.GetAttributeDataArrayForAllPoints(n,a,l,A,c);var h=new r(e.HEAPF32.buffer,c,s).slice();return e._free(c),{name:i,array:h,itemSize:o}}onmessage=function(i){var r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=r.buffer,o=r.taskConfig;t.then((function(e){var t=e.draco,i=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var A=function(e,t,i,r){var a,o,s=r.attributeIDs,A=r.attributeTypes,l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(i,a);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c={index:null,attributes:[]};for(var h in s){var u,d,f=self[A[h]];if(r.useUniqueIDs)d=s[h],u=t.GetAttributeByUniqueId(a,d);else{if(-1===(d=t.GetAttributeId(a,e[s[h]])))continue;u=t.GetAttribute(a,d)}c.attributes.push(n(e,t,a,h,f,u))}l===e.TRIANGULAR_MESH&&(c.index=function(e,t,n){var i=3*n.num_faces(),r=4*i,a=e._malloc(r);t.GetTrianglesUInt32Array(n,r,a);var o=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:o,itemSize:1}}(e,t,a));return e.destroy(a),c}(t,i,s,o),l=A.attributes.map((function(e){return e.array.buffer}));A.index&&l.push(A.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:A},l)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(s),t.destroy(i)}}))}}},GB.taskCache=new WeakMap,GB.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},GB.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},GB.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},GB.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var QB={};QB.LegacyGLTFLoader=function(){function e(e){QA.call(this,e)}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}},update:function(t,n){for(var i in e){var r=e[i];r.update&&r.update(t,n)}}}}function n(e,t){var n={},i=e.material.uniforms;for(var r in i){var a=i[r];if(a.semantic){var o=a.node,s=e;o&&(s=t[o]),n[r]={semantic:a.semantic,sourceNode:s,targetNode:e,uniform:a}}}this.boundUniforms=n,this._m4=new vt}e.prototype=Object.assign(Object.create(QA.prototype),{constructor:e,load:function(e,t,n,i){var r,a=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Ul.extractUrlBase(e);var o=new VA(a.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,(function(e){a.parse(e,r,t)}),n,i)},parse:function(e,t,n){var s,A={};Ul.decodeText(new Uint8Array(e,0,4))===a.magic?(A[i.KHR_BINARY_GLTF]=new o(e),s=A[i.KHR_BINARY_GLTF].content):s=Ul.decodeText(new Uint8Array(e));var l=JSON.parse(s);l.extensionsUsed&&l.extensionsUsed.indexOf(i.KHR_MATERIALS_COMMON)>=0&&(A[i.KHR_MATERIALS_COMMON]=new r(l)),new B(l,A,{crossOrigin:this.crossOrigin,manager:this.manager,path:t||this.resourcePath||""}).parse((function(e,t,i,r){n({scene:e,scenes:t,cameras:i,animations:r})}))}}),e.Shaders={update:function(){console.warn("threeExamples.LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},n.prototype.update=function(e,t){var n=this.boundUniforms;for(var i in n){var r=n[i];switch(r.semantic){case"MODELVIEW":r.uniform.value.multiplyMatrices(t.matrixWorldInverse,r.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var a=r.uniform.value;this._m4.multiplyMatrices(t.matrixWorldInverse,r.sourceNode.matrixWorld),a.getNormalMatrix(this._m4);break;case"PROJECTION":r.uniform.value.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var o=r.uniform.value,s=0;s<o.length;s++)o[s].getInverse(r.sourceNode.matrixWorld).multiply(r.targetNode.skeleton.bones[s].matrixWorld).multiply(r.targetNode.skeleton.boneInverses[s]).multiply(r.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+r.semantic)}}},e.Animations={update:function(){console.warn("threeExamples.LegacyGLTFLoader.Animation has been deprecated. Use THREE.AnimationMixer instead.")}};var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"};function r(e){this.name=i.KHR_MATERIALS_COMMON,this.lights={};var t=(e.extensions&&e.extensions[i.KHR_MATERIALS_COMMON]||{}).lights||{};for(var n in t){var r,a=t[n],o=a[a.type],s=(new Sn).fromArray(o.color);switch(a.type){case"directional":(r=new Tl(s)).position.set(0,0,1);break;case"point":r=new Il(s);break;case"spot":(r=new Ml(s)).position.set(0,0,1);break;case"ambient":r=new Ll(s)}r&&(this.lights[n]=r)}}var a={magic:"glTF",version:1,contentFormat:0};function o(e){this.name=i.KHR_BINARY_GLTF;var t=new DataView(e,0,20),n={magic:Ul.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0),contentLength:t.getUint32(12,!0),contentFormat:t.getUint32(16,!0)};for(var r in a){var o=a[r];if(n[r]!==o)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',r,o)}var s=new Uint8Array(e,20,n.contentLength);this.header=n,this.content=Ul.decodeText(s),this.body=e.slice(20+n.contentLength,n.length)}o.prototype.loadShader=function(e,t){var n=t[e.extensions[i.KHR_BINARY_GLTF].bufferView],r=new Uint8Array(n);return Ul.decodeText(r)};var s={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},A={5126:Number,35675:rt,35676:vt,35664:Je,35665:tt,35666:At,35678:st},l={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:z,9729:W,9984:V,9985:X,9986:j,9987:Z},h={33071:Q,33648:H,10497:G},u={6406:re,6407:ae,6408:oe,6409:se,6410:Ae},d={5121:Y,32819:ee,32820:te,33635:ne},f={1028:1,1029:0},p={512:0,513:2,514:4,515:3,516:5,517:7,518:5,519:1},m={32774:I,32778:101,32779:102},g={0:E,1:S,768:T,769:203,770:L,771:F,772:_,773:207,774:U,775:209,776:210},v={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={scale:"scale",translation:"position",rotation:"quaternion"},w={LINEAR:Te,STEP:Se},x={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function b(e,t,n){if(!e)return Promise.resolve();var i,r=[];if("[object Array]"===Object.prototype.toString.call(e)){i=[];for(var a=e.length,o=0;o<a;o++){(A=t.call(n||this,e[o],o))&&(r.push(A),A instanceof Promise?A.then(function(e,t){i[e]=t}.bind(this,o)):i[o]=A)}}else for(var s in i={},e){var A;if(e.hasOwnProperty(s))(A=t.call(n||this,e[s],s))&&(r.push(A),A instanceof Promise?A.then(function(e,t){i[e]=t}.bind(this,s)):i[s]=A)}return Promise.all(r).then((function(){return i}))}function C(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:(t||"")+e}function M(e){this.isDeferredShaderMaterial=!0,this.params=e}function B(e,n,i){this.json=e||{},this.extensions=n||{},this.options=i||{},this.cache=new t}return M.prototype.create=function(){var e=Ui.clone(this.params.uniforms);for(var t in this.params.uniforms){var n=this.params.uniforms[t];n.value instanceof st&&(e[t].value=n.value,e[t].value.needsUpdate=!0),e[t].semantic=n.semantic,e[t].node=n.node}return this.params.uniforms=e,new uA(this.params)},B.prototype._withDependencies=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n],r="load"+i.charAt(0).toUpperCase()+i.slice(1),a=this.cache.get(i);if(void 0!==a)t[i]=a;else if(this[r]){var o=this[r]();this.cache.add(i,o),t[i]=o}}return b(t,(function(e){return e}))},B.prototype.parse=function(e){var t=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then((function(n){var i=[];for(var r in n.scenes)i.push(n.scenes[r]);var a=void 0!==t.scene?n.scenes[t.scene]:i[0],o=[];for(var r in n.cameras){var s=n.cameras[r];o.push(s)}var A=[];for(var r in n.animations)A.push(n.animations[r]);e(a,i,o,A)}))},B.prototype.loadShaders=function(){var e=this.json,t=this.extensions,n=this.options;return this._withDependencies(["bufferViews"]).then((function(r){return b(e.shaders,(function(e){return e.extensions&&e.extensions[i.KHR_BINARY_GLTF]?t[i.KHR_BINARY_GLTF].loadShader(e,r.bufferViews):new Promise((function(t){var i=new VA(n.manager);i.setResponseType("text"),i.load(C(e.uri,n.path),(function(e){t(e)}))}))}))}))},B.prototype.loadBuffers=function(){var e=this.json,t=this.extensions,n=this.options;return b(e.buffers,(function(e,r){return"binary_glTF"===r?t[i.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise((function(t){var i=new VA(n.manager);i.setResponseType("arraybuffer"),i.load(C(e.uri,n.path),(function(e){t(e)}))})):void console.warn("threeExamples.LegacyGLTFLoader: "+e.type+" buffer type is not supported")}))},B.prototype.loadBufferViews=function(){var e=this.json;return this._withDependencies(["buffers"]).then((function(t){return b(e.bufferViews,(function(e){var n=t.buffers[e.buffer],i=void 0!==e.byteLength?e.byteLength:0;return n.slice(e.byteOffset,e.byteOffset+i)}))}))},B.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then((function(t){return b(e.accessors,(function(e){var n=t.bufferViews[e.bufferView],i=v[e.type],r=l[e.componentType],a=r.BYTES_PER_ELEMENT,o=a*i;if(e.byteStride&&e.byteStride!==o){var s=new r(n);return new eo(new $a(s,e.byteStride/a),i,e.byteOffset/a)}return new Dn(s=new r(n,e.byteOffset,e.count*i),i)}))}))},B.prototype.loadTextures=function(){var e=this.json,t=this.options;return this._withDependencies(["bufferViews"]).then((function(n){return b(e.textures,(function(r){if(r.source)return new Promise((function(a){var o=e.images[r.source],s=o.uri,A=!1;if(o.extensions&&o.extensions[i.KHR_BINARY_GLTF]){var l=o.extensions[i.KHR_BINARY_GLTF],f=n.bufferViews[l.bufferView],p=new Blob([f],{type:l.mimeType});s=URL.createObjectURL(p),A=!0}var m=t.manager.getHandler(s);null===m&&(m=new KA(t.manager)),m.setCrossOrigin(t.crossOrigin),m.load(C(s,t.path),(function(t){if(A&&URL.revokeObjectURL(s),t.flipY=!1,void 0!==r.name&&(t.name=r.name),t.format=void 0!==r.format?u[r.format]:oe,void 0!==r.internalFormat&&t.format!==u[r.internalFormat]&&console.warn("threeExamples.LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==r.type?d[r.type]:Y,r.sampler){var n=e.samplers[r.sampler];t.magFilter=c[n.magFilter]||W,t.minFilter=c[n.minFilter]||j,t.wrapS=h[n.wrapS]||G,t.wrapT=h[n.wrapT]||G}a(t)}),void 0,(function(){A&&URL.revokeObjectURL(s),a()}))}))}))}))},B.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then((function(t){return b(e.materials,(function(n){var r,a,o={},l={};if(n.extensions&&n.extensions[i.KHR_MATERIALS_COMMON]&&(a=n.extensions[i.KHR_MATERIALS_COMMON]),a){var c=["ambient","emission","transparent","transparency","doubleSided"];switch(a.technique){case"BLINN":case"PHONG":r=pA,c.push("diffuse","specular","shininess");break;case"LAMBERT":r=vA,c.push("diffuse");break;case"CONSTANT":default:r=kn}c.forEach((function(e){void 0!==a.values[e]&&(o[e]=a.values[e])})),(a.doubleSided||o.doubleSided)&&(l.side=2),(a.transparent||o.transparent)&&(l.transparent=!0,l.opacity=void 0!==o.transparency?o.transparency:1)}else if(void 0===n.technique)r=pA,Object.assign(o,n.values);else{r=M;var h=e.techniques[n.technique];l.uniforms={};var u=e.programs[h.program];if(u){l.fragmentShader=t.shaders[u.fragmentShader],l.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",u.fragmentShader),r=pA);var d=t.shaders[u.vertexShader];d||(console.warn("ERROR: Missing vertex shader definition:",u.vertexShader),r=pA),l.vertexShader=function(e,t){var n={};for(var i in t.attributes){var r=t.attributes[i],a=(h=t.parameters[r]).type,o=h.semantic;n[i]={type:a,semantic:o}}var s=t.parameters,A=t.attributes,l={};for(var i in n){var c=s[r=A[i]];(o=c.semantic)&&(l[i]=c)}for(var r in l){o=(h=l[r]).semantic;var h,u=new RegExp("\\b"+r+"\\b","g");switch(o){case"POSITION":e=e.replace(u,"position");break;case"NORMAL":e=e.replace(u,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(u,"uv");break;case"TEXCOORD_1":e=e.replace(u,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":e=e.replace(u,"color");break;case"WEIGHT":e=e.replace(u,"skinWeight");break;case"JOINT":e=e.replace(u,"skinIndex")}}return e}(d,h);var v=h.uniforms;for(var y in v){var w=v[y],b=h.parameters[w],C=b.type;if(!A[C])throw new Error("Unknown shader uniform param type: "+C);var B,T=b.count;void 0!==n.values&&(B=n.values[w]);var L=new A[C],F=b.semantic,_=b.node;switch(C){case s.FLOAT:L=b.value,"transparency"==w&&(l.transparent=!0),void 0!==B&&(L=B);break;case s.FLOAT_VEC2:case s.FLOAT_VEC3:case s.FLOAT_VEC4:case s.FLOAT_MAT3:b&&b.value&&L.fromArray(b.value),B&&L.fromArray(B);break;case s.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case s.FLOAT_MAT4:if(T){L=new Array(T);for(var U=0;U<T;U++)L[U]=new A[C];if(b&&b.value){var P=b.value;L.fromArray(P)}B&&L.fromArray(B)}else{if(b&&b.value){var k=b.value;L.fromArray(k)}B&&L.fromArray(B)}break;case s.SAMPLER_2D:L=void 0!==B?t.textures[B]:void 0!==b.value?t.textures[b.value]:null}l.uniforms[y]={value:L,semantic:F,node:_}}for(var D=h.states||{},R=D.enable||[],O=D.functions||{},N=!1,G=!1,Q=!1,H=0,z=R.length;H<z;H++){var V=R[H];switch(x[V]){case"CULL_FACE":N=!0;break;case"DEPTH_TEST":G=!0;break;case"BLEND":Q=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+V)}}l.side=N?void 0!==O.cullFace?f[O.cullFace]:0:2,l.depthTest=G,l.depthFunc=void 0!==O.depthFunc?p[O.depthFunc]:2,l.depthWrite=void 0===O.depthMask||O.depthMask[0],l.blending=Q?5:0,l.transparent=Q;var j=O.blendEquationSeparate;void 0!==j?(l.blendEquation=m[j[0]],l.blendEquationAlpha=m[j[1]]):(l.blendEquation=I,l.blendEquationAlpha=I);var W=O.blendFuncSeparate;void 0!==W?(l.blendSrc=g[W[0]],l.blendDst=g[W[1]],l.blendSrcAlpha=g[W[2]],l.blendDstAlpha=g[W[3]]):(l.blendSrc=S,l.blendDst=E,l.blendSrcAlpha=S,l.blendDstAlpha=E)}}Array.isArray(o.diffuse)?l.color=(new Sn).fromArray(o.diffuse):"string"==typeof o.diffuse&&(l.map=t.textures[o.diffuse]),delete l.diffuse,"string"==typeof o.reflective&&(l.envMap=t.textures[o.reflective]),"string"==typeof o.bump&&(l.bumpMap=t.textures[o.bump]),Array.isArray(o.emission)?r===kn?l.color=(new Sn).fromArray(o.emission):l.emissive=(new Sn).fromArray(o.emission):"string"==typeof o.emission&&(r===kn?l.map=t.textures[o.emission]:l.emissiveMap=t.textures[o.emission]),Array.isArray(o.specular)?l.specular=(new Sn).fromArray(o.specular):"string"==typeof o.specular&&(l.specularMap=t.textures[o.specular]),void 0!==o.shininess&&(l.shininess=o.shininess);var X=new r(l);return void 0!==n.name&&(X.name=n.name),X}))}))},B.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then((function(t){return b(e.meshes,(function(n){var i=new Ha;void 0!==n.name&&(i.name=n.name),n.extras&&(i.userData=n.extras);var r=n.primitives||[];for(var a in r){var o=r[a];if(o.mode===s.TRIANGLES||void 0===o.mode){var A=new ni,l=o.attributes;for(var c in l){if(!(f=l[c]))return;var h=t.accessors[f];switch(c){case"POSITION":A.setAttribute("position",h);break;case"NORMAL":A.setAttribute("normal",h);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":A.setAttribute("uv",h);break;case"TEXCOORD_1":A.setAttribute("uv2",h);break;case"COLOR_0":case"COLOR0":case"COLOR":A.setAttribute("color",h);break;case"WEIGHT":A.setAttribute("skinWeight",h);break;case"JOINT":A.setAttribute("skinIndex",h);break;default:if(!o.material)break;if(!(m=e.materials[o.material]).technique)break;var u=e.techniques[m.technique].parameters||{};for(var d in u)u[d].semantic===c&&A.setAttribute(d,h)}}o.indices&&A.setIndex(t.accessors[o.indices]),(p=new xi(A,m=void 0!==t.materials?t.materials[o.material]:new pA({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:0}))).castShadow=!0,p.name="0"===a?i.name:i.name+a,o.extras&&(p.userData=o.extras),i.add(p)}else if(o.mode===s.LINES){A=new ni,l=o.attributes;for(var c in l){var f;if(!(f=l[c]))return;h=t.accessors[f];switch(c){case"POSITION":A.setAttribute("position",h);break;case"COLOR_0":case"COLOR0":case"COLOR":A.setAttribute("color",h)}}var p,m=t.materials[o.material];o.indices?(A.setIndex(t.accessors[o.indices]),p=new Go(A,m)):p=new Ro(A,m),p.name="0"===a?i.name:i.name+a,o.extras&&(p.userData=o.extras),i.add(p)}else console.warn("Only triangular and line primitives are supported")}return i}))}))},B.prototype.loadCameras=function(){return b(this.json.cameras,(function(e){if("perspective"==e.type&&e.perspective){var t=e.perspective.yfov,n=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,i=t*n,r=new Di(Oh.radToDeg(i),n,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(r.name=e.name),e.extras&&(r.userData=e.extras),r}if("orthographic"==e.type&&e.orthographic){r=new El(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar);return void 0!==e.name&&(r.name=e.name),e.extras&&(r.userData=e.extras),r}}))},B.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then((function(t){return b(e.skins,(function(e){var n=new vt;return void 0!==e.bindShapeMatrix&&n.fromArray(e.bindShapeMatrix),{bindShapeMatrix:n,jointNames:e.jointNames,inverseBindMatrices:t.accessors[e.inverseBindMatrices]}}))}))},B.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then((function(t){return b(e.animations,(function(e,n){var i=[];for(var r in e.channels){var a=e.channels[r],o=e.samplers[a.sampler];if(o){var s=a.target,A=s.id,l=void 0!==e.parameters?e.parameters[o.input]:o.input,c=void 0!==e.parameters?e.parameters[o.output]:o.output,h=t.accessors[l],u=t.accessors[c],d=t.nodes[A];if(d){d.updateMatrix(),d.matrixAutoUpdate=!0;var f=y[s.path]===y.rotation?PA:DA,p=d.name?d.name:d.uuid,m=void 0!==o.interpolation?w[o.interpolation]:Te;i.push(new f(p+"."+y[s.path],MA.arraySlice(h.array,0),MA.arraySlice(u.array,0),m))}}}return new RA(A=void 0!==e.name?e.name:"animation_"+n,void 0,i)}))}))},B.prototype.loadNodes=function(){var e=this.json,t=this.extensions,n=this;return b(e.nodes,(function(e){var t,n=new vt;return e.jointName?((t=new Mo).name=void 0!==e.name?e.name:e.jointName,t.jointName=e.jointName):(t=new Dt,void 0!==e.name&&(t.name=e.name)),e.extras&&(t.userData=e.extras),void 0!==e.matrix?(n.fromArray(e.matrix),t.applyMatrix4(n)):(void 0!==e.translation&&t.position.fromArray(e.translation),void 0!==e.rotation&&t.quaternion.fromArray(e.rotation),void 0!==e.scale&&t.scale.fromArray(e.scale)),t})).then((function(r){return n._withDependencies(["meshes","skins","cameras"]).then((function(n){return b(r,(function(a,o){var s=e.nodes[o];if(void 0!==s.meshes)for(var A in s.meshes){var l=s.meshes[A],c=n.meshes[l];if(void 0!==c)for(var h in c.children){var u,d=c.children[h],f=d.material,p=d.geometry,m=d.userData,g=d.name;switch(f.isDeferredShaderMaterial?f=v=f.create():v=f,d.type){case"LineSegments":d=new Go(p,v);break;case"LineLoop":d=new Qo(p,v);break;case"Line":d=new Ro(p,v);break;default:d=new xi(p,v)}if(d.castShadow=!0,d.userData=m,d.name=g,s.skin&&(u=n.skins[s.skin]),u){var v,y=function(e){for(var t=Object.keys(r),n=0,i=t.length;n<i;n++){var a=r[t[n]];if(a.jointName===e)return a}return null},w=p;(v=f).skinning=!0,(d=new wo(w,v)).castShadow=!0,d.userData=m,d.name=g;for(var x=[],b=[],C=0,M=u.jointNames.length;C<M;C++){var B=u.jointNames[C],I=y(B);if(I){x.push(I);var E=u.inverseBindMatrices.array,S=(new vt).fromArray(E,16*C);b.push(S)}else console.warn("WARNING: joint: '"+B+"' could not be found")}d.bind(new Co(x,b),u.bindShapeMatrix);!function t(n,i,a){var o=n[a];if(void 0!==o)for(var s=0,A=o.length;s<A;s++){var l=o[s],c=r[l],h=e.nodes[l];void 0!==c&&!0===c.isBone&&void 0!==h&&(i.add(c),t(h,c,"children"))}}(s,d,"skeletons")}a.add(d)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+l+'".')}if(void 0!==s.camera){var T=n.cameras[s.camera];a.add(T)}if(s.extensions&&s.extensions[i.KHR_MATERIALS_COMMON]&&s.extensions[i.KHR_MATERIALS_COMMON].light){var L=t[i.KHR_MATERIALS_COMMON].lights[s.extensions[i.KHR_MATERIALS_COMMON].light];a.add(L)}return a}))}))}))},B.prototype.loadScenes=function(){var e=this.json;function t(n,i,r){var a=r[n];i.add(a);var o=e.nodes[n];if(o.children)for(var s=o.children,A=0,l=s.length;A<l;A++){t(s[A],a,r)}}return this._withDependencies(["nodes"]).then((function(i){return b(e.scenes,(function(e){var r=new Rt;void 0!==e.name&&(r.name=e.name),e.extras&&(r.userData=e.extras);for(var a=e.nodes||[],o=0,s=a.length;o<s;o++){t(a[o],r,i.nodes)}return r.traverse((function(e){e.material&&e.material.isRawShaderMaterial&&(e.gltfShader=new n(e,i.nodes),e.onBeforeRender=function(e,t,n){this.gltfShader.update(t,n)})})),r}))}))},e}();var HB=QB.LegacyGLTFLoader;function zB(e,t,n){return t<=e&&e<=n}function VB(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function jB(e){this.tokens=[].slice.call(e)}jB.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():-1},prepend:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.unshift(t.pop());else this.tokens.unshift(e)},push:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.push(t.shift());else this.tokens.push(e)}};function WB(e,t){if(e)throw TypeError("Decoder error");return t||65533}var XB="utf-8";function ZB(e,t){if(!(this instanceof ZB))return new ZB(e,t);if((e=void 0!==e?String(e).toLowerCase():XB)!==XB)throw new Error("Encoding not supported. Only utf-8 is supported");t=VB(t),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(t.fatal),this._ignoreBOM=Boolean(t.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function YB(e){var t=e.fatal,n=0,i=0,r=0,a=128,o=191;this.handler=function(e,s){if(-1===s&&0!==r)return r=0,WB(t);if(-1===s)return-1;if(0===r){if(zB(s,0,127))return s;if(zB(s,194,223))r=1,n=s-192;else if(zB(s,224,239))224===s&&(a=160),237===s&&(o=159),r=2,n=s-224;else{if(!zB(s,240,244))return WB(t);240===s&&(a=144),244===s&&(o=143),r=3,n=s-240}return n<<=6*r,null}if(!zB(s,a,o))return n=r=i=0,a=128,o=191,e.prepend(s),WB(t);if(a=128,o=191,n+=s-128<<6*(r-(i+=1)),i!==r)return null;var A=n;return n=r=i=0,A}}ZB.prototype={decode:function(e,t){var n;n="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t=VB(t),this._streaming||(this._decoder=new YB({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(t.stream);for(var i,r=new jB(n),a=[];!r.endOfStream()&&-1!==(i=this._decoder.handler(r,r.read()));)null!==i&&(Array.isArray(i)?a.push.apply(a,i):a.push(i));if(!this._streaming){do{if(-1===(i=this._decoder.handler(r,r.read())))break;null!==i&&(Array.isArray(i)?a.push.apply(a,i):a.push(i))}while(!r.endOfStream());this._decoder=null}return a.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===a[0]?(this._BOMseen=!0,a.shift()):this._BOMseen=!0)),function(e){for(var t="",n=0;n<e.length;++n){var i=e[n];i<=65535?t+=String.fromCharCode(i):(i-=65536,t+=String.fromCharCode(55296+(i>>10),56320+(1023&i)))}return t}(a)}};var KB=new ZB("utf-8"),JB="tileset",qB="batchtable",$B="boundingVolume",eI=function(){function e(t,n,i,a){r(this,e),this.type=qB,this.batchLength=i;var o=t;n>0&&(console.warn("Binary batch table content not supported yet."),o=t.slice(0,t.byteLength));var s=KB.decode(new Uint8Array(o)),A=JSON.parse(s);A.extensions&&(this.extensions=a.parseExtensions(A.extensions,this.type),delete A.extensions),this.content=A}return o(e,[{key:"getInfoById",value:function(e){if(e<0&&e<this.batchLength)throw new Error("Batch Id (".concat(e,") must be between 0 and\n            ").concat(this.batchLength," to access feature properties from the batch\n            table."));var t={batchTable:{}};for(var n in this.content)Object.prototype.hasOwnProperty.call(this.content,n)&&(t.batchTable[n]=this.content[n][e]);if(this.extensions)for(var i in t.extensions={},this.extensions)Object.prototype.hasOwnProperty.call(this.extensions,i)&&(t.extensions[i]=this.extensions[i].getInfoById(e));return t}}]),e}(),tI=(new vt).makeRotationX(Math.PI/2),nI=(new vt).makeRotationZ(-Math.PI/2),iI=new NB,rI=new HB;function aI(e){var t=["MODELVIEW","MODELVIEWINVERSETRANSPOSE","PROJECTION","JOINTMATRIX"];if(e.gltfShader){var n=[];for(var i in e.gltfShader.boundUniforms)n.push(i);for(var r=0,a=n;r<a.length;r++){var o=a[r],s=e.gltfShader.boundUniforms[o].semantic;t.includes(s)||delete e.gltfShader.boundUniforms[o]}}}var oI=function(e,t){var n=t.gltfUpAxis,r=t.urlBase;if(!e)throw new Error("No array buffer provided.");var a=new DataView(e,4),o=0,s={};if(s.magic=KB.decode(new Uint8Array(e,0,4)),s.magic){s.version=a.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,s.byteLength=a.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,s.FTJSONLength=a.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,s.FTBinaryLength=a.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,s.BTJSONLength=a.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,s.BTBinaryLength=a.getUint32(o,!0);var A=(o+=Uint32Array.BYTES_PER_ELEMENT)+4,l=[],c={},h=new tt;if(s.FTJSONLength>0){var u=A,d=e.slice(u,s.FTJSONLength+u),f=KB.decode(new Uint8Array(d));(c=JSON.parse(f)).RTC_CENTER?h.fromArray(c.RTC_CENTER):h.set(0,0,0)}if(s.FTBinaryLength>0&&console.warn("3D Tiles feature table binary not supported yet."),s.BTJSONLength>0){var p=A+s.FTJSONLength+s.FTBinaryLength,m=e.slice(p,s.BTJSONLength+p);l.push(new eI(m,s.BTBinaryLength,c.BATCH_LENGTH,t.registeredExtensions))}else l.push(Promise.resolve({}));var g=A+s.FTJSONLength+s.FTBinaryLength+s.BTJSONLength+s.BTBinaryLength,v=e.slice(g),y=new DataView(v,0,20);return l.push(new Promise((function(e){var a=function(r){var a,o=C(r.scenes);try{for(o.s();!(a=o.n()).done;){a.value.traverse(aI)}}catch(e){o.e(e)}finally{o.f()}void 0===n||"Y"===n?r.scene.applyMatrix4(tI):"X"===n&&r.scene.applyMatrix4(nI),r.scene.position.copy(h);var s=new Uint8Array(v,20,y.getUint32(12,!0)),A=KB.decode(new Uint8Array(s)),l=JSON.parse(A);l.extensions&&l.extensions.CESIUM_RTC&&(r.scene.position.fromArray(l.extensions.CESIUM_RTC.center),r.scene.updateMatrixWorld(!0));r.scene.traverse((function(e){if(e.isB3dm=!0,e.frustumCulled=!1,e.material){if(t.overrideMaterials){if(Array.isArray(e.material)){var n,r=C(e.material);try{for(r.s();!(n=r.n()).done;){n.value.dispose()}}catch(e){r.e(e)}finally{r.f()}}else e.material.dispose();"object"===i(t.overrideMaterials)&&t.overrideMaterials.isMaterial?e.material=t.overrideMaterials:e.material.depthWrite=!0}else ub()&&e.material.isRawShaderMaterial&&!t.doNotPatchMaterial&&(wb(e.material),console.warn("b3dm shader has been patched to add log depth buffer support"));e.material.transparent=t.opacity<1,e.material.opacity=t.opacity}})),e(r)};1===y.getUint32(4,!0)?rI.parse(v,r,a):iI.parse(v,r,a)}))),Promise.all(l).then((function(e){return{gltf:e[1],batchTable:e[0]}}))}throw new Error("Invalid b3dm file.")},sI=function(e,t){if(!e)throw new Error("No array buffer provided.");var n=new DataView(e),i=0,r={},a={},o={};if(r.magic=KB.decode(new Uint8Array(e,i,4)),i+=4,r.magic){r.version=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,r.byteLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,r.FTJSONLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,r.FTBinaryLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,r.BTJSONLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,r.BTBinaryLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT;var s={};if(r.FTJSONLength>0){var A=i,l=e.slice(A,r.FTJSONLength+A),c=KB.decode(new Uint8Array(l));s=JSON.parse(c)}if(r.FTBinaryLength>0&&(o=function(e,t,n){var i,r=new ni,a=KB.decode(new Uint8Array(e,t,n)),o=JSON.parse(a);o.POINTS_LENGTH&&(i=o.POINTS_LENGTH);if(o.POSITION){var s=o.POSITION.byteOffset+a.length+t,A=new Float32Array(e,s,3*i);r.setAttribute("position",new Dn(A,3))}if(o.RGB){var l=o.RGB.byteOffset+a.length+t,c=new Uint8Array(e,l,3*i);r.setAttribute("color",new Dn(c,3,!0))}if(o.POSITION_QUANTIZED)throw new Error("For pnts loader, POSITION_QUANTIZED: not yet managed");if(o.RGBA)throw new Error("For pnts loader, RGBA: not yet managed");if(o.RGB565)throw new Error("For pnts loader, RGB565: not yet managed");if(o.NORMAL)throw new Error("For pnts loader, NORMAL: not yet managed");if(o.NORMAL_OCT16P)throw new Error("For pnts loader, NORMAL_OCT16P: not yet managed");if(o.BATCH_ID)throw new Error("For pnts loader, BATCH_ID: not yet managed");var h=o.RTC_CENTER?(new tt).fromArray(o.RTC_CENTER):void 0;return{geometry:r,offset:h}}(e,i,r.FTJSONLength)),r.BTJSONLength>0){var h=i+r.FTJSONLength+r.FTBinaryLength,u=e.slice(h,r.BTJSONLength+h);a=new eI(u,r.BTBinaryLength,s.BATCH_LENGTH,t)}var d={point:o,batchTable:a};return Promise.resolve(d)}throw new Error("Invalid pnts file.")};function AI(e,t,n){var i=Ul.extractUrlBase(n),r={gltfUpAxis:t.tileset.asset.gltfUpAxis,urlBase:i,overrideMaterials:t.overrideMaterials,doNotPatchMaterial:t.doNotPatchMaterial,opacity:t.opacity,registeredExtensions:t.registeredExtensions};return oI(e,r).then((function(e){return{batchTable:e.batchTable,object3d:e.gltf.scene}}))}function lI(e,t){return sI(e,t.registeredExtensions).then((function(e){var n=t.material?t.material.clone():new Ho({size:.05,vertexColors:!0}),i=new Xo(e.point.geometry,n);return e.point.offset&&i.position.copy(e.point.offset),{object3d:i}}))}var cI={executeCommand:function(e){var t=e.layer,n=e.metadata,i=new Dt;!function(e,t,n,i){e.frustumCulled=!1,e.layer=t,n.transform&&e.applyMatrix4(n.transform),e.geometricError=n.geometricError,e.tileId=n.tileId,n.refine?e.additiveRefinement="ADD"===n.refine.toUpperCase():e.additiveRefinement=!!i&&i.additiveRefinement,e.viewerRequestVolume=n.viewerRequestVolume,e.boundingVolume=n.boundingVolume,e.boundingVolume.region&&e.add(e.boundingVolume.region),e.updateMatrixWorld()}(i,t,n,e.requester);var r=n.content&&(n.content.url||n.content.uri),a=function(e){e.layers.set(t.threejsLayer),e.userData.metadata=n,e.layer=t,e.material&&(e.material.transparent=t.opacity<1,e.material.opacity=t.opacity,e.material.wireframe=t.wireframe)};if(r){var o=r.startsWith("http")?r:n.baseURL+r,s={b3dm:AI,pnts:lI};return oC.arrayBuffer(o,t.source.networkOptions).then((function(e){if(void 0!==e){var r,A=KB.decode(new Uint8Array(e,0,4));if("{"===A[0]){e=JSON.parse(KB.decode(new Uint8Array(e)));var l=o.slice(0,o.lastIndexOf("/")+1);t.tileset.extendTileset(e,n.tileId,l,t.registeredExtensions)}else if("b3dm"==A)r=s.b3dm;else{if("pnts"!=A)return Promise.reject("Unsupported magic code ".concat(A));r=s.pnts}if(r)return r(e,t,o).then((function(e){return i.content=e.object3d,e.batchTable&&(i.batchTable=e.batchTable),i.add(e.object3d),i.traverse(a),i}))}return i.traverse(a),i}))}return i.traverse(a),Promise.resolve(i)}},hI=1;var uI={executeCommand:function(e){var t=e.layer,n=e.requester;return n.load().then((function(i){var r=new Xo(i,t.material);return function(e){var t=e.geometry.attributes.position.count,n=new Uint8Array(4*t),i=hI++;if(t>65535||i>65535)return console.warn("Currently picking is limited to Points with less than 65535 elements and less than 65535 Points instances"),e;for(var r=0;r<t;r++){var a=i<<16|r;n[4*r+0]=(4278190080&a)>>24,n[4*r+1]=(16711680&a)>>16,n[4*r+2]=(65280&a)>>8,n[4*r+3]=(255&a)>>0}e.baseId=i,e.geometry.setAttribute("unique_id",new Dn(n,4,!0))}(r),r.frustumCulled=!1,r.matrixAutoUpdate=!1,t.isEntwinePointTileLayer||(r.position.copy(n.bbox.min),r.scale.copy(t.scale)),r.updateMatrix(),r.tightbbox=i.boundingBox.applyMatrix4(r.matrix),r.layers.set(t.threejsLayer),r.layer=t,r.extent=Sx.fromBox3(e.view.referenceCrs,n.bbox),r.userData.node=n,r}))}};function dI(e,t){var n=t.priority-e.priority;return 0===n?t.timestamp-e.timestamp:n}function fI(){return{queue:function(e){var t=e.layer,n=this.storages.get(t.id);n||(n={q:new PriorityQueue({comparator:dI}),priority:1,accumulator:0},this.storages.set(t.id,n)),n.priority=t.priority||1,n.q.queue(e),this.counters.pending++},storages:new Map,counters:{executing:0,executed:0,failed:0,cancelled:0,pending:0},execute:function(e,t){var n=this;return this.counters.pending--,this.counters.executing++,t.executeCommand(e).then((function(t){n.counters.executing--,e.resolve(t),n.counters.executed++}),(function(t){n.counters.executing--,e.reject(t),n.counters.failed++,__DEBUG__&&n.counters.failed<3&&console.error(t)}))}}}function pI(){this.defaultQueue=fI(),this.hostQueues=new Map,this.providers={},this.maxCommandsPerHost=6,this.initDefaultProviders()}function mI(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e.camera.camera3D.layers.mask;return e.camera.camera3D.layers.mask=1<<n,function(){e.camera.camera3D.layers.mask=i}}!function(t){if("object"===(void 0===e?"undefined":i(e))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PriorityQueue=t()}}((function(){return function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var A="function"==typeof require&&require;if(!s&&A)return A(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){var n=t[o][1][e];return r(n||e)}),c,c.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){var i,r,a,o,s,A={}.hasOwnProperty;i=e("./PriorityQueue/AbstractPriorityQueue"),r=e("./PriorityQueue/ArrayStrategy"),o=e("./PriorityQueue/BinaryHeapStrategy"),a=e("./PriorityQueue/BHeapStrategy"),(s=function(e){function t(e){e||(e={}),e.strategy||(e.strategy=o),e.comparator||(e.comparator=function(e,t){return(e||0)-(t||0)}),t.__super__.constructor.call(this,e)}return function(e,t){for(var n in t)A.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t}(i)).ArrayStrategy=r,s.BinaryHeapStrategy=o,s.BHeapStrategy=a,t.exports=s},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,t,n){t.exports=function(){function e(e){var t;if(null==(null!=e?e.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=e?e.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new e.strategy(e),this.length=(null!=e&&null!=(t=e.initialValues)?t.length:void 0)||0}return e.prototype.queue=function(e){this.length++,this.priv.queue(e)},e.prototype.dequeue=function(e){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},e.prototype.peek=function(e){if(!this.length)throw"Empty queue";return this.priv.peek()},e.prototype.clear=function(){return this.length=0,this.priv.clear()},e}()},{}],3:[function(e,t,n){var i;i=function(e,t,n){var i,r,a;for(r=0,i=e.length;r<i;)n(e[a=r+i>>>1],t)>=0?r=a+1:i=a;return r},t.exports=function(){function e(e){var t;this.options=e,this.comparator=this.options.comparator,this.data=(null!=(t=this.options.initialValues)?t.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return e.prototype.queue=function(e){var t;t=i(this.data,e,this.comparator),this.data.splice(t,0,e)},e.prototype.dequeue=function(){return this.data.pop()},e.prototype.peek=function(){return this.data[this.data.length-1]},e.prototype.clear=function(){this.data.length=0},e}()},{}],4:[function(e,t,n){t.exports=function(){function e(e){var t,n,i,r,a,o,s,A;for(this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.pageSize=(null!=e?e.pageSize:void 0)||512,this.length=0,s=0;1<<s<this.pageSize;)s+=1;if(1<<s!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=s,this._emptyMemoryPageTemplate=t=[],n=0,a=this.pageSize;0<=a?n<a:n>a;0<=a?++n:--n)t.push(null);if(this._memory=[],this._mask=this.pageSize-1,e.initialValues)for(i=0,r=(o=e.initialValues).length;i<r;i++)A=o[i],this.queue(A)}return e.prototype.queue=function(e){this.length+=1,this._write(this.length,e),this._bubbleUp(this.length,e)},e.prototype.dequeue=function(){var e,t;return e=this._read(1),t=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,t),this._bubbleDown(1,t)),e},e.prototype.peek=function(){return this._read(1)},e.prototype.clear=function(){this.length=0,this._memory.length=0},e.prototype._write=function(e,t){var n;for(n=e>>this._shift;n>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[n][e&this._mask]=t},e.prototype._read=function(e){return this._memory[e>>this._shift][e&this._mask]},e.prototype._bubbleUp=function(e,t){var n,i,r,a;for(n=this.comparator;e>1&&(i=e&this._mask,e<this.pageSize||i>3?r=e&~this._mask|i>>1:i<2?(r=e-this.pageSize>>this._shift,r+=r&~(this._mask>>1),r|=this.pageSize>>1):r=e-2,!(n(a=this._read(r),t)<0));)this._write(r,t),this._write(e,a),e=r},e.prototype._bubbleDown=function(e,t){var n,i,r,a,o;for(o=this.comparator;e<this.length;)if(e>this._mask&&!(e&this._mask-1)?n=i=e+2:e&this.pageSize>>1?(n=(e&~this._mask)>>1,i=(n=(n|=e&this._mask>>1)+1<<this._shift)+1):i=(n=e+(e&this._mask))+1,n!==i&&i<=this.length)if(r=this._read(n),a=this._read(i),o(r,t)<0&&o(r,a)<=0)this._write(n,t),this._write(e,r),e=n;else{if(!(o(a,t)<0))break;this._write(i,t),this._write(e,a),e=i}else{if(!(n<=this.length))break;if(!(o(r=this._read(n),t)<0))break;this._write(n,t),this._write(e,r),e=n}},e}()},{}],5:[function(e,t,n){t.exports=function(){function e(e){var t;this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.length=0,this.data=(null!=(t=e.initialValues)?t.slice(0):void 0)||[],this._heapify()}return e.prototype._heapify=function(){var e,t,n;if(this.data.length>0)for(e=t=1,n=this.data.length;1<=n?t<n:t>n;e=1<=n?++t:--t)this._bubbleUp(e)},e.prototype.queue=function(e){this.data.push(e),this._bubbleUp(this.data.length-1)},e.prototype.dequeue=function(){var e,t;return t=this.data[0],e=this.data.pop(),this.data.length>0&&(this.data[0]=e,this._bubbleDown(0)),t},e.prototype.peek=function(){return this.data[0]},e.prototype.clear=function(){this.length=0,this.data.length=0},e.prototype._bubbleUp=function(e){for(var t,n;e>0&&(t=e-1>>>1,this.comparator(this.data[e],this.data[t])<0);)n=this.data[t],this.data[t]=this.data[e],this.data[e]=n,e=t},e.prototype._bubbleDown=function(e){var t,n,i,r,a;for(t=this.data.length-1;r=(n=1+(e<<1))+1,i=e,n<=t&&this.comparator(this.data[n],this.data[i])<0&&(i=n),r<=t&&this.comparator(this.data[r],this.data[i])<0&&(i=r),i!==e;)a=this.data[i],this.data[i]=this.data[e],this.data[e]=a,e=i},e}()},{}]},{},[1])(1)})),pI.prototype.constructor=pI,pI.prototype.initDefaultProviders=function(){this.addProtocolProvider("tile",OB),this.addProtocolProvider("3d-tiles",cI),this.addProtocolProvider("pointcloud",uI)},pI.prototype.runCommand=function(e,t,n){var i=this,r=this.getProtocolProvider(e.layer.protocol);if(!r)throw new Error("No known provider for layer ".concat(e.layer.id));t.execute(e,r,n).then((function(){if(e.view.notifyChange(e.requester,e.redraw),t.counters.executing<i.maxCommandsPerHost){var n=i.deQueue(t);n&&i.runCommand(n,t)}}))},pI.prototype.execute=function(e){var t=this,n=e.layer,i=n.source&&n.source.url?new URL(n.source.url,document.location).host:void 0;e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),i&&!this.hostQueues.has(i)&&this.hostQueues.set(i,fI());var r=i?this.hostQueues.get(i):this.defaultQueue;return e.timestamp=Date.now(),r.queue(e),r.counters.executing<this.maxCommandsPerHost&&Promise.resolve().then((function(){if(r.counters.executing<t.maxCommandsPerHost){var e=t.deQueue(r);e&&t.runCommand(e,r)}})),e.promise},pI.prototype.addProtocolProvider=function(e,t){if("function"!=typeof t.executeCommand)throw new Error("Can't add provider for ".concat(e,": missing a executeCommand function."));this.providers[e]=t},pI.prototype.getProtocolProvider=function(e){return this.providers[e]||DB},pI.prototype.commandsWaitingExecutionCount=function(){var e,t=this.defaultQueue.counters.pending+this.defaultQueue.counters.executing,n=C(this.hostQueues);try{for(n.s();!(e=n.n()).done;){var i=e.value;t+=i[1].counters.pending+i[1].counters.executing}}catch(e){n.e(e)}finally{n.f()}return t},pI.prototype.commandsRunningCount=function(){var e,t=this.defaultQueue.counters.executing,n=C(this.hostQueues);try{for(n.s();!(e=n.n()).done;){t+=e.value[1].counters.executing}}catch(e){n.e(e)}finally{n.f()}return t},pI.prototype.resetCommandsCount=function(e){var t=this.defaultQueue.counters[e];this.defaultQueue.counters[e]=0;var n,i=C(this.hostQueues);try{for(i.s();!(n=i.n()).done;){var r=n.value;t+=r[1].counters[e],r[1].counters[e]=0}}catch(e){i.e(e)}finally{i.f()}return t},pI.prototype.deQueue=function(e){for(var t=function(e){var t,n,i,r=0,a=C(e);try{for(a.s();!(i=a.n()).done;){var o=i.value[1];o.q.length>0&&(r+=o.priority,o.accumulator+=o.priority,(!t||o.accumulator>n)&&(t=o,n=o.accumulator))}}catch(e){a.e(e)}finally{a.f()}if(t)return t.accumulator-=r,t.q}(e.storages);t&&t.length>0;){var n=t.dequeue();if(!n.earlyDropFunction||!n.earlyDropFunction(n))return n;e.counters.pending--,e.counters.cancelled++,n.reject(new RB(n))}};var gI=new At;function vI(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.mainLoop.gfxEngine.getWindowSize();n=n||new Je(Math.floor(r.x/2),Math.floor(r.y/2));var a=t.level0Nodes.map((function(e){return Cb.push(e,Cb.MODES.ID)})),o=mI(e,t.object3d,t.threejsLayer),s=e.mainLoop.gfxEngine.renderViewToBuffer({camera:e.camera,scene:t.object3d},{x:n.x-i,y:n.y-i,width:1+2*i,height:1+2*i});o(),a.forEach((function(e){return e()}));var A=[];return yI(i,(function(e,t){var n=4*(2*t*i+e),r=s.slice(n,n+4||void 0);gI.fromArray(r).divideScalar(255);var a=Fb(gI,Math.pow(256,3)),o=Math.round(a);A.includes(o)||A.push(o)})),A}function yI(e,t){for(var n,i=0;i<=e;i++){for(var r=i*i,a=-i;a<=i;a++)for(var o=a*a,s=-i;s<=i;s++){var A=o+s*s;if(!(A>r)&&(!(A<=n)&&!1===t(a,s)))return}n=r}}function wI(e){return e.layer?e.layer:e.parent?wI(e.parent):void 0}var xI,bI=new Pc,CI=function(e,t,n,i){var r,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=vI(e,i,t,n),s=function(e){o.includes(e.id)&&e.isTileMesh&&a.push({object:e,layer:i})},A=C(i.level0Nodes);try{for(A.s();!(r=A.n()).done;){var l=r.value;l.traverse(s)}}catch(e){A.e(e)}finally{A.f()}return a},MI=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5?arguments[5]:void 0;if(void 0!==a?bI.layers.set(a):bI.layers.enableAll(),n<0){var o=e.viewToNormalizedCoords(t);bI.setFromCamera(o,e.camera.camera3D);var s,A=bI.intersectObject(i,!0),l=C(A);try{for(l.s();!(s=l.n()).done;){var c=s.value;c.layer=wI(c.object),r.push(c)}}catch(e){l.e(e)}finally{l.f()}return r}var h={x:t.x-n,y:t.y-n,width:1+2*n,height:1+2*n},u=e.mainLoop.gfxEngine.renderViewToBuffer({scene:i,camera:e.camera},h),d=new Sn;e.mainLoop.gfxEngine.renderer.getClearColor(d);var f=Math.round(255*d.r),p=Math.round(255*d.g),m=Math.round(255*d.b),g=e.viewToNormalizedCoords(t),v=g.clone();return yI(n,(function(t,a){var o=4*((a+n)*(2*n+1)+(t+n)),s=u[o],A=u[o+1],l=u[o+2];if(!(Math.abs(f-s)<=1&&Math.abs(p-A)<=1&&Math.abs(m-l)<=1)){v.setX(g.x+t/e.camera.width).setY(g.y+a/e.camera.height),bI.setFromCamera(v,e.camera.camera3D);var c,h=C(bI.intersectObject(i,!0));try{for(h.s();!(c=h.n()).done;){var d=c.value;d.layer=wI(d.object),r.push(d)}}catch(e){h.e(e)}finally{h.f()}return 0==r.length}})),r},BI=0,II=1,EI=2,SI=3,TI=4,LI=[1,3,7,60],FI=function(){function e(){r(this,e),this.state=BI,this.lastErrorTimestamp=0,this.errorCount=0,this.failureParams={lowestLevelError:1/0}}return o(e,[{key:"canTryUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();switch(this.state){case BI:return!0;case SI:case II:case TI:return!1;case EI:default:var t=1e3*this.secondsUntilNextTry();return t<=e-this.lastErrorTimestamp}}},{key:"secondsUntilNextTry",value:function(){if(this.state!==EI)return 0;var e=Math.max(0,Math.min(this.errorCount,LI.length)-1);return LI[e]}},{key:"newTry",value:function(){this.state=II}},{key:"success",value:function(){this.lastErrorTimestamp=0,this.state=BI}},{key:"noMoreUpdatePossible",value:function(){this.state=TI}},{key:"noData",value:function(e){this.state=BI,this.failureParams.lowestLevelError=Math.min(e.targetLevel,this.failureParams.lowestLevelError)}},{key:"failure",value:function(e,t,n){n&&null!=n.targetLevel&&(this.failureParams.lowestLevelError=Math.min(n.targetLevel,this.failureParams.lowestLevelError)),this.lastErrorTimestamp=e,this.state=t?SI:EI,this.errorCount++}},{key:"inError",value:function(){return this.state==SI||this.state==EI}}]),e}(),_I={cleanup:function(e){if(e.layer=null,"function"==typeof e.dispose)e.dispose();else if(e.geometry&&e.geometry.dispose(),e.material)if(Array.isArray(e.material)){var t,n=C(e.material);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(e){n.e(e)}finally{n.f()}}else e.material.dispose()},removeChildren:function(e,t){var n=t.children.filter((function(t){return(t.layer&&t.layer.id)===e.id}));return t.remove.apply(t,y(n)),n},removeChildrenAndCleanup:function(e,t){var n=t.children.filter((function(t){return(t.layer&&t.layer.id)===e.id}));return t.remove.apply(t,y(n)),t.layer===e&&this.cleanup(t),n},removeChildrenAndCleanupRecursively:function(e,t){var n,i=t.children.filter((function(t){return(t.layer&&t.layer.id)===e.id})),r=C(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.removeChildrenAndCleanupRecursively(e,a)}}catch(e){r.e(e)}finally{r.f()}return t.remove.apply(t,y(i)),t.layer&&t.layer.id===e.id&&this.cleanup(t),i}},UI=new ux("EPSG:4326"),PI="";PI=void 0!==document.documentElement.style.transform?"transform":void 0!==document.documentElement.style.webkitTransform?"webkitTransform":void 0!==document.documentElement.style.mozTransform?"mozTransform":void 0!==document.documentElement.style.oTransform?"oTransform":"transform";var kI=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(r(this,n),null==a)throw new Error("coordinates are mandatory to add a Label");var A=(e=t.call(this)).visible;return Object.defineProperty(d(e),"visible",{set:function(e){e!=A&&(A=e,this.content.style.display=e?"block":"none")},get:function(){return A}}),e.isLabel=!0,e.coordinates=a,e.projectedPosition={x:0,y:0},e.boundaries={left:0,right:0,top:0,bottom:0},e.content=document.createElement("div"),e.content.classList.add("itowns-label"),e.content.style.userSelect="none",e.content.style.position="absolute","string"==typeof i?e.content.textContent=i:e.content.appendChild(i),e.baseContent=i,o.isStyle?(e.anchor=o.getTextAnchorPosition(),o.text.haloWidth>0&&e.content.classList.add("itowns-stroke-single"),o.applyToHTML(e.content,s)):e.anchor=[0,0],e.zoom={min:o.zoom&&null!=o.zoom.min?o.zoom.min:2,max:o.zoom&&null!=o.zoom.max?o.zoom.max:24},e.order=o.order||0,e.padding=2,e}return o(n,[{key:"updateProjectedPosition",value:function(e,t){var n=Math.round(e),i=Math.round(t);n==this.projectedPosition.x&&i==this.projectedPosition.y||(this.projectedPosition.x=n,this.projectedPosition.y=i,this.boundaries.left=e+this.offset.left-this.padding,this.boundaries.right=e+this.offset.right+this.padding,this.boundaries.top=t+this.offset.top-this.padding,this.boundaries.bottom=t+this.offset.bottom+this.padding)}},{key:"updateCSSPosition",value:function(){this.content.style[PI]="translate(".concat(this.boundaries.left+this.padding,"px, ").concat(this.boundaries.top+this.padding,"px)")}},{key:"initDimensions",value:function(){if(!this.offset){xI=this.content.getBoundingClientRect();var e=Math.round(xI.width),t=Math.round(xI.height);this.offset={left:e*this.anchor[0],top:t*this.anchor[1]},this.offset.right=this.offset.left+e,this.offset.bottom=this.offset.top+t}}},{key:"update3dPosition",value:function(e){this.coordinates.as(e,UI),UI.toVector3(this.position),this.parent.worldToLocal(this.position),this.updateMatrixWorld()}},{key:"updateElevationFromLayer",value:function(e){var t=Ux.getElevationValueAt(e,this.coordinates,Ux.FAST_READ_Z);if(t&&t!=this.coordinates.z)return this.coordinates.z=t,this.updateHorizonCullingPoint(),!0}},{key:"updateHorizonCullingPoint",value:function(){this.horizonCullingPoint&&this.getWorldPosition(this.horizonCullingPoint)}}]),n}(Dt),DI=new ux("EPSG:4326",0,0,0),RI=new Sx("EPSG:4326",0,0,0,0),OI=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),(i=t.call(this,e,a)).isLabelLayer=!0,i.domElement=document.createElement("div"),i.domElement.id="itowns-label-".concat(i.id),i.defineLayerProperty("visible",!0,(function(){i.domElement.style.display=i.visible?"block":"none"})),i.buildExtent=!0,i}return o(n,[{key:"convert",value:function(e,t){var n=this,i=[],r=this.style&&this.style.text&&this.style.text.field;t.as(e.crs,RI),DI.crs=e.crs;var a={zoom:t.zoom};return e.features.forEach((function(t){if(t.type===bC.POINT){var o=t.style&&t.style.text.field;t.geometries.forEach((function(s){if(DI.setFromArray(t.vertices,s.size*s.indices[0].offset),e.transformCoordinates(DI),2==t.size&&(DI.z=0),RI.isPointInside(DI)){var A,l=s.properties.style&&s.properties.style.text.field,c={globals:a,properties:function(){return s.properties}};if(l||o||r)l?A=s.properties.style.getTextFromProperties(c):o?A=t.style.getTextFromProperties(c):r&&(A=n.style.getTextFromProperties(c));else if(!(s.properties.style&&s.properties.style.icon||t.style&&t.style.icon||n.style&&n.style.icon))return;var h=(s.properties.style||t.style||n.style).symbolStylefromContext(c),u=new kI(A,DI.clone(),h,n.source.sprites);u.layerId=n.id,2==t.size&&(u.needsAltitude=!0),i.push(u)}}))}})),i}},{key:"preUpdate",value:function(){}},{key:"update",value:function(e,t,n,i){var r=this;if(i||!n.children.length){if(!this.frozen&&n.visible&&this.visible){var a=n.getExtentsByProjection(this.source.crs)||[n.extent],o=a[0].zoom;if(!(o<t.zoom.min||o>t.zoom.max)){void 0===n.layerUpdateState[this.id]&&(n.layerUpdateState[this.id]=new FI);var s=n.material.getElevationLayer();if(s&&n.layerUpdateState[s.id].canTryUpdate()&&n.children.forEach((function(t){t.isLabel&&t.needsAltitude&&t.updateElevationFromLayer(r.parent)&&t.update3dPosition(e.view.referenceCrs)})),n.layerUpdateState[this.id].canTryUpdate()){if(this.source.extentInsideLimit(n.extent,o)){n.layerUpdateState[this.id].newTry();var A={layer:this,extentsSource:a,view:e.view,threejsLayer:this.threejsLayer,requester:n};return e.scheduler.execute(A).then((function(t){if(t){var i=e.view.mainLoop.gfxEngine.label2dRenderer,a=[];if(t.forEach((function(t){n.parent?t.forEach((function(t){t.needsAltitude&&t.updateElevationFromLayer(r.parent),n.children.find((function(e){return e.isLabel&&e.baseContent==t.baseContent}))||(n.add(t),t.update3dPosition(e.view.referenceCrs),n.level<4&&(t.horizonCullingPoint=new tt,t.updateHorizonCullingPoint()),a.push(t.content))})):t.forEach((function(e){_I.removeChildrenAndCleanupRecursively(r,e),i.removeLabelDOM(e)}))})),a.length>0){var o,s=n.domElements[r.id];s||(s={dom:document.createElement("div"),visible:!0},n.domElements[r.id]=s),(o=s.dom).append.apply(o,a);var A=n.findClosestDomElement(r.id);(A&&A.dom||r.domElement).appendChild(s.dom),s.visible=!0,t.forEach((function(e){return e.forEach((function(e){return e.initDimensions()}))})),t.forEach((function(e){return e.forEach((function(e){e.visible=!1}))})),n.children.sort((function(e){return e.isLabel?-e.order:1})),n.addEventListener("removed",(function(){t.forEach((function(e){return e.forEach((function(e){return n.remove(e)}))})),r.removeNodeDomElement(n)}))}n.layerUpdateState[r.id].noMoreUpdatePossible()}}))}n.layerUpdateState[this.id].noMoreUpdatePossible()}}}}else _I.removeChildrenAndCleanupRecursively(this,n)}},{key:"removeLabelsFromNodeRecursive",value:function(e){var t=this;e.children.forEach((function(n){n.isLabel&&n.layerId===t.id?e.remove(n):n.isTileMesh&&t.removeLabelsFromNodeRecursive(n)})),this.removeNodeDomElement(e)}},{key:"removeNodeDomElement",value:function(e){if(e.domElements[this.id]){var t=e.domElements[this.id].dom;t.parentElement.removeChild(t),delete e.domElements[this.id]}}},{key:"delete",value:function(){var e=this;this.domElement.parentElement.removeChild(this.domElement),this.parent.level0Nodes.forEach((function(t){return e.removeLabelsFromNodeRecursive(t)}))}}]),n}(yB),NI="layers-initialized",GI="layer-removed",QI="layer-added",HI="initialized",zI="layers-order-changed",VI="camera-moved",jI=function(e,t){e.object3d&&(e.object3d.visible=e.visible),e.threejsLayer&&(e.visible?t.camera.camera3D.layers.enable(e.threejsLayer):t.camera.camera3D.layers.disable(e.threejsLayer))};var WI,XI=new Je,ZI=new vt,YI=new Je,KI=new ln,JI=new tt,qI=new tt,$I=new ux("EPSG:4326"),eE=[],tE=function(e){A(n,e);var t=p(n);function n(e,i){var a,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,n),!i)throw new Error("Invalid viewerDiv parameter (must non be null/undefined)");(a=t.call(this)).domElement=i,a.referenceCrs=e,$I.crs=e,o=s.renderer&&s.renderer.domElement?new LB(s.renderer):new LB(i,s.renderer),a.engine=o,a.mainLoop=s.mainLoop||new ab(new pI,o),a.scene=s.scene3D||new Rt,s.scene3D||(a.scene.autoUpdate=!1),a.camera=new Yx(a.referenceCrs,a.mainLoop.gfxEngine.getWindowSize().x,a.mainLoop.gfxEngine.getWindowSize().y,s.camera),a._frameRequesters={},a._layers=[],window.addEventListener("resize",(function(){return a.resize()}),!1),a._changeSources=new Set,__DEBUG__&&(a.isDebugMode=!0),a._delayedFrameRequesterRemoval=[],a._allLayersAreReadyCallback=function(){a.getLayers().every((function(e){return e.ready}))&&0==a.mainLoop.scheduler.commandsWaitingExecutionCount()&&0==a.mainLoop.renderingState&&(a.dispatchEvent({type:NI}),a.removeFrameRequester(rb,a._allLayersAreReadyCallback))},a.camera.resize(a.domElement.clientWidth,a.domElement.clientHeight);var A=function e(){a.removeEventListener(NI,e),a.dispatchEvent({type:HI})};return a.addEventListener(NI,A),a._fullSizeDepthBuffer=new Uint8Array(4*a.camera.width*a.camera.height),a._pixelDepthBuffer=new Uint8Array(4),a.domElement.tabIndex=-1,a.domElement.focus(),eE.push(d(a)),a}return o(n,[{key:"dispose",value:function(){var e=eE.indexOf(this);if(-1!=e){this.controls&&this.controls.dispose&&this.controls.dispose(),this.removeAllFrameRequesters(),this.removeAllEvents();var t,n=C(this.getLayers((function(e){return!e.isTiledGeometryLayer&&!e.isAtmosphere})));try{for(n.s();!(t=n.n()).done;){var i=t.value;this.removeLayer(i.id)}}catch(e){n.e(e)}finally{n.f()}var r,a=C(this.getLayers((function(e){return e.isAtmosphere})));try{for(a.s();!(r=a.n()).done;){var o=r.value;this.removeLayer(o.id)}}catch(e){a.e(e)}finally{a.f()}var s,A=C(this.getLayers((function(e){return e.isTiledGeometryLayer})));try{for(A.s();!(s=A.n()).done;){var l=s.value;this.removeLayer(l.id)}}catch(e){A.e(e)}finally{A.f()}eE.splice(e,1),this.mainLoop.dispose()}else console.warn("View already disposed")}},{key:"addLayer",value:function(e,t){var n=this;if(!e||!e.isLayer)return Promise.reject(new Error("Add Layer type object"));if(this.getLayerById(e.id))return e._reject(new Error("Invalid id '".concat(e.id,"': id already used")));if(e=function(e,t,n){var i=t.source;if(n&&!t.extent&&(t.extent=n.extent,i&&!i.extent&&(i.extent=n.extent)),t.isGeometryLayer?(n&&(t.threejsLayer=e.mainLoop.gfxEngine.getUniqueThreejsLayer()),t.defineLayerProperty("visible",!0,(function(){return jI(t,e)})),jI(t,e),t.crs=e.referenceCrs):t.crs||(n&&n.tileMatrixSets&&n.tileMatrixSets.includes(ix.formatToTms(i.crs))?t.crs=i.crs:t.crs=n&&n.extent.crs),t.isLabelLayer)e.mainLoop.gfxEngine.label2dRenderer.registerLayer(t);else if(t.labelEnabled||t.addLabelLayer){t.labelEnabled&&console.info("layer.labelEnabled is deprecated use addLabelLayer, instead of"),t.buildExtent=!0;var r=new OI("".concat(t.id,"-label"),{source:i,style:t.style,zoom:t.zoom,crs:i.crs,visible:t.visible});t.addEventListener("visible-property-changed",(function(){r.visible=t.visible})),e.addEventListener(GI,(function n(i){i.layerId===t.id&&e.removeLayer(r.id),e.removeEventListener(GI,n)})),t.whenReady=t.whenReady.then((function(){return e.addLayer(r),t}))}return t}(this,e,t),t)if(e.isColorLayer){var i=this.getLayers((function(e){return e.isColorLayer}));if(e.sequence=i.length,!(t.countColorLayersTextures.apply(t,y(i).concat([e]))<=_b()))return e._reject(new Error("Cant add color layer ".concat(e.id,": the maximum layer is reached")));t.attach(e)}else e.isElevationLayer&&"image/x-bil;bits=32"==e.source.format?(e.source.networkOptions.isWebGL2=this.mainLoop.gfxEngine.renderer.capabilities.isWebGL2,t.attach(e)):t.attach(e);else{if("function"!=typeof e.update)return e._reject(new Error("Cant add GeometryLayer: missing a update function"));if("function"!=typeof e.preUpdate)return e._reject(new Error("Cant add GeometryLayer: missing a preUpdate function"));this._layers.push(e)}return e.object3d&&!e.object3d.parent&&e.object3d!==this.scene&&this.scene.add(e.object3d),Promise.all(e._promises).then((function(){e._resolve(),n.notifyChange(t||e,!1),n._frameRequesters[rb]&&n._frameRequesters[rb].includes(n._allLayersAreReadyCallback)||n.addFrameRequester(rb,n._allLayersAreReadyCallback),n.dispatchEvent({type:QI,layerId:e.id})}),e._reject),e.whenReady}},{key:"removeLayer",value:function(e){var t=this.getLayerById(e);if(t){var n=t.parent;if(t.delete(),n&&!n.detach(t))throw new Error("Error to detach ".concat(e," from ").concat(n.id));if(null==n&&this._layers.splice(this._layers.findIndex((function(t){return t.id==e})),1),t.isColorLayer){var i,r=C(this.getLayers((function(e){return e.isColorLayer})));try{for(r.s();!(i=r.n()).done;){var a=i.value;a.sequence>t.sequence&&a.sequence--}}catch(e){r.e(e)}finally{r.f()}}var o,s=0,A=C(eE);try{for(A.s();!(o=A.n()).done;){s+=o.value.getLayers((function(e){return e.source.uid==t.source.uid&&e.crs==t.crs})).length}}catch(e){A.e(e)}finally{A.f()}return t.source.onLayerRemoved({unusedCrs:0==s?t.crs:void 0}),this.notifyChange(this.camera),this.dispatchEvent({type:GI,layerId:e}),!0}throw new Error("".concat(e," doesn't exist"))}},{key:"notifyChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(this._changeSources.add(e),(e.isTileMesh||e.isCamera)&&(this._fullSizeDepthBuffer.needsUpdate=!0)),this.mainLoop.scheduleViewUpdate(this,t)}},{key:"getLayers",value:function(e){var t,n=[],i=C(this._layers);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(e&&!e(r)||n.push(r),r.attachedLayers){var a,o=C(r.attachedLayers);try{for(o.s();!(a=o.n()).done;){var s=a.value;e&&!e(s,r)||n.push(s)}}catch(e){o.e(e)}finally{o.f()}}}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"getLayerById",value:function(e){return this.getLayers((function(t){return t.id===e}))[0]}},{key:"addFrameRequester",value:function(e,t){if("function"!=typeof t)throw new Error("frameRequester must be a function");this._frameRequesters[e]?this._frameRequesters[e].push(t):this._frameRequesters[e]=[t]}},{key:"removeFrameRequester",value:function(e,t){this._frameRequesters[e].includes(t)?this._delayedFrameRequesterRemoval.push({when:e,frameRequester:t}):console.error("Invalid call to removeFrameRequester: frameRequester isn't registered")}},{key:"removeAllFrameRequesters",value:function(){for(var e in this._frameRequesters)if(Object.prototype.hasOwnProperty.call(this._frameRequesters,e)){var t,n=C(this._frameRequesters[e]);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.removeFrameRequester(e,i)}}catch(e){n.e(e)}finally{n.f()}}this._executeFrameRequestersRemovals()}},{key:"removeAllEvents",value:function(){if(void 0!==this._listeners){for(var e in this._listeners)Object.prototype.hasOwnProperty.call(this._listeners,e)&&delete this._listeners[e];this._listeners=void 0}}},{key:"_executeFrameRequestersRemovals",value:function(){var e,t=C(this._delayedFrameRequesterRemoval);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=this._frameRequesters[n.when].indexOf(n.frameRequester);i>=0?this._frameRequesters[n.when].splice(i,1):console.warn("FrameReq has already been removed")}}catch(e){t.e(e)}finally{t.f()}this._delayedFrameRequesterRemoval.length=0}},{key:"execFrameRequesters",value:function(e,t,n){if(this._frameRequesters[e]){this._delayedFrameRequesterRemoval.length>0&&this._executeFrameRequestersRemovals();for(var i=arguments.length,r=new Array(i>3?i-3:0),a=3;a<i;a++)r[a-3]=arguments[a];var o,s=C(this._frameRequesters[e]);try{for(s.s();!(o=s.n()).done;){var A=o.value;A.update?A.update(t,n,r):A(t,n,r)}}catch(e){s.e(e)}finally{s.f()}}}},{key:"eventToViewCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:XI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.domElement.getBoundingClientRect();if(void 0!==e.touches&&e.touches.length)return t.set(e.touches[n].clientX-i.x,e.touches[n].clientY-i.y);var r=e.target.getBoundingClientRect();return t.set(r.x+e.offsetX-i.x,r.y+e.offsetY-i.y)}},{key:"eventToNormalizedCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.viewToNormalizedCoords(this.eventToViewCoords(e,XI,t))}},{key:"viewToNormalizedCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:XI;return t.x=e.x/this.camera.width*2-1,t.y=e.y/this.camera.height*-2+1,t}},{key:"normalizedToViewCoords",value:function(e){return XI.x=.5*(e.x+1)*this.camera.width,XI.y=-.5*(e.y-1)*this.camera.height,XI}},{key:"pickObjectsAt",value:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];var o=[];if((r=0==r.length?this.getLayers((function(e){return e.isGeometryLayer})):r).forEach((function(e){"string"==typeof e&&(e=t.getLayerById(e)),e&&(e.isGeometryLayer||e.isObject3D)&&o.push(e)})),0==o.length)return[];for(var s=[],A=e instanceof Event?this.eventToViewCoords(e):e,l=0,c=o;l<c.length;l++){var h=c[l];if(h.isGeometryLayer){if(!h.ready){console.warn("view.pickObjectAt : layer is not ready : ",h);continue}h.pickObjectsAt(this,A,n,s)}else MI(this,A,n,h,s)}return s}},{key:"getScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.28;return this.getScaleFromDistance(e,this.getDistanceFromCamera())}},{key:"getScaleFromDistance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.28,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e/=1e3;var n=Oh.degToRad(this.camera.camera3D.fov),i=this.camera.height/(2*t*Math.tan(.5*n));return e*i}},{key:"getDistanceFromCamera",value:function(e){return this.getPickingPositionFromDepth(e,qI),this.camera.camera3D.position.distanceTo(qI)}},{key:"getPixelsToMeters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;return this.camera.camera3D.isOrthographicCamera?e*(WI=(this.camera.camera3D.right-this.camera.camera3D.left)/this.camera.camera3D.zoom)/this.camera.width:this.getPixelsToMetersFromDistance(e,this.getDistanceFromCamera(t))}},{key:"getPixelsToMetersFromDistance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e*t/this.camera._preSSE}},{key:"getMetersToPixels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;return this.camera.camera3D.isOrthographicCamera?(WI=(this.camera.camera3D.right-this.camera.camera3D.left)/this.camera.camera3D.zoom,e*this.camera.width/WI):this.getMetersToPixelsFromDistance(e,this.getDistanceFromCamera(t))}},{key:"getMetersToPixelsFromDistance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.camera._preSSE*e/t}},{key:"pickFeaturesAt",value:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];Array.isArray(r[0])&&(console.warn("Deprecated: the ...where argument of View#pickFeaturesAt should not be an array anymore, but a list: use the spread operator if needed."),r=r[0]);var o=[],s={};(r=0==r.length?this.getLayers((function(e){return e.isColorLayer||e.isGeometryLayer})):r).forEach((function(e){"string"==typeof e&&(e=t.getLayerById(e)),e&&e.isLayer&&(s[e.id]=[],e.isColorLayer&&o.push(e.id))}));var A=e instanceof Event?this.eventToViewCoords(e,XI):e,l=this.pickObjectsAt.apply(this,[A,n].concat(y(r)));if(l.length>0&&l.forEach((function(e){return s[e.layer.id].push(e)})),0==o.length)return s;this.getPickingPositionFromDepth(A,qI);var c,h=this.camera.camera3D.position.distanceTo(qI);$I.setFromVector3(qI);var u={M:this.getPixelsToMetersFromDistance(n,h),D:.001*n};this.isPlanarView?u.D=u.M:this.getPixelsToDegrees&&(u.D=this.getMetersToDegrees(u.M));var d,f=CI(this,A,n,this.tileLayer),p=C(f);try{for(p.s();!(d=p.n()).done;){var m=d.value;if(m.object.material){var g,v=C(m.object.material.getLayers(o));try{for(v.s();!(g=v.n()).done;){var w,x=g.value,b=C(x.textures);try{for(b.s();!(w=b.n()).done;){var M=w.value;M.features&&(c=ix.isMetricUnit(M.features.crs)?u.M:u.D,s[x.id]=s[x.id].concat(kB($I,M.features,c)))}}catch(e){b.e(e)}finally{b.f()}}}catch(e){v.e(e)}finally{v.f()}}}}catch(e){p.e(e)}finally{p.f()}return s}},{key:"readDepthBuffer",value:function(e,t,n,i,r){var a=this.mainLoop.gfxEngine,o=this.tileLayer.wireframe,s=this.tileLayer.opacity,A=this.tileLayer.visible;o&&(this.tileLayer.wireframe=!1),s<1&&(this.tileLayer.opacity=1),A||(this.tileLayer.visible=!0);var l=this.tileLayer.level0Nodes.map((function(e){return Cb.push(e,Cb.MODES.DEPTH)}));return r=a.renderViewToBuffer({camera:this.camera,scene:this.tileLayer.object3d},{x:e,y:t,width:n,height:i,buffer:r}),l.forEach((function(e){return e()})),this.tileLayer.wireframe!==o&&(this.tileLayer.wireframe=o),this.tileLayer.opacity!==s&&(this.tileLayer.opacity=s),this.tileLayer.visible!==A&&(this.tileLayer.visible=A),r}},{key:"getPickingPositionFromDepth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tt;if(this.tileLayer&&0!=this.tileLayer.level0Nodes.length&&this.tileLayer.level0Nodes[0]){var n=this.mainLoop,i=0==n.scheduler.commandsWaitingExecutionCount()&&0==n.renderingState,r=n.gfxEngine,a=r.getWindowSize(),o=this.camera.camera3D;(e=e||a.clone().multiplyScalar(.5)).x=Math.floor(e.x),e.y=Math.floor(e.y);var s,A=o.layers.mask;if(o.layers.mask=1<<this.tileLayer.threejsLayer,i){this._fullSizeDepthBuffer.needsUpdate&&(this.readDepthBuffer(0,0,a.x,a.y,this._fullSizeDepthBuffer),this._fullSizeDepthBuffer.needsUpdate=!1);var l=4*((a.y-e.y-1)*a.x+e.x);s=this._fullSizeDepthBuffer.slice(l,l+4)}else s=this.readDepthBuffer(e.x,e.y,1,1,this._pixelDepthBuffer);if(YI.x=e.x/a.x*2-1,YI.y=-e.y/a.y*2+1,ub()&&"PerspectiveCamera"==o.type){KI.origin.copy(o.position),KI.direction.set(YI.x,YI.y,.5),ZI.multiplyMatrices(o.matrixWorld,ZI.copy(o.projectionMatrix).invert()),KI.direction.applyMatrix4(ZI),KI.direction.sub(KI.origin),JI.set(0,0,1),JI.applyMatrix4(ZI),JI.sub(KI.origin);var c=JI.angleTo(KI.direction),h=r.depthBufferRGBAValueToOrthoZ(s,o),u=h/Math.cos(c);t.addVectors(o.position,KI.direction.setLength(u))}else{var d=r.depthBufferRGBAValueToOrthoZ(s,o);t.set(YI.x,YI.y,d),t.unproject(o)}if(o.layers.mask=A,!(t.length()>1e7))return t}else t=void 0}},{key:"pickCoordinates",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ux(this.tileLayer.extent.crs);return e instanceof Event?this.eventToViewCoords(e):e&&void 0!==e.x&&void 0!==e.y?XI.copy(e):XI.set(this.mainLoop.gfxEngine.width/2,this.mainLoop.gfxEngine.height/2),this.getPickingPositionFromDepth(XI,qI),$I.crs=this.referenceCrs,$I.setFromVector3(qI),$I.as(t.crs,t),t}},{key:"resize",value:function(e,t){null==e&&(e=this.domElement.clientWidth),null==t&&(t=this.domElement.clientHeight),this._fullSizeDepthBuffer=new Uint8Array(4*e*t),this.mainLoop.gfxEngine.onWindowResize(e,t),this.camera.resize(e,t),this.notifyChange(this.camera.camera3D)}}]),n}(Xe),nE=1e3/60,iE=0,rE=1,aE=2,oE=function(e){e.id&&(clearInterval(e.id),e.id=void 0),e.waitTimer&&(clearInterval(e.waitTimer),e.waitTimer=void 0),e.keyframe=0},sE=function(e){oE(e),e.isEnded()&&e.dispatchEvent({type:"animation-ended"}),e.dispatchEvent({type:"animation-stopped"}),e.duration=0},AE=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),(e=t.call(this)).id=null,e.keyframe=0,e.duration=0,e.state=iE,e.waitTimer=null,e}return o(n,[{key:"isPlaying",value:function(){return this.state===rE}},{key:"isStopped",value:function(){return this.state===iE}},{key:"isEnded",value:function(){return this.state===aE}},{key:"play",value:function(e){this.duration=e,this.dispatchEvent({type:"animation-started"}),this.state=rE,oE(this),this.id=setInterval(this.frame.bind(this),nE)}},{key:"playLater",value:function(e,t){var n=Math.floor(nE*t);window.clearInterval(this.waitTimer);var i=this;this.waitTimer=window.setTimeout((function(){i.play(e)}),n)}},{key:"stop",value:function(){this.state=iE,sE(this)}},{key:"frame",value:function(){this.keyframe<this.duration?(this.keyframe++,this.dispatchEvent({type:"animation-frame"})):(this.state=aE,sE(this))}}]),n}(Xe);function lE(e){var t={index:null,position:null,normal:null,uvs:[]},n=[],i=e.builder,r=e.segment||8,a=(r+1)*(r+1)+(e.disableSkirt?0:4*r);if(a>Math.pow(2,32))throw new Error("Tile segments count is too big");var o=r*r*2+(e.disableSkirt?0:4*r*2);t.position=new Float32Array(3*a),t.normal=new Float32Array(3*a);var s=e.builder.uvCount;s>1&&(t.uvs[1]=new Float32Array(a)),n[0]=function(){},e.buildIndexAndUv_0&&(a<Math.pow(2,8)?t.index=new Uint8Array(3*o):a<Math.pow(2,16)?t.index=new Uint16Array(3*o):a<Math.pow(2,32)&&(t.index=new Uint32Array(3*o)),t.uvs[0]=new Float32Array(2*a),n[0]=function(e,n,i){t.uvs[0][2*e+0]=n,t.uvs[0][2*e+1]=i});var A=Math.max(2,Math.floor(r)||2),l=Math.max(2,Math.floor(r)||2),c=0,h=[],u=[],d=[];i.prepare(e);for(var f=0;f<=l;f++){var p=[],m=f/l;i.vProjecte(m,e),s>1&&function(){var r=i.computeUvs[1](e);n[1]=function(e){t.uvs[1][e]=r}}();for(var g=0;g<=A;g++){var v=g/A,y=3*c;i.uProjecte(v,e);var w=i.vertexPosition(e,e.projected),x=i.vertexNormal(e);w.sub(e.center),e.quatNormalToZ&&(w.applyQuaternion(e.quatNormalToZ),x.applyQuaternion(e.quatNormalToZ)),w.toArray(t.position,y),x.toArray(t.normal,y);var b,M=C(n);try{for(M.s();!(b=M.n()).done;){(0,b.value)(c,v,m)}}catch(e){M.e(e)}finally{M.f()}e.disableSkirt||0!==f&&f!==l&&(g===A?u.push(c):0===g&&d.push(c)),p.push(c),c++}h.push(p),0===f?u=u.concat(p):f===l&&(u=u.concat(p.slice().reverse()))}function B(e,n,i,r){return t.index[r+0]=e,t.index[r+1]=n,t.index[r+2]=i,r+3}e.disableSkirt||(u=u.concat(d.reverse()));var I=0;if(e.buildIndexAndUv_0)for(var E=0;E<l;E++)for(var S=0;S<A;S++){var T=h[E][S+1],L=h[E][S],F=h[E+1][S],_=h[E+1][S+1];I=B(_,L,T,I),I=B(_,F,L,I)}var U=c;if(!e.disableSkirt){var P=(new tt).fromArray(t.position).distanceTo((new tt).fromArray(t.position,3)),k=function(){},D=function(){};e.buildIndexAndUv_0&&(k=function(e,t,n,i,r){return e=B(t,n,i,e),e=B(t,i,r,e)},D=function(e){t.uvs[0][2*c+0]=t.uvs[0][2*e+0],t.uvs[0][2*c+1]=t.uvs[0][2*e+1]});for(var R=0;R<u.length;R++){var O=u[R],N=3*c,G=3*O;t.position[N+0]=t.position[G+0]-t.normal[G+0]*P,t.position[N+1]=t.position[G+1]-t.normal[G+1]*P,t.position[N+2]=t.position[G+2]-t.normal[G+2]*P,t.normal[N+0]=t.normal[G+0],t.normal[N+1]=t.normal[G+1],t.normal[N+2]=t.normal[G+2],D(O),s>1&&(t.uvs[1][c]=t.uvs[1][O]);var Q=(R+1)%u.length;I=k(I,O,c,0===Q?U:c+1,u[Q]),c++}}return t}function cE(e){e.buildIndexAndUv_0=!0,e.center=e.builder.center(e.extent).clone();var t=lE(e);t.index=new Dn(t.index,1),t.uvs[0]=new Dn(t.uvs[0],2),t.position=new Dn(t.position,3),t.normal=new Dn(t.normal,3);for(var n=1;n<e.builder.uvCount;n++)t.uvs[1]=new Dn(t.uvs[1],1);return t}var hE=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cE(e);r(this,n),(i=t.call(this)).center=e.center,i.extent=e.extent,i.setIndex(a.index),i.setAttribute("position",a.position),i.setAttribute("normal",a.normal);for(var o=0;o<a.uvs.length;o++)i.setAttribute("uv_".concat(o),a.uvs[o]);return i.computeBoundingBox(),i.OBB={},i}return n}(ni),uE=Math.PI/4,dE=1/(2*Math.PI),fE=new tt(0,0,1),pE=new tt(0,1,0),mE=new qe,gE=new qe,vE=new qe;function yE(e){return 1-(.5-Math.log(Math.tan(uE+.5*Oh.degToRad(e)))*dE)}var wE,xE,bE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.tmp={coords:[new ux("EPSG:4326",0,0),new ux("EPSG:4326",0,0)],position:new tt,dimension:new Je},this.crs=t.crs,this.uvCount=t.uvCount,this.computeUvs=[function(){},function(e){var t=yE(e.projected.latitude)*e.nbRow;return(isFinite(t)?t:0)-e.deltaUV1}]}return o(e,[{key:"prepare",value:function(e){e.nbRow=Math.pow(2,e.level+1);var t=yE(e.extent.south);isFinite(t)||(t=0);var n=t%(1/e.nbRow);e.deltaUV1=(t-n)*e.nbRow,e.quatNormalToZ=vE.setFromAxisAngle(pE,-(.5*Math.PI-Oh.degToRad(e.extent.center().latitude))),e.projected={longitude:0,latitude:0},e.extent.dimensions(this.tmp.dimension)}},{key:"center",value:function(e){return e.center(this.tmp.coords[0]).as(this.crs,this.tmp.coords[1]).toVector3()}},{key:"vertexPosition",value:function(e){return this.tmp.coords[0].setFromValues(e.projected.longitude,e.projected.latitude),this.tmp.coords[0].as(this.crs,this.tmp.coords[1]).toVector3(this.tmp.position),this.tmp.position}},{key:"vertexNormal",value:function(){return this.tmp.coords[1].geodesicNormal}},{key:"uProjecte",value:function(e,t){t.projected.longitude=t.extent.west+e*this.tmp.dimension.x}},{key:"vProjecte",value:function(e,t){t.projected.latitude=t.extent.south+e*this.tmp.dimension.y}},{key:"computeSharableExtent",value:function(e){var t=Math.abs(e.west-e.east)/2,n=new Sx(e.crs,-t,t,e.south,e.north),i=Oh.degToRad(e.west-n.west),r=Oh.degToRad(90-e.center(this.tmp.coords[0]).latitude);return mE.setFromAxisAngle(fE,i),gE.setFromAxisAngle(pE,r),mE.multiply(gE),{sharableExtent:n,quaternion:mE.clone(),position:this.center(e)}}}]),e}(),CE=new bE({crs:"EPSG:4978",uvCount:1}),ME=new tt,BE=new Je,IE=new tt,EE=new ux("EPSG:4326",0,0,0),SE=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tt(1/0,1/0,1/0),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tt(-1/0,-1/0,-1/0);return r(this,n),Dt.DefaultUp.set(0,0,1),(e=t.call(this)).box3D=new Jt(i.clone(),a.clone()),e.natBox=e.box3D.clone(),e.z={min:0,max:0,scale:1},f(e,d(e))}return o(n,[{key:"clone",value:function(){return(new n).copy(this)}},{key:"copy",value:function(e){return g(l(n.prototype),"copy",this).call(this,e),this.box3D.copy(e.box3D),this.natBox.copy(e.natBox),this.z.min=e.z.min,this.z.max=e.z.max,this.z.scale=e.z.scale,this}},{key:"update",value:function(){this.updateMatrixWorld(!0)}},{key:"updateZ",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.z.scale;this.z={min:e,max:t,scale:n,delta:Math.abs(t-e)*n},this.box3D.min.z=this.natBox.min.z+e*n,this.box3D.max.z=this.natBox.max.z+t*n}},{key:"updateScaleZ",value:function(e){e>0&&this.updateZ(this.z.min,this.z.max,e)}},{key:"isSphereAboveXYBox",value:function(e){var t=this.worldToLocal(e.center),n=Math.max(this.box3D.min.x,Math.min(t.x,this.box3D.max.x)),i=Math.max(this.box3D.min.y,Math.min(t.y,this.box3D.max.y));return Math.sqrt((n-t.x)*(n-t.x)+(i-t.y)*(i-t.y))<e.radius}},{key:"setFromExtent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.min||0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.max||0;if("EPSG:4326"==e.crs){var r=CE.computeSharableExtent(e),a=r.sharableExtent,o=r.quaternion,s=r.position,A=Math.max(Math.floor(a.dimensions(BE).x/90+1),2),l={extent:a,level:0,segment:A,disableSkirt:!0,builder:CE},c=new hE(l);wE||(wE=new n),wE.box3D.copy(c.boundingBox),wE.natBox.copy(c.boundingBox),this.copy(wE),this.updateZ(t,i),this.position.copy(s),this.quaternion.copy(o),this.updateMatrixWorld(!0)}else{if(ix.isTms(e.crs)||!ix.isMetricUnit(e.crs))throw new Error("Unsupported extent crs");e.center(EE).toVector3(this.position),e.dimensions(BE),ME.set(BE.x,BE.y,Math.abs(i-t)),this.box3D.setFromCenterAndSize(IE,ME),this.updateMatrixWorld(!0)}return this}}]),n}(Dt),TE=new tt,LE=new ux("EPSG:4326",0,0,0),FE=new ox,_E=[],UE=new tt;function PE(e){return e-360*Math.floor((e+180)/360)}function kE(e){return e.getLayers((function(e){return e.isTiledGeometryLayer}))[0]}var DE=function(e){A(n,e);var t=p(n);function n(){var e;return r(this,n),e=t.call(this),Dt.DefaultUp.set(0,0,1),e.seaLevel=new Dt,e.target=new Dt,e.target.rotation.order="ZXY",e.camera=new ki,e.add(e.seaLevel),e.seaLevel.add(e.target),e.target.add(e.camera),e.coord=new ux("EPSG:4978",0,0),e.targetWorldPosition=new tt,e.removeAll=function(){},e._onChangeCallback=null,e}return o(n,[{key:"applyTransformToCamera",value:function(e,t){var n=this;this.proxy?(t.quaternion._onChange(this._onChangeCallback),this.camera.matrixWorld.decompose(this.proxy.position,t.quaternion,t.scale),t.quaternion._onChange((function(){return n.removeProxy(e,t)}))):this.camera.matrixWorld.decompose(t.position,t.quaternion,t.scale)}},{key:"setProxy",value:function(e,t){var n=this;!this.proxy&&e&&t&&(this.proxy={position:new tt},Object.keys(t.position).forEach((function(i){return function(e,t,n,i){n.proxy.position[i]=t.position[i],Object.defineProperty(t.position,i,{get:function(){return n.proxy.position[i]},set:function(r){n.removeProxy(e,t),t.position[i]=r}})}(e,t,n,i)})),this._onChangeCallback=t.quaternion._onChangeCallback,t.quaternion._onChange((function(){return n.removeProxy(e,t)})))}},{key:"removeProxy",value:function(e,t){var n=this;this.stop(e),this.proxy&&e&&t&&(Object.keys(t.position).forEach((function(e){return Object.defineProperty(t.position,e,{value:n.proxy.position[e],writable:!0})})),t.quaternion._onChange(this._onChangeCallback),this.proxy=null)}},{key:"setTargetFromCoordinate",value:function(e,t){t.as(kE(e).extent.crs,this.coord);var n=Math.max(0,this.coord.z);this.coord.z=n,this.coord.as(e.referenceCrs).toVector3(TE),"EPSG:4978"==e.referenceCrs?(this.lookAt(TE),this.seaLevel.position.set(0,0,TE.length()-n)):(this.position.set(TE.x,TE.y,0),this.seaLevel.position.set(0,0,0)),this.target.position.set(0,0,n)}},{key:"setFromPositions",value:function(e,t){this.setTargetFromCoordinate(e,new ux(e.referenceCrs,TE)),this.target.rotation.set(0,0,0),this.updateMatrixWorld(!0),this.camera.position.copy(t),this.target.worldToLocal(this.camera.position);var n=this.camera.position.length();this.target.rotation.x=Math.asin(this.camera.position.z/n);var i=Oh.clamp(this.camera.position.y/(Math.cos(this.target.rotation.x)*n),-1,1);this.target.rotation.z=Math.sign(-this.camera.position.x)*Math.acos(i),this.camera.position.set(0,n,0)}},{key:"applyParams",value:function(e,t){t.coord&&this.setTargetFromCoordinate(e,t.coord),null!=t.tilt&&(this.target.rotation.x=Oh.degToRad(t.tilt)),null!=t.heading&&(this.target.rotation.z=Oh.degToRad(PE(t.heading+180))),t.range&&this.camera.position.set(0,t.range,0),this.camera.rotation.set(.5*-Math.PI,0,Math.PI),this.updateMatrixWorld(!0),this.targetWorldPosition.setFromMatrixPosition(this.seaLevel.matrixWorld)}},{key:"getParams",value:function(){return{coord:this.coord.clone(),tilt:this.tilt,heading:this.heading,range:this.range,targetWorldPosition:this.targetWorldPosition}}},{key:"setfromCamera",value:function(e,t,n){t.updateMatrixWorld(!0),null==n&&(n=e.getPickingPositionFromDepth()||function(e,t){var n=new tt(0,0,.5);if(n.unproject(t),n.sub(t.position).normalize(),"EPSG:4978"==e.referenceCrs)return FE.intersection({direction:n,origin:t.position});var i=t.position.z/n.z;return n.multiplyScalar(i).add(t.position)}(e,t));var i=n&&!isNaN(n.x)?t.position.distanceTo(n):100;t.localToWorld(TE.set(0,0,-i)),this.setFromPositions(e,t.position)}},{key:"copyObject3D",value:function(e){return this.copy(e,!1),this.seaLevel.copy(e.seaLevel,!1),this.target.copy(e.target,!1),this.camera.copy(e.camera),this}},{key:"animateCameraToLookAtTarget",value:function(e,t,i){var r=this;i.easing=i.easing||Ku.Easing.Quartic.InOut,this.setfromCamera(e,t);var a=new Ku.Group;this.start=(this.start||new n).copyObject3D(this),this.end=(this.end||new n).copyObject3D(this);var o,s,A=i.time||2500,l={t:0},c=[],h={promise:new Promise((function(e,t){o=e,s=t})),resolve:o,reject:s};return this.addPlaceTargetOnGround(e,t,i.coord,l),this.end.applyParams(e,i),c.push(new Ku.Tween(l,a).to({t:1},A).easing(i.easing).onUpdate((function(t){"EPSG:4978"==e.referenceCrs&&r.quaternion.slerpQuaternions(r.start.quaternion,r.end.quaternion,t.t),r.camera.quaternion.slerpQuaternions(r.start.camera.quaternion,r.end.camera.quaternion,t.t),r.target.rotation.set(0,0,0),r.target.rotateZ(Oh.lerp(r.start.target.rotation.z,r.end.target.rotation.z,t.t)),r.target.rotateX(Oh.lerp(r.start.target.rotation.x,r.end.target.rotation.x,t.t))}))),"EPSG:4978"!=e.referenceCrs&&c.push(new Ku.Tween(this.position,a).to(this.end.position,A).easing(i.easing)),c.push(new Ku.Tween(this.seaLevel.position,a).to(this.end.seaLevel.position,A).easing(i.easing)),c.push(new Ku.Tween(this.camera.position,a).to(this.end.camera.position,A).easing(i.easing)),this.animationFrameRequester=function(){a.update(),r.updateMatrixWorld(!0),r.applyTransformToCamera(e,t),r.targetWorldPosition.setFromMatrixPosition(r.seaLevel.matrixWorld),i.callback&&i.callback(r),LE.crs=e.referenceCrs,LE.setFromVector3(r.targetWorldPosition).as(kE(e).extent.crs,r.coord),e.notifyChange(t)},this.removeAll=function(t){this.removeAll=function(){},a.removeAll(),this.animationFrameRequester&&e.removeFrameRequester(nb,this.animationFrameRequester),h.resolve(void 0!==t),this.animationFrameRequester=null},c[c.length-1].onComplete(this.removeAll),c.forEach((function(e){return e.start()})),e.addFrameRequester(nb,this.animationFrameRequester),e.notifyChange(t),h}},{key:"stop",value:function(e){this.removePlaceTargetOnGround(e),this.removeAll()}},{key:"addPlaceTargetOnGround",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{t:1};if(this.removePlaceTargetOnGround(e),e&&t){var a=this.target.position.z;this.placeTargetOnGround=function(){var o=Math.max(0,Ux.getElevationValueAt(kE(e),n||i.coord,Ux.PRECISE_READ_Z)||0);i.target.position.z=a*(1-r.t)+o*r.t,i.target.updateMatrixWorld(!0),i.applyTransformToCamera(e,t)},this.placeTargetOnGround(),e.addFrameRequester(nb,this.placeTargetOnGround)}}},{key:"removePlaceTargetOnGround",value:function(e){e&&this.placeTargetOnGround&&(e.removeFrameRequester(nb,this.placeTargetOnGround),this.placeTargetOnGround=null)}},{key:"tilt",get:function(){return Oh.radToDeg(this.target.rotation.x)}},{key:"heading",get:function(){return PE(Oh.radToDeg(this.target.rotation.z)+180)}},{key:"range",get:function(){return this.camera.position.y}}]),n}(Dt);function RE(e){return _E[e.uuid]=_E[e.uuid]||new DE(e),_E[e.uuid]}var OE,NE={defaultStopPlaceOnGroundAtEnd:!1,Easing:Ku.Easing,stop:function(e,t){RE(t).stop(e)},getTransformCameraLookingAtTarget:function(e,t,n){var i=RE(t);return i.setfromCamera(e,t,n),i.getParams()},transformCameraToLookAtTarget:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.isExtent&&(n=this.getCameraTransformOptionsFromExtent(e,t,n)),n.proxy=void 0===n.proxy||n.proxy;var i=RE(t);return i.stop(e),i.setfromCamera(e,t),n.proxy&&i.setProxy(e,t),i.applyParams(e,n),i.addPlaceTargetOnGround(e,t,n.coord),i.applyTransformToCamera(e,t),e.notifyChange(t),Promise.resolve(i.getParams())},getCameraTransformOptionsFromExtent:function(e,t,n){var i,r={coord:new ux(n.crs,0,0,0),heading:0,tilt:e.isPlanarView?90:89.9};if(e.isGlobeView?(n=n.as("EPSG:4326"),xE||(xE=new SE),xE.setFromExtent(n),xE.box3D.getSize(UE),i={x:UE.y,y:UE.x}):i=(n=n.as(e.referenceCrs)).dimensions(),n.center(r.coord),t.isOrthographicCamera)i.x/i.y>t.aspect?t.zoom=(t.right-t.left)/i.x:t.zoom=(t.top-t.bottom)/i.y,t.updateProjectionMatrix(),r.range=1e3;else if(t.isPerspectiveCamera){var a=Ke.degToRad(t.fov);if(i.x/i.y>t.aspect){var o=.5*e.domElement.clientHeight/Math.tan(.5*a),s=2*Math.atan(.5*e.domElement.clientWidth/o);r.range=i.x/(2*Math.tan(.5*s))}else r.range=i.y/(2*Math.tan(.5*a))}return r},animateCameraToLookAtTarget:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.proxy=void 0===i.proxy||i.proxy;var r=RE(t);return r.stop(e),i.proxy&&r.setProxy(e,t),r.animateCameraToLookAtTarget(e,t,i).promise.then((function(t){var i=r.getParams();return(void 0===i.stopPlaceOnGroundAtEnd?n.defaultStopPlaceOnGroundAtEnd:i.stopPlaceOnGroundAtEnd)&&r.stop(e),i.finished=t,i}))},sequenceAnimationsToLookAtTarget:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{}],r=function(e){return e.reduce((function(e,t){return e.then((function(e){return!e.length||e[e.length-1].finished?t().then(Array.prototype.concat.bind(e)):Promise.resolve([{finished:!1}])}))}),Promise.resolve([]))},a=i.map((function(i){return function(){return n.animateCameraToLookAtTarget(e,t,i)}}));return r(a)},getDiffParams:function(e,t){var n;if(e&&t)return Math.abs(e.range-t.range)/e.range>.001&&((n=n||{}).range={previous:e.range,new:t.range}),Math.abs(e.tilt-t.tilt)>.1&&((n=n||{}).tilt={previous:e.tilt,new:t.tilt}),Math.abs(e.heading-t.heading)>.1&&((n=n||{}).heading={previous:e.heading,new:t.heading}),(Math.abs(e.coord.x-t.coord.x)>1e-6||Math.abs(e.coord.y-t.coord.y)>1e-6)&&((n=n||{}).coord={previous:e.coord,new:t.coord}),n}},GE=37,QE=38,HE=39,zE=40,VE=16,jE=17,WE=function(){function e(){r(this,e),this.NONE={},this.ORBIT={mouseButton:B.LEFT,keyboard:jE,enable:!0,finger:2},this.DOLLY={mouseButton:B.MIDDLE,enable:!0},this.PAN={mouseButton:B.RIGHT,up:QE,bottom:zE,left:GE,right:HE,enable:!0,finger:3},this.MOVE_GLOBE={mouseButton:B.LEFT,enable:!0,finger:1},this.PANORAMIC={mouseButton:B.LEFT,keyboard:VE,enable:!0}}return o(e,[{key:"inputToState",value:function(e,t){for(var n=0,i=Object.keys(this);n<i.length;n++){var r=this[i[n]];if(r.enable&&r.mouseButton===e&&r.keyboard===t)return r}return this.NONE}},{key:"touchToState",value:function(e){for(var t=0,n=Object.keys(this);t<n.length;t++){var i=this[n[t]];if(i.enable&&e==i.finger)return i}return this.NONE}}]),e}(),XE=1e-6,ZE=new Je,YE=new Je,KE=new Je,JE=new Rc(1,.01,0),qE=new Rc(1,0,0),$E=1,eS=new Je,tS=new Je,nS=new Je,iS=new tt,rS=new Je,aS=new Je,oS=new Je,sS=new qe,AS=new Dt;AS.matrixWorldInverse=new vt;var lS=new ux("EPSG:4978"),cS=new ux("EPSG:4978",0,0,0),hS=new ux("EPSG:4326",0,0,0);function uS(e,t){cS.setFromVector3(e).as("EPSG:4326",hS),t.position.copy(e),t.lookAt(hS.geodesicNormal.add(e)),t.rotateX(.5*Math.PI),t.updateMatrixWorld(!0)}var dS,fS,pS=0,mS=!0,gS=.25,vS=new qe(0,0,0,1),yS=new tt,wS=new tt,xS=new qe,bS=new en,CS=new tt,MS=new tt,BS={},IS="orientation-changed",ES="range-changed",SS="camera-target-changed",TS=new qe,LS=new qe,FS=new tt(1,0,0),_S=1/0,US=new tt,PS=new tt,kS=new Pc,DS=new tt,RS=new tt,OS=new en,NS=function(e){A(n,e);var t=p(n);function n(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),(a=t.call(this)).player=new AE,a.view=e,a.camera=e.camera.camera3D,a.states=new WE,a.state=a.states.NONE,a.enabled=!0,o.zoomSpeed&&(console.warn("Controls zoomSpeed parameter is deprecated. Use zoomInFactor and zoomOutFactor instead."),o.zoomFactor=o.zoomFactor||o.zoomSpeed),a.zoomFactor=o.zoomFactor||1.25,a.minDistance=o.minDistance||50,a.maxDistance=o.maxDistance||8*rx.x,a.minZoom=0,a.maxZoom=1/0,a.rotateSpeed=o.rotateSpeed||.25,a.keyPanSpeed=7,a.minPolarAngle=Oh.degToRad(.5),a.maxPolarAngle=Oh.degToRad(86),a.minAzimuthAngle=-1/0,a.maxAzimuthAngle=1/0,a.handleCollision=void 0===o.handleCollision||o.handleCollision,a.minDistanceCollision=60,a.enableKeys=!0,a.enableDamping=!0,a.dampingMoveFactor=null!=o.dampingMoveFactor?o.dampingMoveFactor:gS,a.enablePan=!0,a.startEvent={type:"start"},a.endEvent={type:"end"},a.updateHelper=function(){},a._onEndingMove=null,a._onMouseMove=a.onMouseMove.bind(d(a)),a._onMouseUp=a.onMouseUp.bind(d(a)),a._onMouseDown=a.onMouseDown.bind(d(a)),a._onMouseWheel=a.onMouseWheel.bind(d(a)),a._onContextMenuListener=a.onContextMenuListener.bind(d(a)),a._ondblclick=a.ondblclick.bind(d(a)),a._onTouchStart=a.onTouchStart.bind(d(a)),a._update=a.update.bind(d(a)),a._onTouchMove=a.onTouchMove.bind(d(a)),a._onKeyDown=a.onKeyDown.bind(d(a)),a._onKeyUp=a.onKeyUp.bind(d(a)),a._onBlurListener=a.onBlurListener.bind(d(a)),a.view.domElement.addEventListener("contextmenu",a._onContextMenuListener,!1),a.view.domElement.addEventListener("mousedown",a._onMouseDown,!1),a.view.domElement.addEventListener("mousewheel",a._onMouseWheel,!1),a.view.domElement.addEventListener("dblclick",a._ondblclick,!1),a.view.domElement.addEventListener("DOMMouseScroll",a._onMouseWheel,!1),a.view.domElement.addEventListener("touchstart",a._onTouchStart,!1),a.view.domElement.addEventListener("touchend",a._onMouseUp,!1),a.view.domElement.addEventListener("touchmove",a._onTouchMove,!1),a.player.addEventListener("animation-frame",a._update),window.addEventListener("keydown",a._onKeyDown,!1),window.addEventListener("keyup",a._onKeyUp,!1),window.addEventListener("blur",a._onBlurListener),e.scene.add(AS),i.isExtent?i.center().as("EPSG:4978",cS):(i.coord.as("EPSG:4978",cS),i.tilt=i.tilt||89.5,i.heading=i.heading||0),uS(cS,AS),a.lookAtCoordinate(i,!1),lS.crs=a.view.referenceCrs,a}return o(n,[{key:"dollyInScale",get:function(){return this.zoomFactor}},{key:"dollyOutScale",get:function(){return 1/this.zoomFactor}},{key:"isPaused",get:function(){return this.state==this.states.NONE}},{key:"onEndingMove",value:function(e){this._onEndingMove&&(this.player.removeEventListener("animation-stopped",this._onEndingMove),this._onEndingMove=null),this.state=this.states.NONE,this.handlingEvent(e)}},{key:"rotateLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;qE.theta-=e}},{key:"rotateUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;qE.phi-=e}},{key:"panLeft",value:function(e){var t=this.camera.matrix.elements;iS.fromArray(t),iS.multiplyScalar(-e),yS.add(iS)}},{key:"panUp",value:function(e){var t=this.camera.matrix.elements;iS.fromArray(t,4),iS.multiplyScalar(e),yS.add(iS)}},{key:"mouseToPan",value:function(e,t){var n=this.view.mainLoop.gfxEngine;if(this.state=this.states.PAN,this.camera.isPerspectiveCamera){var i=this.camera.position.distanceTo(this.getCameraTargetPosition());i*=2*Math.tan(Oh.degToRad(.5*this.camera.fov)),this.panLeft(e*i/n.width*this.camera.aspect),this.panUp(t*i/n.height)}else this.camera.isOrthographicCamera&&(this.panLeft(e*(this.camera.right-this.camera.left)/n.width),this.panUp(t*(this.camera.top-this.camera.bottom)/n.height))}},{key:"dolly",value:function(e){0!==e&&(OE=e>0?this.dollyInScale:this.dollyOutScale,this.camera.isPerspectiveCamera?$E/=OE:this.camera.isOrthographicCamera&&(this.camera.zoom=Oh.clamp(this.camera.zoom*OE,this.minZoom,this.maxZoom),this.camera.updateProjectionMatrix(),this.view.notifyChange(this.camera)))}},{key:"getMinDistanceCameraBoundingSphereObbsUp",value:function(e){if(e.level>10&&1==e.children.length&&e.geometry){var t=e.obb;OS.center.copy(this.camera.position),OS.radius=this.minDistanceCollision,t.isSphereAboveXYBox(OS)&&(_S=Math.min(OS.center.z-t.box3D.max.z,_S))}}},{key:"update",value:function(){if(_S=1/0,this.handleCollision&&this.view.tileLayer){var e,t=C(this.view.tileLayer.level0Nodes);try{for(t.s();!(e=t.n()).done;){e.value.traverse(this.getMinDistanceCameraBoundingSphereObbsUp.bind(this))}}catch(e){t.e(e)}finally{t.f()}}switch(this.state){case this.states.MOVE_GLOBE:if(_S<0)AS.translateY(-_S),this.camera.position.setLength(this.camera.position.length()-_S);else if(_S<this.minDistanceCollision){var n=this.minDistanceCollision*(1-_S/this.minDistanceCollision);AS.translateY(n),this.camera.position.setLength(this.camera.position.length()+n)}US.copy(PS).applyQuaternion(sS),AS.position.applyQuaternion(sS),this.camera.position.applyQuaternion(sS);break;case this.states.PAN:this.camera.position.add(yS),AS.position.add(yS);break;case this.states.PANORAMIC:this.camera.worldToLocal(AS.position);var i=this.camera.position.clone().normalize().applyQuaternion(this.camera.quaternion.clone().invert());TS.setFromAxisAngle(i,qE.theta).multiply(LS.setFromAxisAngle(FS,qE.phi)),AS.position.applyQuaternion(TS),this.camera.localToWorld(AS.position);break;default:this.camera.position.applyMatrix4(AS.matrixWorldInverse),(qE.theta||qE.phi)&&JE.setFromVector3(this.camera.position);var r=JE.radius*Math.sin(this.minPolarAngle),a=8*r,o=2*r;if(this.handleCollision)if(_S<a&&_S>o&&qE.phi>0){var s=a-o,A=1-(s-(_S-o))/s;qE.phi*=A*A}else if(_S<o&&_S>-o&&qE.phi>-.01){var l=2*o,c=-Math.asin(.25*(o-_S)/JE.radius);c=Oh.clamp(c,-.01,0);var h=1-(o-_S)/l;qE.phi=Oh.lerp(qE.phi,c,h),_S-=Math.sin(qE.phi)*JE.radius}JE.theta+=qE.theta,JE.phi+=qE.phi,JE.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,JE.theta)),JE.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,JE.phi)),JE.radius=this.camera.position.length()*$E,JE.makeSafe(),JE.radius=Math.max(this.minDistance,Math.min(this.maxDistance,JE.radius)),this.camera.position.setFromSpherical(JE),_S<0&&(this.camera.position.y-=_S,JE.setFromVector3(this.camera.position),qE.phi=0),AS.localToWorld(this.camera.position)}this.camera.up.copy(AS.position).normalize(),this.camera.lookAt(AS.position),this.enableDamping?(qE.theta*=.75,qE.phi*=.75,sS.slerp(vS,.2*this.dampingMoveFactor)):(qE.theta=0,qE.phi=0,sS.set(0,0,0,1)),$E=1,yS.set(0,0,0),(wS.distanceToSquared(this.camera.position)>XE||8*(1-xS.dot(this.camera.quaternion))>XE)&&(this.view.notifyChange(this.camera),wS.copy(this.camera.position),xS.copy(this.camera.quaternion)),this.enableDamping&&this.state===this.states.ORBIT&&this.player.isStopped()&&(qE.theta>XE||qE.phi>XE)&&this.player.playLater(60,2),this.view.dispatchEvent({type:VI,coord:lS.setFromVector3(AS.position),range:JE.radius,heading:-Oh.radToDeg(JE.theta),tilt:90-Oh.radToDeg(JE.phi)})}},{key:"onMouseMove",value:function(e){if(this.player.isPlaying()&&this.player.stop(),!1!==this.enabled){e.preventDefault();var t=this.view.eventToViewCoords(e);switch(this.state){case this.states.ORBIT:case this.states.PANORAMIC:YE.copy(t),KE.subVectors(YE,ZE);var n=this.view.mainLoop.gfxEngine;this.rotateLeft(2*Math.PI*KE.x/n.width*this.rotateSpeed),this.rotateUp(2*Math.PI*KE.y/n.height*this.rotateSpeed),ZE.copy(YE);break;case this.states.DOLLY:aS.copy(t),oS.subVectors(aS,rS),this.dolly(-oS.y),rS.copy(aS);break;case this.states.PAN:this.enablePan&&(tS.copy(t),nS.subVectors(tS,eS),this.mouseToPan(nS.x,nS.y),eS.copy(tS));break;case this.states.MOVE_GLOBE:var i=this.view.viewToNormalizedCoords(t);kS.setFromCamera(i,this.camera),kS.ray.intersectSphere(bS,MS)?(PS.copy(MS).normalize(),sS.setFromUnitVectors(PS,US),pS=Date.now()):this.onMouseUp()}this.state!==this.states.NONE&&this.update()}}},{key:"updateTarget",value:function(){this.view.getPickingPositionFromDepth(null,RS);var e=isNaN(RS.x)?100:this.camera.position.distanceTo(RS);DS.set(0,0,-e),this.camera.localToWorld(DS),uS(DS,AS),AS.matrixWorldInverse.copy(AS.matrixWorld).invert(),DS.copy(this.camera.position),DS.applyMatrix4(AS.matrixWorldInverse),JE.setFromVector3(DS)}},{key:"handlingEvent",value:function(e){e=e||NE.getTransformCameraLookingAtTarget(this.view,this.camera);var t=NE.getDiffParams(fS,e);if(t&&(t.range&&this.dispatchEvent({type:ES,previous:t.range.previous,new:t.range.new}),t.coord&&this.dispatchEvent({type:SS,previous:t.coord.previous,new:t.coord.new}),t.tilt||t.heading)){var n={type:IS};t.tilt&&(n.previous={tilt:t.tilt.previous},n.new={tilt:t.tilt.new}),t.heading&&(n.previous=n.previous||{},n.new=n.new||{},n.new.heading=t.heading.new,n.previous.heading=t.heading.previous),this.dispatchEvent(n)}}},{key:"onMouseDown",value:function(e){if(NE.stop(this.view,this.camera),this.player.stop(),this.onEndingMove(),!1!==this.enabled){this.updateTarget(),fS=NE.getTransformCameraLookingAtTarget(this.view,this.camera,RS),this.state=this.states.inputToState(e.button,dS);var t=this.view.eventToViewCoords(e);switch(this.state){case this.states.ORBIT:case this.states.PANORAMIC:ZE.copy(t);break;case this.states.MOVE_GLOBE:this.view.getPickingPositionFromDepth(t,CS)?(bS.radius=CS.length(),US.copy(CS).normalize(),this.updateHelper(CS,BS.picking)):this.state=this.states.NONE;break;case this.states.DOLLY:rS.copy(t);break;case this.states.PAN:eS.copy(t)}this.state!=this.states.NONE&&(this.view.domElement.addEventListener("mousemove",this._onMouseMove,!1),this.view.domElement.addEventListener("mouseup",this._onMouseUp,!1),this.view.domElement.addEventListener("mouseleave",this._onMouseUp,!1),this.dispatchEvent(this.startEvent))}}},{key:"ondblclick",value:function(e){if(!1!==this.enabled&&!dS){this.player.stop();var t=this.view.getPickingPositionFromDepth(this.view.eventToViewCoords(e)),n=this.getRange(t);return t&&n>this.minDistance?this.lookAtCoordinate({coord:new ux("EPSG:4978",t),range:.6*n,time:1500}):void 0}}},{key:"onMouseUp",value:function(){var e=this;!1!==this.enabled&&(this.view.domElement.removeEventListener("mousemove",this._onMouseMove,!1),this.view.domElement.removeEventListener("mouseup",this._onMouseUp,!1),this.view.domElement.removeEventListener("mouseleave",this._onMouseUp,!1),this.dispatchEvent(this.endEvent),this.player.stop(),this.enableDamping?this.state===this.states.ORBIT&&(qE.theta>XE||qE.phi>XE)?(this.player.play(60),this._onEndingMove=function(){return e.onEndingMove()},this.player.addEventListener("animation-stopped",this._onEndingMove)):this.state===this.states.MOVE_GLOBE&&Date.now()-pS<50?(this.player.play(120),this._onEndingMove=function(){return e.onEndingMove()},this.player.addEventListener("animation-stopped",this._onEndingMove)):this.onEndingMove():this.onEndingMove())}},{key:"onMouseWheel",value:function(e){if(this.player.stop(),this.enabled&&this.states.DOLLY.enable){NE.stop(this.view,this.camera),e.preventDefault(),this.updateTarget();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),this.dolly(t);var n=this.getRange(RS);this.update();var i=this.getRange(RS);Math.abs(i-n)/n>.001&&this.dispatchEvent({type:ES,previous:n,new:i}),this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}},{key:"onKeyUp",value:function(){!1!==this.enabled&&!1!==this.enableKeys&&(dS=void 0)}},{key:"onKeyDown",value:function(e){if(this.player.stop(),!1!==this.enabled&&!1!==this.enableKeys)switch(dS=e.keyCode,e.keyCode){case this.states.PAN.up:this.mouseToPan(0,this.keyPanSpeed),this.state=this.states.PAN,this.update();break;case this.states.PAN.bottom:this.mouseToPan(0,-this.keyPanSpeed),this.state=this.states.PAN,this.update();break;case this.states.PAN.left:this.mouseToPan(this.keyPanSpeed,0),this.state=this.states.PAN,this.update();break;case this.states.PAN.right:this.mouseToPan(-this.keyPanSpeed,0),this.state=this.states.PAN,this.update()}}},{key:"onTouchStart",value:function(e){if(this.player.stop(),!1!==this.enabled&&(this.state=this.states.touchToState(e.touches.length),this.updateTarget(),this.state!==this.states.NONE)){switch(this.state){case this.states.MOVE_GLOBE:var t=this.view.eventToViewCoords(e);this.view.getPickingPositionFromDepth(t,CS)?(bS.radius=CS.length(),US.copy(CS).normalize(),this.updateHelper(CS,BS.picking)):this.state=this.states.NONE;break;case this.states.ORBIT:case this.states.DOLLY:var n=e.touches[0].pageX,i=e.touches[0].pageY,r=n-e.touches[1].pageX,a=i-e.touches[1].pageY,o=Math.sqrt(r*r+a*a);rS.set(0,o),ZE.set(n,i);break;case this.states.PAN:eS.set(e.touches[0].pageX,e.touches[0].pageY)}this.dispatchEvent(this.startEvent)}}},{key:"onTouchMove",value:function(e){if(this.player.isPlaying()&&this.player.stop(),!1!==this.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case this.states.MOVE_GLOBE.finger:var t=this.view.eventToViewCoords(e),n=this.view.viewToNormalizedCoords(t);kS.setFromCamera(n,this.camera),kS.ray.intersectSphere(bS,MS)?(PS.copy(MS).normalize(),sS.setFromUnitVectors(PS,US),pS=Date.now()):this.onMouseUp.bind(this)();break;case this.states.ORBIT.finger:case this.states.DOLLY.finger:var i=this.view.mainLoop.gfxEngine;YE.set(e.touches[0].pageX,e.touches[0].pageY),KE.subVectors(YE,ZE),this.rotateLeft(2*Math.PI*KE.x/i.width*this.rotateSpeed),this.rotateUp(2*Math.PI*KE.y/i.height*this.rotateSpeed),ZE.copy(YE);var r=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(r*r+a*a);aS.set(0,o),oS.subVectors(aS,rS),this.dolly(oS.y),rS.copy(aS);break;case this.states.PAN.finger:tS.set(e.touches[0].pageX,e.touches[0].pageY),nS.subVectors(tS,eS),this.mouseToPan(nS.x,nS.y),eS.copy(tS);break;default:this.state=this.states.NONE}this.state!==this.states.NONE&&this.update()}}},{key:"onContextMenuListener",value:function(e){e.preventDefault()}},{key:"onBlurListener",value:function(){this.onKeyUp(),this.onMouseUp()}},{key:"dispose",value:function(){this.view.domElement.removeEventListener("contextmenu",this._onContextMenuListener,!1),this.view.domElement.removeEventListener("mousedown",this._onMouseDown,!1),this.view.domElement.removeEventListener("mousemove",this._onMouseMove,!1),this.view.domElement.removeEventListener("mousewheel",this._onMouseWheel,!1),this.view.domElement.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1),this.view.domElement.removeEventListener("mouseup",this._onMouseUp,!1),this.view.domElement.removeEventListener("mouseleave",this._onMouseUp,!1),this.view.domElement.removeEventListener("dblclick",this._ondblclick,!1),this.view.domElement.removeEventListener("touchstart",this._onTouchStart,!1),this.view.domElement.removeEventListener("touchend",this._onMouseUp,!1),this.view.domElement.removeEventListener("touchmove",this._onTouchMove,!1),this.player.removeEventListener("animation-frame",this._onKeyUp),window.removeEventListener("keydown",this._onKeyDown,!1),window.removeEventListener("keyup",this._onKeyUp,!1),window.removeEventListener("blur",this._onBlurListener),this.dispatchEvent({type:"dispose"})}},{key:"setTilt",value:function(e,t){return this.lookAtCoordinate({tilt:e},t)}},{key:"setHeading",value:function(e,t){return this.lookAtCoordinate({heading:e},t)}},{key:"setRange",value:function(e,t){return this.lookAtCoordinate({range:e},t)}},{key:"getCameraTargetPosition",value:function(){return AS.position}},{key:"getRange",value:function(e){return NE.getTransformCameraLookingAtTarget(this.view,this.camera,e).range}},{key:"getTilt",value:function(e){return NE.getTransformCameraLookingAtTarget(this.view,this.camera,e).tilt}},{key:"getHeading",value:function(e){return NE.getTransformCameraLookingAtTarget(this.view,this.camera,e).heading}},{key:"pan",value:function(e){return this.mouseToPan(e.x,e.y),this.update(),Promise.resolve()}},{key:"getCameraOrientation",value:function(){return this.view.getPickingPositionFromDepth(null,RS),[this.getTilt(RS),this.getHeading(RS)]}},{key:"getCameraCoordinate",value:function(){return new ux("EPSG:4978",this.camera.position).as("EPSG:4326")}},{key:"getLookAtCoordinate",value:function(){return NE.getTransformCameraLookingAtTarget(this.view,this.camera).coord}},{key:"setAnimationEnabled",value:function(e){mS=e}},{key:"isAnimationEnabled",value:function(){return mS}},{key:"getZoom",value:function(){return this.view.tileLayer.computeTileZoomFromDistanceCamera(this.getRange(),this.view.camera)}},{key:"setZoom",value:function(e,t){return this.lookAtCoordinate({zoom:e},t)}},{key:"zoomIn",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.lookAtCoordinate({zoom:Math.min(this.getZoom()+1,18),time:500},e)}},{key:"zoomOut",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.lookAtCoordinate({zoom:this.getZoom()-1,time:500},e)}},{key:"getScale",value:function(e){return console.warn("Deprecated, use View#getScale instead."),this.view.getScale(e)}},{key:"pixelsToMeters",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;console.warn("Deprecated use View#getPixelsToMeters instead.");var n=this.getScale(t),i=e*t;return i/n/1e3}},{key:"pixelsToDegrees",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;console.warn("Deprecated, use View#getPixelsToMeters and GlobeControls#getMetersToDegrees instead.");var n=this.pixelsToMeters(e,t);return Oh.radToDeg(2*Math.asin(n/(2*rx.x)))}},{key:"metersToPixels",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;console.warn("Deprecated, use View#getMetersToPixels instead.");var n=this.getScale(t);return e*n/(t/=1e3)}},{key:"setScale",value:function(e,t,n){return this.lookAtCoordinate({scale:e,pitch:t},n)}},{key:"lookAtCoordinate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isAnimationEnabled();if(!t.isExtent&&(t.zoom?t.range=this.view.tileLayer.computeDistanceCameraFromTileZoom(t.zoom,this.view.camera):t.scale&&(t.range=this.view.getScaleFromDistance(t.pitch,t.scale),(t.range<this.minDistance||t.range>this.maxDistance)&&(console.warn("This scale ".concat(t.scale," can not be reached")),t.range=Oh.clamp(t.range,this.minDistance,this.maxDistance))),void 0!==t.tilt)){var i=90-Oh.radToDeg(this.maxPolarAngle),r=90-Oh.radToDeg(this.minPolarAngle);(t.tilt<i||t.tilt>r)&&(t.tilt=Oh.clamp(t.tilt,i,r),console.warn("Tilt was clamped to ",t.tilt," the interval is between ".concat(i," and ").concat(r," degree")))}return fS=NE.getTransformCameraLookingAtTarget(this.view,this.camera),n?(t.callback=function(e){return AS.position.copy(e.targetWorldPosition)},this.dispatchEvent({type:"animation-started"}),NE.animateCameraToLookAtTarget(this.view,this.camera,t).then((function(t){return e.dispatchEvent({type:"animation-ended"}),e.handlingEvent(t),t}))):NE.transformCameraToLookAtTarget(this.view,this.camera,t).then((function(t){return AS.position.copy(t.targetWorldPosition),e.handlingEvent(t),t}))}},{key:"pickGeoPosition",value:function(e){var t=this.view.getPickingPositionFromDepth(e);if(t)return new ux("EPSG:4978",t).as("EPSG:4326")}},{key:"getView",value:function(e){var t=this.getLookAtCoordinate();return{coord:[t.longitude,t.latitude],heading:this.getHeading(),tilt:this.getTilt(),range:this.getRange()}}},{key:"setView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.coord&&Array.isArray(e.coord)&&(e.coord=new ux("EPSG:4326").setFromArray(e.coord).as("EPSG:4978",cS)),Math.abs(e.heading-this.getHeading())<1e-4&&(e.heading=this.getHeading()),this.lookAtCoordinate(e,t)}},{key:"flyTo",value:function(e){return this.setView(e,!0)}},{key:"fit",value:function(e){if(e){var t=(new Jt).setFromObject(e).getSize(new tt);return this.flyTo({coord:new ux("EPSG:4978").setFromVector3(e.getWorldPosition(new tt)).as("EPSG:4326"),range:Math.max(t.x,t.z),tilt:90})}}}]),n}(Xe);function GS(e){if(e.dispose)e.dispose();else if(e.geometry&&e.geometry.dispose(),e.material)if(Array.isArray(e.material)){var t,n=C(e.material);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(e){n.e(e)}finally{n.f()}}else e.material.dispose()}function QS(e,t){var n,i=C(e.children);try{for(i.s();!(n=i.n()).done;){QS(n.value,t)}}catch(e){i.e(e)}finally{i.f()}t(e)}var HS=function(e){A(n,e);var t=p(n);function n(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,n),o.cacheLifeTime=null==o.cacheLifeTime?$b.GEOMETRY:o.cacheLifeTime,(a=t.call(this,e,o)).isGeometryLayer=!0,!i||!i.isObject3D)throw new Error("Missing/Invalid object3d parameter (must be a\n                three.js Object3D instance)");return"Group"===i.type&&""===i.name&&(i.name=e),Object.defineProperty(d(a),"object3d",{value:i,writable:!1,configurable:!0}),a.defineLayerProperty("opacity",1,(function(){(a.parent?a.parent.object3d:a.object3d).traverse((function(e){e.layer==d(a)?a.changeOpacity(e):e.content&&e.content.layer==d(a)&&e.content.traverse(a.changeOpacity)}))})),a.defineLayerProperty("wireframe",!1,(function(){(a.parent?a.parent.object3d:a.object3d).traverse((function(e){e.layer==d(a)&&e.material?e.material.wireframe=a.wireframe:e.content&&e.content.layer==d(a)&&e.content.traverse((function(e){e.material&&e.layer==d(a)&&(e.material.wireframe=a.wireframe)}))}))})),a.attachedLayers=[],a.visible=null==o.visible||o.visible,Object.defineProperty(a.zoom,"max",{value:1/0,writable:!1}),a.filteringExtent=!a.source.isFileSource,a.structure="3d",a}return o(n,[{key:"getObjectToUpdateForAttachedLayers",value:function(e){if(e.parent&&e.material)return{element:e,parent:e.parent}}},{key:"postUpdate",value:function(){}},{key:"culling",value:function(){return!0}},{key:"attach",value:function(e){if(!e.update)throw new Error("Missing 'update' function -> can't attach layer\n                ".concat(e.id));this.attachedLayers.push(e),e.parent=this}},{key:"detach",value:function(e){var t=this.attachedLayers.length;return this.attachedLayers=this.attachedLayers.filter((function(t){return t.id!=e.id})),e.parent=void 0,this.attachedLayers.length<t}},{key:"delete",value:function(){var e=this;this.parent&&QS(this.parent.object3d,(function(t){t.layer&&t.layer.id==e.id&&(t.parent.remove(t),GS(t))})),this.object3d.parent&&this.object3d.parent.remove(this.object3d),this.object3d.traverse(GS)}},{key:"pickObjectsAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.defaultPickingRadius,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=this.parent?this.parent.object3d:this.object3d;return MI(e,t,n,r,i,this.threejsLayer)}},{key:"changeOpacity",value:function(e){e.material&&(null!=e.material.opacity&&(e.material.transparent=this.opacity<1,e.material.opacity=this.opacity),e.material.uniforms&&null!=e.material.uniforms.opacity&&(e.material.transparent=this.opacity<1,e.material.uniforms.opacity.value=this.opacity))}}]),n}(yB),zS=function(e){A(n,e);var t=p(n);function n(e,i,a,o){var s,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(r(this,n),s=t.call(this,e,i),!o)throw new Error("extent is mandatory to build a TileMesh");s.layer=a,s.extent=o,s.extent.zoom=A,s.level=A,s.material.objectId=s.id,s.obb=s.geometry.OBB.clone(),s.boundingSphere=new en,s.obb.box3D.getBoundingSphere(s.boundingSphere),s._tms=new Map;var l,c=C(a.tileMatrixSets);try{for(c.s();!(l=c.n()).done;){var h=l.value;s._tms.set(h,s.extent.tiledCovering(h))}}catch(e){c.e(e)}finally{c.f()}return s.frustumCulled=!1,s.matrixAutoUpdate=!1,s.rotationAutoUpdate=!1,s.layerUpdateState={},s.isTileMesh=!0,s.domElements={},s}return o(n,[{key:"setBBoxZ",value:function(e,t,n){null==e&&null==t||Math.floor(e)===Math.floor(this.obb.z.min)&&Math.floor(t)===Math.floor(this.obb.z.max)||(this.obb.updateZ(e,t,n),this.horizonCullingPointElevationScaled&&this.horizonCullingPointElevationScaled.setLength(this.obb.z.delta+this.horizonCullingPoint.length()),this.obb.box3D.getBoundingSphere(this.boundingSphere))}},{key:"getExtentsByProjection",value:function(e){return this._tms.get(ix.formatToTms(e))}},{key:"findCommonAncestor",value:function(e){if(e)return e.level==this.level?e.id==this.id?e:0!=e.level?this.parent.findCommonAncestor(e.parent):void 0:e.level<this.level?this.parent.findCommonAncestor(e):this.findCommonAncestor(e.parent)}},{key:"onBeforeRender",value:function(){this.material.layersNeedUpdate&&this.material.updateLayersUniforms()}},{key:"findClosestDomElement",value:function(e){if(this.parent.isTileMesh)return this.parent.domElements[e]||this.parent.findClosestDomElement(e)}}]),n}(xi),VS=new Map,jS=new eC;var WS=new Je;var XS=function(e,t,n){var i=n.builder,r=e,a=void 0!==r?r.level+1:0,o={extent:t,level:a,segment:n.segments||16,disableSkirt:n.disableSkirt};return function(e,t){var n=e.computeSharableExtent(t.extent),i=n.sharableExtent,r=n.quaternion,a=n.position,o=i.south.toFixed(6),s="".concat(e.crs,"_").concat(t.disableSkirt?0:1,"_").concat(t.segment),A=jS.get(o,t.level,s);if(!A){var l;A=new Promise((function(e){l=e})),jS.set(A,o,t.level,s),t.extent=i,t.center=e.center(t.extent).clone();var c,h=VS.get(s);t.buildIndexAndUv_0=!h,t.builder=e;try{c=lE(t)}catch(e){return Promise.reject(e)}h||((h={}).index=new Dn(c.index,1),h.uv=new Dn(c.uvs[0],2),VS.set(s,h)),c.index=h.index,c.uvs[0]=h.uv,c.position=new Dn(c.position,3),c.normal=new Dn(c.normal,3),t.builder.uvCount>1&&(c.uvs[1]=new Dn(c.uvs[1],1));var u=new hE(t,c);return u.OBB=new SE(u.boundingBox.min,u.boundingBox.max),u._count=0,u.dispose=function(){u._count--,u._count<=0&&(u.index=null,delete u.attributes.uv_0,ni.prototype.dispose.call(u),jS.delete(o,t.level,s))},l(u),Promise.resolve({geometry:u,quaternion:r,position:a})}return A.then((function(e){return{geometry:e,quaternion:r,position:a}}))}(i,o).then((function(e){e.geometry._count++;var o=n.tileMatrixSets.length,s=new Ob(n.materialOptions,o),A=new zS(e.geometry,s,n,t,a);if(r&&r.isTileMesh){var l=i.computeSharableExtent(r.extent);e.position.sub(l.position).applyQuaternion(l.quaternion.invert()),e.quaternion.premultiply(l.quaternion)}return A.position.copy(e.position),A.quaternion.copy(e.quaternion),A.visible=!1,A.updateMatrix(),A.add(A.obb),function(e,t){if(e.material.transparent=t.opacity<1,e.material.opacity=t.opacity,t.diffuse&&(e.material.diffuse=t.diffuse),__DEBUG__&&(e.material.showOutline=t.showOutline||!1,e.material.wireframe=t.wireframe||!1),t.isGlobeLayer){e.horizonCullingPoint=e.extent.center().as("EPSG:4978").toVector3(),e.extent.dimensions(WS).multiplyScalar(Oh.DEG2RAD);var n=WS.length(),i=Math.abs(1/Math.cos(.5*n));e.horizonCullingPoint.setLength(i*e.horizonCullingPoint.length()),e.horizonCullingPointElevationScaled=e.horizonCullingPoint.clone()}}(A,n),r&&A.setBBoxZ(r.obb.z.min,r.obb.z.max),A}))};function ZS(e,t,n,i,r){if(e.isCancelledCommandException)t.layerUpdateState[n.id].success();else if(e instanceof SyntaxError)t.layerUpdateState[n.id].failure(0,!0);else{__DEBUG__&&(n.isColorLayer?console.warn("Error in process color on layer",n.id,", node",t,e):n.isElevationLayer?console.warn("Error in process elevation on layer",n.id,", node",t,e):console.warn("Error in process feature on layer",n.id,", node",t,e));var a=t.layerUpdateState[n.id].errorCount>4;t.layerUpdateState[n.id].failure(Date.now(),a,{targetLevel:i}),a||window.setTimeout((function(){r.notifyChange(t,!1)}),1e3*t.layerUpdateState[n.id].secondsUntilNextTry())}}var YS=Math.pow(131072,.5);function KS(e){return!e.requester.parent||!e.requester.material||(!!(e.layer.isElevationLayer&&e.requester.material.getElevationLayer()&&e.targetLevel<=e.requester.material.getElevationLayer().level)||!e.requester.material.visible)}function JS(e,t,n,i,r){return{view:e,layer:t,extentsSource:n,extentsDestination:i,requester:r,priority:(a=r.material,a.visible?100:10),earlyDropFunction:KS};var a}function qS(e){return function(t){t.material&&t.material.removeLayer&&(t.material.removeLayer(e),t.material.elevationLayerIds[0]==e&&t.setBBoxZ(0,0)),t.layerUpdateState&&t.layerUpdateState[e]&&delete t.layerUpdateState[e]}}var $S=new tt,eT=new tt,tT=function(e){A(n,e);var t=p(n);function n(e,i,a,o,s){var A;if(r(this,n),s.cacheLifeTime=$b.INFINITE,s.source=!1,(A=t.call(this,e,i,s)).isTiledGeometryLayer=!0,A.protocol="tile",A.sseSubdivisionThreshold=A.sseSubdivisionThreshold||1,A.schemeTile=a,A.builder=o,A.info=new qb(d(A)),!A.schemeTile)throw new Error("Cannot init tiled layer without schemeTile for layer ".concat(A.id));if(!A.builder)throw new Error("Cannot init tiled layer without builder for layer ".concat(A.id));A.level0Nodes=[];var l,c=[],h=C(A.schemeTile);try{for(h.s();!(l=h.n()).done;){var u=l.value;c.push(A.convert(void 0,u))}}catch(e){h.e(e)}finally{h.f()}return A._promises.push(Promise.all(c).then((function(e){var t;A.level0Nodes=e,(t=A.object3d).add.apply(t,y(e)),A.object3d.updateMatrixWorld()}))),A}return o(n,[{key:"pickObjectsAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.defaultPickingRadius,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return CI(e,t,n,this,i)}},{key:"preUpdate",value:function(e,t){var n=this;if(t.has(void 0)||0==t.size)return this.level0Nodes;__DEBUG__&&(this._latestUpdateStartingLevel=0),e.colorLayers=e.view.getLayers((function(e,t){return t&&t.id==n.id&&e.isColorLayer})),e.elevationLayers=e.view.getLayers((function(e,t){return t&&t.id==n.id&&e.isElevationLayer})),e.maxElevationLevel=-1;var i,r,a=C(e.elevationLayers);try{for(a.s();!(i=a.n()).done;){var o=i.value;e.maxElevationLevel=Math.max(o.source.zoom.max,e.maxElevationLevel)}}catch(e){a.e(e)}finally{a.f()}-1==e.maxElevationLevel&&(e.maxElevationLevel=1/0),this.colorLayersOrder=wB(e.colorLayers);var s,A=C(t.values());try{for(A.s();!(s=A.n()).done;){var l=s.value;if(l.isCamera)return this.level0Nodes;if(l.layer===this){if(r){if(!(r=l.findCommonAncestor(r)))return this.level0Nodes}else r=l;null==r.material&&(r=void 0)}}}catch(e){A.e(e)}finally{A.f()}return r?(__DEBUG__&&(this._latestUpdateStartingLevel=r.level),[r]):this.level0Nodes}},{key:"update",value:function(e,t,i){var r=this;if(!i.parent)return _I.removeChildrenAndCleanup(this,i);if(i.parent.pendingSubdivision)return i.visible=!1,i.material.visible=!1,void this.info.update(i);if(i.visible=!this.culling(i,e.camera),i.visible){var a=!1;return i.material.visible=!0,this.info.update(i),(i.pendingSubdivision||n.hasEnoughTexturesToSubdivide(e,i)&&this.subdivision(e,this,i))&&(this.subdivideNode(e,i),i.material.visible=i.pendingSubdivision,this.info.update(i),a=!0),i.material.visible&&!a?_I.removeChildren(this,i):a?i.children.filter((function(e){return e.layer==r})):void 0}return i.material.visible=!1,this.info.update(i),_I.removeChildren(this,i)}},{key:"convert",value:function(e,t){return XS(e,t,this)}},{key:"countColorLayersTextures",value:function(){return arguments.length}},{key:"culling",value:function(e,t){return!t.isBox3Visible(e.obb.box3D,e.obb.matrixWorld)}},{key:"subdivideNode",value:function(e,t){var n=this;if(!t.pendingSubdivision&&!t.children.some((function(e){return e.layer==n}))){var i=t.extent.subdivision();t.pendingSubdivision=!0;var r={view:e.view,requester:t,layer:this,priority:1e4,extentsSource:i,redraw:!1};return e.scheduler.execute(r).then((function(n){var i,r=C(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;t.add(a),a.updateMatrixWorld(!0)}}catch(e){r.e(e)}finally{r.f()}t.pendingSubdivision=!1,e.view.notifyChange(t,!1)}),(function(e){if(t.pendingSubdivision=!1,!e.isCancelledCommandException)throw new Error(e)}))}}},{key:"subdivision",value:function(e,t,n){if(n.level<this.minSubdivisionLevel)return!0;if(this.maxSubdivisionLevel<=n.level)return!1;var i=n.material.getElevationLayer();if(i){var r=i.textures[0];if(r&&r.extent)if(i.offsetScales[0].z<1/Math.pow(2,this.maxDeltaElevationLevel))return!1}$S.setFromMatrixScale(n.matrixWorld),eT.copy(n.boundingSphere.center).applyMatrix4(n.matrixWorld);var a=Math.max(0,e.camera.camera3D.position.distanceTo(eT)-n.boundingSphere.radius*$S.x);if(e.camera.camera3D.isOrthographicCamera){var o=e.camera.camera3D,s=2*e.camera._preSSE*o.zoom/(o.top-o.bottom);n.screenSize=s*n.boundingSphere.radius*$S.x}else n.screenSize=e.camera._preSSE*(2*n.boundingSphere.radius*$S.x)/a;var A=n.screenSize/(2*YS);return this.sseSubdivisionThreshold<A}}],[{key:"hasEnoughTexturesToSubdivide",value:function(e,t){var n,i=t.layerUpdateState||{},r=t.material.getElevationLayer(),a=C(e.elevationLayers);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=t.getExtentsByProjection(o.crs)[0].zoom;if(!(s>o.zoom.max||s<o.zoom.min)&&(!o.frozen&&o.ready&&o.source.extentInsideLimit(t.extent,s)&&(!r||r.level<0))){if(i[o.id]&&i[o.id].inError())continue;return!1}}}catch(e){a.e(e)}finally{a.f()}var A,l=C(e.colorLayers);try{for(l.s();!(A=l.n()).done;){var c=A.value;if(!c.frozen&&c.visible&&c.ready){var h=t.getExtentsByProjection(c.crs)[0].zoom;if(!(h>c.zoom.max||h<c.zoom.min)&&(!i[c.id]||!i[c.id].inError())&&(r=t.material.getLayer(c.id),c.source.extentInsideLimit(t.extent,h)&&(!r||r.level<0)))return!1}}}catch(e){l.e(e)}finally{l.f()}return!0}}]),n}(HS),nT=new vt,iT=new tt,rT=0,aT=new tt,oT=function(e){A(n,e);var t=p(n);function n(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,n);var s=Bx.get(ix.tms_4326),A=Mx.get("EPSG:4326").subdivisionByScheme(s);o.tileMatrixSets=[ix.tms_4326,ix.tms_3857];var l=o.tileMatrixSets.length,c=new bE({crs:"EPSG:4978",uvCount:l});(a=t.call(this,e,i||new Ha,A,c,o)).isGlobeLayer=!0,a.options.defaultPickingRadius=5,a.minSubdivisionLevel=null==a.minSubdivisionLevel?2:a.minSubdivisionLevel,a.maxSubdivisionLevel=null==a.maxSubdivisionLevel?19:a.maxSubdivisionLevel,a.maxDeltaElevation=a.maxDeltaElevation||4,a.extent=a.schemeTile[0].clone();for(var h=1;h<a.schemeTile.length;h++)a.extent.union(a.schemeTile[h]);return nT.copy(a.object3d.matrixWorld).invert(),nT.premultiply((new vt).makeScale(1/rx.x,1/rx.y,1/rx.z)),a}return o(n,[{key:"preUpdate",value:function(e,t){return iT.copy(e.camera.camera3D.position).applyMatrix4(nT),rT=iT.lengthSq()-1,g(l(n.prototype),"preUpdate",this).call(this,e,t)}},{key:"countColorLayersTextures",value:function(){for(var e=0,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r],s=o.crs||o.source.crs;e+="EPSG:3857"==s?3:1}return e}},{key:"subdivision",value:function(e,t,i){if(5==i.level){var r=i.getExtentsByProjection(ix.tms_4326)[0].row;if(31==r||0==r)return!1}return g(l(n.prototype),"subdivision",this).call(this,e,t,i)}},{key:"culling",value:function(e,t){return!!g(l(n.prototype),"culling",this).call(this,e,t)||!(e.level<this.minSubdivisionLevel)&&this.horizonCulling(e.horizonCullingPointElevationScaled)}},{key:"horizonCulling",value:function(e){aT.copy(e).applyMatrix4(nT),aT.sub(iT);var t=aT.lengthSq(),n=-aT.dot(iT);return rT<0?n>0:rT<n&&rT<n*n/t}},{key:"computeTileZoomFromDistanceCamera",value:function(e,t){var n=YS*(.5*this.sseSubdivisionThreshold)/t._preSSE/rx.x,i=e*n,r=Math.log(Math.PI/(2*Math.asin(i)))/Math.log(2),a=Math.PI/Math.pow(2,r);return i=(e-.5*(2*rx.x*Math.sin(.5*a)))*n,r=Math.log(Math.PI/(2*Math.asin(i)))/Math.log(2),isNaN(r)?0:Math.round(r)}},{key:"computeDistanceCameraFromTileZoom",value:function(e,t){var n=Math.PI/Math.pow(2,e),i=.5*(2*rx.x*Math.sin(.5*n)),r=i/YS;return t._preSSE*r/(.5*this.sseSubdivisionThreshold)+i}}]),n}(tT),sT={getSunPosition:function(){var e=Math,t=e.PI,n=e.sin,i=e.cos,r=e.tan,a=e.asin,o=e.atan2,s=t/180,A=23.4397*s;function l(e,t,a){return o(n(e),i(e)*n(t)-r(a)*i(t))}function c(e,t,r){return a(n(t)*n(r)+i(t)*i(r)*i(e))}return function(e,h,u){var d,f,p=s*-u,m=s*h,g=function(e){return function(e){return e.valueOf()/864e5-.5+2440588}(e)-2451545}(e),v=function(e){return s*(357.5291+.98560028*e)}(g),y=function(e,n){return e+n+102.9372*s+t}(v,function(e){return s*(1.9148*n(e)+.02*n(2*e)+3e-4*n(3*e))}(v)),w=(d=y,a(n(f=0)*i(A)+i(f)*n(A)*n(d))),x=function(e,t){return o(n(e)*i(A)-r(t)*n(A),i(e))}(y,0),b=function(e,t){return s*(280.16+360.9856235*e)-t}(g,p),C=b-x;return{EclipticLongitude:y,declinaison:w,ascension:x,H:C,SiderealTime:b,altitude:c(C,m,w),azimuth:l(C,m,w)+t/2}}},getSunPositionInScene:function(e,t,n){var i=864e5,r=sT.getSunPosition()(e,t,n).ascension+e%i/i*-360+180;return new ux("EPSG:4326",r,t,5e7).as("EPSG:4978").toVector3()}},AT={uniforms:{luminance:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},v3LightPosition:{type:"v3",value:new tt},up:{type:"v3",value:new tt(0,1,0)}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix *  vec4( cameraPosition + position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( cameraPosition + position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 v3LightPosition;","uniform vec3 up;","varying vec3 vWorldPosition;","// uniform sampler2D sDiffuse;","// const float turbidity = 10.0; //","// const float reileigh = 2.; //","// const float luminance = 1.0; //","// const float mieCoefficient = 0.005;","// const float mieDirectionalG = 0.8;","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","// constants for atmospheric scattering","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003; // refractive index of air","const float N = 2.545E25; // number of molecules per unit volume for air at","// 288.15K and 1013mb (sea level -45 celsius)","const float pn = 0.035; // depolatization factor for standard air","// wavelength of used primaries, according to preetham","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","// mie stuff","// K coefficient for the primaries","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","// optical length at zenith for molecules","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","// 66 arc seconds -> degrees, and the cosine of that","// earth shadow hack","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{ ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// float logLuminance(vec3 c)","// {","//     return log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);","// }","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","vec3 up2 = normalize(cameraPosition.xyz);","float sunfade = 1.0-clamp(1.0-exp((v3LightPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(v3LightPosition);","float sunE = sunIntensity(dot(sunDirection, up2));","// extinction (absorbtion + out scattering) ","// rayleigh coefficients","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","// mie coefficients","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","// optical length","// cutoff angle at 90 to avoid singularity in next formula.","float zenithAngle = acos(max(0.0, dot(up2, normalize(vWorldPosition - cameraPosition))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","// combined extinction factor","vec3 Fex = exp(-(betaR * sR + betaM * sM));","// in scattering","float cosTheta = dot(normalize(vWorldPosition - cameraPosition), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up2, sunDirection),5.0),0.0,1.0));","//nightsky","vec3 direction = normalize(vWorldPosition - cameraPosition);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;","vec3 L0 = vec3(0.1) * Fex;","// composition + solar disc","//if (cosTheta > sunAngularDiameterCos)","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","// if (normalize(vWorldPosition - cameraPosition).y>0.0)","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1. - ( (length(cameraPosition) - 6400000.) / 1000.);","}"].join("\n")},lT=function(e){A(n,e);var t=p(n);function n(){r(this,n);var e=Ui.clone(AT.uniforms),i=new Pi({fragmentShader:AT.fragmentShader,vertexShader:AT.vertexShader,uniforms:e,side:1,transparent:!0,depthWrite:!1}),a=new Ys(4e4,32,15);return t.call(this,a,i)}return n}(xi),cT="\n#include <logdepthbuf_pars_fragment>\n\nuniform int atmoIN;\nvarying float intensity;\n\nvec4 glowColor = vec4(0.45, 0.74, 1. ,1.0);\n\nvoid main() {\n    #include <logdepthbuf_fragment>\n    gl_FragColor = glowColor * intensity;\n}\n",hT="\n#include <common>\n#include <logdepthbuf_pars_vertex>\n\nuniform int atmoIN;\nvarying float intensity;\n\nvoid main()\n{\n    vec3 normalES    = normalize( normalMatrix * normal );\n    vec3 normalCAMES = normalize( normalMatrix * cameraPosition );\n\n    if(atmoIN == 0) {\n        intensity = pow(0.666 - dot(normalES, normalCAMES), 4. );\n    } else {\n        intensity = pow( 1.  - dot(normalES, normalCAMES), 0.8 );\n    }\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position,  1.0 );\n\n    #include <logdepthbuf_vertex>\n}\n",uT=new tt(1,0,0),dT=new tt,fT=new ux("EPSG:4326"),pT=new ux("EPSG:4326"),mT=new Sn(9688568),gT=new Sn,vT=new Sn(197896),yT=6e5,wT=160*rx.x,xT=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"atmosphere",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,n),a.source=!1,(e=t.call(this,i,new Dt,a)).isAtmosphere=!0;var o=new Pi({uniforms:{atmoIN:{type:"i",value:0},screenSize:{type:"v2",value:new Je(window.innerWidth,window.innerHeight)}},vertexShader:hT,fragmentShader:cT,side:1,blending:2,transparent:!0,wireframe:!1}),s=new Zs(1,64,64),A=new xi(s,o);A.scale.copy(rx).multiplyScalar(1.14),e.basicAtmosphere=new Dt,e.realisticAtmosphere=new Dt,e.realisticAtmosphere.visible=!1,e.object3d.add(e.basicAtmosphere),e.object3d.add(e.realisticAtmosphere),e.basicAtmosphere.add(A);var l=new Pi({uniforms:{atmoIN:{type:"i",value:1},screenSize:{type:"v2",value:new Je(window.innerWidth,window.innerHeight)}},vertexShader:hT,fragmentShader:cT,side:0,blending:2,transparent:!0,depthWrite:!1}),c=new xi(s,l);return c.scale.copy(rx).multiplyScalar(1.002),e.basicAtmosphere.add(c),e.realisticLightingPosition={x:-.5,y:0,z:1},e.fog={enable:!0,distance:wT},e.realisticAtmosphereInitParams=a.Kr?a:{Kr:.0025,Km:.0015,ESun:20,g:-.95,innerRadius:64e5,outerRadius:67e5,wavelength:[.65,.57,.475],scaleDepth:.25},e.object3d.updateMatrixWorld(),e}return o(n,[{key:"update",value:function(e,t,n){n.material.fogDistance=this.fog.distance,n.material.lightingEnabled=this.realisticAtmosphere.visible,n.material.lightPosition=this.realisticLightingPosition}},{key:"preUpdate",value:function(e,t){var n=e.view.camera.camera3D.position;if(this.fog.enable){dT.setFromMatrixPosition(e.view.tileLayer.object3d.matrixWorld);var i=dT.distanceTo(n);this.fog.distance=wT*Math.pow(.25*(i-.99*rx.x)/rx.x,1.5)}else this.fog.distance=1e11;var r=e.view.mainLoop.gfxEngine.renderer;fT.crs=e.view.referenceCrs,fT.setFromVector3(n).as("EPSG:4326",pT);var a=pT.altitude;if(a<yT){var o=(yT-a)/yT;gT.copy(vT).lerp(mT,o),r.setClearColor(gT,r.getClearAlpha())}else r.setClearColor(vT,r.getClearAlpha())}},{key:"_initRealisticLighning",value:function(){var e=this.realisticAtmosphereInitParams,t={v3LightPosition:{value:uT.clone().normalize()},v3InvWavelength:{value:new tt(1/Math.pow(e.wavelength[0],4),1/Math.pow(e.wavelength[1],4),1/Math.pow(e.wavelength[2],4))},fCameraHeight:{value:0},fCameraHeight2:{value:0},fInnerRadius:{value:e.innerRadius},fInnerRadius2:{value:e.innerRadius*e.innerRadius},fOuterRadius:{value:e.outerRadius},fOuterRadius2:{value:e.outerRadius*e.outerRadius},fKrESun:{value:e.Kr*e.ESun},fKmESun:{value:e.Km*e.ESun},fKr4PI:{value:4*e.Kr*Math.PI},fKm4PI:{value:4*e.Km*Math.PI},fScale:{value:1/(e.outerRadius-e.innerRadius)},fScaleDepth:{value:e.scaleDepth},fScaleOverScaleDepth:{value:1/(e.outerRadius-e.innerRadius)/e.scaleDepth},g:{value:e.g},g2:{value:e.g*e.g},nSamples:{value:3},fSamples:{value:3},tDisplacement:{value:new st},tSkyboxDiffuse:{value:new st},fNightScale:{value:1}},n=new xi(new Zs(e.innerRadius,50,50),new Pi({uniforms:t,vertexShader:"\nuniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nvarying vec3 c0;\nvarying vec3 c1;\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n\n     float cameraHeight2 = length(cameraPosition) * length(cameraPosition);\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n    float fCameraAngle = dot(-v3Ray, position) / length(position);\n    float fLightAngle = dot(v3LightPosition, position) / length(position);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Calculate the attenuation factor for the ground\n    c0 = v3Attenuate;\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nvarying vec3 c0;\nvarying vec3 c1;\n\nvoid main (void) {\n\tgl_FragColor = vec4(c1, 1.0 - c0/4.);\n}",blending:2,transparent:!0,depthTest:!1,depthWrite:!1})),i=new xi(new Zs(e.outerRadius,196,196),new Pi({uniforms:t,vertexShader:"\nuniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\nfloat scale(float fCos) {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n    float lengthCamera = length(cameraPosition);\n    float cameraHeight2 = lengthCamera * lengthCamera;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n    float fStartDepth = exp(-1.0 / fScaleDepth);\n    float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;\n        float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n        float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\n    c1 = v3FrontColor * fKmESun;\n    v3Direction = cameraPosition - position;\n}",fragmentShader:"\nuniform vec3 v3LightPos;\nuniform float g;\nuniform float g2;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\n// Calculates the Mie phase function\nfloat getMiePhase(float fCos, float fCos2, float g, float g2) {\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(1.0 + g2 - 2.0 * g * fCos, 1.5);\n}\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(float fCos2) {\n    return 0.75 + 0.75 * fCos2;\n}\n\nvoid main (void) {\n    float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\n    float fCos2 = fCos * fCos;\n\n    vec3 color = getRayleighPhase(fCos2) * c0 + getMiePhase(fCos, fCos2, g, g2) * c1;\n\n    gl_FragColor = vec4(color, 1.0);\n    gl_FragColor.a = gl_FragColor.b;\n}",transparent:!0,side:1})),r=new lT;r.frustumCulled=!1,n.layers.mask=this.object3d.layers.mask,i.layers.mask=this.object3d.layers.mask,r.layers.mask=this.object3d.layers.mask,this.realisticAtmosphere.add(n),this.realisticAtmosphere.add(i),this.realisticAtmosphere.add(r);var a=10,o=2,s=.005,A=.8,l=1;r.material.uniforms.turbidity.value=a,r.material.uniforms.reileigh.value=o,r.material.uniforms.luminance.value=l,r.material.uniforms.mieCoefficient.value=s,r.material.uniforms.mieDirectionalG.value=A,r.material.uniforms.up.value=new tt}},{key:"setRealisticOn",value:function(e){var t=this;e&&(this.realisticAtmosphere.children.length||this._initRealisticLighning(),this.realisticLightingPosition=sT.getSunPositionInScene((new Date).getTime(),48.85,2.35).normalize(),this.realisticAtmosphere.children.forEach((function(e){return e.material.uniforms.v3LightPosition.value.copy(t.realisticLightingPosition)}))),this.basicAtmosphere.visible=!e,this.realisticAtmosphere.visible=e}}]),n}(HS),bT={GLOBE_INITIALIZED:HI,LAYER_ADDED:QI,LAYER_REMOVED:GI,COLOR_LAYERS_ORDER_CHANGED:zI},CT=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,n),Dt.DefaultUp.set(0,0,1),(i=t.call(this,"EPSG:4978",e,o)).isGlobeView=!0,i.camera.camera3D.near=Math.max(15,2352e-9*rx.x),i.camera.camera3D.far=10*rx.x;var s=new oT("globe",o.object3d,o);i.mainLoop.gfxEngine.label2dRenderer.infoTileLayer=s.info;var A=new Tl;return A.position.set(-.5,0,1),A.updateMatrixWorld(!0),s.object3d.add(A),i.addLayer(s),i.tileLayer=s,Array.isArray(a.coord)&&(a.coord=new ux("EPSG:4326").setFromArray(a.coord)),a.isExtent||(a.coord=a.coord||new ux("EPSG:4326",0,0),a.tilt=a.tilt||89.5,a.heading=a.heading||0,a.range=a.range||2*rx.x),o.noControls?NE.transformCameraToLookAtTarget(d(i),i.camera.camera3D,a):(i.controls=new NS(d(i),a),i.controls.handleCollision=void 0===o.handleCollision||o.handleCollision),i.addLayer(new xT("atmosphere",o.atmosphere)),i.camera.resize(e.clientWidth,e.clientHeight),i}return o(n,[{key:"addLayer",value:function(e){if(!e||!e.isLayer)return Promise.reject(new Error("Add Layer type object"));if(e.isColorLayer){if(!this.tileLayer.tileMatrixSets.includes(ix.formatToTms(e.source.crs)))return e._reject("Only ".concat(this.tileLayer.tileMatrixSets," tileMatrixSet are currently supported for color layers"))}else if(e.isElevationLayer&&ix.formatToTms(e.source.crs)!==this.tileLayer.tileMatrixSets[0])return e._reject("Only ".concat(this.tileLayer.tileMatrixSets[0]," tileMatrixSet is currently supported for elevation layers"));return g(l(n.prototype),"addLayer",this).call(this,e,this.tileLayer)}},{key:"getPixelsToDegrees",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;return this.getMetersToDegrees(this.getPixelsToMeters(e,t))}},{key:"getPixelsToDegreesFromDistance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.getMetersToDegrees(this.getPixelsToMetersFromDistance(e,t))}},{key:"getMetersToDegrees",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Oh.radToDeg(2*Math.asin(e/(2*rx.x)))}}]),n}(tE);new Pc,new ux("EPSG:4326",0,0,0),new vt,new Sn(1,1,1),new Sn(.5,.5,.5),new Sn(.5,.5,.5),new Sn(.63,.32,.18),new Sn(0,1,0),new Sn(0,.8,0),new Sn(0,.6,0),new Sn(1,.66,0),new Sn(1,0,1),new Sn(1,0,0),new Sn(0,0,1),new Sn(.8,.8,1),new Sn(.4,.4,.7),new Sn(1,1,0),new Sn(.3,.6,.6);var MT={38:{method:"translateZ",sign:-1},40:{method:"translateZ",sign:1},37:{method:"translateX",sign:-1},39:{method:"translateX",sign:1},33:{method:"rotateZ",sign:1,noSpeed:!0},34:{method:"rotateZ",sign:-1,noSpeed:!0},wheelup:{method:"translateZ",sign:1,oneshot:!0},wheeldown:{method:"translateZ",sign:-1,oneshot:!0}};function BT(e){e.preventDefault(),this._isMouseDown=!0;var t=this.view.eventToViewCoords(e);this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y}function IT(e){e.preventDefault(),this._isMouseDown=!0,this._onMouseDownMouseX=e.touches[0].pageX,this._onMouseDownMouseY=e.touches[0].pageY}function ET(e){if(!0===this._isMouseDown){var t=this.view.eventToViewCoords(e),n=Oh.degToRad(this._camera3D.fov)/this.view.mainLoop.gfxEngine.height;this._camera3D.rotateY((t.x-this._onMouseDownMouseX)*n),this._camera3D.rotateX((t.y-this._onMouseDownMouseY)*n),this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y,this.view.notifyChange(this._camera3D,!1)}}function ST(){this._isMouseDown=!1}function TT(e){var t=MT[e.keyCode];t&&(this.moves.delete(t),e.preventDefault())}function LT(e){var t=MT[e.keyCode];t&&(this.moves.add(t),this.view.notifyChange(this._camera3D,!1),e.preventDefault())}function FT(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t<0?this.moves.add(MT.wheelup):this.moves.add(MT.wheeldown),this.view.notifyChange(this._camera3D,!1)}var _T=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,n),(i=t.call(this)).view=e,i.options=a,i._camera3D=e.camera.camera3D,i.moves=new Set,i.moveSpeed=10,i._onMouseDownMouseX=0,i._onMouseDownMouseY=0,i._isMouseDown=!1,e.domElement.addEventListener("mousedown",BT.bind(d(i)),!1),e.domElement.addEventListener("touchstart",IT.bind(d(i)),!1);var o=ET.bind(d(i));return e.domElement.addEventListener("mousemove",o,!1),e.domElement.addEventListener("touchmove",o,!1),e.domElement.addEventListener("mouseup",ST.bind(d(i)),!1),e.domElement.addEventListener("touchend",ST.bind(d(i)),!1),e.domElement.addEventListener("mousewheel",FT.bind(d(i)),!1),e.domElement.addEventListener("DOMMouseScroll",FT.bind(d(i)),!1),window.addEventListener("keyup",TT.bind(d(i)),!0),window.addEventListener("keydown",LT.bind(d(i)),!0),i.view.addFrameRequester($x,i.update.bind(d(i))),a.focusOnMouseOver&&e.domElement.addEventListener("mouseover",(function(){return e.domElement.focus()})),a.focusOnClick&&e.domElement.addEventListener("click",(function(){return e.domElement.focus()})),i}return o(n,[{key:"isUserInteracting",value:function(){return 0!==this.moves.size||this._isMouseDown}},{key:"update",value:function(e,t){t&&(e=16);var n,i=C(this.moves);try{for(i.s();!(n=i.n()).done;){var r=n.value;this._camera3D[r.method](r.sign*(r.noSpeed?1:this.moveSpeed)*e/1e3)}}catch(e){i.e(e)}finally{i.f()}if(this.moves.size>0||this._isMouseDown){this.view.notifyChange(this._camera3D);var a,o=C(this.moves);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.oneshot&&this.moves.delete(s)}}catch(e){o.e(e)}finally{o.f()}}}}]),n}(Xe);function UT(e,t,n){var i=.5*Oh.degToRad(n-e.fov);return Oh.clamp(t,-i,i)}var PT=new tt(0,1,0);function kT(e,t,n){t.quaternion.setFromUnitVectors(PT,t.up),t.rotateY(n.rotateY),t.rotateX(n.rotateX),e.notifyChange(e.camera.camera3D)}var DT={38:{method:"translateZ",sign:-1},40:{method:"translateZ",sign:1},37:{method:"translateX",sign:-1},39:{method:"translateX",sign:1},33:{method:"translateY",sign:1},34:{method:"translateY",sign:-1}};function RT(e){this.camera.position.z+=e}var OT=new tt,NT=new qe,GT=new xt(0,0,0,"YXZ");function QT(e){OT.copy(this.camera.position),OT.normalize(),this.camera.position.add(OT.multiplyScalar(e))}var HT=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,n),(i=t.call(this)).isFirstPersonControls=!0,i.camera=e.camera.camera3D,i.view=e,i.moves=new Set,a.panoramaRatio){var o=200*a.panoramaRatio/(2*Math.PI);a.verticalFOV=2==a.panoramaRatio?180:Oh.radToDeg(2*Math.atan(200/(2*o)))}return a.verticalFOV=a.verticalFOV||180,a.moveSpeed=void 0===a.moveSpeed?10:a.moveSpeed,i.options=a,i._isMouseDown=!1,i._onMouseDownMouseX=0,i._onMouseDownMouseY=0,i._state={rotateX:0,rotateY:0,snapshot:function(){return{rotateX:this.rotateX,rotateY:this.rotateY}}},i.reset(),i.eventListeners=a.disableEventListeners,a.disableEventListeners||(i._onMouseDown=i.onMouseDown.bind(d(i)),i._onMouseMove=i.onMouseMove.bind(d(i)),i._onMouseUp=i.onMouseUp.bind(d(i)),i._onMouseWheel=i.onMouseWheel.bind(d(i)),i._onKeyUp=i.onKeyUp.bind(d(i)),i._onKeyDown=i.onKeyDown.bind(d(i)),e.domElement.addEventListener("mousedown",i._onMouseDown,!1),e.domElement.addEventListener("touchstart",i._onMouseDown,!1),e.domElement.addEventListener("mousemove",i._onMouseMove,!1),e.domElement.addEventListener("touchmove",i._onMouseMove,!1),e.domElement.addEventListener("mouseup",i._onMouseUp,!1),e.domElement.addEventListener("touchend",i._onMouseUp,!1),e.domElement.addEventListener("mousewheel",i._onMouseWheel,!1),e.domElement.addEventListener("DOMMouseScroll",i._onMouseWheel,!1),document.addEventListener("keydown",i._onKeyDown,!1),document.addEventListener("keyup",i._onKeyUp,!1)),i.view.addFrameRequester($x,i.update.bind(d(i))),i._onFocus=function(){return e.domElement.focus()},i.focusOnMouseOver=a.focusOnMouseOver,a.focusOnMouseOver&&e.domElement.addEventListener("mouseover",i._onFocus),i.focusOnClick=a.focusOnClick,a.focusOnClick&&e.domElement.addEventListener("click",i._onFocus),"EPSG:4978"==e.referenceCrs?i.moveCameraVertical=QT:i.moveCameraVertical=RT,i}return o(n,[{key:"isUserInteracting",value:function(){return 0!==this.moves.size&&!this._isMouseDown}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];NT.setFromUnitVectors(PT,this.camera.up),NT.invert(),NT.multiply(this.camera.quaternion),GT.setFromQuaternion(NT),e||(this._state.rotateX=GT.x),this._state.rotateY=GT.y}},{key:"update",value:function(e,t,n){if(0!=this.enabled){t&&(e=16);var i,r=this.camera.position.y,a=C(this.moves);try{for(a.s();!(i=a.n()).done;){var o=i.value;"translateY"===o.method?this.moveCameraVertical(o.sign*this.options.moveSpeed*e/1e3):this.camera[o.method](o.sign*this.options.moveSpeed*e/1e3)}}catch(e){a.e(e)}finally{a.f()}!0!==this._isMouseDown&&!0!==n||kT(this.view,this.camera,this._state),this.moves.size&&this.view.notifyChange(this.view.camera.camera3D),this.camera.position.y=r}}},{key:"onMouseDown",value:function(e){if(0!=this.enabled){this._isMouseDown=!0;var t=this.view.eventToViewCoords(e);this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y,this._stateOnMouseDown=this._state.snapshot()}}},{key:"onMouseUp",value:function(){0!=this.enabled&&(this._isMouseDown=!1)}},{key:"onMouseMove",value:function(e){if(0!=this.enabled&&!0===this._isMouseDown){var t=Oh.degToRad(this.camera.fov)/this.view.mainLoop.gfxEngine.height,n=this.view.eventToViewCoords(e);this._state.rotateY=(n.x-this._onMouseDownMouseX)*t+this._stateOnMouseDown.rotateY,this._state.rotateX=UT(this.camera,(n.y-this._onMouseDownMouseY)*t+this._stateOnMouseDown.rotateX,this.options.verticalFOV),kT(this.view,this.camera,this._state)}}},{key:"onMouseWheel",value:function(e){if(0!=this.enabled){var t=0;void 0!==e.wheelDelta?t=-e.wheelDelta:void 0!==e.detail&&(t=e.detail),this.camera.fov=Oh.clamp(this.camera.fov+Math.sign(t),10,Math.min(100,this.options.verticalFOV)),this.camera.updateProjectionMatrix(),this._state.rotateX=UT(this.camera,this._state.rotateX,this.options.verticalFOV),kT(this.view,this.camera,this._state)}}},{key:"onKeyUp",value:function(e){if(0!=this.enabled){var t=DT[e.keyCode];t&&(this.moves.delete(t),this.view.notifyChange(void 0,!1),e.preventDefault())}}},{key:"onKeyDown",value:function(e){if(0!=this.enabled){var t=DT[e.keyCode];t&&(this.moves.add(t),this.view.notifyChange(void 0,!1),e.preventDefault())}}},{key:"dispose",value:function(){this.eventListeners||(this.view.domElement.removeEventListener("mousedown",this._onMouseDown,!1),this.view.domElement.removeEventListener("touchstart",this._onMouseDown,!1),this.view.domElement.removeEventListener("mousemove",this._onMouseMove,!1),this.view.domElement.removeEventListener("touchmove",this._onMouseMove,!1),this.view.domElement.removeEventListener("mouseup",this._onMouseUp,!1),this.view.domElement.removeEventListener("touchend",this._onMouseUp,!1),this.view.domElement.removeEventListener("mousewheel",this._onMouseWheel,!1),this.view.domElement.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1),document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("keyup",this._onKeyUp,!1)),this.focusOnMouseOver&&this.view.domElement.removeEventListener("mouseover",this._onFocus),this.focusOnClick&&this.view.domElement.removeEventListener("click",this._onFocus),this.dispatchEvent({type:"dispose"})}}]),n}(Xe);new kn({color:16777215,depthTest:!1,transparent:!0,opacity:.5}),new ux("EPSG:4326",0,0),new Ho,new Fo,new Sn,new kn,new vt,(new tt).set(0,0,1),new ux("EPSG:4326",0,0,0);var zT={color_layers_pars_fragment:"\nstruct Layer {\n    int textureOffset;\n    int crs;\n    float effect;\n    float opacity;\n};\n\nuniform sampler2D   colorTextures[NUM_FS_TEXTURES];\nuniform vec4        colorOffsetScales[NUM_FS_TEXTURES];\nuniform Layer       colorLayers[NUM_FS_TEXTURES];\nuniform int         colorTextureCount;\n\nvec3 uvs[NUM_CRS];\n\nfloat getBorderDistance(vec2 uv) {\n    vec2 p2 = min(uv, 1. -uv);\n    return min(p2.x, p2.y);\n}\n\nfloat tolerance = 0.99;\n\nvec4 applyWhiteToInvisibleEffect(vec4 color, float intensity) {\n    float a = dot(color.rgb, vec3(0.333333333));\n    if (a >= tolerance) {\n        color.a *= 1.0 - pow(abs(a), intensity);\n    }\n    return color;\n}\n\nvec4 applyLightColorToInvisibleEffect(vec4 color, float intensity) {\n    float a = max(0.05,1. - length(color.xyz - 1.));\n    color.a *= 1.0 - pow(abs(a), intensity);\n    color.rgb *= color.rgb * color.rgb;\n    return color;\n}\n\n#if defined(DEBUG)\nuniform bool showOutline;\nuniform vec3 outlineColors[NUM_CRS];\nuniform float outlineWidth;\n\nvec4 getOutlineColor(vec3 outlineColor, vec2 uv) {\n    float alpha = 1. - clamp(getBorderDistance(uv) / outlineWidth, 0., 1.);\n    return vec4(outlineColor, alpha);\n}\n#endif\n\nuniform float minBorderDistance;\nvec4 getLayerColor(int textureOffset, sampler2D tex, vec4 offsetScale, Layer layer) {\n    if ( textureOffset >= colorTextureCount ) return vec4(0);\n\n    vec3 uv;\n    // #pragma unroll_loop\n    for ( int i = 0; i < NUM_CRS; i ++ ) {\n        if ( i == layer.crs ) uv = uvs[ i ];\n    }\n\n    float borderDistance = getBorderDistance(uv.xy);\n    if (textureOffset != layer.textureOffset + int(uv.z) || borderDistance < minBorderDistance ) return vec4(0);\n    vec4 color = texture2D(tex, pitUV(uv.xy, offsetScale));\n    if(color.a > 0.0) {\n        if(layer.effect > 2.0) {\n            color.rgb /= color.a;\n            color = applyLightColorToInvisibleEffect(color, layer.effect);\n        } else if(layer.effect > 0.0) {\n            color.rgb /= color.a;\n            color = applyWhiteToInvisibleEffect(color, layer.effect);\n        }\n    }\n\n    color.a *= layer.opacity;\n    return color;\n}\n",elevation_pars_vertex:"\n#if NUM_VS_TEXTURES > 0\n    struct Layer {\n        float scale;\n        float bias;\n        int mode;\n        float zmin;\n        float zmax;\n    };\n\n    uniform Layer       elevationLayers[NUM_VS_TEXTURES];\n    uniform sampler2D   elevationTextures[NUM_VS_TEXTURES];\n    uniform vec4        elevationOffsetScales[NUM_VS_TEXTURES];\n    uniform int         elevationTextureCount;\n\n    highp float decode32(highp vec4 rgba) {\n        highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;\n        highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;\n        highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);\n        highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));\n        return Result;\n    }\n\n    float getElevationMode(vec2 uv, sampler2D tex, int mode) {\n        if (mode == ELEVATION_RGBA)\n            return decode32(texture2D( tex, uv ).abgr * 255.0);\n        if (mode == ELEVATION_DATA || mode == ELEVATION_COLOR)\n        #if defined(WEBGL2)\n            return texture2D( tex, uv ).r;\n        #else\n            return texture2D( tex, uv ).w;\n        #endif\n        return 0.;\n    }\n\n    float getElevation(vec2 uv, sampler2D tex, vec4 offsetScale, Layer layer) {\n        uv = uv * offsetScale.zw + offsetScale.xy;\n        float d = getElevationMode(uv, tex, layer.mode);\n        if (d < layer.zmin || d > layer.zmax) d = 0.;\n        return d * layer.scale + layer.bias;\n    }\n#endif\n",elevation_vertex:"\n#if NUM_VS_TEXTURES > 0\n    if(elevationTextureCount > 0) {\n        float elevation = getElevation(uv, elevationTextures[0], elevationOffsetScales[0], elevationLayers[0]);\n        transformed += elevation * normal;\n    }\n#endif\n",fog_fragment:"\n#if defined(USE_FOG)\n    float fogFactor = 1. - min( exp(-fogDepth / fogDistance), 1.);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor);\n#endif\n",fog_pars_fragment:"\n#if defined(USE_FOG)\nuniform vec3  fogColor;\nuniform float fogDistance;\nvarying float fogDepth;\n#endif\n",lighting_fragment:"\nif (lightingEnabled) {\n    float light = min(2. * dot(vNormal, lightPosition), 1.);\n    gl_FragColor.rgb *= light;\n}\n",lighting_pars_fragment:"\nuniform bool lightingEnabled;\nuniform vec3 lightPosition;\nvarying vec3 vNormal;\n",mode_depth_fragment:"\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragColor = packDepthToRGBA(gl_FragDepthEXT);\n#else\nfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\ngl_FragColor = packDepthToRGBA(fragCoordZ);\n#endif\n",mode_id_fragment:"\ngl_FragColor = packDepthToRGBA(float(objectId) / 16777216.0);\n",mode_pars_fragment:"\n#if MODE == MODE_ID || MODE == MODE_DEPTH\n#include <packing>\n#endif\n\n#if MODE == MODE_ID\nuniform int objectId;\n#endif\n",overlay_fragment:"\ngl_FragColor.rgb = mix(gl_FragColor.rgb, overlayColor, overlayAlpha);\n",overlay_pars_fragment:"\nuniform vec3  overlayColor;\nuniform float overlayAlpha;\n",pitUV:"\nvec2 pitUV(vec2 uv, vec4 pit)\n{\n    return uv * pit.zw + vec2(pit.x, 1.0 - pit.w - pit.y);\n}\n",precision_qualifier:"\nprecision highp float;\nprecision highp int;\n",projective_texturing_vertex:"\nfor(int i = 0; i < ORIENTED_IMAGES_COUNT; ++i)\n    projectiveTextureCoords[i] = projectiveTextureMatrix[i] * mvPosition;\n",projective_texturing_pars_vertex:"\nuniform mat4 projectiveTextureMatrix[ORIENTED_IMAGES_COUNT];\nvarying vec4 projectiveTextureCoords[ORIENTED_IMAGES_COUNT];\n",projective_texturing_pars_fragment:"\nuniform sampler2D projectiveTexture[ORIENTED_IMAGES_COUNT];\nuniform sampler2D mask[ORIENTED_IMAGES_COUNT];\nvarying vec4      projectiveTextureCoords[ORIENTED_IMAGES_COUNT];\nuniform float     projectiveTextureAlphaBorder;\nuniform float     opacity;\nuniform bool      boostLight;\n\nstruct Distortion {\n    vec2 size;\n#if USE_DISTORTION\n    vec2 pps;\n    vec4 polynom;\n    vec3 l1l2;\n#endif\n};\n\nuniform Distortion projectiveTextureDistortion[ORIENTED_IMAGES_COUNT];\n\nfloat getAlphaBorder(vec2 p)\n{\n    vec2 d = clamp(projectiveTextureAlphaBorder * min(p, 1. - p), 0., 1.);\n    return min(d.x, d.y);\n}\n\n#if USE_DISTORTION\nvoid distort(inout vec2 p, vec4 polynom, vec2 pps)\n{\n    vec2 v = p - pps;\n    float v2 = dot(v, v);\n    if (v2 > polynom.w) {\n        p = vec2(-1.);\n    }\n    else {\n        p += (v2 * (polynom.x + v2 * (polynom.y + v2 * polynom.z) ) ) * v;\n    }\n}\n\nvoid distort(inout vec2 p, vec4 polynom, vec3 l1l2, vec2 pps)\n{\n    if ((l1l2.x == 0.) && (l1l2.y == 0.)) {\n        distort(p, polynom, pps);\n    } else {\n        vec2 AB = (p - pps) / l1l2.z;\n        float R = length(AB);\n        float lambda = atan(R) / R;\n        vec2 ab = lambda * AB;\n        float rho2 = dot(ab, ab);\n        float r357 = 1. + rho2* (polynom.x + rho2* (polynom.y + rho2 * polynom.z));\n        p = pps + l1l2.z * (r357 * ab + vec2(dot(l1l2.xy, ab), l1l2.y * ab.x));\n    }\n}\n#endif\n\nvec4 mixBaseColor(vec4 aColor, vec4 baseColor) {\n    #ifdef USE_BASE_MATERIAL\n        baseColor.rgb = aColor.a == 1.0 ? aColor.rgb : mix(baseColor, aColor, aColor.a).rgb;\n        baseColor.a = min(1.0, aColor.a + baseColor.a);\n    #else\n        baseColor.rgb += aColor.rgb * aColor.a;\n        baseColor.a += aColor.a;\n    #endif\n    return baseColor;\n}\n\nvec4 projectiveTextureColor(vec4 coords, Distortion distortion, sampler2D tex, sampler2D mask, vec4 baseColor) {\n    vec3 p = coords.xyz / coords.w;\n    if(p.z * p.z < 1.) {\n#if USE_DISTORTION\n        p.xy *= distortion.size;\n        distort(p.xy, distortion.polynom, distortion.l1l2, distortion.pps);\n        p.xy /= distortion.size;\n#endif\n\n        float d = getAlphaBorder(p.xy) * texture2D(mask, p.xy).r;\n\n        if(d > 0.) {\n\n#if DEBUG_ALPHA_BORDER\n        vec3 r = texture2D(tex, p.xy).rgb;\n        return mixBaseColor(vec4( r.r * d, r.g, r.b, 1.0), baseColor);\n#else\n        vec4 color = texture2D(tex, p.xy);\n        color.a *= d;\n        if (boostLight) {\n            return mixBaseColor(vec4(sqrt(color.rgb), color.a), baseColor);\n        } else {\n            return mixBaseColor(color, baseColor);\n        }\n#endif\n\n        }\n    }\n    return mixBaseColor(vec4(0.), baseColor);\n}\n",project_pars_vertex:"\nattribute vec3 position;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n",WebGL2_pars_vertex:"\n#if defined(WEBGL2)\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\n",WebGL2_pars_fragment:"\n#if defined(WEBGL2)\n#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n#endif\n",install:function(e,t,n){return n?(Object.keys(t).forEach((function(i){"install"!=i&&(e[n+i]=t[i])})),e):Object.assign(e,this)}};zT.install(Vi,zT,"itowns/");var VT=new Sx("EPSG:4326",[0,0,0,0]);function jT(e,t,n,i,r,a,o,s){e.beginPath();var A,l=C(n);try{for(l.s();!(A=l.n()).done;){var c=A.value;if(c.extent&&c.extent.intersectsExtent(a)){var h=c.offset*r,u=h+c.count*r;e.moveTo(t[h],t[h+1]);for(var d=h+r;d<u;d+=r)e.lineTo(t[d],t[d+1])}}}catch(e){l.e(e)}finally{l.f()}i.stroke&&(!function(e,t,n){t.strokeStyle!==e.stroke.color&&(t.strokeStyle=e.stroke.color);var i=(e.stroke.width||2)*n;t.lineWidth!==i&&(t.lineWidth=i);var r=null==e.stroke.opacity?1:e.stroke.opacity;r!==t.globalAlpha&&"number"==typeof r&&(t.globalAlpha=r);t.lineCap!==e.stroke.lineCap&&(t.lineCap=e.stroke.lineCap);t.setLineDash(e.stroke.dasharray.map((function(e){return e*n*2})))}(i,e,o),e.stroke()),s&&i.fill&&(!function(e,t,n){e.fill.pattern&&t.fillStyle.src!==e.fill.pattern.src?(t.fillStyle=t.createPattern(e.fill.pattern,"repeat"),t.fillStyle.setTransform?t.fillStyle.setTransform(matrix.scale(n)):console.warn("Raster pattern isn't completely supported on Ie and edge")):t.fillStyle!==e.fill.color&&(t.fillStyle=e.fill.color);e.fill.opacity!==t.globalAlpha&&(t.globalAlpha=e.fill.opacity)}(i,e,o),e.fill())}function WT(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0;e.beginPath();var a=null==i.point.opacity?1:i.point.opacity;a!==e.globalAlpha&&(e.globalAlpha=a),e.arc(t,n,(i.point.radius||3)*r,0,2*Math.PI,!1),i.point.color&&(e.fillStyle=i.point.color,e.fill()),i.point.line&&(e.lineWidth=(i.point.width||1)*r,e.strokeStyle=i.point.line,e.stroke())}document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();var XT=new ux("EPSG:4326",0,0,0);function ZT(e,t,n,i,r){var a,o=n.dimensions().x/e.canvas.width,s={zoom:n.zoom},A=C(t.geometries);try{var l=function(){var A=a.value;if(A.extent.intersectsExtent(n)){var l={globals:s,properties:function(){return A.properties}},c=(A.properties.style||i).drawingStylefromContext(l);if(c)if(t.type===bC.POINT){var h,u=(Math.round(c.point.radius*r)||3*r)*o,d=C(A.indices);try{for(d.s();!(h=d.n()).done;)for(var f=h.value,p=f.offset*t.size,m=p+f.count*t.size,g=p;g<m;g+=t.size)XT.setFromArray(t.vertices,g),n.isPointInside(XT,u)&&WT(e,t.vertices[g],t.vertices[g+1],c,r)}catch(e){d.e(e)}finally{d.f()}}else!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{offset:0,count:1}],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;if(0!==t.length)if(i.length){var A,l=C(i);try{for(l.s();!(A=l.n()).done;){jT(e,t,n,A.value,r,a,o,s)}}catch(e){l.e(e)}finally{l.f()}}else jT(e,t,n,i,r,a,o,s)}(e,t.vertices,A.indices,c,t.size,n,r,t.type==bC.POLYGON)}};for(A.s();!(a=A.n()).done;)l()}catch(e){A.e(e)}finally{A.f()}}var YT=new Je,KT=new Je,JT=new Je,qT=new Sx("EPSG:4326",0,0,0,0),$T=function(e,t,n,i,r){var a;if(e){t.dimensions(KT);var o=document.createElement("canvas");XT.crs=t.crs,o.width=n,o.height=n;var s=o.getContext("2d");r&&(s.fillStyle=r.getStyle(),s.fillRect(0,0,n,n)),s.globalCompositeOperation=i.globalCompositeOperation||"source-over",s.imageSmoothingEnabled=!1,s.lineJoin="round";var A=e.crs==t.crs?t:t.as(e.crs,VT),l=e.translation,c=e.scale;qT.transformedCopy(l,c,A),JT.set(s.canvas.width,s.canvas.width).divide(KT),YT.set(t.west,t.south).add(l).multiply(JT).negate(),s.setTransform(JT.x/c.x,0,0,JT.y/c.y,YT.x,YT.y);var h,u=c.x/JT.x,d=C(e.features);try{for(d.s();!(h=d.n()).done;){var f=h.value;ZT(s,f,qT,f.style||i,u)}}catch(e){d.e(e)}finally{d.f()}(a=new Ko(o)).flipY=!1}else if(r){var p=new Uint8Array(3);p[0]=255*r.r,p[1]=255*r.g,p[2]=255*r.b,a=new Gi(p,1,1,ae)}else a=new st;return a},eL=new Sx("EPSG:4326",[0,0,0,0]),tL=function(e){return e.generateMipmaps=!1,e.magFilter=W,e.minFilter=W,e};var nL=function(e,t,n){var i;if(e.isFeatureCollection){var r=n.source.backgroundLayer,a=r&&r.paint?new Sn(r.paint["background-color"]):void 0;t.as(ix.formatToEPSG(n.crs),eL),(i=$T(e,eL,256,n.style,a)).features=e,i.extent=t}else{if(!e.isTexture)throw new Error("Data type is not supported to convert into texture");i=e}return n.isColorLayer?function(e,t){return e.anisotropy=16,e.premultiplyAlpha=t,tL(e)}(i,n.transparent):n.isElevationLayer?(i.flipY&&(i.flipY=!1),tL(i)):void 0},iL=function(e){A(n,e);var t=p(n);function n(e,i){return r(this,n),i.cacheLifeTime=null==i.cacheLifeTime?$b.TEXTURE:i.cacheLifeTime,t.call(this,e,i)}return o(n,[{key:"convert",value:function(e,t){return nL(e,t,this)}},{key:"delete",value:function(){var e,t=C(this.parent.level0Nodes);try{for(t.s();!(e=t.n()).done;){e.value.traverse(qS(this.id))}}catch(e){t.e(e)}finally{t.f()}}}]),n}(yB),rL=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),(i=t.call(this,e,a)).isColorLayer=!0,i.style=new pC(a.style),i.defineLayerProperty("visible",!0),i.defineLayerProperty("opacity",1),i.defineLayerProperty("sequence",0),i.transparent=a.transparent||i.opacity<1,i.noTextureParentOutsideLimit=!!a.source&&a.source.isFileSource,i.fx=a.fx||0,i.buildExtent=!0,i.structure="2d",i}return o(n,[{key:"setupRasterNode",value:function(e){var t=new zb(e.material,this);return e.material.addLayer(t),e.material.setSequence(this.parent.colorLayersOrder),t}},{key:"update",value:function(e,t,n,i){return function(e,t,n,i){var r=n.material;if(i&&r){var a=n.getExtentsByProjection(t.crs),o=a[0].zoom;if(!(o>t.zoom.max||o<t.zoom.min)){var s=r.getLayer(t.id);if(void 0===n.layerUpdateState[t.id]){if(n.layerUpdateState[t.id]=new FI,!t.source.extentInsideLimit(n.extent,o)&&(t.noTextureParentOutsideLimit||!i.material||!i.material.getLayer||!i.material.getLayer(t.id)))return void n.layerUpdateState[t.id].noMoreUpdatePossible();if(!s){s=t.setupRasterNode(n);var A=i.material&&i.material.getLayer(t.id);s.initFromParent(A,a)}if(s.level>=t.source.zoom.min)return void e.view.notifyChange(n,!1)}if(r.visible&&t.visible&&n.layerUpdateState[t.id].canTryUpdate())if(s.level>=a[0].zoom)n.layerUpdateState[t.id].noMoreUpdatePossible();else if(!t.frozen){var l=n.layerUpdateState[t.id].failureParams,c=a[0].zoom||n.level,h=Yb(t.updateStrategy.type,n,c,s.level,t,l);if(!(!t.source.isVectorSource&&h<=s.level||h>c)){if(!t.source.extentInsideLimit(n.extent,h))return n.layerUpdateState[t.id].noData({targetLevel:h}),void e.view.notifyChange(n,!1);var u=a.map((function(e){return e.tiledExtentParent(h)}));n.layerUpdateState[t.id].newTry();var d=JS(e.view,t,u,a,n);return e.scheduler.execute(d).then((function(e){var i=a.map((function(t,n){return t.offsetToParent(e[n].extent,s.offsetScales[n])}));s.setTextures(e,i),n.layerUpdateState[t.id].success()}),(function(i){return ZS(i,n,t,h,e.view)}))}l.lowestLevelError!=1/0&&n.layerUpdateState[t.id].noMoreUpdatePossible()}}}}(e,this,n,i)}}]),n}(iL),aL=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,n),(i=t.call(this,e,a)).isElevationLayer=!0;var o=1;return i.useColorTextureElevation&&(o=i.colorTextureElevationMaxZ-i.colorTextureElevationMinZ),i.defineLayerProperty("scale",i.scale||1,(function(e){e.parent.object3d.traverse((function(t){t.layer==e.parent&&t.material&&(t.material.setElevationScale(e.scale*o),t.obb.updateScaleZ(e.scale))}))})),i}return o(n,[{key:"setupRasterNode",value:function(e){var t=this,n=new Vb(e.material,this);e.material.addLayer(n),e.material.setSequenceElevation(this.id);var i=function(){return e.setBBoxZ(n.min,n.max,t.scale)};return i(),n.addEventListener("updatedElevation",i),n}},{key:"update",value:function(e,t,n,i){return function(e,t,n,i){var r=n.material;if(i&&r){var a=n.getExtentsByProjection(t.crs),o=a[0].zoom;if(!(o>t.zoom.max||o<t.zoom.min)){var s=r.getElevationLayer();if(s||(s=t.setupRasterNode(n)),void 0===n.layerUpdateState[t.id]){n.layerUpdateState[t.id]=new FI;var A=i.material&&i.material.getLayer(t.id);if(s.initFromParent(A,a),s.level>=t.source.zoom.min)return void e.view.notifyChange(n,!1)}if(!t.frozen&&r.visible&&n.layerUpdateState[t.id].canTryUpdate()){var l=n.layerUpdateState[t.id].failureParams,c=Yb(t.updateStrategy.type,n,a[0].zoom,s.level,t,l);if(!(c<=s.level||c>a[0].zoom)){if(!t.source.extentInsideLimit(n.extent,c))return n.layerUpdateState[t.id].noData({targetLevel:c}),void e.view.notifyChange(n,!1);var h=a.map((function(e){return e.tiledExtentParent(c)}));n.layerUpdateState[t.id].newTry();var u=JS(e.view,t,h,a,n);return e.scheduler.execute(u).then((function(e){if(c<=s.level)n.layerUpdateState[t.id].noMoreUpdatePossible();else{var i=a.map((function(t,n){return t.offsetToParent(e[n].extent,s.offsetScales[n])}));s.setTextures(e,i),n.layerUpdateState[t.id].success()}}),(function(i){return ZS(i,n,t,c,e.view)}))}n.layerUpdateState[t.id].noMoreUpdatePossible()}}}}(e,this,n,i)}}]),n}(iL),oL=new xi,sL=new Jt;oL.geometry.boundingBox=sL;var AL=new xi,lL=new Jt;function cL(e,t,n,i,r,a){var o={view:e,requester:r,layer:n,priority:r?1/(r.distance+1):100,metadata:i,redraw:a};return t.execute(o)}function hL(e){return e.children.filter((function(t){return t.layer==e.layer&&t.tileId}))}function uL(e,t,n,r){n.additiveRefinement?function(e,t,n,i){var r,a=C(t.tileset.tiles[n.tileId].children);try{var o=function(){var a=r.value;if(a.promise||a.loaded)return"continue";var o=n.matrixWorld;if(a.transform&&(o=mL.multiplyMatrices(n.matrixWorld,a.transform)),!(!i||!i(t,e.camera,a,o)))return"continue";a.promise=cL(e.view,e.scheduler,t,a,n,!0).then((function(i){n.add(i),i.updateMatrixWorld();var r=pL(t.extent.crs,i.boundingVolume,i.matrixWorld);i.traverse((function(e){e.extent=r})),t.onTileContentLoaded(i),e.view.notifyChange(a),a.loaded=!0,delete a.promise}))};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}(e,t,n,r):function(e,t,n){if(!n.pendingSubdivision&&0==hL(n).length){var r=function(){var i=t.tileset.tiles[n.tileId].children;if(null==i||0===i.length)return{v:void 0};n.pendingSubdivision=!0;for(var r=[],a=function(a){r.push(cL(e.view,e.scheduler,t,i[a],n,!1).then((function(r){i[a].loaded=!0,n.add(r),r.updateMatrixWorld(),n.additiveRefinement&&e.view.notifyChange(n),t.tileset.tiles[r.tileId].loaded=!0,t.onTileContentLoaded(r)})))},o=0;o<i.length;o++)a(o);Promise.all(r).then((function(){n.pendingSubdivision=!1,e.view.notifyChange(n)}))}();if("object"===i(r))r.v}}(e,t,n)}AL.geometry.boundingBox=lL;var dL=new Jt,fL=new en;function pL(e,t,n){if(t.region){var i=dL.copy(t.region.box3D).applyMatrix4(t.region.matrixWorld);return Sx.fromBox3(e,i)}if(t.box){var r=dL.copy(t.box).applyMatrix4(n);return Sx.fromBox3(e,r)}var a=fL.copy(t.sphere).applyMatrix4(n);return new Sx(e,{west:a.center.x-a.radius,east:a.center.x+a.radius,south:a.center.y-a.radius,north:a.center.y+a.radius})}var mL=new vt;function gL(e,t,n,i){return!(!n.viewerRequestVolume||!n.viewerRequestVolume.viewerRequestVolumeCulling(t,i))||!(!n.boundingVolume||!n.boundingVolume.boundingVolumeCulling(t,i))}function vL(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=t.additiveRefinement||n>0,r=0;r<t.children.length;r++)t.children[r].content?vL(e,t.children[r],n+1):i&&t.children[r].traverse(yL);if(i)t.dispose&&t.dispose(),delete t.content,e.tileset.tiles[t.tileId].loaded=!1,t.remove.apply(t,y(t.children)),0==n&&t.parent&&t.parent.remove(t);else{var a=hL(t);t.remove.apply(t,y(a))}}function yL(e){var t,n=C(e.children);try{for(n.s();!(t=n.n()).done;){yL(t.value)}}catch(e){n.e(e)}finally{n.f()}if(e.material)if(Array.isArray(e.material)){var i,r=C(e.material);try{for(r.s();!(i=r.n()).done;){i.value.dispose()}}catch(e){r.e(e)}finally{r.f()}}else e.material.dispose();e.geometry&&e.geometry.dispose(),e.remove.apply(e,y(e.children))}function wL(){if(!this.visible)return[];var e=Date.now();if(this._cleanableTiles.length&&e-this._cleanableTiles[0].cleanableSince>this.cleanupDelay){this.root.cleanableSince=void 0;for(var t=0;t<this._cleanableTiles.length;t++){var n=this._cleanableTiles[t];if(!(e-n.cleanableSince>this.cleanupDelay))break;vL(this,n)}this._cleanableTiles.splice(0,t)}return[this.root]}var xL=new Jt,bL=new en;function CL(e,t){e.content&&(e.content.visible=t)}function ML(e,t){t.cleanableSince||(t.cleanableSince=Date.now(),e._cleanableTiles.push(t))}function BL(e,t,n){return void 0!==t.tileset.tiles[n.tileId].children&&(!!t.tileset.tiles[n.tileId].isTileset||function(e,t){if(t.distance=0,t.boundingVolume.region)xL.copy(t.boundingVolume.region.box3D),xL.applyMatrix4(t.boundingVolume.region.matrixWorld),t.distance=xL.distanceToPoint(e.camera3D.position);else if(t.boundingVolume.box)xL.copy(t.boundingVolume.box),xL.applyMatrix4(t.matrixWorld),t.distance=xL.distanceToPoint(e.camera3D.position);else{if(!t.boundingVolume.sphere)return 1/0;bL.copy(t.boundingVolume.sphere),bL.applyMatrix4(t.matrixWorld),t.distance=Math.max(0,bL.distanceToPoint(e.camera3D.position))}return 0===t.distance?1/0:e._preSSE*(t.geometricError/t.distance)}(e.camera,n)>t.sseThreshold)}var IL=new vt,EL=new tt,SL=new tt,TL=new Sx("EPSG:4326",0,0,0,0),LL=new tt,FL=new tt,_L=function(){function e(t,n,i){if(r(this,e),this.type=$B,t.region)this.initBoundingRegion(t.region,n);else if(t.box)this.initBoundingBox(t.box);else{if(!t.sphere)throw new Error("3D Tiles nodes must have a bounding volume");this.initBoundingSphere(t.sphere)}t.extensions&&(this.extensions=i.parseExtensions(t.extensions,this.type))}return o(e,[{key:"initBoundingRegion",value:function(e,t){TL.set(Oh.radToDeg(e[0]),Oh.radToDeg(e[2]),Oh.radToDeg(e[1]),Oh.radToDeg(e[3]));var n=new SE;n.setFromExtent(TL),n.updateZ(e[4],e[5]),n.matrix.premultiply(t),n.matrix.decompose(n.position,n.quaternion,n.scale),this.region=n}},{key:"initBoundingBox",value:function(e){EL.set(e[0],e[1],e[2]),SL.set(e[3],e[7],e[11]).multiplyScalar(2),this.box=new Jt,this.box.setFromCenterAndSize(EL,SL)}},{key:"initBoundingSphere",value:function(e){LL.set(e[0],e[1],e[2]),this.sphere=new en(LL,e[3])}},{key:"boundingVolumeCulling",value:function(e,t){return!(!this.region||e.isBox3Visible(this.region.box3D,IL.multiplyMatrices(t,this.region.matrix)))||(!(!this.box||e.isBox3Visible(this.box,t))||this.sphere&&!e.isSphereVisible(this.sphere,t))}},{key:"viewerRequestVolumeCulling",value:function(e,t){return this.region?(console.warn("Region viewerRequestVolume not yet supported"),!0):this.box?(console.warn("Bounding box viewerRequestVolume not yet supported"),!0):!(!this.sphere||(FL.copy(this.sphere.center),FL.applyMatrix4(t),e.camera3D.position.distanceTo(FL)<=this.sphere.radius))}}]),e}(),UL=new vt,PL=function(){function e(t,n,i){r(this,e),this.type=JB,this.asset=t.asset,this.properties=t.properties,this.geometricError=t.geometricError,this.extensionsUsed=t.extensionsUsed,this.extensionsRequired=t.extensionsRequired,this.tiles=[],this.parseTiles(t.root,n,void 0,i),t.extensions&&(this.extensions=i.parseExtensions(t.extensions,this.type))}return o(e,[{key:"parseTiles",value:function(e,t,n,i){if(e.transform=e.transform?(new vt).fromArray(e.transform):void 0,e._worldFromLocalTransform=e.transform,n&&n._worldFromLocalTransform&&(e.transform?e._worldFromLocalTransform=(new vt).multiplyMatrices(n._worldFromLocalTransform,e.transform):e._worldFromLocalTransform=n._worldFromLocalTransform),(e.viewerRequestVolume&&e.viewerRequestVolume.region||e.boundingVolume&&e.boundingVolume.region)&&(e._worldFromLocalTransform?UL.copy(e._worldFromLocalTransform).invert():UL.identity()),e.viewerRequestVolume=e.viewerRequestVolume?new _L(e.viewerRequestVolume,UL,i):void 0,e.boundingVolume=e.boundingVolume?new _L(e.boundingVolume,UL,i):void 0,this.tiles.push(e),e.tileId=this.tiles.length-1,e.baseURL=t,e.children){var r,a=C(e.children);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.parseTiles(o,t,e,i)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"extendTileset",value:function(e,t,n,i){this.parseTiles(e.root,n,this.tiles[t],i),this.tiles[t].children=[e.root],this.tiles[t].isTileset=!0}}]),e}(),kL=function(){function e(){r(this,e)}return o(e,[{key:"registerExtension",value:function(e,t){this[e]=t}},{key:"getExtension",value:function(e,t){if(this[e]&&this[e][t])return this[e][t];console.error("".concat("No extension manager registered for extension "," ").concat(e," and for class ").concat(t))}},{key:"isExtensionRegistered",value:function(e){return this[e]}},{key:"parseExtensions",value:function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=new(this.getExtension(i,t))(e[i]));return n}}]),e}(),DL=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gL,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BL;return function(n,i,r){if(!r.parent.pendingSubdivision||r.parent.additiveRefinement){var a=!e||!e(i,n.camera,r,r.matrixWorld);if(r.visible=a,a){var o;if(r.cleanableSince&&(i._cleanableTiles.splice(i._cleanableTiles.indexOf(r),1),r.cleanableSince=void 0),r.pendingSubdivision||t(n,i,r))uL(n,i,r,e),CL(r,r.pendingSubdivision||r.additiveRefinement),o=hL(r);else{CL(r,!0);var s,A=C(hL(r));try{for(A.s();!(s=A.n()).done;){var l=s.value;l.visible=!1,ML(i,l)}}catch(e){A.e(e)}finally{A.f()}}return o}ML(i,r)}else r.visible=!1}}(),RL=function(e){A(n,e);var t=p(n);function n(e,i,a){var o;r(this,n),(o=t.call(this,e,new Ha,{source:i.source})).isC3DTilesLayer=!0,o.sseThreshold=i.sseThreshold||16,o.cleanupDelay=i.cleanupDelay||1e3,o.onTileContentLoaded=i.onTileContentLoaded||function(){},o.protocol="3d-tiles",o.overrideMaterials=void 0===i.overrideMaterials||i.overrideMaterials,o.name=i.name,o.registeredExtensions=i.registeredExtensions||new kL,o._cleanableTiles=[];var s=o.addInitializationStep();return o.source.whenReady.then((function(e){if(o.tileset=new PL(e,o.source.baseUrl,o.registeredExtensions),o.tileset.extensionsUsed){var t,n=C(o.tileset.extensionsUsed);try{for(n.s();!(t=n.n()).done;){var i=t.value;o.registeredExtensions.isExtensionRegistered(i)||(o.tileset.extensionsRequired&&o.tileset.extensionsRequired.includes(i)?console.error('3D Tiles tileset required extension "'.concat(i,'" must be registered to the 3D Tiles layer of iTowns to be parsed and used.')):console.warn('3D Tiles tileset used extension "'.concat(i,'" must be registered to the 3D Tiles layer of iTowns to be parsed and used.')))}}catch(e){n.e(e)}finally{n.f()}}(function(e,t,n,i){return cL(e,t,n,i,void 0,!0).then((function(t){n.object3d.add(t),t.updateMatrixWorld(),n.tileset.tiles[t.tileId].loaded=!0,n.root=t,n.extent=pL(n.crs||e.referenceCrs,t.boundingVolume,t.matrixWorld),n.onTileContentLoaded(t)}))})(a,a.mainLoop.scheduler,d(o),e.root).then(s)})),o}return o(n,[{key:"preUpdate",value:function(){return wL.bind(this)()}},{key:"update",value:function(e,t,n){return DL(e,t,n)}},{key:"getObjectToUpdateForAttachedLayers",value:function(e){if(e.content){var t=[];e.content.traverse((function(n){n.isObject3D&&n.material&&n.layer==e.layer&&t.push(n)}));var n=e.parent;return n&&n.content?{elements:t,parent:n.content}:{elements:t}}}},{key:"findBatchTable",value:function(e){return e.batchTable?e.batchTable:e.parent?this.findBatchTable(e.parent):void 0}},{key:"getInfoFromIntersectObject",value:function(e){for(var t={},n=-1,i={},r=0;r<e.length;r++){var a=e[r].object.geometry.attributes;if(a&&a._BATCHID){var o=e[r].face.a;n=a._BATCHID.array[o],i=this.findBatchTable(e[r].object);break}}if(-1!==n)return t.batchID=n,Object.assign(t,i.getInfoById(n)),t}}]),n}(HS);(new vt).set(1,0,0,1,0,1,0,1,0,0,2,0,0,0,0,2),new Gi(new Uint8Array([255,255,255]),1,1,ae,Y),new st,new uA,new KA,new rt,new ux("EPSG:4978",0,0,0);var OL=new xi,NL=new Jt;OL.geometry.boundingBox=NL;new Sx("EPSG:4326",[0,0,0,0]);var GL=0;function QL(e){var t=/\$\{u:([\w-_.|]+)\}/.exec(e);if(!t)return e;var n=t[1].split("|");return e.replace(t[0],n[GL++%n.length])}for(var HL=function(e,t){return QL(t.url.replace(/(\$\{z\}|%TILEMATRIX)/,e.zoom).replace(/(\$\{y\}|%ROW)/,e.row).replace(/(\$\{x\}|%COL)/,e.col))},zL=new Sx(ix.tms_4326,0,0,0),VL=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),e.crs=e.crs||"EPSG:3857",!e.crs&&!e.projection)throw new Error("New TMSSource/WMTSSource: crs projection is required");if(e.format=e.format||"image/png",(i=t.call(this,e)).isTMSSource=!0,e.extent||(i.extent=Mx.get(e.crs)),i.zoom=e.zoom||{min:1,max:18},i.isInverted=e.isInverted||!1,i.url=e.url,i.crs=ix.formatToTms(e.crs),i.tileMatrixSetLimits=e.tileMatrixSetLimits,i.extentSetlimits={},!i.zoom)if(i.tileMatrixSetLimits){var a=Object.keys(i.tileMatrixSetLimits),o=a.length,s=Number(a[o-1]),A=s-o+1;i.zoom={min:A,max:s}}else i.zoom={min:0,max:1/0};return i}return o(n,[{key:"urlFromExtent",value:function(e){return HL(e,this)}},{key:"onLayerAdded",value:function(e){g(l(n.prototype),"onLayerAdded",this).call(this,e);var t=e.out.parent,i=t?t.extent.crs:e.out.crs;if(this.tileMatrixSetLimits&&!this.extentSetlimits[i]){this.extentSetlimits[i]={},zL.crs=this.crs;for(var r=this.zoom.max;r>=this.zoom.min;r--){var a=this.tileMatrixSetLimits[r],o=zL.set(r,a.minTileRow,a.minTileCol).as(i),s=o.west,A=o.north,c=zL.set(r,a.maxTileRow,a.maxTileCol).as(i),h=c.east,u=c.south;this.extentSetlimits[i][r]=new Sx(i,s,h,u,A)}}}},{key:"extentInsideLimit",value:function(e,t){return t>=this.zoom.min&&t<=this.zoom.max&&(null==this.extentSetlimits[e.crs]||this.extentSetlimits[e.crs][t].intersectsExtent(e))}}]),n}(vB),jL=function(e){A(n,e);var t=p(n);function n(e){var i;if(r(this,n),!e.name)throw new Error("New WMTSSource: name is required");return(i=t.call(this,e)).isWMTSSource=!0,i.url="".concat(i.url)+"?LAYER=".concat(e.name)+"&FORMAT=".concat(i.format)+"&SERVICE=WMTS"+"&VERSION=".concat(e.version||"1.0.0")+"&REQUEST=GetTile"+"&STYLE=".concat(e.style||"normal")+"&TILEMATRIXSET=".concat(e.tileMatrixSet)+"&TILEMATRIX=%TILEMATRIX&TILEROW=%ROW&TILECOL=%COL",void 0!==e.tk&&(i.url+="&tk="+e.tk),i}return n}(VL),WL={POSITION_CARTESIAN:{numElements:3,arrayType:Float32Array,attributeName:"position"},COLOR_PACKED:{numElements:4,arrayType:Uint8Array,attributeName:"color",normalized:!0},INTENSITY:{numElements:1,numByte:2,arrayType:Uint16Array,attributeName:"intensity",normalized:!0},CLASSIFICATION:{numElements:1,arrayType:Uint8Array,attributeName:"classification",normalized:!0},NORMAL_SPHEREMAPPED:{numElements:2,arrayType:Uint8Array,attributeName:"sphereMappedNormal"},NORMAL_OCT16:{numElements:2,arrayType:Uint8Array,attributeName:"oct16Normal"},NORMAL:{numElements:3,arrayType:Float32Array,attributeName:"normal"}},XL=function(){var e=YL[ZL],t=WL[e];t.potreeName=e,t.numByte=t.numByte||t.arrayType.BYTES_PER_ELEMENT,t.byteSize=t.numElements*t.numByte,t.normalized=t.normalized||!1;var n="getUint".concat(8*t.numByte);t.getValue=1===t.numByte?function(e,t){return e[n](t)}:function(e,t){return e[n](t,!0)}},ZL=0,YL=Object.keys(WL);ZL<YL.length;ZL++)XL();var KL=function(e){A(n,e);var t=p(n);function n(e){var i;return r(this,n),(i=t.call(this,e)).baseUrl=i.url.slice(0,i.url.lastIndexOf("/")+1),i.whenReady=oC.json(i.url,i.networkOptions),i}return n}(vB),JL=function(){function e(t){r(this,e),this.classes=t.classes,this.inverseHierarchy={},this.instancesIdxs=[];var n={},i=0,a=t.parentCounts;void 0===a&&(a=new Array(t.instancesLength)).fill(1);for(var o=0;o<t.instancesLength;o++){for(var s=0;s<a[o];s++)o!==t.parentIds[i]&&(void 0===this.inverseHierarchy[o]&&(this.inverseHierarchy[o]=[]),this.inverseHierarchy[o].push(t.parentIds[i]),i++);var A=t.classIds[o];void 0===n[A]&&(n[A]=0),this.instancesIdxs[o]={classId:A,instanceIdx:n[A]},n[A]++}}return o(e,[{key:"getInfoById",value:function(e){var t={},n=this.instancesIdxs[e].classId,i=this.classes[n].name,r=this.instancesIdxs[e].instanceIdx,a=this.classes[n].instances;for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o][r]);var s={};if(s[i]=t,this.inverseHierarchy&&this.inverseHierarchy[e]){var A,l=C(this.inverseHierarchy[e]);try{for(l.s();!(A=l.n()).done;){var c=A.value;Object.assign(s,this.getInfoById(c))}}catch(e){l.e(e)}finally{l.f()}}return s}}]),e}(),qL={imagery:{id:"GaoDe_imagery",source:{crs:"EPSG:3857",isInverted:!0,format:"image/png",url:"https://webst02.is.autonavi.com/appmaptile?style=6&x=${x}&y=${y}&z=${z}",tileMatrixSet:"w",zoom:{min:1,max:18},type:"TMS"}},imageryLabel:{id:"GaoDe_imageryLabel",source:{url:"https://webst02.is.autonavi.com/appmaptile?style=8&x=${x}&y=${y}&z=${z}",crs:"EPSG:3857",format:"tiles",tk:"a7fbb569ae07158a0350f2952b4ee2a1",style:"default",zoom:{min:1,max:18},name:"cia",tileMatrixSet:"w",type:"TMS"}},vector:{id:"GaoDe_vector",source:{crs:"EPSG:3857",isInverted:!0,format:"image/png",url:"https://webst02.is.autonavi.com/appmaptile?style=7&x=${x}&y=${y}&z=${z}",tileMatrixSet:"PM",zoom:{min:1,max:18},type:"TMS"}}},$L={coord:[108.5525,34.3227],range:10204904,tilt:90,heading:.001},eF=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),Dt.DefaultUp.set(0,0,1),window.__DEBUG__=!1,a.logarithmicDepthBuffer=!0,(i=t.call(this,e,a)).options=a,i.isGISViewer=!0,i}return o(n,[{key:"initialize",value:function(e){g(l(n.prototype),"initialize",this).call(this,e),this.camera.frustumCulled=!0,this.scene.background=null,this.renderer.setClearAlpha(1),this.defaultView=$L,this.globe=new CT(this.container,this.defaultView,{camera:this.camera,renderer:this.renderer,scene3D:this.scene}),this.globe.render=this.renderManager.render,this.controls=this.globe.controls,this.viewMode=Vf.GLOBE,this.controlsMap={},this.controlsMap[Vf.GLOBE]=this.controls,this.camera.near=.1,this.camera.updateProjectionMatrix(),xf.bindAll(["onUpdate","_onGlobeComplete"],this),this.onGlebeComplete=!1,this.controls.enabled=!1,this.globe.addEventListener(bT.GLOBE_INITIALIZED,this._onGlobeComplete),setTimeout(this._onGlobeComplete,2e3),this.mapCenter=this.coordinatesToVector3(e.view?e.view.coord:$L.coord),this.addEventListener("update",this.onUpdate),this.initLayer()}},{key:"_onGlobeComplete",value:function(){this.controls.enabled=!0,this.onGlebeComplete||(this.dispatchEvent(Xu.MAP_INIT),this.options.view&&(this.defaultView=this.options.view,this.controls.flyTo(this.defaultView)),this.onGlebeComplete=!0)}},{key:"initLayer",value:function(){this.imageLayer=this.loadColorLayer(qL.imagery),this.labelLayer=this.loadColorLayer(qL.imageryLabel)}},{key:"addModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{noFit:!0};return g(l(n.prototype),"addModel",this).call(this,e,t)}},{key:"loadModel",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.onLoad;return i.noSky=!0,i.focus=!1,i.background=!1,i.addModel=!1,i.onLoad=function(e){var n=new Ha;if(n.name="modelBox",n.isModelBox=!0,t.modelGroup.add(n),!i.coord&&e.coordinate&&2===e.coordinate.split(",").length){var a=e.coordinate.split(",");i.coord=[Number(a[1]),Number(a[0])]}i.coord&&(i.coord.isVector3?n.position.copy(i.coord):Array.isArray(i.coord)?3===i.coord.length?n.position.fromArray(i.coord):2===i.coord.length&&n.position.copy(t.coordinatesToVector3(i.coord)):i.coord.isCoordinates&&n.position.copy(t.coordinatesToVector3(i.coord)));var o=n.position.clone().normalize().add(n.position);e.isModel&&(e.position.y+=e.getSize().y/2),n.lookAt(o),n.rotateX(Math.PI/2),n.add(e),r&&r(e)},g(l(n.prototype),"loadModel",this).call(this,e,i)}},{key:"loadColorLayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;"WMTS"===e.source.type?e.source=new jL(e.source):"TMS"===e.source.type&&(e.source=new VL(e.source));var n=new rL(e.id,e);return this.globe.addLayer(n).then((function(){t&&t()})),n}},{key:"removeLayerById",value:function(e){this.globe.removeLayer(e)}},{key:"getLayerById",value:function(e){return this.globe.getLayerById(e)}},{key:"getLayers",value:function(){return this.globe.getLayers().splice(2)}},{key:"load3DTiles",value:function(e,t){var n=new kL;n.registerExtension("3DTILES_batch_table_hierarchy",s({},qB,JL));var i=new RL("3d-tiles-bt-hierarchy",{name:"BTHierarchy",source:new KL(e),registeredExtensions:n},this.globe);return tE.prototype.addLayer.call(this.globe,i).then(t),i}},{key:"coordinatesToVector3",value:function(e){return Array.isArray(e)&&(e=new ux("EPSG:4326",e[0],e[1])),e.as(this.globe.referenceCrs).toVector3()}},{key:"vector3ToCoordinates",value:function(e){var t=new ux("EPSG:4978").setFromVector3(e).as("EPSG:4326");return[t.longitude,t.latitude]}},{key:"pickPosition",value:function(e){return this.globe.getPickingPositionFromDepth(this.globe.eventToViewCoords(e))}},{key:"pickCoordinates",value:function(e,t){return this.globe.pickCoordinates(e,t)}},{key:"computeDistance",value:function(e,t){return e.isVector3&&(e=this.vector3ToCoordinates(e)),t.isVector3&&(t=this.vector3ToCoordinates(t)),e.isCoordinates&&(e=[e.x,e.y]),t.isCoordinates&&(t=[t.x,t.y]),xf.computeDistance(e,t)}},{key:"getObjectCoord",value:function(e){return this.vector3ToCoordinates(e.getWorldPosition(new tt))}},{key:"setObjectCoord",value:function(e,t){e&&e.position.copy(this.coordinatesToVector3(t))}},{key:"setViewMode",value:function(e){if(this.viewMode!==e){switch(this.viewMode=e,this.controls.enabled=!1,e){case Vf.GLOBE:this.controls=this.globe.controls=this.controlsMap[Vf.GLOBE];break;case Vf.ROAM_FREE:this.controls=this.globe.controls=this.controlsMap[Vf.ROAM_FREE]||new HT(this.globe);break;case Vf.FLY:this.controls=this.globe.controls=this.controlsMap[Vf.FLY]||new _T(this.globe)}this.controls.enabled=!0}}},{key:"fitCamera",value:function(){}},{key:"_initControls",value:function(){this.camera.defaultPos=this.camera.position.clone()}},{key:"_proxyEvent",value:function(){var e=this;this.renderManager.addEventListener(Xu.UPDATE,(function(){e.dispatchEvent(Xu.UPDATE)})),this.modelManager.addEventListener(Xu.MODEL_UPDATE,(function(){e.dispatchEvent(Xu.MODEL_UPDATE)}))}},{key:"_addElevationLayer",value:function(){var e=this,t=function(t){t.source=new jL(t.source);var n=new aL(t.id,t);e.globe.addLayer(n)};oC.json("./layers/JSONLayers/WORLD_DTM.json").then(t),oC.json("./layers/JSONLayers/IGN_MNT_HIGHRES.json").then(t)}},{key:"getCoordsByAddress",value:function(e,t){var n=this;tu.getCoordsByAddress(e,(function(e){var i=e.bound.split(",");e.range=n.computeDistance([Number(i[0]),Number(i[1])],[Number(i[2]),Number(i[3])]),t(e.coord,e.range)}))}},{key:"positioning",value:function(e,t){var n=this;this.controls.flyTo($L).then((function(){n.controls.flyTo({coord:e,tilt:90,heading:.001,range:t})}))}},{key:"onUpdate",value:function(){}},{key:"dispose",value:function(){this.globe.dispose(),g(l(n.prototype),"dispose",this).call(this)}}]),n}(zg);function tF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;Dt.call(this),this.name="BoxClippingHelper",this.box=e,this.boxSize=new tt,this.line=new Eh(e,t),this.add(this.line);var n=new Li(1,1,1);this.mesh=new xi(n,new kn({transparent:!0,opacity:.25,color:t})),this.box.getSize(this.boxSize),this.mesh.scale.set(this.boxSize.x,this.boxSize.y,this.boxSize.z),this.box.getCenter(this.mesh.position),this.add(this.mesh)}tF.prototype=Object.create(Dt.prototype),tF.prototype.update=function(){this.box.getSize(this.boxSize),this.mesh.scale.set(this.boxSize.x,this.boxSize.y,this.boxSize.z),this.box.getCenter(this.mesh.position)};var nF=function(e){A(n,e);var t=p(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r(this,n),(i=t.call(this))._mode=-1,i._enabled=!1,i._empty=Object.freeze([]),i._clipPlane=new dn(new tt(-1,0,0),0),i._boxClipPlane=[],i._root=new Dt,i._showHelper=!0,i.target=a||e.modelGroup,i.viewer=e,i.viewer.renderer.localClippingEnabled=!0,i.viewer.add(i._root),i._init(),i.mode=n.Mode.Plane,i}return o(n,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e=Boolean(e),this.mode==n.Mode.Plane&&(this._control.visible=e),this._root.visible=e,this._updateClippingPlanes()}},{key:"mode",get:function(){return this._mode},set:function(e){var t,i;if(e!==this._mode){switch(e){case n.Mode.Plane:this._control.enabled=!0,(t=this._root).remove.apply(t,y(this._root.children)),this._root.add(this._planeHelper),this.viewer.add(this._control),this._clipPlanes=[this._clipPlane],this._updateClippingPlanes();break;case n.Mode.Box:this._control.enabled=!1,this.viewer.remove(this._control),(i=this._root).remove.apply(i,y(this._root.children)),this._root.add(this._boxHelper),this._clipPlanes=this._boxClipPlane,this._updateClippingPlanes()}this._mode=e}}},{key:"showHelper",get:function(){return this._showHelper},set:function(e){(e=Boolean(e))!==this._showHelper&&(this._boxHelper.visible=e,this._planeHelper.visible=e,this._showHelper=e)}},{key:"_init",value:function(){var e=this;this.target.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material:[t.material]).forEach((function(t){t.clippingPlanes=e._empty}))})),this._initPlaneHelper(),this._initBoxHelper()}},{key:"_initBoxHelper",value:function(){var e=this,t=(new Jt).setFromObject(this.target),i=new tt,r=(new Jt).copy(t);t.getSize(i),this._boxClipPlane.push(new dn(new tt(1,0,0),-t.min.x)),this._boxClipPlane.push(new dn(new tt(-1,0,0),t.max.x)),this._boxClipPlane.push(new dn(new tt(0,1,0),-t.min.y)),this._boxClipPlane.push(new dn(new tt(0,-1,0),t.max.y)),this._boxClipPlane.push(new dn(new tt(0,0,1),-t.min.z)),this._boxClipPlane.push(new dn(new tt(0,0,-1),t.max.z)),this._boxHelper=new tF(t,this.color);var a,o=new Pc,s=new tt,A={},l=new Je,c=new Je,h=new At,u=!1;this.viewer.domElement.addEventListener("mousedown",(function(i){if(e.mode===n.Mode.Box&&(o.setFromCamera(xf.getDomMouse(i,e.viewer.renderManager.containerRect),e.viewer.camera),o.ray.intersectBox(t,s))){switch(a=e._getIntersectFaceInBox(t,s),A.pageX=i.pageX,A.pageY=i.pageY,u=!0,e.viewer.controls.enabled=!1,a){case 0:h.set(1,0,0,0);break;case 1:h.set(-1,0,0,0);break;case 2:h.set(0,1,0,0);break;case 3:h.set(0,-1,0,0);break;case 4:h.set(0,0,1,0);break;case 5:h.set(0,0,-1,0)}h.applyMatrix4(e.viewer.camera.matrixWorldInverse).applyMatrix4(e.viewer.camera.projectionMatrix),l.set(-h.x,h.y)}})),this.viewer.domElement.addEventListener("mousemove",(function(h){if(e.mode===n.Mode.Box){if(c.set(h.pageX-A.pageX,h.pageY-A.pageY).normalize(),u){var d=0;switch(a){case 0:if(d=c.dot(l)*i.x/100,t.min.x-d>=r.max.x||t.min.x-d<r.min.x)break;t.min.x-=d,e._boxClipPlane[0].constant+=d;break;case 1:if(d=c.dot(l)*i.x/100,t.max.x+d>=r.max.x||t.max.x+d<r.min.x)break;t.max.x+=d,e._boxClipPlane[1].constant+=d;break;case 2:if(d=c.dot(l)*i.y/100,t.min.y-d>=r.max.y||t.min.y-d<r.min.y)break;t.min.y-=d,e._boxClipPlane[2].constant+=d;break;case 3:if(d=c.dot(l)*i.y/100,t.max.y+d>=r.max.y||t.max.y+d<r.min.y)break;t.max.y+=d,e._boxClipPlane[3].constant+=d;break;case 4:if(d=c.dot(l)*i.z/100,t.min.z-d>=r.max.z||t.min.z-d<r.min.z)break;t.min.z-=d,e._boxClipPlane[4].constant+=d;break;case 5:if(d=c.dot(l)*i.z/100,t.max.z+d>=r.max.z||t.max.z+d<r.min.z)break;t.max.z+=d,e._boxClipPlane[5].constant+=d}}else o.setFromCamera(xf.getDomMouse(h,e.viewer.renderManager.containerRect),e.viewer.camera),e.viewer.domElement.style.cursor=o.ray.intersectBox(t,s)?"move":"default";A.pageX=h.pageX,A.pageY=h.pageY}})),this.viewer.domElement.addEventListener("mouseup",(function(){e.mode===n.Mode.Box&&(e.viewer.controls.enabled=!0,u=!1,e.viewer.domElement.style.cursor="default")}))}},{key:"_initPlaneHelper",value:function(){var e=this,t=.5*Math.PI,i=(new Jt).setFromObject(this.target),r=i.getSize(new tt),a=Math.max(r.x,r.y,r.z),o=new xi(new Ki(a,a),new kn({color:16777215,side:2,opacity:.3,transparent:!0}));this._planeHelper=o,i.getCenter(this._planeHelper.position),o.renderOrder=11e3,o.rotation.y=t;var s=new Mu(this.viewer.camera,this.viewer.domElement,!0);this._control=s,s.attach(o),s.addEventListener("dragging-changed",(function(t){e.mode===n.Mode.Plane&&(e.viewer.controls.enabled=!t.value)})),s.addEventListener("objectChange",(function(r){if(e.mode===n.Mode.Plane){var a=r.target.axis;if(a){var A=o.getWorldPosition(new tt),l="X"===e._axis?A.x:"Y"===e._axis?A.y:A.z;if(a!==e._axis){switch(e._axis=a,o.rotation.set(0,0,0),a){case"X":e._clipPlane.normal.set(-1,0,0),i.getCenter(o.position),o.rotation.y=t;break;case"Y":e._clipPlane.normal.set(0,-1,0),i.getCenter(o.position),o.rotation.x=t;break;case"Z":e._clipPlane.normal.set(0,0,-1),i.getCenter(o.position)}s.dragging=!1,s.pointerDown(r.pointer)}switch(a){case"X":case"Y":case"Z":e._clipPlane.constant=l}}}})),this._clipPlane.normal=new tt(-1,0,0),this._clipPlane.constant=o.position.x}},{key:"_updateClippingPlanes",value:function(){var e=this;this.target.getWorldPosition(this._root.position),this.target.traverse((function(t){t.isMesh&&((Array.isArray(t.material)?t.material:[t.material]).forEach((function(t){t.clippingPlanes=e.enabled?e._clipPlanes:e._empty})),e.mode===n.Mode.Box&&e._boxHelper.update())}))}},{key:"_getIntersectFaceInBox",value:function(e,t){var n=-1,i=1/0;return Math.abs(t.x-e.max.x)<i&&(i=Math.abs(t.x-e.max.x),n=1),Math.abs(t.x-e.min.x)<i&&(i=Math.abs(t.x-e.min.x),n=0),Math.abs(t.y-e.max.y)<i&&(i=Math.abs(t.y-e.max.y),n=3),Math.abs(t.y-e.min.y)<i&&(i=Math.abs(t.y-e.min.y),n=2),Math.abs(t.z-e.max.z)<i&&(i=Math.abs(t.z-e.max.z),n=5),Math.abs(t.z-e.min.z)<i&&(i=Math.abs(t.z-e.min.z),n=4),n}}]),n}(Xe);nF.Mode={Plane:0,Box:1};var iF,rF,aF,oF,sF,AF,lF,cF,hF=function(){function e(){r(this,e)}return o(e,null,[{key:"createLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff",n=new Si;return e.forEach((function(e){n.vertices.push((new tt).copy(e))})),new Ro(n,new Fo({color:t}))}},{key:"createSprite",value:function(e,t){var n=new po(new to({map:(new KA).load(e,(function(e){}))}));return n.scale.set(t,t,t),n}},{key:"createPointLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#ffffff",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=new Il(e,t,n);return i}},{key:"createSpotLight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#ffffff",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=new Ml(e,t,n,i);return r}},{key:"createBoundingBox",value:function(e,t){return new Ih(e,t)}},{key:"createFontMesh",value:function(e,t,n){(n=n||{}).font=e;var i=new Ws(t,n);return i.computeBoundingBox(),new xi(i,new Nh([new pA({color:n.color,shading:1}),new pA({color:n.color,shading:2})]))}},{key:"createLightHelper",value:function(e){var t;return e.isDirectionalLight?t=new wh(e,1):e.isSpotLight?t=new Jc(e):e.isPointLight&&(t=new ih(e)),t}},{key:"createPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff",i=new Ki(e,t),r=new xi(i,new kn({color:n}));return r.rotation.x=-Math.PI/2,r}}]),e}(),uF=function(e,t){iu.call(this),void 0===au&&console.error("TexturePass relies on CopyShader");var n=au;this.map=e,this.opacity=void 0!==t?t:1,this.uniforms=Ui.clone(n.uniforms),this.material=new Pi({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.fsQuad=new iu.FullScreenQuad(null)};uF.prototype=Object.assign(Object.create(iu.prototype),{constructor:uF,render:function(e,t,n){var i=e.autoClear;e.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(),this.fsQuad.render(e),e.autoClear=i}});var dF={uniforms:{tDiffuse:{value:null},pixelSize:{value:null},kernel:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform float pixelSize;\n        uniform float kernel[25];\n        varying vec2 vUv;\n        void main(){\n            vec4 texel = \n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-2, 2)))) * kernel[0] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-1, 2)))) * kernel[1] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 0, 2)))) * kernel[2] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 1, 2)))) * kernel[3] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 2, 2)))) * kernel[4] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-2, 1)))) * kernel[5] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-1, 1)))) * kernel[6] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 0, 1)))) * kernel[7] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 1, 1)))) * kernel[8] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 2, 1)))) * kernel[9] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-2, 0)))) * kernel[10] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-1, 0)))) * kernel[11] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 0, 0)))) * kernel[12] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 1, 0)))) * kernel[13] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 2, 0)))) * kernel[14] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-2,-1)))) * kernel[15] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-1,-1)))) * kernel[16] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 0,-1)))) * kernel[17] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 1,-1)))) * kernel[18] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 2,-1)))) * kernel[19] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-2,-2)))) * kernel[20] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2(-1,-2)))) * kernel[21] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 0,-2)))) * kernel[22] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 1,-2)))) * kernel[23] +\n                texture2D(tDiffuse, fract(1.0 + (vUv + pixelSize * vec2( 2,-2)))) * kernel[24] ;\n\n            gl_FragColor = texel / 256.0;\n        }\n    "},fF=new If;function pF(e){if(iF||((iF=new Ka({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio),iF.setClearAlpha(0)),iF.setSize(e,e),rF)oF&&rF.remove(oF),sF&&rF.remove(sF),aF.left=e/-2,aF.right=e/2,aF.top=e/2,aF.bottom=e/-2,aF.updateProjectionMatrix();else{(rF=new Rt).background=null,rF.add(new Ll(16777215,.7));var t=new Tl(16777215,.7);t.position.set(-1,1,-1).normalize(),rF.add(t),aF=new El(e/-2,e/2,e/2,e/-2,1,1e3)}aF.position.set(0,0,-e-1),aF.lookAt(0,0,0)}var mF,gF,vF,yF,wF,xF,bF,CF,MF=function(){function e(){r(this,e)}return o(e,null,[{key:"generateMaterialIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128;if(pF(t),oF)oF.material=e;else{var n=new Ys(1,32,32);$u(n),oF=new xi(n,e)}return rF.add(oF),oF.scale.set(t/2,t/2,t/2),iF.render(rF,aF),iF.domElement.style.background="transparent",iF.domElement.toDataURL("image/png")}},{key:"generateHDRIcon",value:function(e,t,n){pF(t=t||128),fF.renderer=iF,fF.load(e,(function(e){var i=new kn({map:e,side:2});if(sF)sF.material=i;else{var r=new Ki(1,1);sF=new xi(r,i)}rF.add(sF),sF.position.set(0,0,0),sF.scale.set(t,t,t),iF.render(rF,aF),n&&n(iF.domElement.toDataURL("image/jpeg"))}))}},{key:"generateTextureIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128;pF(t);var n=new kn({map:e,side:2});if(sF)sF.material=n;else{var i=new Ki(1,1);sF=new xi(i,n)}return rF.add(sF),sF.position.set(0,0,0),sF.scale.set(t,t,t),iF.render(rF,aF),iF.domElement.toDataURL("image/jpeg")}},{key:"generateBlurMap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3?arguments[3]:void 0;pF(t),AF||(AF=new lu(iF),lF=new uF,(cF=new ou(dF)).uniforms.pixelSize.value=2/t,cF.uniforms.kernel.value=[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1]),AF.setSize(t,t),AF.passes.length=0,AF.addPass(lF);for(var r=0;r<n;r++)AF.addPass(cF);fF.renderer=iF,fF.load(e,(function(e){lF.map=e,AF.render(),i(AF.renderer.domElement.toDataURL("image/png"))}),(function(){}),(function(){}),256,$)}}]),e}(),BF=new Jt,IF=[1,1,1],EF=new tt,SF=new kn({color:16777215,transparent:!0,opacity:0,depthWrite:!1}),TF=0,LF=!1,FF=0,_F=30,UF=.3,PF=function(){function e(){r(this,e)}return o(e,null,[{key:"getVisible",value:function(){return LF}},{key:"createShadow",value:function(e,t){CF&&CF===e?(bF.root.children.includes(yF)||bF.root.add(yF),kF()):(CF=e,bF=t,function(){(wF=e.boundingBox).getCenter(EF);var t=wF,n=t.max,i=t.min;TF=parseInt((n.y-i.y)/100*1e3)/1e3,(xF=new xi(new Yi(1,1).rotateX(-Math.PI/2),SF)).renderOrder=1,xF.name="_shadow.mesh",CF._shadow=xF,(yF=new Ha).name="_shadow.group",yF.add(xF),CF.parent.updateMatrixWorld(),CF.parent.matrixWorld.decompose(yF.position,yF.quaternion,yF.scale),bF.root.add(yF),kF()}()),LF=!0}},{key:"updateShadow",value:function(){kF()}},{key:"clearShadow",value:function(){LF&&(xF.material.opacity=0,_F=30,UF=.3,FF=0,bF.root.remove(yF))}},{key:"getBlurLevel",value:function(){return _F/5}},{key:"setBlurLevel",value:function(e){isNaN(e)||e>10||e<1||(_F=5*e,kF())}},{key:"getStrength",value:function(){return 10*UF}},{key:"setStrength",value:function(e){isNaN(e)||e>10||e<1||(UF=e/10,kF())}},{key:"getHeight",value:function(){return FF/TF}},{key:"setHeight",value:function(e){isNaN(e)||e>100||e<0||(FF=TF*e,kF())}},{key:"importShadow",value:function(t,n,i){i&&i.visible&&(e.createShadow(t,n),FF=TF*i.height||0,UF=i.strength/10||.3,_F=5*i.blur||30,LF=!0,kF())}}]),e}();function kF(){var e;if(CF){mF||((mF=new Ka({antialias:!0,alpha:!0})).setClearAlpha(0),mF.setPixelRatio(window.devicePixelRatio),mF.setSize(512,512),mF.domElement.style.width="512px",mF.domElement.style.height="512px",(gF=new Rt).overrideMaterial=new kn({color:0}),vF=new El(-1,1,1,-1,0,1e3)),gF.remove(gF.children[0]),gF.add(CF),CF.updateMatrixWorld(),BF.setFromObject(CF);var t=BF.max,n=BF.min;BF.getCenter(EF);var i=t.x-n.x,r=t.z-n.z;(e=xF.geometry).scale.apply(e,[1.2*i/IF[0],1,1.2*r/IF[2]]),IF=[1.2*i,1,1.2*r],xF.position.set(EF.x,n.y-FF,EF.z),vF.left=-1.2*i/2,vF.right=1.2*i/2,vF.top=1.2*r/2,vF.bottom=-1.2*r/2,vF.far=t.y-n.y,vF.updateProjectionMatrix(),vF.position.set(EF.x,t.y+.1,EF.z),vF.lookAt(EF.x,n.y,EF.z),vF.updateMatrixWorld(),mF.render(gF,vF),bF.modelGroup.add(CF),xF.material.map&&xF.material.map.dispose(),MF.generateBlurMap(mF.domElement.toDataURL("image/png"),512,_F,(function(e){xF.material.opacity=UF,xF.material.map=(new KA).load(e),xF.material.needsUpdate=!0}))}}var DF,RF=new tt,OF=new tt,NF=new tt,GF=function(e){A(n,e);var t=p(n);function n(e,i,a){var o;r(this,n),(o=t.call(this)).name="DirectionalLightIcon",o.light=i,o.camera=e,o.light.updateMatrixWorld(),o.color=a||"#1296db",o.matrix=i.matrixWorld,o.matrixAutoUpdate=!1,o.lightIcon=new po(new to({map:(new KA).load("data:image/png;base64,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"),sizeAttenuation:!1,depthTest:!1})),o.add(o.lightIcon),o.lightIcon.scale.multiplyScalar(2e-4),o.targetLines=[];for(var s=new kn({depthTest:!0,color:o.color}),A=0;A<4;A++){var l=new Li(.001,.001,.25);l.translate(0,0,.125);var c=new xi(l,s);c.renderOrder=5001,o.targetLines.push(c),o.add(c)}return o.targetLines[0].geometry.translate(0,.0075,0),o.targetLines[1].geometry.translate(0,-.0075,0),o.targetLines[2].geometry.translate(.0075,0,0),o.targetLines[3].geometry.translate(-.0075,0,0),o.size=1,o.update(),o}return o(n,[{key:"dispose",value:function(){this.lightIcon.geometry.dispose(),this.lightIcon.material.dispose(),this.targetLines.forEach((function(e){e.geometry.dispose(),e.material.dispose()}))}},{key:"update",value:function(){var e=this;RF.setFromMatrixPosition(this.light.matrixWorld),RF.normalize(),OF.setFromMatrixPosition(this.light.target.matrixWorld),OF.normalize(),NF.subVectors(OF,RF),NF.normalize(),this.lightIcon.lookAt(OF);var t=RF.distanceTo(this.camera.position)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n=this.size/75;this.lightIcon.scale.set(n,n,n),this.targetLines.forEach((function(n){n.lookAt(OF),n.scale.set(1,1,1).multiplyScalar(t*e.size/4)}))}}]),n}(Dt),QF=function(){function e(){r(this,e)}return o(e,null,[{key:"screenShot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(DF=e.renderManager.defaultRenderer).getPixelRatio()||1,i=t.width||300*n,r=t.height||300*n,a=DF.getSize(),o=DF.domElement.width,s=DF.domElement.height;DF.domElement.width=i,DF.domElement.height=r,DF.setSize(i,r);var A=e.camera.clone();A.aspect=i/r,A.updateProjectionMatrix(),DF.render(e.scene,A);var l=DF.domElement.toDataURL("image/png");return DF.domElement.width=o,DF.domElement.height=s,DF.setSize(a.x,a.y),l}},{key:"encircleScreenShot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(DF=e.renderManager.defaultRenderer).getPixelRatio()||1,i=t.count||16,r=t.width||300*n,a=t.height||300*n,o=DF.getSize(),s=DF.domElement.width,A=DF.domElement.height;DF.domElement.width=r,DF.domElement.height=a,DF.setSize(r,a);var l=t.callback,c=e.camera.clone();c.aspect=r/a,c.updateProjectionMatrix(),e.controls.update();var h=new Zf({camera:c,renderer:DF,renderManager:e.renderManager}),u=[];h.setPosition(e.camera.position.x,e.camera.position.y,e.camera.position.z),h.setTarget(e.controls.target.x,e.controls.target.y,e.controls.target.z);for(var d=0;d<i;d++)h.update(),DF.render(e.scene,c),u.push(DF.domElement.toDataURL("image/png")),u.length===i&&(DF.domElement.width=s,DF.domElement.height=A,DF.setSize(o.x,o.y),l&&l(u)),h.rotateLeft(360/i)}}]),e}(),HF=function(e){A(n,e);var t=p(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#FFFF00";r(this,n),(e=t.call(this)).viewer=null,e.dotIndex=0,e.path=i,e.longlats=[],e.isClose=!1,e.lineColor=a;var o=new Si;return e.lineMaterial=new Fo({color:a,depthTest:!1,depthWrite:!1}),e.line=new Ro(o,e.lineMaterial),e.line.renderOrder=5e3,e.add(e.line),e.dotGroup=new Dt,e.add(e.dotGroup),e.dotMaterial=e.createDotMaterial(),e}return o(n,[{key:"path",get:function(){return this._path},set:function(e){if(e){this._path=[];for(var t=0;t<e.length;t++)this.pathPush(e[t])}}},{key:"isClose",get:function(){return this._isClose},set:function(e){this._isClose=e}},{key:"viewer",get:function(){return this._viewer},set:function(e){this._viewer=e}},{key:"curDot",get:function(){this.dotGroup.children[this.dotIndex]||(this.dotIndex=0);var e=this.dotGroup.children[this.dotIndex];return this.dotIndex++,e}},{key:"addPoint",value:function(e){e&&(this.pathPush(e),this.updateDot())}},{key:"addLongLat",value:function(e){if(e&&Array.isArray(e)&&this.viewer){this.longlats.push(e);var t=this.viewer.coordinatesToVector3(e);this.addPoint(t)}}},{key:"addPoints",value:function(e){var t=this;e&&e.length>0&&(e.forEach((function(e){e&&t.pathPush(e)})),this.updateDot())}},{key:"addLongLats",value:function(e){var t=this;e&&e.length>0&&(e.forEach((function(n){n&&Array.isArray(n)&&t.viewer&&(t.longlats.push(e),t.pathPush(t.viewer.coordinatesToVector3(n)))})),this.updateDot())}},{key:"pathPush",value:function(e){var t=(new tt).copy(e);this._path.push(t)}},{key:"removePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.path.length>0&&(null!=e&&this.path[e]||(e=this.path.length-1),this.path.splice(e,1),this.longlats&&this.longlats[e]&&this.longlats.splice(e,1),this.updateDot())}},{key:"updatePath",value:function(){var e=this,t=[];if(this.dotGroup.children.forEach((function(e){t.push(e.position.clone())})),this.path=t,this.viewer){var n=[];this.path.forEach((function(t){n.push(e.viewer.coordinatesToVector3(t))})),this.longlats=n}this.updateLine()}},{key:"updateDot",value:function(){for(var e=this.path,t=this.dotGroup.children,n=Math.max(e.length,t.length),i=0;i<n;i++)if(e[i]&&t[i])t[i].position.copy(e[i]);else if(e[i]){var r=this.createDot(e[i]);this.dotGroup.add(r)}else if(t[i]){t.splice(i,t.length-i);break}this.updateLine()}},{key:"updateLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.path=e);var t=new Si;if(this.longlats&&this.longlats.length>0)t.vertices=this.detVector3();else{var n=[];this.path.forEach((function(e){n.push(e)})),this.isClose&&n.push(n[0]),t.vertices=n}this.line.geometry.dispose(),this.line.geometry=t,this.line.geometry.verticesNeedUpdate=!0}},{key:"createDot",value:function(e,t){var n=new po(this.dotMaterial.clone());return n.isPathPoint=!0,n.renderOrder=5e3,n.scale.set(.04,.04,1),e&&n.position.copy(e),n}},{key:"createDotMaterial",value:function(){var e=document.createElement("canvas");e.width=e.height=32;var t=e.getContext("2d");return t.beginPath(),t.arc(16,16,4,0,2*Math.PI),t.fillStyle=this.lineColor,t.fill(),new to({map:new Ko(e),sizeAttenuation:!1,depthTest:!1,depthWrite:!1})}},{key:"show",value:function(){this.visible=!0}},{key:"hide",value:function(){this.visible=!1}},{key:"detVector3",value:function(){var e=[];if(1===this.longlats.length)e.push(this.viewer.coordinatesToVector3(this.longlats[0]));else{var t=[];this.longlats.forEach((function(e){t.push(e)})),this.isClose&&t.push(t[0]);for(var n=0;n<t.length-1;n++){for(var i=new Je(t[n][0],t[n][1]),r=new Je(t[n+1][0],t[n+1][1]),a=i.distanceTo(r),o=r.clone().sub(i).normalize(),s=Math.ceil(a/1),A=0;A<s;A++){var l=i.clone().addScaledVector(o,1*A),c=this.viewer.coordinatesToVector3([l.x,l.y]);e.push(c)}var h=this.viewer.coordinatesToVector3([r.x,r.y]);e.push(h)}}return e}}]),n}(Dt),zF=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.init(t,n)}return o(e,[{key:"init",value:function(t,n){this.model=t,this.path=n.path,this.directions=n.directions,this.target=n.target,this.rotate=n.rotate,this.tension=n.tension?n.tension:.2,this.time=n.time?n.time:3e3,this.loopType=n.loopType==e.LOOPTYPE_PINGPONG?e.LOOPTYPE_PINGPONG:e.LOOPTYPE_NORMAL,this.loop=n.loop||1/0,this.loopTypeState=0,this.tween=null,this.onUpdate=n.onUpdate,this.onRepeat=n.onRepeat,this.onComplete=n.onComplete}},{key:"path",get:function(){return this._path},set:function(e){if(this._path=[],e)for(var t=0;t<e.length;t++)this._path.push((new tt).copy(e[t]))}},{key:"directions",get:function(){return this._directions},set:function(e){if(this._directions=[],e)for(var t=0;t<e.length;t++)this._directions.push((new tt).copy(e[t]))}},{key:"model",get:function(){return this._model},set:function(e){this._model=e}},{key:"target",get:function(){return this._target},set:function(e){e&&(this._target=(new tt).copy(e))}},{key:"rotate",get:function(){return this._rotate},set:function(e){e&&(this._rotate=(new tt).copy(e))}},{key:"tension",get:function(){return this._tension},set:function(e){this._tension=e}},{key:"time",get:function(){return this._time},set:function(e){this._time=e}},{key:"loopType",get:function(){return this._loopType},set:function(e){this._loopType=e}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e}},{key:"onUpdate",set:function(e){e&&(this.updateCallBack=e)}},{key:"onRepeat",set:function(e){e&&(this.repeatCallBack=e)}},{key:"onComplete",set:function(e){e&&(this.completeCallBack=e)}},{key:"begin",value:function(){if(this.isValidData()){this.model.pathTween&&this.model.pathTween.stop(),this.model.pathTween=this,this.curve=new VF(this.path,"catmullrom",this.tension);var e=this.curve.getLines();!this.model.isCamera&&this.tension&&(this.model.moveLines&&this.model.parent.remove(this.model.moveLines),this.model.moveLines=e,this.model.parent.add(e)),this.directions&&this.directions.length===this.path.length&&(this.curveDir=new al(this.directions));this.tween=new Ku.Tween({t:0}).to({t:1},this.time).onUpdate(this._onUpdate.bind(this)).onComplete(this._onComplete.bind(this)).onRepeat(this._onRepeat.bind(this)).repeat(this.loop-1).start()}}},{key:"_onUpdate",value:function(t){var n=t.t,i=1;this.loopType===e.LOOPTYPE_PINGPONG&&1===this.loopTypeState&&(n=1-t.t,i=-1);var r=new tt,a=new tt;if(this.curve.getPoint(n,r),this.curve.getPoint(n+.03*i,a),this.rotate&&!this.model.isCamera){var o,s=new tt(0,0,1);o=this.target?this.target.clone().sub(r).normalize():a.clone().sub(r).normalize();var A=this.getInitRotateQua4(this.rotate),l=this.getLookAtRotateQue4(s,o),c=A.multiply(l);this.model.quaternion.copy(c)}else if(this.model.isCamera)if(this.target)this.model.target=this.target.clone(),this.model.controller.target=this.target.clone(),this.model.lookAt(this.target.clone());else{if(this.curveDir){var h=new tt;this.curveDir.getPoint(n,h),a=this.model.getWorldPosition().clone().addScaledVector(h,10)}this.model.target=a.clone(),this.model.controller.target=a.clone(),this.model.lookAt(a.clone())}else this.target?(this.model.target=this.target.clone(),this.model.lookAt(this.target.clone())):(this.model.target=a.clone(),this.model.lookAt(a.clone()));this.model.position.copy(r.clone()),this.updateCallBack&&this.updateCallBack()}},{key:"_onRepeat",value:function(){this.repeatCallBack&&this.repeatCallBack(),this.loopTypeState++,this.loopTypeState%=2,this.tween&&(this.tween._valuesStart.t=0,this.tween._duration=this.time)}},{key:"_onComplete",value:function(){this.completeCallBack&&this.completeCallBack()}},{key:"start",value:function(){this.tween&&(this.tween._duration=(1-this.tween._object.t)*this.time,this.tween.start())}},{key:"stop",value:function(){this.tween&&(this.tween.stop(),this.tween._duration=(1-this.tween._object.t)*this.time)}},{key:"end",value:function(){this.tween&&this.tween.end()}},{key:"getInitRotateQua4",value:function(e){var t=new qe;if(0===e.x&&0===e.y&&0===e.z)return t;var n=new qe;n.setFromAxisAngle(new tt(1,0,0),e.x);var i=new qe;i.setFromAxisAngle(new tt(0,1,0),e.y);var r=new qe;return r.setFromAxisAngle(new tt(0,0,1),e.z),t.multiply(n),t.multiply(i),t.multiply(r),t}},{key:"getLookAtRotateQue4",value:function(e,t){var n=new qe;if(0===e.x&&0===e.y&&0===e.z||0===t.x&&0===t.y&&0===t.z||e.x===t.x&&e.y===t.y&&e.z===t.z)return n;var i=e.clone(),r=new tt(0,1,0).clone().cross(i).normalize(),a=new tt(e.x,0,e.z).normalize(),o=new tt(t.x,0,t.z).normalize(),s=a.angleTo(o);r.angleTo(o)>Math.PI/2&&(s=-s);var A=new tt(t.x,0,t.z).normalize(),l=t.clone(),c=A.angleTo(l);l.y>0&&(c=-c);var h=new qe;h.setFromAxisAngle(new tt(1,0,0),c);var u=new qe;return u.setFromAxisAngle(new tt(0,1,0),s),n.multiply(u),n.multiply(h),n}},{key:"isValidData",value:function(){return this.model?!this.path||this.path.length<2?(console.error(""),!1):"number"!=typeof this.tension||this.tension<0||this.tension>1?(console.error("0-1"),!1):"number"!=typeof this.time||this.time<=0?(console.error(""),!1):0!==this.loopType&&1!==this.loopType?(console.error("01"),!1):!("number"!=typeof this.loop||this.loop<1)||(console.error("0"),!1):(console.error(""),!1)}}]),e}(),VF=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"catmullrom",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r(this,e);var o=new al(t);o.curveType=n,o.tension=i,this.curve=o,this.path=t,this.accuracy=a||10*t.length,this.curveType=n,this.tension=i,this.points=o.getPoints(this.accuracy),this.compute()}return o(e,[{key:"compute",value:function(){var e=this.points.length;this.allLen=0,this.lenArr=[0];for(var t=0;t<e-1;t++){var n=this.points[t],i=this.points[t+1],r=n.distanceTo(i);this.allLen+=r,this.lenArr.push(this.lenArr[t]+r)}var a=this.path.length,o=this.path[1].clone().sub(this.path[0]);this.firstPoint=this.path[0].clone().add(o);var s=this.path[a-1].clone().sub(this.path[a-1]);this.lastPoint=this.path[a-1].clone().add(s)}},{key:"getPoint",value:function(e,t){if(e<0)return t?t.set(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z):t=this.firstPoint.clone(),t;if(e>1)return t?t.set(this.lastPoint.x,this.lastPoint.y,this.lastPoint.z):t=this.lastPoint.clone(),t;for(var n=this.allLen*e,i=0;i<this.lenArr.length-1;i++){var r=this.lenArr[i],a=this.lenArr[i+1];if(n==r)return t?t.set(this.points[i].x,this.points[i].y,this.points[i].z):t=this.points[i].clone(),t;if(r<n&&a>n){var o=this.points[i],s=n-r,A=this.points[i+1].clone().sub(o).normalize(),l=o.clone().addScaledVector(A,s);return t?t.set(l.x,l.y,l.z):t=this.points[i].clone(),t}}var c=this.points[this.points.length-1];return t?t.set(c.x,c.y,c.z):t=c.clone(),t}},{key:"getLines",value:function(){for(var e=this.points,t=[],n=[],i=0;i<e.length-1;i++)t.push(e[i].x),t.push(e[i].y),t.push(e[i].z),t.push(e[i+1].x),t.push(e[i+1].y),t.push(e[i+1].z),n.push(1,0,0,1,0,0);var r=new ni;r.setAttribute("position",new Vn(t,3)),r.setAttribute("color",new Vn(n,3));var a=new Go(r,new wA({color:16711680,dashSize:4,gapSize:3}));return a.computeLineDistances(),a}}]),e}();zF.LOOPTYPE_NORMAL=0,zF.LOOPTYPE_PINGPONG=1;var jF="#FF0000",WF={m:1,mm:1e3,km:.001},XF=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this)).unselectColor=i||"#FFFF00",a.type=e||n.TYPE_DISTANCE,a.earthsCoreVec=new tt(0,0,0),a.init(),a}return o(n,[{key:"init",value:function(){this.showUnit="m",this.decimalPlaces=2,this.hided=!1,this.onComplete=null,this.pathEditor=new HF([],this.unselectColor),this.add(this.pathEditor),this.panelNode=new Dt,this.add(this.panelNode)}},{key:"addPoint",value:function(e,t){if(this.type===n.TYPE_DISTANCE)e&&this.pathEditor.addPoint(e),this.pathEditor.path.length>=2&&this.addDistancePanel();else if(this.type===n.TYPE_HEIGHT){var i=this.computeHeightPoint(e,t);i&&this.pathEditor.addPoint(i),this.pathEditor.path.length>=2&&this.addHeightPanel()}else this.type===n.TYPE_ANGLE?(e&&this.pathEditor.addPoint(e),this.pathEditor.path.length>=3&&this.addAnglePanel()):this.type===n.TYPE_AREA&&(e&&this.pathEditor.addPoint(e),this.pathEditor.path.length>=3&&this.addAreaPanel())}},{key:"addPoints",value:function(e){var t=this;e.forEach((function(e){t.addPoint(e)}))}},{key:"addAreaPanel",value:function(){var e=this.pathEditor.path;this.clearPanel();var t=e[0],n=e[1],i=e[2],r=this.computePolyArea(e),a=new Jt;a.setFromPoints(e);var o=a.getCenter(),s=a.max.distanceTo(a.min);this.maxLength=s,this.textScale=2,this.textMeshScale=.002*this.maxLength,this.fontSize=20*this.textScale;var A=n.distanceTo(t),l=n.distanceTo(i),c=.005*this.maxLength*.5*30,h=Math.min(A,l);c=c>3*h/4?3*h/4:c;var u=t.clone().sub(n).normalize(),d=i.clone().sub(n).normalize(),f=n.clone().addScaledVector(u,c),p=n.clone().addScaledVector(d,c),m=new tt((f.x+p.x)/2,(f.y+p.y)/2,(f.z+p.z)/2).clone().sub(n),g=this._drawText2((r*this.magnification*this.magnification).toFixed(this.decimalPlaces)+this.showUnit+"2"),v=g.clone();v.geometry=g.geometry.clone(),v.selectMat=g.selectMat.clone(),v.unselectMat=g.unselectMat.clone(),this.panelNode.add(v);var y=m.clone().normalize(),w=u.clone().cross(d).normalize(),x=w.clone().cross(y);x.y<0&&(x.negate(),w.negate());var b=new vt;b.makeBasis(y,x,w),b.setPosition(o),g.geometry.applyMatrix(b);var C=new vt;C.makeBasis(y.clone().negate(),x.clone(),w.clone().negate()),C.setPosition(o.clone()),v.geometry.applyMatrix(C),this.lengthMesh=g,this.lengthMesh.back=v}},{key:"addAnglePanel",value:function(){var e=this.pathEditor.path;this.clearPanel();for(var t=0;t<e.length-2;t++){var n=e[t],i=e[t+1],r=e[t+2],a=n.distanceTo(i).toFixed(4);this.maxLength=a,this.textScale=2,this.textMeshScale=.002*this.maxLength,this.fontSize=20*this.textScale;var o=i.distanceTo(n),s=i.distanceTo(r),A=.005*this.maxLength*.5*30,l=Math.min(o,s);A=A>3*l/4?3*l/4:A;var c=n.clone().sub(i).normalize(),h=r.clone().sub(i).normalize(),u=180*c.angleTo(h)/Math.PI,d=i.clone().addScaledVector(c,A),f=i.clone().addScaledVector(h,A),p=new tt((d.x+f.x)/2,(d.y+f.y)/2,(d.z+f.z)/2),m=p.clone().sub(i),g=p.addScaledVector(m,2),v=this._drawText2(u.toFixed(this.decimalPlaces)+""),y=v.clone();y.geometry=v.geometry.clone(),y.selectMat=v.selectMat.clone(),y.unselectMat=v.unselectMat.clone(),this.panelNode.add(y);var w=m.clone().normalize(),x=c.clone().cross(h).normalize(),b=x.clone().cross(w);b.y<0&&(b.negate(),x.negate());var C=new vt;C.makeBasis(w,b,x),C.setPosition(g),v.geometry.applyMatrix(C);var M=new vt;M.makeBasis(w.clone().negate(),b.clone(),x.clone().negate()),M.setPosition(g.clone()),y.geometry.applyMatrix(M),this.lengthMesh=v,this.lengthMesh.back=y}}},{key:"addHeightPanel",value:function(){var e=this.pathEditor.path;this.clearPanel();for(var t=0;t<e.length-1;t++){var n=e[t],i=e[t+1],r=n.distanceTo(i);this.maxLength=r,this.textScale=2,this.textMeshScale=.002*this.maxLength,this.fontSize=20*this.textScale;var a=n.distanceTo(i),o=i.clone().sub(n).normalize(),s=n.clone().addScaledVector(o,a/2),A=o.clone(),l=void 0,c=void 0;if(0==A.clone().dot(new tt(1,0,0)))l=new tt(1,0,0),c=A.clone().cross(l).normalize();else{var h=new tt(0,1,0);l=(c=A.clone().cross(h).normalize()).clone().cross(A).normalize()}l.y<0&&(l.negate(),c.negate());var u=s.clone().addScaledVector(l,.03*this.maxLength),d=this._drawText2((r*this.magnification).toFixed(this.decimalPlaces)+this.showUnit),f=d.clone();f.geometry=d.geometry.clone(),f.selectMat=d.selectMat.clone(),f.unselectMat=d.unselectMat.clone(),this.panelNode.add(f);var p=new vt;p.makeBasis(A,l,c),p.setPosition(u),d.geometry.applyMatrix(p);var m=new vt;m.makeBasis(A.clone().negate(),l.clone(),c.clone().negate()),m.setPosition(u.clone()),f.geometry.applyMatrix(m),this.lengthMesh=d,this.lengthMesh.back=f}}},{key:"addDistancePanel",value:function(){var e=this.pathEditor.path;this.clearPanel();for(var t=0;t<e.length-1;t++){var n=e[t],i=e[t+1],r=n.distanceTo(i);this.maxLength=r,this.textScale=2,this.textMeshScale=.002*this.maxLength,this.fontSize=20*this.textScale;var a=n.distanceTo(i),o=i.clone().sub(n).normalize(),s=n.clone().addScaledVector(o,a/2),A=o.clone(),l=void 0,c=void 0;if(0==A.clone().dot(new tt(1,0,0)))l=new tt(1,0,0),c=A.clone().cross(l).normalize();else{var h=new tt(0,1,0);l=(c=A.clone().cross(h).normalize()).clone().cross(A).normalize()}l.y<0&&(l.negate(),c.negate());var u=s.clone().addScaledVector(l,.03*this.maxLength),d=this._drawText2((r*this.magnification).toFixed(this.decimalPlaces)+this.showUnit),f=d.clone();f.geometry=d.geometry.clone(),f.selectMat=d.selectMat.clone(),f.unselectMat=d.unselectMat.clone(),this.panelNode.add(f);var p=new vt;p.makeBasis(A,l,c),p.setPosition(u),d.geometry.applyMatrix(p);var m=new vt;m.makeBasis(A.clone().negate(),l.clone(),c.clone().negate()),m.setPosition(u.clone()),f.geometry.applyMatrix(m),this.lengthMesh=d,this.lengthMesh.back=f}}},{key:"removePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.pathEditor.removePoint(e)}},{key:"updatePath",value:function(){this.pathEditor.updatePath(),this.updatePanel()}},{key:"clearPanel",value:function(){for(;this.panelNode.children.length>0;)this.panelNode.remove(this.panelNode.children[0])}},{key:"updatePanel",value:function(){this.clearPanel();this.addPoint(null)}},{key:"_onComplete",value:function(){this.onComplete&&this.onComplete()}},{key:"close",value:function(e){e&&e()}},{key:"hide",value:function(){this.visible=!1}},{key:"show",value:function(){this.visible=!0}},{key:"_drawText2",value:function(e,t){var n=document.createElement("canvas"),i=this._getMaterial(n,e,this.unselectColor),r=document.createElement("canvas"),a=this._getMaterial(r,e,jF),o=new xi(new Ki(n.width*this.textMeshScale/this.textScale,n.height*this.textMeshScale/this.textScale),i);return o.renderOrder=je,o.name="Text",t&&o.position.copy(t),o.selectMat=a,o.unselectMat=i,this.panelNode.add(o),o}},{key:"_getMaterial",value:function(e,t,n){e.height=this.fontSize,this._fillText(e,t,n);var i=new Ko(e);i.anisotropy=16;var r=new kn({map:i,transparent:!0});return r.depthTest=!1,r}},{key:"_fillText",value:function(e,t,n){var i="normal bolder "+this.fontSize+"px ";e.width=this._measureTextWidth(i,t);var r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.font=i,r.fillStyle=n||this.unselectColor,r.textAlign="left",r.textBaseline="top",r.fillText(t,0,0)}},{key:"_measureTextWidth",value:function(e,t){this._measureCanvas||(this._measureCanvas=document.createElement("canvas"),this._measureCanvas.height=100,this._measureCanvas.width=100);var n=this._measureCanvas.getContext("2d");return n.font=e,n.measureText(t).width}},{key:"computePolyArea",value:function(e){for(var t=0,n=this.getFaces(e),i=0;i<n.length;i++){var r=n[i],a=e[r[0]],o=e[r[1]],s=e[r[2]];t+=this.computeTriArea(a,o,s)}var A=[];e.forEach((function(e){A.push(e.x,e.y,e.z)}));var l=[];n.forEach((function(e){l.push(e[0],e[1],e[2])}));var c=new ni;c.attributes.position=new Dn(new Float32Array(A),3),c.index=new Dn(new Uint16Array(l),1);var h=new kn({side:2,transparent:!0,opacity:.2});h.color=new Sn(this.unselectColor);var u=new xi(c,h);return u.renderOrder=je,this.panelNode.add(u),t}},{key:"computeTriArea",value:function(e,t,n){var i=t.distanceTo(e),r=n.distanceTo(t),a=e.distanceTo(n),o=(i+r+a)/2;return Math.sqrt(o*(o-i)*(o-r)*(o-a))}},{key:"computeHeightPoint",value:function(e,t){var n=null;if(t){var i=this.pathEditor.path;if(0===i.length)e&&(n=(new tt).copy(e));else{var r=t.origin.clone(),a=this.earthsCoreVec,o=i[0],s=i[i.length-1],A=t.direction.clone().normalize(),l=o.clone().sub(a).normalize(),c=l.clone().cross(A).normalize(),h=A.clone().cross(c).normalize(),u=new dn;u.setFromNormalAndCoplanarPoint(h,r);var d=Math.abs(u.distanceToPoint(a)),f=s.distanceTo(a),p=h.angleTo(l),m=Math.abs(1/Math.cos(p)*d);m>f&&(n=a.clone().addScaledVector(l,m))}}else e&&(n=(new tt).copy(e));return n}},{key:"getFaces",value:function(e){if(e.length<3)return[];for(var t,n,i,r,a,o,s=1e-4,A=!1,l=0;l<e.length-1;l++)if(t=e[l],n=e[(l+1)%e.length],i=e[(l+2)%e.length],this.computeTriArea(t,n,i)){A=!0;break}if(!A)return[];r=n.clone().sub(t).normalize(),a=i.clone().sub(n).normalize(),o=r.clone().cross(a).normalize(),Math.abs(o.x);for(var c=Math.abs(o.y)<s,h=Math.abs(o.z)<s,u=[],d=0;d<e.length;d++){var f=e[d],p=void 0;p=c?new Je(h?f.z:f.x,f.y):new Je(f.x,f.z),u.push(p)}return Ns.triangulateShape(u,[])}},{key:"select",value:function(){this.children.forEach((function(e){"Edge"===e.name&&e.material.color.setStyle(jF)})),this.lengthMesh.material=this.lengthMesh.selectMat,this.lengthMesh.back.material=this.lengthMesh.back.selectMat,this.lengthMesh.material.map.needsUpdate=!0,this.lengthMesh.back.material.map.needsUpdate=!0}},{key:"unSelect",value:function(){var e=this;this.children.forEach((function(t){"Edge"===t.name&&t.material.color.setStyle(e.unselectColor)})),this.lengthMesh.material=this.lengthMesh.unselectMat,this.lengthMesh.back.material=this.lengthMesh.back.unselectMat,this.lengthMesh.material.map.needsUpdate=!0,this.lengthMesh.back.material.map.needsUpdate=!0}},{key:"curDot",get:function(){return this.pathEditor.curDot}},{key:"unselectColor",get:function(){return this._unselectColor},set:function(e){e&&(this._unselectColor=e)}},{key:"pointMaterial",get:function(){if(!this._pointMaterial){var e,t;(e=document.createElement("canvas")).width=e.height=16;var n=e.getContext("2d");n.beginPath(),n.arc(8,8,8,0,2*Math.PI),n.fillStyle=this.unselectColor,n.fill(),t=new Ko(e),this._pointMaterial=new to({map:t,sizeAttenuation:!1,depthTest:!1,depthWrite:!1})}return this._pointMaterial}},{key:"showUnit",get:function(){return this._showUnit},set:function(e){void 0===e&&(e="m"),WF[e]&&(this._showUnit=e,this.magnification=WF[e])}},{key:"magnification",get:function(){return this._magnification},set:function(e){void 0===e&&(e=1),this._magnification=e}},{key:"decimalPlaces",get:function(){return this._decimalPlaces},set:function(e){void 0===e&&(e=2),"string"==typeof e&&(e=parseInt(e)),"number"==typeof e&&e>=0&&(this._decimalPlaces=Math.round(e))}},{key:"earthsCoreVec",get:function(){return this._earthsCoreVec},set:function(e){e&&(this._earthsCoreVec=(new tt).copy(e))}},{key:"toJSON",value:function(){return{type:this.type,points:this.pathEditor.path,color:this.unselectColor}}},{key:"loadJson",value:function(e){this.addPoints(e.points)}},{key:"reset",value:function(){for(var e=this.showUnit,t=this.decimalPlaces,n=this.toJSON();this.children.length>0;)this.remove(this.children[0]);this.init(),this.showUnit=e,this.decimalPlaces=t,this.loadJson(n)}},{key:"destroy",value:function(){}}]),n}(Dt);XF.TYPE_DISTANCE=0,XF.TYPE_HEIGHT=1,XF.TYPE_ANGLE=2,XF.TYPE_AREA=3;var ZF=function(){function e(t){r(this,e),this.viewer=t,xf.bindAll(["_onMouseUp","_onMouseMove","_onUpdate"],this),this.measuresGroup=new Dt,this.viewer.modelGroup.add(this.measuresGroup),this.curMeasure3D=null,this.container=document.createElement("div"),this.viewer.container.appendChild(this.container),this.earthsCoreVec=new tt,this.viewer.container.addEventListener("mouseup",this._onMouseUp.bind(this))}return o(e,[{key:"distanceMeasure",value:function(){this.start(XF.TYPE_DISTANCE),this._consoleCallBack&&this._consoleCallBack("")}},{key:"heightMeasure",value:function(){this.start(XF.TYPE_HEIGHT),this._consoleCallBack&&this._consoleCallBack("")}},{key:"angleMeasure",value:function(){this.start(XF.TYPE_ANGLE),this._consoleCallBack&&this._consoleCallBack("")}},{key:"areaMeasure",value:function(){this.start(XF.TYPE_AREA),this._consoleCallBack&&this._consoleCallBack("")}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:XF.TYPE_DISTANCE;this.curMeasure3D?this.curMeasure3D.type!=e&&(this.removeMeasure(),this.addMeasure(e)):this.addMeasure(e),this.viewer.domElement.style.cursor="crosshair",this.container.style.display="block"}},{key:"end",value:function(){this.viewer.domElement.style.cursor="auto",this.container.style.display="none",this.curMeasure3D=null}},{key:"show",value:function(){!1===this.measuresGroup.visible&&(this.measuresGroup.visible=!0,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"hide",value:function(){!0===this.measuresGroup.visible&&(this.measuresGroup.visible=!1,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"addMeasure",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:XF.TYPE_DISTANCE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||this.measureColor;return this.curMeasure3D=new XF(e,n),this.curMeasure3D.earthsCoreVec=this.earthsCoreVec,this.curMeasure3D.showUnit=this.measureUnit,this.curMeasure3D.decimalPlaces=this.measureDecimalPlaces,this.measuresGroup.add(this.curMeasure3D),this.curMeasure3D}},{key:"updateMeasure",value:function(){for(var e=[],t=0;t<this.measuresGroup.children.length;t++){var n=this.measuresGroup.children[t].toJSON();e.push(n)}this.clearMeasure();for(var i=0;i<e.length;i++){var r=e[i],a=this.addMeasure(r.type,r.color);a.loadJson(r),this.measuresGroup.add(a)}this.curMeasure3D=null}},{key:"removeMeasure",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.measuresGroup.children.length>0&&(-1===e&&(e=this.measuresGroup.children.length-1),this.measuresGroup.children.splice(e,1),this.curMeasure3D=null,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"clearMeasure",value:function(){this.measuresGroup.children.splice(0,this.measuresGroup.children.length)}},{key:"loadJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"MeasureData",t=localStorage.getItem(e);if(t){t=JSON.parse(t);for(var n=0;n<t.length;n++){var i=t[n],r=this.addMeasure(i.type,i.color);r.loadJson(i),this.measuresGroup.add(r)}}this.curMeasure3D=null,this._consoleCallBack&&this._consoleCallBack("")}},{key:"saveJson",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"MeasureData",t=[],n=0;n<this.measuresGroup.children.length;n++){var i=this.measuresGroup.children[n],r=i.toJSON();t.push(r)}return localStorage.setItem(e,JSON.stringify(t)),this._consoleCallBack&&this._consoleCallBack(""),t}},{key:"_onMouseUp",value:function(e){if(2==e.button)this.end();else if(this.curMeasure3D){var t=this.viewer.picker.screenToVector(e);this.curMeasure3D.type===XF.TYPE_HEIGHT?this.curMeasure3D.addPoint(t,this.viewer.picker.rayCaster.ray):t&&this.curMeasure3D.addPoint(t)}}},{key:"_onMouseMove",value:function(e){if(this.curMeasure3D){var t=this.viewer.picker.screenToVector(e);t&&(this.currMeasure.v2=t,this.currMeasure.showLine(),this.viewer.renderManager.render())}}},{key:"_onUpdate",value:function(){}},{key:"earthsCoreVec",get:function(){return this._earthsCoreVec},set:function(e){e&&(this._earthsCoreVec=(new tt).copy(e))}},{key:"measureColor",get:function(){return this._measureColor},set:function(e){e&&(this._measureColor=e)}},{key:"measureUnit",get:function(){return this._measureUnit},set:function(e){this._measureUnit=e}},{key:"measureDecimalPlaces",get:function(){return this._measureDecimalPlaces},set:function(e){this._measureDecimalPlaces=e}},{key:"consoleCallBack",set:function(e){e&&(this._consoleCallBack=e)}}]),e}(),YF=function(){function e(t){r(this,e),this.viewer=t,xf.bindAll(["_onMouseUp","_onMouseMove","_onUpdate"],this),this.meshesGroup=new Dt,this.viewer.modelGroup.add(this.meshesGroup)}return o(e,[{key:"addCube",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.color&&(t.color=e.color);var n=new Ti(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments),i=new vA(t),r=new xi(n,i);return e.position&&r.position.copy(e.position),e.parent?e.parent.add(r):this.meshesGroup.add(r),r}},{key:"addSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.color&&(t.color=e.color);var n=new Zs(e.radius,e.widthSegments,e.heightSegments),i=new vA(t),r=new xi(n,i);return e.position&&r.position.copy(e.position),e.parent?e.parent.add(r):this.meshesGroup.add(r),r}},{key:"addTorus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.color&&(t.color=e.color);var n=new ps(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc),i=new vA(t),r=new xi(n,i);return e.position&&r.position.copy(e.position),e.parent?e.parent.add(r):this.meshesGroup.add(r),r}},{key:"addRectPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.color&&(t.color=e.color),e.doubleSide&&(t.side=2);var n=new Yi(e.width,e.height,e.widthSegments,e.heightSegments),i=new vA(t),r=new xi(n,i);return e.position&&r.position.copy(e.position),e.parent?e.parent.add(r):this.meshesGroup.add(r),r}},{key:"addCirclePlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.color&&(t.color=e.color),e.doubleSide&&(t.side=2);var n=new AA(e.radius,e.segments,e.thetaStart,e.thetaLength),i=new vA(t),r=new xi(n,i);return e.position&&r.position.copy(e.position),e.parent?e.parent.add(r):this.meshesGroup.add(r),r}},{key:"show",value:function(){!1===this.meshesGroup.visible&&(this.meshesGroup.visible=!0,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"hide",value:function(){!0===this.meshesGroup.visible&&(this.meshesGroup.visible=!1,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"removeMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.meshesGroup.children.length>0&&(-1===e&&(e=this.meshesGroup.children.length-1),this.meshesGroup.children.splice(e,1),this._consoleCallBack&&this._consoleCallBack(""))}},{key:"clearAll",value:function(){this.meshesGroup.children.length>0&&(this.meshesGroup.children.splice(0,this.meshesGroup.children.length),this._consoleCallBack&&this._consoleCallBack(""))}},{key:"_onMouseUp",value:function(e){}},{key:"_onMouseMove",value:function(e){}},{key:"_onUpdate",value:function(){}},{key:"consoleCallBack",set:function(e){e&&(this._consoleCallBack=e)}}]),e}(),KF=function(){function e(t){r(this,e),this.viewer=t,this.type=e.TYPE_DRAW,xf.bindAll(["_onMouseUp","_onMouseMove","_onUpdate"],this),this.pathsGroup=new Dt,this.viewer.modelGroup.add(this.pathsGroup),this.curPathEditor=null,this.container=document.createElement("div"),this.viewer.container.appendChild(this.container),this.viewer.container.addEventListener("mouseup",this._onMouseUp.bind(this))}return o(e,[{key:"start",value:function(){this.curPathEditor||this.addPathEditor(),this.viewer.domElement.style.cursor="crosshair",this.container.style.display="block",this._consoleCallBack&&this._consoleCallBack("")}},{key:"end",value:function(){this.viewer.domElement.style.cursor="auto",this.container.style.display="none",this.curPathEditor=null,this.viewer.enableTransform&&(this.viewer.enableTransform=!0),this.viewer.transform&&this.viewer.transform.setTarget(null),this.type=e.TYPE_DRAW}},{key:"show",value:function(){!1===this.pathsGroup.visible&&(this.pathsGroup.visible=!0,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"hide",value:function(){!0===this.pathsGroup.visible&&(this.pathsGroup.visible=!1,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"addPathEditor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||this.pathEditorColor;return this.curPathEditor=new HF([],n),this.curPathEditor.addPoints(e),this.pathsGroup.add(this.curPathEditor),this.curPathEditor}},{key:"updatePathEditor",value:function(){for(var e=0;e<this.pathsGroup.children.length;e++){this.pathsGroup.children[e].updatePath()}this.curPathEditor=null,this.end()}},{key:"removePathEditor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.pathsGroup.children.length>0&&(-1===e&&(e=this.pathsGroup.children.length-1),this.pathsGroup.children.splice(e,1),this.curPathEditor=null,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"clearPathEditor",value:function(){this.pathsGroup.children.splice(0,this.pathsGroup.children.length)}},{key:"enableEditor",value:function(){this.type=e.TYPE_EDIT,this._consoleCallBack&&this._consoleCallBack("")}},{key:"loadJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PathEditorData",t=localStorage.getItem(e);if(t){t=JSON.parse(t);for(var n=0;n<t.length;n++){var i=t[n],r=this.addPathEditor(i.points,i.color);this.pathsGroup.add(r)}}this.curPathEditor=null,this._consoleCallBack&&this._consoleCallBack("")}},{key:"saveJson",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PathEditorData",t=[],n=0;n<this.pathsGroup.children.length;n++){var i=this.pathsGroup.children[n],r={points:i.path,color:i.lineColor};t.push(r)}return localStorage.setItem(e,JSON.stringify(t)),this._consoleCallBack&&this._consoleCallBack(""),t}},{key:"_onMouseUp",value:function(t){if(2==t.button)this.end();else if(this.type===e.TYPE_EDIT){var n=[];this.pathsGroup.children.forEach((function(e){n=n.concat(e.dotGroup)}));var i=this.viewer.picker.intersectModels(t,null,null,n);i&&i.length>0?(this.viewer.enableTransform||(this.viewer.enableTransform=!0),this.viewer.transform.setTarget(i[0].object)):this.viewer.transform&&this.viewer.transform.setTarget(null)}else if(this.curPathEditor){var r=this.viewer.picker.screenToVector(t);r&&this.curPathEditor.addPoint(r)}}},{key:"_onMouseMove",value:function(e){}},{key:"_onUpdate",value:function(){}},{key:"pathEditorColor",get:function(){return this._pathEditorColor},set:function(e){e&&(this._pathEditorColor=e)}},{key:"consoleCallBack",set:function(e){e&&(this._consoleCallBack=e)}}]),e}();KF.TYPE_DRAW=0,KF.TYPE_EDIT=1;var JF=.001,qF=function(e){A(n,e);var t=p(n);function n(e,i){var a;return r(this,n),(a=t.call(this)).unselectColor=i||"#FF4500",a.type=e||n.TYPE_RECT,a.decimalPlaces=3,a.init(),a}return o(n,[{key:"init",value:function(){this.hided=!1,this.pathEditor=new HF([],this.unselectColor),this.pathEditor.isClose=!0,this.add(this.pathEditor),this.panelNode=new Dt,this.add(this.panelNode)}},{key:"addPoint",value:function(e,t){if(this.type===n.TYPE_POLYGON)e&&(Array.isArray(e)?this.pathEditor.addLongLat(e):this.pathEditor.addPoint(e)),this.pathEditor.path.length>=3&&this.addAreaPanel(this.pathEditor.path);else if(this.type===n.TYPE_RECT){if(e)if(this.firstPoint){for(;this.pathEditor.path.length>0;)this.pathEditor.removePoint();if(Array.isArray(e)){var i=this.firstPoint,r=[e[0],e[1]],a=[i[0],e[1]],o=[e[0],i[1]];this.pathEditor.addLongLat(i),this.pathEditor.addLongLat(a),this.pathEditor.addLongLat(r),this.pathEditor.addLongLat(o)}else{var s=this.firstPoint.clone(),A=e,l=new tt(s.x,s.y,A.z),c=new tt(A.x,A.y,s.z);this.pathEditor.addPoint(s),this.pathEditor.addPoint(l),this.pathEditor.addPoint(A),this.pathEditor.addPoint(c)}this.addAreaPanel(this.pathEditor.path),t&&t()}else Array.isArray(e)?this.firstPoint=[e[0],e[1]]:this.firstPoint=(new tt).copy(e)}else if(this.type===n.TYPE_CIRCULAR){if(e)if(this.firstPoint){for(;this.pathEditor.path.length>0;)this.pathEditor.removePoint();if(Array.isArray(e))for(var h=new Je(this.firstPoint[0],this.firstPoint[1]).distanceTo(new Je(e[0],e[1])),u=0;u<=360;u+=10){var d=u/180*Math.PI,f=this.firstPoint[0]+h*Math.cos(d),p=this.firstPoint[1]+h*Math.sin(d);this.pathEditor.addLongLat([f,p])}else{e.y=this.firstPoint.y;for(var m=this.firstPoint.distanceTo(e),g=0;g<=360;g+=10){var v=g/180*Math.PI,y=this.firstPoint.x+m*Math.cos(v),w=this.firstPoint.z+m*Math.sin(v);this.pathEditor.addPoint({x:y,y:this.firstPoint.y,z:w})}}this.addAreaPanel(this.pathEditor.path),t&&t()}else Array.isArray(e)?this.firstPoint=[e[0],e[1]]:this.firstPoint=(new tt).copy(e);this.pathEditor.dotGroup.visible=!1}}},{key:"addPoints",value:function(e){var t=this;e.forEach((function(e){t.addPoint(e)}))}},{key:"addLongLats",value:function(e){var t=this;e.forEach((function(e){t.addLongLat(e)}))}},{key:"removePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.pathEditor.removePoint(e)}},{key:"updatePath",value:function(){this.pathEditor.updatePath(),this.updatePanel()}},{key:"clearPanel",value:function(){for(;this.panelNode.children.length>0;)this.panelNode.remove(this.panelNode.children[0])}},{key:"updatePanel",value:function(){this.clearPanel();this.addPoint(null)}},{key:"close",value:function(e){e&&e()}},{key:"hide",value:function(){this.visible=!1}},{key:"show",value:function(){this.visible=!0}},{key:"filter",value:function(e,t){var n=this.getLoop(t);if(n.length>=3)for(var i=0;i<e.length;i++){var r=e[i],a=r.getWorldPosition(new tt).clone();a.applyMatrix4(t),a=this.pointRegular(a);var o=this.pointAtLoop(n,a);r.visible="out"!=o}}},{key:"pointRegular",value:function(e){return new tt(parseFloat(e.x.toFixed(this.decimalPlaces)),parseFloat(e.y.toFixed(this.decimalPlaces)),parseFloat(e.z.toFixed(this.decimalPlaces)))}},{key:"getLoop",value:function(e){var t=this,n=this.pathEditor.path,i=[];n.forEach((function(n){var r=n.clone().applyMatrix4(e);r=t.pointRegular(r),i.push(r)}));for(var r=[],a=null,o=0;o<i.length;o++){var s=o==i.length-1,A=i[o],l=s?i[0]:i[o+1],c=A.distanceTo(l);if(c<JF)i.splice(o,1),o--;else{var h={startPoint:A,endPoint:l,lineLen:c,dir:l.clone().sub(A).normalize()};r.push(h),a&&(a.next=h,h.pre=a),a=h}}r[r.length-1].next=r[0],r[0].pre=r[r.length-1];for(var u=0;u<r.length;u++){var d=r[u];if(d.lineLen<JF)r.remove(d),u--,d.next.startPoint=d.startPoint.clone(),d.next.pre=d.pre,d.pre.next=d.next;else{var f=d.dir.angleTo(d.next.dir);f<JF?(r.remove(d.next),u--,d.endPoint=d.next.endPoint.clone(),d.next=d.next.next,d.next.pre=d):Math.PI-f<JF&&(d.lineLen>d.next.lineLen?(r.remove(d.next),u--,d.endPoint=d.next.endPoint.clone(),d.next=d.next.next,d.next.pre=d):(r.remove(d),u--,d.next.startPoint=d.startPoint.clone(),d.next.pre=d.pre,d.pre.next=d.next))}}return r}},{key:"pointAtLoop",value:function(e,t){for(var n=t.x,i=t.y,r={},a="out",o=0;o<e.length;o++){var s=e[o],A=s.startPoint,l=A.x,c=A.y,h=s.endPoint,u=h.x,d=h.y;if(!(c>i&&d>i))if(n!=l||n!=u){if(!(n>l&&n>u||n<l&&n<u)){var f=u-l;if(!(Math.abs(f)<JF)){var p=c+(n-l)*((d-c)/f);if(!(p>i)){if(p==i)return a=n==l||n==u?"atpoint":"atline";if(n==l){if(s.endPoint.x>n&&s.pre.startPoint.x>n||s.endPoint.x<n&&s.pre.startPoint.x<n)continue}else if(n==u&&(s.startPoint.x>n&&s.next.endPoint.x>n||s.startPoint.x<n&&s.next.endPoint.x<n))continue;var m=n.toFixed(3)+"_"+p.toFixed(3);r[m]||(r[m]=!0)}}}}else{var g=void 0,v=void 0;if(c>d?(g=c,v=d):(g=d,v=c),i>=v&&i<=g)return a="atline";if(s.pre.startPoint.x>n&&s.next.endPoint.x>n||s.pre.startPoint.x<n&&s.next.endPoint.x<n);else{var y=l.toFixed(3)+"_"+v.toFixed(3)+"_"+u.toFixed(3)+"_"+g.toFixed(3);r[y]||(r[y]=!0)}}}var w=0;for(var x in r)w++;return w%2==1&&(a="in"),a}},{key:"addAreaPanel",value:function(e){this.clearPanel();var t=this.getFaces(e),n=[];e.forEach((function(e){n.push(e.x,e.y,e.z)}));var i=[];t.forEach((function(e){i.push(e[0],e[1],e[2])}));var r=new ni;r.attributes.position=new Dn(new Float32Array(n),3),r.index=new Dn(new Uint16Array(i),1);var a=new kn({side:2,transparent:!0,opacity:.2,depthTest:!1,depthWrite:!1});a.color=new Sn(this.unselectColor);var o=new xi(r,a);o.renderOrder=5e3,this.panelNode.add(o)}},{key:"computePolyArea",value:function(e){e||(e=this.pathEditor.path);for(var t=0,n=this.getFaces(e),i=0;i<n.length;i++){var r=n[i],a=e[r[0]],o=e[r[1]],s=e[r[2]];t+=this.computeTriArea(a,o,s)}return t}},{key:"getFaces",value:function(e){if(e.length<3)return[];for(var t,n,i,r,a,o,s=!1,A=0;A<e.length-1;A++)if(t=e[A],n=e[(A+1)%e.length],i=e[(A+2)%e.length],this.computeTriArea(t,n,i)){s=!0;break}if(!s)return[];r=n.clone().sub(t).normalize(),a=i.clone().sub(n).normalize(),o=r.clone().cross(a).normalize(),Math.abs(o.x);for(var l=Math.abs(o.y)<JF,c=Math.abs(o.z)<JF,h=[],u=0;u<e.length;u++){var d=e[u],f=void 0;f=l?new Je(c?d.z:d.x,d.y):new Je(d.x,d.z),h.push(f)}return Ns.triangulateShape(h,[])}},{key:"computeTriArea",value:function(e,t,n){var i=t.distanceTo(e),r=n.distanceTo(t),a=e.distanceTo(n),o=(i+r+a)/2;return Math.sqrt(o*(o-i)*(o-r)*(o-a))}},{key:"select",value:function(){this.children.forEach((function(e){"Edge"===e.name&&e.material.color.setStyle("#FF0000")})),this.lengthMesh.material=this.lengthMesh.selectMat,this.lengthMesh.back.material=this.lengthMesh.back.selectMat,this.lengthMesh.material.map.needsUpdate=!0,this.lengthMesh.back.material.map.needsUpdate=!0}},{key:"unSelect",value:function(){var e=this;this.children.forEach((function(t){"Edge"===t.name&&t.material.color.setStyle(e.unselectColor)})),this.lengthMesh.material=this.lengthMesh.unselectMat,this.lengthMesh.back.material=this.lengthMesh.back.unselectMat,this.lengthMesh.material.map.needsUpdate=!0,this.lengthMesh.back.material.map.needsUpdate=!0}},{key:"viewer",get:function(){return this._viewer},set:function(e){e&&(this._viewer=e,this.pathEditor&&(this.pathEditor.viewer=e))}},{key:"curDot",get:function(){return this.pathEditor.curDot}},{key:"unselectColor",get:function(){return this._unselectColor},set:function(e){e&&(this._unselectColor=e)}},{key:"pointMaterial",get:function(){if(!this._pointMaterial){var e=document.createElement("canvas");e.width=e.height=16;var t=e.getContext("2d");t.beginPath(),t.arc(8,8,8,0,2*Math.PI),t.fillStyle=this.unselectColor,t.fill(),this._pointMaterial=new to({map:new Ko(e),sizeAttenuation:!1,depthTest:!1,depthWrite:!1})}return this._pointMaterial}},{key:"toJSON",value:function(){var e={type:this.type,color:this.unselectColor},t=this.pathEditor.longlats;if(t&&t.length>0)this.type===n.TYPE_RECT&&t.length>3?e.longlats=[t[0],t[2]]:this.type===n.TYPE_CIRCULAR&&t.length>1?e.longlats=[this.firstPoint,t[0]]:this.type===n.TYPE_POLYGON&&t.length>3?e.longlats=t:e=null;else{var i=this.pathEditor.path;this.type===n.TYPE_RECT&&i.length>3?e.points=[i[0],i[2]]:this.type===n.TYPE_CIRCULAR&&i.length>1?e.points=[this.firstPoint,i[0]]:this.type===n.TYPE_POLYGON&&i.length>3?e.points=i:e=null}return e}},{key:"loadJson",value:function(e){e.longlats?this.addPoints(e.longlats):this.addPoints(e.points)}},{key:"reset",value:function(){for(var e=this.showUnit,t=this.decimalPlaces,n=this.toJSON();this.children.length>0;)this.remove(this.children[0]);this.init(),this.showUnit=e,this.decimalPlaces=t,this.loadJson(n)}},{key:"destroy",value:function(){}}]),n}(Dt);qF.TYPE_RECT=0,qF.TYPE_CIRCULAR=1,qF.TYPE_POLYGON=2;var $F=function(){function e(t){r(this,e),this.viewer=t,this.selectionsGroup=new Dt,this.viewer.modelGroup.add(this.selectionsGroup),this.curSelection=null,this.container=document.createElement("div"),this.viewer.container.appendChild(this.container),this.earthsCoreVec=new tt,this._onMouseUp=this._onMouseUp.bind(this),this._onMouseMove=this._onMouseMove.bind(this)}return o(e,[{key:"polygonSelection",value:function(){this.start(qF.TYPE_POLYGON),this._consoleCallBack&&this._consoleCallBack("")}},{key:"rectSelection",value:function(){this.start(qF.TYPE_RECT),this._consoleCallBack&&this._consoleCallBack("")}},{key:"circularSelection",value:function(){this.start(qF.TYPE_CIRCULAR),this._consoleCallBack&&this._consoleCallBack("")}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qF.TYPE_POLYGON;this.curSelection?this.curSelection.type!=e&&(this.removeSelection(),this.addSelection(e)):this.addSelection(e),this.viewer.container.addEventListener("mouseup",this._onMouseUp),this.viewer.container.addEventListener("mousemove",this._onMouseMove),this.viewer.domElement.style.cursor="crosshair",this.container.style.display="block"}},{key:"end",value:function(){this._endCallBack&&this._endCallBack(this.curSelection),this.curSelection&&(this.curSelection=null),this.viewer.container.removeEventListener("mouseup",this._onMouseUp),this.viewer.container.removeEventListener("mousemove",this._onMouseMove),this.viewer.domElement.style.cursor="auto",this.container.style.display="none"}},{key:"filter",value:function(e){if(this.curSelection&&this.end(),this.selectionsGroup.children.length>0){var t=this.selectionsGroup.children[this.selectionsGroup.children.length-1],n=this.viewer.camera.matrix.clone();n.setPosition(0,0,0);var i=(new vt).getInverse(n);t.filter(e,i)}this._consoleCallBack&&this._consoleCallBack("")}},{key:"show",value:function(){!1===this.selectionsGroup.visible&&(this.selectionsGroup.visible=!0,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"hide",value:function(){!0===this.selectionsGroup.visible&&(this.selectionsGroup.visible=!1,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"addSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qF.TYPE_POLYGON,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||this.selectionColor;return this.curSelection=new qF(e,n),this.curSelection.viewer=this.viewer,this.selectionsGroup.add(this.curSelection),this.curSelection}},{key:"removeSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.selectionsGroup.children.length>0&&(-1===e&&(e=this.selectionsGroup.children.length-1),this.selectionsGroup.children.splice(e,1),this.curSelection=null,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"clearSelection",value:function(){this.selectionsGroup.children.splice(0,this.selectionsGroup.children.length)}},{key:"loadJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SelectionData",t=localStorage.getItem(e);if(t){t=JSON.parse(t);for(var n=0;n<t.length;n++){var i=t[n],r=this.addSelection(i.type,i.color);r.loadJson(i),this.selectionsGroup.add(r)}}this.curSelection=null,this._consoleCallBack&&this._consoleCallBack("")}},{key:"saveJson",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SelectionData",t=[],n=0;n<this.selectionsGroup.children.length;n++){var i=this.selectionsGroup.children[n],r=i.toJSON();t.push(r)}return localStorage.setItem(e,JSON.stringify(t)),this._consoleCallBack&&this._consoleCallBack(""),t}},{key:"_onMouseUp",value:function(e){if(2==e.button)this.curSelection&&this.end();else if(this.curSelection)if(this.viewer.isGISViewer){var t=this.viewer.pickPosition(e);if(t){var n=this.viewer.vector3ToCoordinates(t),i=this;this.curSelection.addPoint(n,(function(){i.end()}))}}else{var r=this.viewer.picker.screenToVector(e);if(r){var a=this;this.curSelection.addPoint(r,(function(){a.end()}))}}}},{key:"_onMouseMove",value:function(e){if(this.curSelection&&this.curSelection.firstPoint)if(this.viewer.isGISViewer){var t=this.viewer.pickPosition(e);if(t){var n=this.viewer.vector3ToCoordinates(t);this.curSelection.addPoint(n)}}else{var i=this.viewer.picker.screenToVector(e);i&&this.curSelection.addPoint(i)}}},{key:"_onUpdate",value:function(){}},{key:"destory",value:function(){this.end(),this.viewer.modelGroup.remove(this.selectionsGroup)}},{key:"selectionColor",get:function(){return this._selectionColor},set:function(e){e&&(this._selectionColor=e)}},{key:"consoleCallBack",set:function(e){e&&(this._consoleCallBack=e)}},{key:"endCallBack",set:function(e){e&&(this._endCallBack=e)}}]),e}(),e_=" \n                uniform float size; \n                uniform float time; \n                uniform float u_len; \n                attribute float u_index;\n                varying float u_opacitys;\n                void main() { \n                    if( u_index < time + u_len && u_index > time){\n                        float u_scale = 1.0 - (time + u_len - u_index) /u_len;\n                        u_opacitys = u_scale;\n                        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                        gl_Position = projectionMatrix * mvPosition;\n                        gl_PointSize = size * u_scale * 1.0;\n                    } \n                }\n                ",t_=" \n                uniform sampler2D u_map;\n                uniform float u_opacity;\n                uniform vec3 color;\n                uniform float isTexture;\n                varying float u_opacitys;\n                void main() {\n                    vec4 u_color = vec4(color,u_opacity * u_opacitys);\n                    gl_FragColor = u_color;\n                }",n_=function(e){A(n,e);var t=p(n);function n(e,i,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#02E6FF";return r(this,n),(o=t.call(this)).flyId=0,o.flyArr=[],o.baicSpeed=1,Array.isArray(e)&&(e=(new tt).fromArray(e)),Array.isArray(i)&&(i=(new tt).fromArray(i)),o.start=e,o.end=i,o.height=a,o.color=s,o._baseScale=.1,o._opacity=1,o._init(),o}return o(n,[{key:"_initCurve",value:function(){var e=new fl(this.start,new tt((this.start.x+this.end.x)/2,2*this.height,(this.start.z+this.end.z)/2),this.end);return this.curveLength=e.getLength(),e.getPoints(40*this.start.distanceTo(this.end))}},{key:"_init",value:function(){var e=this,t=this._initCurve(),n=new Si;n.vertices=t,this.baseLine=new Ro(n,new Fo({color:this.color})),this.add(this.baseLine),this._createFlyLine(t,this.color,{}),this.timer=setInterval((function(){e._createFlyLine(e._initCurve(),e.color,{}),e.flyArr.length>=3&&clearInterval(e.timer)}),3e3),this.pointMaterial=new kn({map:xf.createCircleMap(this.color),side:2,transparent:!0}),this.startPoint=new xi(new AA(1,32),this.pointMaterial),this.startPoint.rotation.x=Math.PI/2,this.startPoint.position.copy(this.start),this.endPoint=new xi(new AA(1,32),this.pointMaterial),this.endPoint.position.copy(this.end),this.endPoint.rotation.x=Math.PI/2,this.add(this.startPoint),this.add(this.endPoint)}},{key:"_createGeometry",value:function(e,t){t=t||new ni;var n=[],i=[];return e.forEach((function(e,t){n.push(e.x,e.y,e.z),i.push(t)})),t.setAttribute("position",new Vn(n,3)),t.setAttribute("u_index",new Vn(i,1)),t}},{key:"_createFlyLine",value:function(e,t,n){var i=n.width,r=void 0===i?3:i;n.length,n.speed;var a=n.repeat,o=void 0===a?1/0:a,s=new Pi({uniforms:{color:{value:new Sn(t).lerp(new Sn(1,1,1),.3),type:"v3"},size:{value:r,type:"f"},u_len:{value:10*this.curveLength,type:"f"},u_opacity:{value:.7,type:"f"},time:{value:-10*this.curveLength,type:"f"}},transparent:!0,depthTest:!1,vertexShader:e_,fragmentShader:t_,defaultAttributeValues:{}}),A=this._createGeometry(e);this.points=new Xo(A,s),this.points._speed=this.curveLength/3,this.points._repeat=o,this.points._been=0,this.points._total=e.length,this.flyId++,this.flyArr.push(this.points),this.add(this.points)}},{key:"update",value:function(e){var t=this;e>.2||(this.flyArr.forEach((function(n){if(n.parent)if(n._been>n._repeat)n.visible=!1,"function"==typeof n._callback&&n._callback(n),t.remove(n);else{var i=n.material.uniforms;i.time.value<n._total?i.time.value+=e*(t.baicSpeed/e)*n._speed:(n._been+=1,i.time.value=-i.u_len.value)}})),this._baseScale+=15*e,this._baseScale=this._baseScale>1?.2:this._baseScale,this.startPoint.scale.set(this._baseScale,this._baseScale,this._baseScale),this.endPoint.scale.copy(this.startPoint.scale))}},{key:"_updateLine",value:function(){var e=this;this.startPoint.position.copy(this.start),this.endPoint.position.copy(this.end);var t=this._initCurve(),n=new Si;n.vertices=t,this.baseLine.geometry.dispose(),this.baseLine.geometry=n,this.flyArr.forEach((function(n){e._createGeometry(t,n.geometry),n.geometry.verticesNeedUpdate=!0}))}},{key:"onAfterRender",value:function(){AMRT.needsUpdate=!0}},{key:"setHeight",value:function(e){e!=this.height&&(this.height=e,this._updateLine())}},{key:"setStartPoint",value:function(e){this.start=e,this._updateLine()}},{key:"setEndPoint",value:function(e){this.end=e,this._updateLine()}},{key:"setColor",value:function(e){this.color=e,this.baseLine.material.color.setStyle(this.color);var t=new Sn(e).lerp(new Sn(1,1,1),.3);this.flyArr.forEach((function(e){e.material.uniforms.color.value.copy(t)})),this.pointMaterial.map=xf.createCircleMap(this.color),this.pointMaterial.map.needsUpdate=!0}},{key:"toJSON",value:function(){return{start:this.start,end:this.end,height:this.height,color:this.color}}},{key:"dispose",value:function(){for(;0<this.children.length;){var e=this.children[0];this.remove(e),e.geometry.dispose(),e.material.dispose()}this.parent&&this.parent.remove(this)}}]),n}(zm),i_=function(){function e(t){r(this,e),this.viewer=t,this.flyLinesGroup=new Dt,this.viewer.modelGroup.add(this.flyLinesGroup),this.circleGroup=new Dt,this.viewer.modelGroup.add(this.circleGroup),this.flyLineColor="#02E6FF",this.flyLinePoints=[],this.curFlyLine=null,this.container=document.createElement("div"),this.viewer.container.appendChild(this.container),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseMove=this._onMouseMove.bind(this)}return o(e,[{key:"start",value:function(){this.curFlyLine&&(this.removeFlyLine(),this.flyLinePoints=[]),this.viewer.container.addEventListener("mouseup",this._onMouseUp),this.viewer.container.addEventListener("mousemove",this._onMouseMove),this.viewer.domElement.style.cursor="crosshair",this.container.style.display="block"}},{key:"end",value:function(){this.flyLinePoints=[],this._endCallBack&&this._endCallBack(this.curFlyLine),this.curFlyLine&&(this.curFlyLine=null),this.circle&&(this.circle.visible=!1),this.viewer.container.removeEventListener("mouseup",this._onMouseUp),this.viewer.container.removeEventListener("mousemove",this._onMouseMove),this.viewer.domElement.style.cursor="auto",this.container.style.display="none"}},{key:"show",value:function(){!1===this.flyLinesGroup.visible&&(this.flyLinesGroup.visible=!0,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"hide",value:function(){!0===this.flyLinesGroup.visible&&(this.flyLinesGroup.visible=!1,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"addFlyLine",value:function(e,t,n,i){return this.curFlyLine=new n_(e,t,n||.3*e.distanceTo(t),i||this.flyLineColor),this.flyLinesGroup.add(this.curFlyLine),this.curFlyLine}},{key:"removeFlyLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.flyLinesGroup.children.length>0&&(-1===e&&(e=this.flyLinesGroup.children.length-1),this.flyLinesGroup.children.splice(e,1),this.curFlyLine=null,this._consoleCallBack&&this._consoleCallBack(""))}},{key:"clearFlyLine",value:function(){this.flyLinesGroup.children.splice(0,this.flyLinesGroup.children.length)}},{key:"loadJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FlyLineData",t=localStorage.getItem(e);if(t){t=JSON.parse(t);for(var n=0;n<t.length;n++){var i=t[n],r=this.addFlyLine((new tt).copy(i.start),(new tt).copy(i.end),i.height,i.color);this.flyLinesGroup.add(r)}}this.curFlyLine=null,this._consoleCallBack&&this._consoleCallBack("")}},{key:"saveJson",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"FlyLineData",t=[],n=0;n<this.flyLinesGroup.children.length;n++){var i=this.flyLinesGroup.children[n],r=i.toJSON();t.push(r)}return localStorage.setItem(e,JSON.stringify(t)),this._consoleCallBack&&this._consoleCallBack(""),t}},{key:"addCircle",value:function(e,t){return this.circle?t!=this.oldColor&&(this.circleGroup.remove(this.circle),this.circle=this.createCircle(t),this.circleGroup.add(this.circle)):(this.circle=this.createCircle(t),this.circleGroup.add(this.circle)),e&&this.circle.position.copy(e),this.circle.visible=!0,this.circle}},{key:"createCircle",value:function(e){var t=new kn({map:xf.createCircleMap(e),side:2,transparent:!0}),n=new xi(new AA(2,32),t);return n.rotation.x=Math.PI/2,n}},{key:"_onMouseUp",value:function(e){if(0===e.button){var t=this.viewer.picker.screenToVector(e);t&&(this.flyLinePoints.push(t),2===this.flyLinePoints.length?(this.addFlyLine(this.flyLinePoints[0],this.flyLinePoints[1]),this.flyLinePoints=[],this.circle.visible=!1):this.addCircle(t,this.flyLineColor))}else 2===e.button&&this.end()}},{key:"_onMouseMove",value:function(e){}},{key:"_onUpdate",value:function(){}},{key:"destory",value:function(){this.end(),this.viewer.modelGroup.remove(this.flyLinesGroup)}},{key:"flyLineColor",get:function(){return this._flyLineColor},set:function(e){e&&(this._flyLineColor=e)}},{key:"consoleCallBack",set:function(e){e&&(this._consoleCallBack=e)}},{key:"endCallBack",set:function(e){e&&(this._endCallBack=e)}}]),e}();return e.ACESFilmicToneMapping=5,e.AMRTBasicMaterial=xA,e.AMRTShadowMaterial=bA,e.AddEquation=I,e.AddOperation=2,e.AdditiveBlending=2,e.AlphaFormat=re,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=Ll,e.AmbientLightProbe=$l,e.Anchor=tm,e.AnimationClip=RA,e.AnimationLoader=jA,e.AnimationMixer=Fc,e.AnimationObjectGroup=Tc,e.AnimationUtils=MA,e.ArcCurve=$A,e.ArrayCamera=za,e.ArrowHelper=_h,e.Audio=lc,e.AudioAnalyser=pc,e.AudioContext=Zl,e.AudioListener=Ac,e.AudioLoader=Yl,e.AxesHelper=Uh,e.AxisHelper=function(e){return console.warn("AxisHelper has been renamed to AxesHelper."),new Uh(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicMeshTool=YF,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("BinaryTextureLoader has been renamed to DataTextureLoader."),new XA(e)},e.Bone=Mo,e.BooleanKeyframeTrack=LA,e.BoundingBoxHelper=function(e,t){return console.warn("BoundingBoxHelper has been deprecated. Creating a BoxHelper instead."),new Ih(e,t)},e.Box2=Gc,e.Box3=Jt,e.Box3Helper=Eh,e.BoxBufferGeometry=Li,e.BoxGeometry=Ti,e.BoxHelper=Ih,e.BufferAttribute=Dn,e.BufferGeometry=ni,e.BufferGeometryLoader=Dl,e.ByteType=1010,e.Cache=HA,e.Camera=ki,e.CameraHelper=Ch,e.CameraViewMode=Vf,e.CanvasRenderer=function(){console.error("CanvasRenderer has been removed")},e.CanvasTexture=Ko,e.CatmullRomCurve3=al,e.CineonToneMapping=4,e.CircleBufferGeometry=lA,e.CircleGeometry=AA,e.ClampToEdgeWrapping=Q,e.Clipping=nF,e.Clock=ic,e.ClosedSplineCurve3=Gh,e.Color=Sn,e.ColorKeyframeTrack=FA,e.CompressedTexture=Yo,e.CompressedTextureLoader=WA,e.ConeBufferGeometry=sA,e.ConeGeometry=oA,e.CubeCamera=Oi,e.CubeGeometry=Ti,e.CubeReflectionMapping=k,e.CubeRefractionMapping=D,e.CubeTexture=Ar,e.CubeTextureLoader=YA,e.CubeUVReflectionMapping=O,e.CubeUVRefractionMapping=N,e.CubicBezierCurve=ll,e.CubicBezierCurve3=cl,e.CubicInterpolant=IA,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=JA,e.CurvePath=gl,e.CustomBlending=5,e.CylinderBufferGeometry=aA,e.CylinderGeometry=rA,e.Cylindrical=Oc,e.DataTexture=Gi,e.DataTexture2DArray=lr,e.DataTexture3D=cr,e.DataTextureLoader=XA,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=GA,e.DepthFormat=ce,e.DepthStencilFormat=he,e.DepthTexture=Jo,e.DirectionalLight=Tl,e.DirectionalLightHelper=wh,e.DirectionalLightIcon=GF,e.DirectionalLightShadow=Sl,e.DiscreteInterpolant=SA,e.DodecahedronBufferGeometry=cs,e.DodecahedronGeometry=ls,e.DoubleSide=2,e.DstAlphaFactor=_,e.DstColorFactor=U,e.DynamicBufferAttribute=function(e,t){return console.warn("DynamicBufferAttribute has been removed. Use new BufferAttribute().setDynamic( true ) instead."),new Dn(e,t).setDynamic(!0)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=Ve,e.DynamicReadUsage=35049,e.EdgesGeometry=iA,e.EdgesHelper=function(e,t){return console.warn("EdgesHelper has been removed. Use EdgesGeometry instead."),new Go(new iA(e.geometry),new Fo({color:void 0!==t?t:16777215}))},e.EllipseCurve=qA,e.EntityFactory=hF,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=R,e.Euler=xt,e.Event=Xu,e.EventDispatcher=Xe,e.ExtrudeBufferGeometry=zs,e.ExtrudeBufferGeometry2=Wh,e.ExtrudeGeometry=Hs,e.ExtrudeGeometry2=jh,e.Face3=_n,e.Face4=function(e,t,n,i,r,a,o){return console.warn("Face4 has been removed. A Face3 will be created instead."),new _n(e,t,n,r,a,o)},e.FaceColors=1,e.FaceNormalsHelper=mh,e.FileLoader=VA,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("Float32Attribute has been removed. Use new Float32BufferAttribute() instead."),new Vn(e,t)},e.Float32BufferAttribute=Vn,e.Float64Attribute=function(e,t){return console.warn("Float64Attribute has been removed. Use new Float64BufferAttribute() instead."),new jn(e,t)},e.Float64BufferAttribute=jn,e.FloatType=q,e.FlyLineTool=i_,e.Fog=qa,e.FogExp2=Ja,e.Font=jl,e.FontLoader=Xl,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=0,e.Frustum=zi,e.GISViewer=eF,e.GammaEncoding=De,e.Geometry=Si,e.GeometryUtils=zh,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=ch,e.Group=Ha,e.HalfFloatType=$,e.HemisphereLight=xl,e.HemisphereLightHelper=Ah,e.HemisphereLightProbe=ql,e.IconHelper=MF,e.IcosahedronBufferGeometry=As,e.IcosahedronGeometry=ss,e.ImageBitmapLoader=zl,e.ImageLoader=ZA,e.ImageUtils=at,e.ImmediateRenderObject=Vc,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=kl,e.InstancedBufferGeometry=Pl,e.InstancedInterleavedBuffer=Uc,e.InstancedMesh=Lo,e.Int16Attribute=function(e,t){return console.warn("Int16Attribute has been removed. Use new Int16BufferAttribute() instead."),new Gn(e,t)},e.Int16BufferAttribute=Gn,e.Int32Attribute=function(e,t){return console.warn("Int32Attribute has been removed. Use new Int32BufferAttribute() instead."),new Hn(e,t)},e.Int32BufferAttribute=Hn,e.Int8Attribute=function(e,t){return console.warn("Int8Attribute has been removed. Use new Int8BufferAttribute() instead."),new Rn(e,t)},e.Int8BufferAttribute=Rn,e.IntType=1013,e.InterleavedBuffer=$a,e.InterleavedBufferAttribute=eo,e.Interpolant=BA,e.InterpolateDiscrete=Se,e.InterpolateLinear=Te,e.InterpolateSmooth=Le,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("JSONLoader has been removed.")},e.KeepStencilOp=He,e.KeyframeTrack=TA,e.LOD=yo,e.LargeSceneLoader=wg,e.LargeSceneLoader2=Ng,e.LatheBufferGeometry=$s,e.LatheGeometry=qs,e.Layers=bt,e.LensFlare=function(){console.error("LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=wl,e.LightProbe=Jl,e.LightProbeHelper=lh,e.LightShadow=bl,e.Line=Ro,e.Line3=zc,e.LineBasicMaterial=Fo,e.LineCurve=hl,e.LineCurve3=ul,e.LineDashedMaterial=wA,e.LineLoop=Qo,e.LinePieces=1,e.LineSegments=Go,e.LineStrip=0,e.LinearEncoding=Pe,e.LinearFilter=W,e.LinearInterpolant=EA,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=Z,e.LinearMipmapNearestFilter=X,e.LinearToneMapping=1,e.Loader=QA,e.LoaderUtils=Ul,e.LoadingManager=NA,e.LogLuvEncoding=3003,e.LoopOnce=Ie,e.LoopPingPong=2202,e.LoopRepeat=Ee,e.LuminanceAlphaFormat=Ae,e.LuminanceFormat=se,e.MOUSE=B,e.Material=Pn,e.MaterialLoader=_l,e.Math=Ke,e.MathUtils=Oh,e.Matrix3=rt,e.Matrix4=vt,e.MaxEquation=104,e.Measure3D=XF,e.Measure3DTool=ZF,e.Mesh=xi,e.MeshBasicMaterial=kn,e.MeshDepthMaterial=Pa,e.MeshDistanceMaterial=ka,e.MeshLambertMaterial=vA,e.MeshMatcapMaterial=yA,e.MeshNormalMaterial=gA,e.MeshPhongMaterial=pA,e.MeshPhysicalMaterial=fA,e.MeshStandardMaterial=dA,e.MeshToonMaterial=mA,e.MinEquation=103,e.MirroredRepeatWrapping=H,e.MixOperation=1,e.MultiMaterial=Nh,e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=z,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=j,e.NearestMipmapNearestFilter=V,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=_A,e.Object3D=Dt,e.ObjectLoader=Ol,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=os,e.OctahedronGeometry=as,e.OneFactor=S,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=F,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=El,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.ParametricBufferGeometry=es,e.ParametricGeometry=$o,e.Particle=function(e){return console.warn("Particle has been renamed to Sprite."),new po(e)},e.ParticleBasicMaterial=function(e){return console.warn("ParticleBasicMaterial has been renamed to PointsMaterial."),new Ho(e)},e.ParticleSystem=function(e,t){return console.warn("ParticleSystem has been renamed to Points."),new Xo(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("ParticleSystemMaterial has been renamed to PointsMaterial."),new Ho(e)},e.Path=vl,e.PathEditor=HF,e.PathEditorTool=KF,e.PathTween=zF,e.PerspectiveCamera=Di,e.Plane=dn,e.PlaneBufferGeometry=Ki,e.PlaneGeometry=Yi,e.PlaneHelper=Sh,e.PointCloud=function(e,t){return console.warn("PointCloud has been renamed to Points."),new Xo(e,t)},e.PointCloudMaterial=function(e){return console.warn("PointCloudMaterial has been renamed to PointsMaterial."),new Ho(e)},e.PointLight=Il,e.PointLightHelper=ih,e.Points=Xo,e.PointsMaterial=Ho,e.PolarGridHelper=hh,e.PolyhedronBufferGeometry=ns,e.PolyhedronGeometry=ts,e.PositionalAudio=fc,e.PositionalAudioHelper=uh,e.PropertyBinding=Sc,e.PropertyMixer=mc,e.QuadraticBezierCurve=dl,e.QuadraticBezierCurve3=fl,e.Quaternion=qe,e.QuaternionKeyframeTrack=PA,e.QuaternionLinearInterpolant=UA,e.REVISION=M,e.RGBADepthPacking=Qe,e.RGBAFormat=oe,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=be,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_BPTC_Format=Ce,e.RGBA_ETC2_EAC_Format=Be,e.RGBA_PVRTC_2BPPV1_Format=we,e.RGBA_PVRTC_4BPPV1_Format=ye,e.RGBA_S3TC_DXT1_Format=fe,e.RGBA_S3TC_DXT3_Format=pe,e.RGBA_S3TC_DXT5_Format=me,e.RGBDEncoding=Ge,e.RGBEEncoding=Re,e.RGBEFormat=le,e.RGBELoader=Ph,e.RGBFormat=ae,e.RGBM16Encoding=Ne,e.RGBM7Encoding=Oe,e.RGB_ETC1_Format=xe,e.RGB_ETC2_Format=Me,e.RGB_PVRTC_2BPPV1_Format=ve,e.RGB_PVRTC_4BPPV1_Format=ge,e.RGB_S3TC_DXT1_Format=de,e.RawShaderMaterial=uA,e.Ray=ln,e.Raycaster=Pc,e.RectAreaLight=Fl,e.RectAreaLightHelper=rh,e.RedFormat=ue,e.ReinhardToneMapping=2,e.RenderOrder2=We,e.RenderOrder3=3e3,e.RenderOrder5=je,e.RepeatWrapping=G,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Js,e.RingGeometry=Ks,e.Scene=Rt,e.SceneUtils=Vh,e.ScreenHelper=QF,e.SelectionTool=$F,e.ShaderChunk=Vi,e.ShaderLib=Wi,e.ShaderMaterial=Pi,e.ShadowHelper=PF,e.ShadowMaterial=hA,e.Shape=yl,e.ShapeBufferGeometry=tA,e.ShapeGeometry=eA,e.ShapePath=Vl,e.ShapeUtils=Ns,e.ShortType=1011,e.Skeleton=Co,e.SkeletonHelper=nh,e.SkinnedMesh=wo,e.SmoothShading=2,e.Sphere=en,e.SphereBufferGeometry=Ys,e.SphereGeometry=Zs,e.Spherical=Rc,e.SphericalHarmonics3=Kl,e.SphericalReflectionMapping=305,e.Spline=Hh,e.SplineCurve=pl,e.SplineCurve3=Qh,e.SpotLight=Ml,e.SpotLightHelper=Jc,e.SpotLightShadow=Cl,e.Sprite=po,e.SpriteMaterial=to,e.SrcAlphaFactor=L,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=T,e.StaticCopyUsage=35046,e.StaticDrawUsage=ze,e.StaticReadUsage=35045,e.StereoCamera=nc,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=kA,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TWEEN=Ku,e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=rs,e.TetrahedronGeometry=is,e.TextBufferGeometry=Xs,e.TextGeometry=Ws,e.Texture=st,e.TextureLoader=KA,e.TorusBufferGeometry=ms,e.TorusGeometry=ps,e.TorusKnotBufferGeometry=fs,e.TorusKnotGeometry=ds,e.TransFormMode=$p,e.TransformControls=qp,e.Triangle=Mn,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=us,e.TubeGeometry=hs,e.UVMapping=P,e.Uint16Attribute=function(e,t){return console.warn("Uint16Attribute has been removed. Use new Uint16BufferAttribute() instead."),new Qn(e,t)},e.Uint16BufferAttribute=Qn,e.Uint32Attribute=function(e,t){return console.warn("Uint32Attribute has been removed. Use new Uint32BufferAttribute() instead."),new zn(e,t)},e.Uint32BufferAttribute=zn,e.Uint8Attribute=function(e,t){return console.warn("Uint8Attribute has been removed. Use new Uint8BufferAttribute() instead."),new On(e,t)},e.Uint8BufferAttribute=On,e.Uint8ClampedAttribute=function(e,t){return console.warn("Uint8ClampedAttribute has been removed. Use new Uint8ClampedBufferAttribute() instead."),new Nn(e,t)},e.Uint8ClampedBufferAttribute=Nn,e.Uncharted2ToneMapping=3,e.Uniform=_c,e.UniformsLib=ji,e.UniformsUtils=Ui,e.UnsignedByteType=Y,e.UnsignedInt248Type=ie,e.UnsignedIntType=J,e.UnsignedShort4444Type=ee,e.UnsignedShort5551Type=te,e.UnsignedShort565Type=ne,e.UnsignedShortType=K,e.VSMShadowMap=3,e.Vector2=Je,e.Vector3=tt,e.Vector4=At,e.VectorKeyframeTrack=DA,e.Vertex=function(e,t,n){return console.warn("Vertex has been removed. Use Vector3 instead."),new tt(e,t,n)},e.VertexColors=2,e.VertexNormalsHelper=Yc,e.VideoTexture=ii,e.Viewer=zg,e.WebGLMultisampleRenderTarget=ct,e.WebGLRenderTarget=lt,e.WebGLRenderTargetCube=Ni,e.WebGLRenderer=Ka,e.WebGLUtils=Na,e.WireframeGeometry=qo,e.WireframeHelper=function(e,t){return console.warn("WireframeHelper has been removed. Use WireframeGeometry instead."),new Go(new qo(e.geometry),new Fo({color:void 0!==t?t:16777215}))},e.WorkerBufferAttribute=Wn,e.WrapAroundEnding=Ue,e.XHRLoader=function(e){return console.warn("XHRLoader has been renamed to FileLoader."),new VA(e)},e.ZeroCurvatureEnding=Fe,e.ZeroFactor=E,e.ZeroSlopeEnding=_e,e.ZeroStencilOp=0,e.sRGBEncoding=ke,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
